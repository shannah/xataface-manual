<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.12">
<meta name="author" content="Steve Hannah">
<title>Xataface Definitive Guide</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:50%;border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" type="text/css" href="css/book.css"/>
<script src="js/book.js"></script>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Xataface Definitive Guide</h1>
<div class="details">
<span id="author" class="author">Steve Hannah</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_preface">Preface</a></li>
<li><a href="#_pre_history_of_xataface">Pre-history of Xataface</a>
<ul class="sectlevel2">
<li><a href="#_the_vision">The Vision</a></li>
</ul>
</li>
<li><a href="#_the_evolution_of_xataface">The Evolution of Xataface</a>
<ul class="sectlevel2">
<li><a href="#_influence_of_plone_on_xataface">Influence of Plone on Xataface</a></li>
<li><a href="#_influence_of_filemaker_on_xataface">Influence of FileMaker on Xataface</a></li>
<li><a href="#_outgrowing_the_mould">Outgrowing the Mould</a></li>
</ul>
</li>
<li><a href="#_getting_started">Getting Started</a></li>
<li><a href="#_introduction">Introduction</a>
<ul class="sectlevel2">
<li><a href="#_requirements">Requirements</a></li>
<li><a href="#_license">License</a></li>
<li><a href="#_development_procedures">Development Procedures</a></li>
<li><a href="#_why_use_xataface">Why Use Xataface?</a></li>
</ul>
</li>
<li><a href="#_xataface_installation">Xataface Installation</a>
<ul class="sectlevel2">
<li><a href="#_prerequisites">Prerequisites</a></li>
<li><a href="#_installation_using_the_xataface_cli">Installation using the Xataface CLI</a></li>
</ul>
</li>
<li><a href="#_creating_your_first_xataface_app">Creating your first Xataface app</a>
<ul class="sectlevel2">
<li><a href="#_creating_a_new_table">Creating A New Table</a></li>
<li><a href="#_development_environment">Development Environment</a></li>
<li><a href="#_changing_field_labels">Changing Field Labels</a></li>
</ul>
</li>
<li><a href="#_a_more_complex_example_faculty_of_widgetry_app">A More Complex Example: Faculty of Widgetry App</a></li>
<li><a href="#_sorting_and_filtering">Sorting and Filtering</a></li>
<li><a href="#_sorting_results">Sorting Results</a>
<ul class="sectlevel2">
<li><a href="#_sort_configuration">Sort Configuration</a></li>
</ul>
</li>
<li><a href="#_filtering_results">Filtering Results</a>
<ul class="sectlevel2">
<li><a href="#filter_types">Filter Types</a></li>
<li><a href="#_filters_configuration">Filters Configuration</a></li>
</ul>
</li>
<li><a href="#_exporting_data">Exporting Data</a></li>
<li><a href="#rss-feeds">RSS Feeds</a>
<ul class="sectlevel2">
<li><a href="#_configuring_rss_feeds">Configuring RSS Feeds</a></li>
</ul>
</li>
<li><a href="#_recipes">Recipes</a></li>
<li><a href="#actions">Actions and Menus</a>
<ul class="sectlevel2">
<li><a href="#material-icons">Using Material Icons</a></li>
<li><a href="#javascript-action">Triggering Javascript Function with Action</a></li>
<li><a href="#customize-action-label">Customizing Action Labels</a></li>
<li><a href="#tables-navigation-menu">Customising Navigation Menu</a></li>
<li><a href="#ajax_actions">Action to Trigger AJAX Request</a></li>
<li><a href="#showing-progress-indicator">Showing a Progress Indicator</a></li>
</ul>
</li>
<li><a href="#relationships">Relationships</a>
<ul class="sectlevel2">
<li><a href="#default-related-sort">Setting Default Sort for Related Lists</a></li>
</ul>
</li>
<li><a href="#security">Security</a>
<ul class="sectlevel2">
<li><a href="#authentication">Authentication</a></li>
<li><a href="#user-registration">Allowing User Registration</a></li>
<li><a href="#email-login">Enabling Email Login</a></li>
<li><a href="#session-config">Session Configuration</a></li>
<li><a href="#auto-login">Auto-Login Support</a></li>
<li><a href="#oauth2">OAuth2 Authentication</a></li>
<li><a href="#api-authentication">API Authentication</a></li>
<li><a href="#relationship-permissions">Relationship Permissions</a></li>
</ul>
</li>
<li><a href="#theme_customization">Theme Customization</a>
<ul class="sectlevel2">
<li><a href="#changing-logo">Changing the Site Logo Image</a></li>
<li><a href="#alternative-logos">Responsive Logo Image</a></li>
<li><a href="#webp-logo">Using WebP Images for the Logo</a></li>
<li><a href="#adding-a-custom-stylesheet">Adding a Custom Stylesheet</a></li>
<li><a href="#changing-color-scheme">Changing the Color Scheme</a></li>
<li><a href="#user-specific-stylesheet">Using Preferences to Override Color Scheme</a></li>
<li><a href="#user-selected-color-scheme">Allowing Users to Choose Their Own Color Scheme</a></li>
<li><a href="#customize-favicon">Using a Custom favicon</a></li>
</ul>
</li>
<li><a href="#templates">Templates</a>
<ul class="sectlevel2">
<li><a href="#block-parameters">Passing Parameters to Blocks</a></li>
</ul>
</li>
<li><a href="#form_customization">Form Customization</a>
<ul class="sectlevel2">
<li><a href="#_multiple_tabs_in_forms">Multiple Tabs in Forms</a></li>
<li><a href="#_delegating_new_record_form_to_a_different_table">Delegating "New Record Form" to a Different Table</a></li>
<li><a href="#_using_ownerstamp_to_mark_record_ownership">Using <code>ownerstamp</code> to Mark Record Ownership</a></li>
<li><a href="#_redirecting_user_to_different_page_after_saving_record">Redirecting User to Different Page After Saving Record</a></li>
<li><a href="#recipe-auto-updating-field">Auto-Updating a Field When Other Fields are Changed</a></li>
<li><a href="#display-field-preview-using-ajax">Displaying Field Preview using AJAX</a></li>
<li><a href="#_disabling_client_side_validation">Disabling Client-side Validation</a></li>
<li><a href="#_setting_fixed_number_of_rows_in_the_grid_widget">Setting Fixed Number of Rows in the Grid Widget</a></li>
<li><a href="#field-actions">Adding Actions to Fields</a></li>
</ul>
</li>
<li><a href="#list_customization">List Customization</a>
<ul class="sectlevel2">
<li><a href="#_adding_option_to_filter_result_list">Adding Option to Filter Result LIst</a></li>
<li><a href="#_hiding_filter_counts">Hiding Filter Counts</a></li>
<li><a href="#_sorting_filter_results">Sorting Filter Results</a></li>
<li><a href="#row-css-classes">Adding CSS Classes to Rows</a></li>
<li><a href="#_adding_row_actions">Adding Row Actions</a></li>
<li><a href="#custom-row-action-styles">Customizing Row Action Styles</a></li>
<li><a href="#_adding_javascript_row_actions">Adding Javascript Row Actions</a></li>
<li><a href="#toggle-row-actions">Making Row Actions Toggleable</a></li>
<li><a href="#ajax-list-row-actions">Using AJAX To Modify Row Records</a></li>
<li><a href="#default-sort">Specifying Default Sorting</a></li>
<li><a href="#grid-view">Rendering List View as a Grid</a></li>
<li><a href="#list-style-mobile">Using Mobile List Template on Desktop</a></li>
<li><a href="#row-style-external-link">Rendering Row as Link to External URL</a></li>
</ul>
</li>
<li><a href="#view_tab_customization"><em>View</em> Tab Customization</a>
<ul class="sectlevel2">
<li><a href="#_displaying_syntheticcalculated_field">Displaying Synthetic/Calculated Field</a></li>
</ul>
</li>
<li><a href="#searching">Searching</a>
<ul class="sectlevel2">
<li><a href="#_case_sensitive_searches">Case-Sensitive Searches</a></li>
<li><a href="#_explicitly_specifying_case_sensitivity_of_a_search">Explicitly Specifying Case-sensitivity of a Search</a></li>
<li><a href="#_making_columns_not_searchable">Making Columns Not-Searchable</a></li>
</ul>
</li>
<li><a href="#file_uploads">File Uploads</a>
<ul class="sectlevel2">
<li><a href="#_specifying_content_disposition_of_file_download">Specifying Content Disposition of File Download</a></li>
<li><a href="#generating-thumbnails">Generating Thumbnails</a></li>
<li><a href="#_storing_files_on_amazon_s3">Storing Files on Amazon S3</a></li>
</ul>
</li>
<li><a href="#http_request_handling">HTTP Request Handling</a>
<ul class="sectlevel2">
<li><a href="#_specifying_a_default_action">Specifying a Default Action</a></li>
<li><a href="#_using_different_default_action_depending_on_table">Using Different Default Action Depending on Table</a></li>
<li><a href="#_specifying_default_query_parameters_for_default_actions">Specifying Default Query Parameters for Default Actions</a></li>
<li><a href="#_showing_the_edit_tab_by_default_for_record_details">Showing the "Edit" Tab By Default for Record Details</a></li>
<li><a href="#_setting_default_query_parameters_for_the_browse_action">Setting Default Query Parameters for the <code>browse</code> Action</a></li>
<li><a href="#_setting_a_related_records_tab_as_the_default_browse_action">Setting a Related Records Tab as the Default Browse Action</a></li>
</ul>
</li>
<li><a href="#tables_views_queries">Tables, Views, and Queries</a>
<ul class="sectlevel2">
<li><a href="#_accessing_an_sql_query_like_a_table">Accessing an SQL query like a Table</a></li>
</ul>
</li>
<li><a href="#deployment-and-administration">Deployment and Administration</a>
<ul class="sectlevel2">
<li><a href="#whereis-phpini">Where is my php.ini file?</a></li>
<li><a href="#_using_different_config_files_on_different_servers">Using Different Config Files on Different Servers</a></li>
<li><a href="#_application_versioning_and_synchronization">Application Versioning and Synchronization</a></li>
</ul>
</li>
<li><a href="#_user_interface_and_themes">User Interface and Themes</a></li>
<li><a href="#responsive-ui">Responsive UI</a>
<ul class="sectlevel2">
<li><a href="#_switching_between_mobile_and_desktop_theme">Switching Between Mobile And Desktop Theme</a></li>
<li><a href="#_mobile_header_and_footer">Mobile Header and Footer</a></li>
<li><a href="#_table_tabs">Table Tabs</a></li>
<li><a href="#_fab_floating_action_button">FAB (Floating Action Button)</a></li>
<li><a href="#_customizing_the_list_view">Customizing the List View</a></li>
</ul>
</li>
<li><a href="#_appendix_1_configuration_directives">Appendix 1: Configuration Directives</a></li>
<li><a href="#confini-directives">Conf.ini Directives</a>
<ul class="sectlevel2">
<li><a href="#_stand_alone_attributes">Stand-alone Attributes</a></li>
</ul>
</li>
<li><a href="#fieldsini-directives">Fields.ini Directives</a></li>
<li><a href="#relationshipsini-directives">Relationships.ini Directives</a>
<ul class="sectlevel2">
<li><a href="#_overview_3">Overview</a></li>
<li><a href="#_field_directives_2">Field Directives</a></li>
<li><a href="#_glance_lists">Glance Lists</a></li>
<li><a href="#_relationship_permissions">Relationship Permissions</a></li>
</ul>
</li>
<li><a href="#actionsini-directives">Actions.ini Directives</a>
<ul class="sectlevel2">
<li><a href="#_syntax_2">Syntax</a></li>
<li><a href="#_directives">Directives</a></li>
<li><a href="#_php_expression_context">PHP Expression Context</a></li>
<li><a href="#action-categories">Action Categories</a></li>
</ul>
</li>
<li><a href="#preference-directives">Preferences Directives</a></li>
<li><a href="#permissionsini-directives">Permissions.ini Directives</a>
<ul class="sectlevel2">
<li><a href="#_defining_permissions">Defining Permissions</a></li>
<li><a href="#_limiting_access_to_actions_based_on_permissions">Limiting Access to Actions based on Permissions</a></li>
<li><a href="#_defining_who_gets_which_permissions">Defining Who Get&#8217;s Which Permissions</a></li>
<li><a href="#_roles">Roles</a></li>
<li><a href="#_xataface_core_permissions_roles">Xataface Core Permissions &amp; Roles</a></li>
</ul>
</li>
<li><a href="#appendix-rss-config">RSS Configuration Directives</a>
<ul class="sectlevel2">
<li><a href="#rss-getfeed"><code>getFeed()</code> Delegate Method</a></li>
<li><a href="#rss-getfeeditem"><code>getFeedItem()</code> Delegate Method</a></li>
</ul>
</li>
<li><a href="#_thumbnail_handling">Thumbnail Handling</a>
<ul class="sectlevel2">
<li><a href="#_how_it_works">How it works</a></li>
<li><a href="#_php_api">PHP API</a></li>
</ul>
</li>
<li><a href="#_appendix_2_delegate_class_methods">Appendix 2: Delegate Class Methods</a></li>
<li><a href="#_table_delegate_class">Table Delegate Class</a>
<ul class="sectlevel2">
<li><a href="#_relationships_methods">Relationships Methods</a></li>
</ul>
</li>
<li><a href="#_appendix_3_javascript_environment">Appendix 3: Javascript Environment</a></li>
<li><a href="#_javascript_components">Javascript Components</a>
<ul class="sectlevel2">
<li><a href="#_window_xataface">window.xataface</a></li>
<li><a href="#action-sheet">xataface.ActionSheet</a></li>
<li><a href="#showInfiniteProgress">xataface.showInfiniteProgress()</a></li>
<li><a href="#hideInfiniteProgress">xataface.hideInfiniteProgress()</a></li>
<li><a href="#_xataface_infinitescroll">xataface.InfiniteScroll</a></li>
<li><a href="#recordbrowser">xataface.RecordBrowser</a></li>
<li><a href="#sheet">xataface.Sheet</a></li>
</ul>
</li>
<li><a href="#_appendix_4_url_conventions">Appendix 4: URL Conventions</a></li>
<li><a href="#_appendix_performance">Appendix: Performance</a></li>
<li><a href="#scaler">Scaler Module</a></li>
<li><a href="#output-cache">Output Cache</a>
<ul class="sectlevel2">
<li><a href="#_features">Features</a></li>
<li><a href="#_how_it_works_2">How it works?</a></li>
<li><a href="#_faq">FAQ</a></li>
</ul>
</li>
<li><a href="#opcache">PHP Opcache</a>
<ul class="sectlevel2">
<li><a href="#_getting_more_out_of_opcache">Getting More Out of Opcache</a></li>
<li><a href="#_refreshing_the_opcache">Refreshing the Opcache</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_preface">Preface</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_pre_history_of_xataface">Pre-history of Xataface</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Xataface was first released in 2005.  I had just been hired as a web services developer in the Faculty of Applied Sciences at Simon Fraser University, and I was inheriting resposibility for the maintenance and development of a relatively large content management system that had been built in-house, originally in PERL, and later ported to PHP.</p>
</div>
<div class="paragraph">
<p>This system, named "Group Content Management System", or GCMS for short, was used to manage information about all of the research groups in the faculty.  It included profiles for faculty members, grad students, labs, research groups, publications and projects.  It included administrative back-ends for administrators to update all of these profiles, and it served as a platform to publish web sites for faculty members and research groups.</p>
</div>
<div class="paragraph">
<p>The MySQL database, on which it was built, included dozens of tables, and a fairly complex set of relationships.  The PHP code for the application suffered from too many hands in the kitchen, with no central API to manage business rules.  Each form included custom PHP code and SQL commands to handle layout and validation.  It was not "a pleasure" to work on.</p>
</div>
<div class="paragraph">
<p>At my previous job, in the Faculty of Education,  I had built many similar systems, so I had reached the point where I was a little bored of the tedium involved in creating CRUD applications, as they were known.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
CRUD stands for "Create Read Update Delete", and it refers to a class of applications where the primary functions involve creating, reading, updating, and deleting records in a database.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the Faculty of Education we had used FileMaker extensively for our in-house databases.  It made the creation and maintenance of complex databases remarkably simple, and it provided an instant administrative user interface that was friendly for the clerical staff to maintain the database content themselves. I always felt limited by FileMaker though.</p>
</div>
<div class="paragraph">
<p>As long as you&#8217;re playing inside FileMaker&#8217;s box, it was great.  But if we wanted to integrate these databases into our web site, things got tricky.  At the time, you needed FileMaker server, and the web connector, which both carried expensive licenses.  We did have these products in the Faculty, and we did use the web connector to publish a few databases on the web, but it wasn&#8217;t performant and you couldn&#8217;t just use SQL to query the database.</p>
</div>
<div class="paragraph">
<p>We used <a href="https://github.com/yodarunamok/fxphp">FX.php</a> for interacting with the FileMaker database, which provided quite a nice abstraction layer, but we couldn&#8217;t benefit from FileMaker&#8217;s UI creation tools at all.  We were building our UIs from scratch, essentially, writing our own UI, validation, and queries.  In fact, I created a predecessor to Xataface that was built on FX.php, which generated the UI automatically using some config files, much the way that we do in Xataface.  This worked, pretty well, but, the reliance on Filemaker made our solutions less portable and slower than I would have liked. At this point, we weren&#8217;t benefiting from FileMaker&#8217;s UI development strengths at all since I was building the UI entirely in PHP, so I figured, why not try to do the same thing with a free, fast, ubiquitous database like MySQL.</p>
</div>
<div class="paragraph">
<p>And so, Xataface was born</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Originally Xataface was called "Dataface", but a Texas computer company named "Dataface" took exception to our name, and sent me a cease and desist letter.  So I changed the name to Xataface
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_the_vision">The Vision</h3>
<div class="paragraph">
<p>Most applications that I was building for the faculty had two parts:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>The "public" front-end</strong>, which was usually integrated into a public website.  This might be the faculty profiles section of the website where faculty members' publications are displayed.  These pages would be generated using PHP, and pulling data directly from the database.</p>
</li>
<li>
<p><strong>The administrative back-end</strong>.  This is the interface that allows the clerical staff to update the faculty profiles in the database.  Some applications will have a single user managing all of the content in the database, while others will allow multiple users to update different content.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The public front-end would usually be created using HTML, CSS, and standard PHP, to fetch data from the database and display it. Quite often, the website would already have a template, so it would just be a matter of fetching data from the database and rendering it inside the site&#8217;s template.  For this portion of the application development, I was happy with the state of existing tools - i.e. vanilla PHP and MySQL to get the job done.  Each project was sufficiently different as to not benefit from a standardized framework.</p>
</div>
<div class="paragraph">
<p>For the administrative back-end, however, the work was tedious.  You needed to write forms to add new, edit, view, and delete records from each table.  The user interface needed to be friendly for non-technical users, since it would be used by regular folks - secretaries, faculty members, receptionists, etc..  You couldn&#8217;t just set up a database administration app like PHPMyAdmin.</p>
</div>
<div class="paragraph">
<p>It seemed to me that, for this type of application, the database schema already included all of the information needed to generate the user interface.  You could look at a table and see exactly what the form would need to look like for editing records on it.  VARCHAR fields should use a text field, TEXT fields should use a textarea, DATE fields should use a date or calendar widget etc&#8230;&#8203;  If we needed to provide additional configuration, such as explicitly choosing a different widget, or adding validation rules, the developer could create config files using a logical naming convention.</p>
</div>
<div class="paragraph">
<p>The first goal with Xataface was to see how much of the administrative back-end requirements could be achieved using only the database schema.  No configuration files, or custom PHP.</p>
</div>
<div class="paragraph">
<p>Of course, the first goal cannot be achieved 100%, so, the second goal of Xataface was, to the extent that the first goal cannot be achieved, how much of the administrative back-end requirements could be achieved using only the database schema, and some simple, human-friendly configuration settings.</p>
</div>
<div class="paragraph">
<p>Unfortunately, the second goal cannot usually be achieved 100%, so, the third goal of Xataface was, to the extent that the second goal cannot be achieved, make sure that the administrative back-end requirements can be fulfilled using as little custom PHP as possible.</p>
</div>
<div class="paragraph">
<p>The third goal can, in general, always be achieved.</p>
</div>
<div class="paragraph">
<p>After each application I develop using Xataface, I do a post-mortem to identify:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Features that were implemented PHP which can be achieved using configuration directives. I.e. moving features from the 3rd goal, into the 2nd goal. For example, initially, validation had to be handled using a PHP function, but eventually I added configuration directives for validation such as <code>validators:required</code> and <code>validators:lettersonly</code>.</p>
</li>
<li>
<p>Features that were implemented using configuration directives which can be achieved using heuristics using only the database schema.  I.e. moving features from the 2nd goal, into the 1st goal.  For example, initially fields marked <code>NON NULL</code> in the database can default to use the <code>validators:required</code> option, so that the user is forced to provide input.</p>
</li>
<li>
<p>Features that were implemented in PHP which could possibly be packaged as a reusable module.  I.e. reducing the complexity of PHP required to achieve the third goal.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The ultimate goal is to move <strong>everything</strong> into the first goal, but this will likely never fully occur as there will always be some features that can&#8217;t be automatically derived from the database schema - though with the advent of machine learning, I suppose anything is possible.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p><strong>NO CODE GENERATION</strong></p>
</div>
<div class="paragraph">
<p>I decided early on, that I didn&#8217;t want to use code generation.  Most other CRUD frameworks I had experienced used code generation to generate a basic app which would then be customized by the developer.   Code-generation sounds great at first, but it quickly becomes unmaintainable.  The first app requirements are almost never the final requirements. If you generate PHP code for an app based on the database schema, and then you need to add a column or two, you&#8217;ll need to regenerate the code - which will cause you to lose any modifications you made in the mean time.</p>
</div>
<div class="paragraph">
<p>Xataface, instead uses conventions and configuration.  If you add a field to the database, you don&#8217;t need to regenerate anything.  Xataface will automatically include that field in the app from then on.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_evolution_of_xataface">The Evolution of Xataface</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The first project that Xataface was applied to was the Group content management system (GCMS) of the Faculty of Applied Sciences.  This was the system that was used to manage the websites for faculty members, research groups, and publications.  The database was already built, and there was an existing administrative back-end that was, in my opinion, hard to work with.  I replaced this administrative back-end entirely using Xataface.  The application itself (not counting the code inside Xataface), contained almost no PHP code, and handful of configuration files.  The underlying database was left untouched.  The result was an application that was orders of magnitude easier to maintain, and, at the same time yielded a better user experience.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-280320-091647.625.png" alt="Image 280320 091647.625">
</div>
<div class="title">Figure 1. The original Dataface "List" view. This view showed the results of a query in a table.</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-280320-091749.102.png" alt="Image 280320 091749.102">
</div>
<div class="title">Figure 2. The "Details" view in the GCMS application.  This view allowed the user to edit a single record. Originally there was no "view" tab (read only details view), only a "main" tab that allowed editing a record.  Later on, I would add a "View" and "Edit" tab in the "Details" view.</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-280320-092637.616.png" alt="Image 280320 092637.616">
</div>
<div class="title">Figure 3. The "Find" tab in the GCMS application.  The find tab allowed searching on all fields in the table.</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-280320-092823.655.png" alt="Image 280320 092823.655">
</div>
<div class="title">Figure 4. The "Publications" tab in the GCMS application.  This is a "relationship" tab, as it shows only the publications related to a particular profile.  One of the key innovations of Xataface was its ability to define relationships, and have the application UI take advantage of these by providing <strong>add</strong>, <strong>remove</strong>, <strong>view</strong>, and <strong>search</strong> capabilities on those relationships.</div>
</div>
<div class="paragraph">
<p>After unrolling this "rewrite" of GCMS, I decided to release Xataface (then Dataface) to the world as an open source project.  I created a project on SourceForge, set up a website for it, wrote a "Getting Started" tutorial, and then returned to my day job, developing web applications or the faculty.</p>
</div>
<div class="sect2">
<h3 id="_influence_of_plone_on_xataface">Influence of Plone on Xataface</h3>
<div class="paragraph">
<p>At the time that I was developing the first version of Dataface, we were using the  <a href="https://www.plone.org">Plone</a> content management system for the faculty&#8217;s website.  If you&#8217;re familiar with Plone (circa 2005) you&#8217;ll recognize the tabs, lists, and navigation menus from the GCMS screenshots.  That&#8217;s because I used the plone stylesheet as a basis for Xataface&#8217;s styles.  I really liked the way Plone looked, and the stylesheet had many of the UI elements that I needed for Xataface.  I needed tabs - Plone had nice looking tabs.  I needed tabular lists.  Plone has nice looking sortable lists.  I needed navigation menus.  Etc&#8230;&#8203;  Some of these elements have persisted to present day.  Xataface 2.0 included a new default theme, "g2", that introduced a totally new stylesheet, but developers could still "opt out" of the "g2" theme and use the original plone theme.
Xataface 3.0 finally eliminates the original theme (nearly) entirely, but if you dig you can likely still find some elements of that original Plone theme.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-280320-101804.269.png" alt="Image 280320 101804.269">
</div>
<div class="title">Figure 5. Plone content management system circa 2005.  The initial release of Xataface used the Plone stylesheet, and many aspects of the design can still be found in the Xataface of today, if you look closely.</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>From Wikipedia:</p>
</div>
<div class="paragraph">
<p>Plone is a free and open source content management system built on top of the Zope application server. Plone is positioned as an "Enterprise CMS" and is commonly used for intranets and as part of the web presence of large organizations. High-profile public sector users include the U.S. Federal Bureau of Investigation, Brazilian Government, United Nations, City of Bern (Switzerland), New South Wales Government (Australia), and European Environment Agency.[2] Plone&#8217;s proponents cite its security track record[3] and its accessibility[4] as reasons to choose Plone.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Aside from the stylesheet, Plone also inspired some other aspects of Xataface&#8217;s design.  In particular, Xataface&#8217;s use of actions (e.g. the actions.ini file) to inject menus, buttons, and functionality into the UI are directly pulled from Plone.</p>
</div>
</div>
<div class="sect2">
<h3 id="_influence_of_filemaker_on_xataface">Influence of FileMaker on Xataface</h3>
<div class="paragraph">
<p>I&#8217;ve already discussed the fact that FileMaker was a key inspiration for Xataface.  I liked the way that FileMaker allowed mere mortals to both create and manage relatively complex databases. It was impressive that an office assistant,  with no programming skills whatsoever, could build a fully-functional database application with a nice user interface in a few hours.  To do the same thing with PHP and MySQL would take a software developer weeks, and it likely still would have been missing features that the FileMaker app provides out of the box.</p>
</div>
<div class="paragraph">
<p>The Xataface "Details", "Find", and "List" tabs were an answer to FileMaker&#8217;s "Details", "List" and "Find" modes.</p>
</div>
<div class="paragraph">
<p>The one mode that Xataface didn&#8217;t provide an answer for is the "Layout" mode, which is the mode of FileMaker that allows users to design their own forms using a drag and drop palette of widgets and a canvas.  Xataface, instead, just used HTML for its views.</p>
</div>
<div class="paragraph">
<p>One day, I&#8217;d like to add such a tool to Xataface, but, frankly, it&#8217;s difficult to do well, and time is almost always better spent extending Xataface&#8217;s other features.</p>
</div>
</div>
<div class="sect2">
<h3 id="_outgrowing_the_mould">Outgrowing the Mould</h3>
<div class="paragraph">
<p>At the beginning, Xataface was just intended to be an open source alternative to FileMaker.  It didn&#8217;t take long, however to start growing in its own direction.  Today it has become a full-featured platform on which arbitrary data-driven web applications can be built.</p>
</div>
<div class="paragraph">
<p>Early on, I added support for modules, custom actions, and pluggable authentication.  These foundational elements enabled grown into application types not originally envisioned.</p>
</div>
<div class="paragraph">
<p>Xataface was being downloaded thousands of times per week from SourceForge, and developers were contacting about a diverse range of applications that they were building.  Over the next few years, I used Xataface as the foundation for many side projects including:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>An auction application, <a href="https://github.com/shannah/webauction">WebAuction</a>, which has hosted hundreds of online auctions for non-profit organizations ranging from the United Way, to the SFU Plant Sale.</p>
<div class="imageblock">
<div class="content">
<img src="images/Image-290320-090051.779.png" alt="Image 290320 090051.779">
</div>
<div class="title">Figure 6. WebAuction used to host the annual SFU platsale was written with Xataface.</div>
</div>
</li>
<li>
<p>A church library application, LibrarianDB,  for managing the books in a church library.</p>
<div class="imageblock">
<div class="content">
<img src="images/Image-290320-090701.286.png" alt="Image 290320 090701.286">
</div>
<div class="title">Figure 7. LibrarianDB, developed with Xataface, was developed to help manage books in a church library</div>
</div>
</li>
<li>
<p>A general content management system for a website ("Little Content Management System" or LCMS).</p>
</li>
<li>
<p>A registration system for people to apply for sessional instructor, and TA positions in the faculty.</p>
</li>
<li>
<p>Survey Builder, an application for creating and hosting surveys online.</p>
<div class="imageblock">
<div class="content">
<img src="images/Image-290320-091221.806.png" alt="Image 290320 091221.806">
</div>
<div class="title">Figure 8. A survey built and hosted by SurveyBuilder.</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-290320-091301.571.png" alt="Image 290320 091301.571">
</div>
<div class="title">Figure 9. Administrative back-end for SurveyBuilder.  This uses the g2 theme.</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-290320-091403.237.png" alt="Image 290320 091403.237">
</div>
<div class="title">Figure 10. Editing the survey content for SurveyBuilder in the Xataface back-end.  This used the CKeditor module for WYSIWYG HTML editing.</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Over the years, Xataface has added countless features that improve the developer and user experience alike. I have enjoyed building it, and I sincerely hope that you enjoy using it to build your own creations.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_started">Getting Started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section provides the tools to get you bootstrapped in Xataface.  In general, you can read the sections of this book in any order, but I recommend you at least start with this section as it will give you the vocabulary and experience to understand the content in all other sections.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Xataface is a simple framework for building data-driven web applications in PHP and MySQL. This section introduces some of the concepts and applications of Dataface.
To fully understand what Xataface is, we must first define a few key terms:</p>
</div>
<div class="paragraph">
<p><strong>Framework</strong> - A set of software routines that provide a foundation structure for an application. Frameworks take the tedium out of writing an application from scratch. (From Answers.com)</p>
</div>
<div class="paragraph">
<p><strong>Data-driven design</strong> - Designing an application around the data that it will store.</p>
</div>
<div class="paragraph">
<p>Xataface is a Framework in the sense that it is a set of classes and libraries that take the tedium out of writing web applications. It provides a simple web interface to a MySQL database enabling users to update, delete, and find data in the underlying database. The interface is targeted at secretaries and end-users as opposed to database administrators.</p>
</div>
<div class="paragraph">
<p>Xataface enables data-driven design because it allows developers to develop web sites by first designing the database that will be used to store the data on the website, and then design the pages used to display the data. The developer can focus on the data because he or she does not have to worry about having to build forms to update the data. If the requirements of the application change, the developer can simply add a field to the database table and all associated web forms will be updated automatically (because they are all dynamically generated using the database schema).</p>
</div>
<div class="sect2">
<h3 id="_requirements">Requirements</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>PHP &gt;= 4.3 (for Xataface 1.1.x and lower);  PHP &gt;= 5 for Xataface 1.2 and higher</p>
</li>
<li>
<p>MySQL &gt;= 3.2.3  (Some features require 4.1 or higher).</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_license">License</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>GPLv2</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_development_procedures">Development Procedures</h3>
<div class="paragraph">
<p>Identify the data that will need to be stored for a web site.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-290320-093727.459.png" alt="Image 290320 093727.459">
</div>
<div class="title">Figure 11. ERD diagram describing a simple database with two tables, "Program" and "Courses", with a relationship between them.</div>
</div>
<div class="paragraph">
<p>Design the database using your favorite database administration program (e.g., PHPMyAdmin)</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-290320-093844.702.png" alt="Image 290320 093844.702">
</div>
<div class="title">Figure 12. PHPMyAdmin is a popular tool for creating databases on MySQL/MariaDB.  You can use any tool you like for creating your database, or no tool at all (i.e. raw SQL).</div>
</div>
<div class="paragraph">
<p>Tell Xataface some DB connection info, and voila! You have an application:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-290320-094309.877.png" alt="Image 290320 094309.877">
</div>
<div class="title">Figure 13. Bare-bones Xataface application out of the box with no customizations.</div>
</div>
</div>
<div class="sect2">
<h3 id="_why_use_xataface">Why Use Xataface?</h3>
<div class="paragraph">
<p>Some simple examples similar to those that are frequently encountered by web developers, and how dataface can be used to acheive a solution.</p>
</div>
<div class="paragraph">
<p>As a web services developer would frequently getting requests to build websites that were manageable by the site owner.  Most of these requests also specify certain types of content that must be stored on the website, and much of this content needs to be n-ary (i.e., there will be multiple instances of each type of content).  Let me give you an example.</p>
</div>
<div class="sect3">
<h4 id="_example_1_website_for_faculty_of_widgetry">Example 1: Website for Faculty of Widgetry</h4>
<div class="paragraph">
<p>The Faculty of Widgetry needs a website to publish information about its undergraduate programs.  It is important for them to be able to publish admission requirements, and program overviews for each program.  It is also important to have course outlines and timetables for each course. The Faculty of Widgetry has 12 undergraduate programs and over 100 courses offered.</p>
</div>
<div class="sect4">
<h5 id="_solution_1_static_html">Solution 1: Static HTML</h5>
<div class="paragraph">
<p>To build this web site using only static HTML pages using Dreamweaver or some other HTML editor would require at least 112 pages to be created (one for each course and program).  However, once we recognize that there are only 2 types of pages required (one for courses and one for programs), we can reduce the task down to creating 2 templates and filling in the main content for each program and course individually.  Most HTML editors have some templating ability so you can make changes to the template and have the changes propogated to all pages that use that template with the click of a button.</p>
</div>
<div class="paragraph">
<p>This works great, but courses are added frequently, and outlines are changed.  Do you really want to receive requests to update all of these pages every time there are changes to make?  (If your answer is 'yes', then you probably won&#8217;t be interested in reading the rest of this tutorial).  Whether the Dean of the faculty knows it or not, it is very important for the program assistants to be able to update these web pages on their own.  To acheive these goals you can:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install Dreamweaver on the Program Assistants' computers, teach them how to use it, and allow them to perform updates.</p>
</li>
<li>
<p>Install Contribute, which is a scaled down version of Dreamweaver to make it easier for the Program Assistants to edit the content.</p>
</li>
<li>
<p>Use another solution that is equivalent to one of the above 2 solutions.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Installing Dreamweaver for each Program Assistant is a little overkill, and since it has the ability to do much more than just update content.  In addition,  Dreamweaver is really a developer&#8217;s tool - not a secretary&#8217;s tool, so it can be difficult to learn at first.  The best reason NOT to install Dreamweaver on the Program Assistant&#8217;s computer, however, is that it enables him/her to muck things up by accident (believe me, I has happened to me more times than I care to count).</p>
</div>
<div class="paragraph">
<p>Admittedly, Contribute is a viable option as it controls access to only certain portions of web pages to be edited, and it is targetted at secretaries (not developers) so it is easier to use.  In fact, given the requirements for this web site (as stated above), this is a perfectly good solution.  However you better hope that none of the following requirements are added:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Each program web page should contain an up-to-date list of all of the courses required for the program, along with a link to the course outline for that course.</p>
</li>
<li>
<p>Course outlines should be available in PDF format as well as HTML format.</p>
</li>
<li>
<p>An index page showing all of the courses available should be added.  This page must allow courses to be organized by program, course subject, or course number.</p>
</li>
<li>
<p>Any other requirement that would have information formatted in more than one way.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If any of these requirements are likely to be added (EVER) then you would be well-advised to look into solutions that  use a database back-end.</p>
</div>
</div>
<div class="sect4">
<h5 id="_solution_2_use_a_content_management_system_cms">Solution 2: Use a Content Management System (CMS)</h5>
<div class="paragraph">
<p>There are hundreds of content management systems available that will allow you to store and update content through the web (TTW).  Some of them even have an assortment of add-ons that will allow you to store more specific types of information.  Some good CMS&#8217;s include Plone, Drupal, and Xoops.  Suppose we want to develop the Faculty of Widgetry website using one of these CMS&#8217;s.  Any good CMS will allow you to create and edit HTML documents easily (without having to write any custom products).  However, it is often the case that our documents require the content to be structured.  For example, each program has some common data associated with it: Program Name, Admission Deadline, Program Description, Outline, Courses, etc&#8230;&#8203;  If we want to properly separate data from presentation, we would need to build a special content-type to store our programs.  Most CMS&#8217;s allow you to develop custom content-types using the underlying programming language and an API (Application Programming Interface).  Some API&#8217;s are easier to use than others and some are documented better than others.  The common element is that each has its own proprietary interface for writing these add-ons.</p>
</div>
<div class="paragraph">
<p>If you are using a CMS and you are proficient in the creation of add-on content-types, then you will be able to build the Faculty of Widgetry website without great difficulty.  However there are a number of reasons why you may choose NOT to use a CMS:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Steep learning curve: Depending on the CMS it can be very time consuming and difficult to learn how to use and modify the CMS to suit you purposes.</p>
</li>
<li>
<p>It is over-kill: Most CMS&#8217;s are filled with features and modules that you will never need.  In fact it can even be a pain to turn them off if you don&#8217;t want them.</p>
</li>
<li>
<p>You can get tied into the CMS:  When you are using a CMS, you will start developing for the CMS.  With all of your content in the CMS it may be difficult to migrate to a different solution later on.  (The truth of this statement will vary for different CMS&#8217;s).  Choose your CMS carefully.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_solution_3_use_an_existing_application">Solution 3: Use an existing Application</h4>
<div class="paragraph">
<p>OK, OK, let&#8217;s not get too carried away with trying to develop the website until we have checked the market to see if someone else has already done it better.  Maybe there is already a PHP application that makes websites for Faculties easy.  I mean, I can&#8217;t be the first person that needed to build a website for a Faculty.  In fact if you do a search or go to Hotscripts.com, you will probably find a handful of applications or scripts that almost do what you need.  If you&#8217;re lucky, maybe you can find an application that does exactly what you need (but frankly, I&#8217;ve never been that lucky).  If you find one, maybe it&#8217;s worth taking it for a test drive.  But beware. Using a system that almost does what you need but is difficult to modify to your needs can be worse than building it by scratch.  Make sure that you are able to modify the application to suit your needs exactly.</p>
</div>
<div class="sect4">
<h5 id="_solution_4_use_php_and_mysql">Solution 4: Use PHP and MySQL</h5>
<div class="paragraph">
<p>If all we want to do is separate the data from the presentation and allow the Program Assistants to update data on the website, why not just design a MySQL database with the appropriate tables and fields to store the required data.  In our case we will need 2 tables:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">Programs
    Fields:
        ProgramID : int
        ProgramName : varchar
        ProgramDescription: text
        AdmissionDeadline: date
        Outline_HTML : text
        Outline_PDF : blob
Courses
    Fields:
        CourseID : int
        CourseSubject : varchar
        CourseTitle : varchar
        CourseNumber : int
        ProgramID : int
        CourseDescription : text
        Outline_HTML : text
        Outline_PDF : blob</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now it&#8217;s easy to create a few web pages that extract data from the database and displays it as HTML.  In fact if there is an existing page template that you can use for the header and footer, you can develop the entire Faculty website in under an hour (you just have to create 3 pages).</p>
</div>
<div class="paragraph">
<p><strong>Question</strong>: How will the Program Assistants update the information in the database?</p>
</div>
<div class="paragraph">
<p><strong>Answer</strong>: OK, let&#8217;s assume that you&#8217;re not going to teach them SQL and that a DB Admin tool will also be too difficult to learn.  Then you have to create HTML forms to update records in the database.</p>
</div>
<div class="paragraph">
<p>Ouch!  What was easy just became hard.  Making HTML forms is a real pain, because you have to validate the input, deal with file uploads, and also make sure that everything is stored to the database OK without losing any information.  Such a basic task, but it can be very difficult.  This is when it is time to use Xataface.</p>
</div>
</div>
<div class="sect4">
<h5 id="_solution_5_use_xataface">Solution 5: Use Xataface</h5>
<div class="paragraph">
<p>OK, this isn&#8217;t really its own solution.  It is more like "Solution 4 Part II", because Xataface is intended to complement your custom application you built with solution 4, by providing an easy-to-use, configurable user interface that is targeted at secretaries and normal users (as opposed to database administrators).  A Xataface application takes only seconds to set up and it will provide you with a full user interface for your users to edit information in the database.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_xataface_installation">Xataface Installation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Over the years I have developed several different installation mechanisms for Xataface.  At the end of the day, installation only requires that you copy the <strong>xataface</strong> directory onto your web server.  To update it, you simply replace that directory with the new version.</p>
</div>
<div class="paragraph">
<p>Creating an application with Xataface, however, involves more than just <strong>installing</strong> Xataface.  You need to, at minimum create a config file with your database connection settings, and a 2-line PHP script (usually named "index.php") to serve as an entry point for your application.</p>
</div>
<div class="paragraph">
<p>And this all assumes that you already have a web server set up with PHP and MySQL, and that you&#8217;ve created a database for your application to use.</p>
</div>
<div class="paragraph">
<p>With version 3.0, Xataface now includes a command line (CLI) utilty to automate common tasks like creating new apps, generating delegate classes, enabling authentication, etc&#8230;&#8203;  This tutorial describes the installation and usage of this CLI script for creating and maintaining Xataface applications.  If you would prefer to do things manually, you can skip to the "Manual Installation" section.</p>
</div>
<div class="sect2">
<h3 id="_prerequisites">Prerequisites</h3>
<div class="paragraph">
<p>Before you install Xataface, you should have a PHP and MySQL installed. I recommend XAMPP</p>
</div>
</div>
<div class="sect2">
<h3 id="_installation_using_the_xataface_cli">Installation using the Xataface CLI</h3>
<div class="listingblock">
<div class="title">Paste the following into macOS Terminal or Linux shell prompt</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/shannah/install-xataface/master/install.sh)"</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This command will install Xataface at <code>~/xataface</code> (i.e. inside your home directory).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The output of this script will look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/shannah/install-xataface/master/install.sh)"
Cloning into 'xataface'...
remote: Enumerating objects: 180, done.
remote: Counting objects: 100% (180/180), done.
remote: Compressing objects: 100% (125/125), done.
remote: Total 12947 (delta 105), reused 110 (delta 50), pack-reused 12767
Receiving objects: 100% (12947/12947), 19.50 MiB | 11.95 MiB/s, done.
Resolving deltas: 100% (7814/7814), done.
Adding /Users/shannah/xataface/bin to your path in /Users/shannah/.bash_profile</code></pre>
</div>
</div>
<div class="paragraph">
<p>This installs the <code>xataface</code> CLI script at <code>~/xataface/bin/xataface</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_creating_your_first_xataface_app">Creating your first Xataface app</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that you have xataface installed, we can proceed to create our first app.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Please ensure that you have both <code>mysql</code> and <code>apachectl</code> in your PATH.  If you are using XAMPP for your server, this can be accomplished with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">export PATH=/Applications/XAMPP/xamppfiles/bin:$PATH</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Open a command prompt and enter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">xataface create hello-world</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output will be as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ xataface create hello-world
Create project at hello-world
Setting up scaffold at hello-world ...Done
Checking for PHPMyAdmin installation...Found.
Linking /Users/shannah/.xataface/phpmyadmin to hello-world/lib/phpmyadmin ...Done.
Copying xataface to hello-world/www/xataface ...Done.
Removing hello-world/www/xataface/site_skeleton ...Done.
Initializing database ...
Starting mysql server...Started Successfully
Bootstrapping database...Done
Stopping mysql server...Stopped
Done</code></pre>
</div>
</div>
<div class="paragraph">
<p>At this point, you should have a new directory named "hello-world", which contains our application&#8217;s directory structure.</p>
</div>
<div class="paragraph">
<p>We can launch our app by "cd"ing into our new "hello-world" directory and running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">xataface start</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will fire up MySQL and Apache with document root at "www" and the database stored in "data"</p>
</div>
<div class="paragraph">
<p>The console output will be something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">Starting apache on port 9090
No services added.
Starting MariaDB
PID FILE /Users/shannah/Vagrant/hello-world/bin/../data/Steves-MacBook-Pro-2.local.pid

Waiting for ready
kill -0 says wait some more...
.Waiting for ready
We are ready
 SUCCESS!
About to touch lock file /Users/shannah/Vagrant/hello-world/bin/../tmp/mysql
Exiting with return value 0
Did start mysql server
No services added.
Did start apache server</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, point your web browser to "http://localhost:9090"</p>
</div>
<div class="paragraph">
<p>You should see something like:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-210320-073817.755.png" alt="Image 210320 073817.755">
</div>
<div class="title">Figure 14. A vanilla Xataface application created with the "xataface create" command.</div>
</div>
<div class="paragraph">
<p>This database has only a single table named "test", which contains a single column named "test_field".  You can add new record by clicking "New Record".</p>
</div>
<div class="paragraph">
<p>You&#8217;ll see a "new record" form:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-210320-074221.388.png" alt="Image 210320 074221.388">
</div>
<div class="title">Figure 15. Xataface new record form for the default "test" table.</div>
</div>
<div class="paragraph">
<p>Enter "Hello World" into the test field and press "Save".</p>
</div>
<div class="paragraph">
<p>You should see a message saying "Record successfully saved".</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-210320-074350.524.png" alt="Image 210320 074350.524">
</div>
</div>
<div class="sect2">
<h3 id="_creating_a_new_table">Creating A New Table</h3>
<div class="paragraph">
<p>Xataface provides an installation of PHPMyAdmin to assist you in building a database for your application.  You can access PHPMyAdmin at the URL:  <code><a href="http://localhost:9090/phpmyadmin" class="bare">http://localhost:9090/phpmyadmin</a></code></p>
</div>
<div class="paragraph">
<p>Open a new browser tab with this URL, and you should see something like:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-210320-074835.666.png" alt="Image 210320 074835.666">
</div>
</div>
<div class="paragraph">
<p>The database for this app is named "hello-world", and it is listed in the left-hand menu for PHPMyAdmin.  Click on that node to expand, it, then select "New":</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-210320-075036.734.png" alt="Image 210320 075036.734">
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s add a table called notes, by filling in the new table form as follows:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-210320-075421.538.png" alt="Image 210320 075421.538">
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Be sure to check the "A/I" box for the "note_id" field so that it will be an auto increment field.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Press "Save" when done.</p>
</div>
<div class="paragraph">
<p>Now we want to tell Xataface to use this table in our application.  Open the <code>www/conf.ini.php</code> file in our app.  The contents will look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">;&lt;?php exit;
__include__=conf.db.ini.php

[_tables]
    test=test</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>[_tables]</code> section is used by Xataface to generate the top menu in your application.  Let&#8217;s tell it to use our new "notes" table by adding the following:</p>
</div>
<div class="listingblock">
<div class="title">The conf.ini.php file after adding the "notes" table to the list of tables for our app to use.</div>
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">;&lt;?php exit;
__include__=conf.db.ini.php

[_tables]
    test=test
	notes=Notes <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The left "notes" indicates the table name.  The right "Notes" indicates the label that should be used in our tables menu.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Save this file and reload the application in the web browser.</p>
</div>
<div class="paragraph">
<p>You should now see a "Notes" tab on the top.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-210320-075955.851.png" alt="Image 210320 075955.851">
</div>
</div>
<div class="paragraph">
<p>Click on this tab, then press "New Record" to see our form for adding records.  You should see something like:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-210320-080256.754.png" alt="Image 210320 080256.754">
</div>
</div>
<div class="paragraph">
<p>This form includes inputs for all of the columns in our table, except the "note_id" column.  This is because "note_id" is an auto-increment field and doesn&#8217;t require user input.</p>
</div>
<div class="paragraph">
<p>Each field uses a different type of widget according to the type of the underlying database column.  E.g. the "Title" field is a text field because it is a VARCHAR column.  The "note_content" field is a text area because it is a TEXT column, etc&#8230;&#8203;  You can override the widget that is used to edit any field very easily by editing the "fields.ini" file for the "notes" table, which we&#8217;ll do in the new section.</p>
</div>
<div class="paragraph">
<p>For now we will use this application as is while we explore the application interface.</p>
</div>
<div class="paragraph">
<p>Enter some dummy data into this form and press "Save".  Then press "New Record", and enter another new record.  Create 3 or 4 notes with different content so that we have something to play with.</p>
</div>
<div class="paragraph">
<p>Once you&#8217;ve entered a few notes, click on the "Notes" tab to return to the "List" view of the "notes" table.  My app looks like the following screenshot, as I&#8217;ve entered 3 notes:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-210320-081024.587.png" alt="Image 210320 081024.587">
</div>
</div>
<div class="sect3">
<h4 id="_filtering_the_list">Filtering the List</h4>
<div class="paragraph">
<p>Xataface provides a few different ways to filter the list view.  We can:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click on a column header to search by column content.</p>
</li>
<li>
<p>Enter a keyword search into the top right search box, which will look for matches in <strong>any</strong> column of the table.</p>
</li>
<li>
<p>We can do an advanced "Find" by clicking on the "Find" tab.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Later we&#8217;ll also learn how to add "filter" drop-down lists.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-210320-081432.732.png" alt="Image 210320 081432.732">
</div>
<div class="title">Figure 16. Clicking on the column heading in list view will reveal search boxes to search on one or more columns.</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-210320-081559.817.png" alt="Image 210320 081559.817">
</div>
<div class="title">Figure 17. Entering keywords into the top-right search box will allow you to look for matches in any column of the table.</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-210320-081653.719.png" alt="Image 210320 081653.719">
</div>
<div class="title">Figure 18. The "Find" tab includes an advanced search form which includes a field for each column in the table.</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_development_environment">Development Environment</h3>
<div class="paragraph">
<p>At this point we have a fully-functional database application, and you didn&#8217;t have to write a single line of code.  Let&#8217;s pull the curtain back a little and see what&#8217;s going on in our application under the hood.</p>
</div>
<div class="paragraph">
<p>The "hello-world" directory that was created by xataface when we ran "xataface create hello-world" contains the following folders:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-220320-071850.431.png" alt="Image 220320 071850.431">
</div>
<div class="title">Figure 19. The root application directory generated by <code>xataface create hello-world</code></div>
</div>
<div class="paragraph">
<p>This root directory comprises a mini development environment for our application.  The application itself is entirely contained inside the "www" directory, and when it comes time to deploy the app to production, we will likely <strong>only</strong> be uploading this directory to the web server.</p>
</div>
<div class="paragraph">
<p>The subdirectories in this folder include:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>app</strong> - This is a symlink to the www directory, however, in cases where the Xataface app is actually contained in a subfolder of "www", this symlink will point to that subdirectory.  The Xataface maintenance scripts always use "app" as the app&#8217;s document root (i.e. the directory containing conf.ini).</p>
</li>
<li>
<p><strong>bin</strong> - This directory contains a set of maintenance scripts that can be used to automate certain maintenance tasks.  This is for the development environment only, and does not need to be copied to the production web server.</p>
</li>
<li>
<p><strong>data</strong> - This directory stores the development mysql database files.  This is for the development environment only.  On the production server, there will likely be a single central MySQL/MariaDB server where your database will reside.</p>
</li>
<li>
<p><strong>etc</strong> - This directory stores apache and mysql config files used for the development environment only.</p>
</li>
<li>
<p><strong>install.sql</strong> - This stores the SQL to recreate the database.</p>
</li>
<li>
<p><strong>lib</strong> - This directory stores some additional libraries that may be useful for the development environment, such as PhpMyAdmin.  This is for the development environment only, and should not be copied to the production web server.</p>
</li>
<li>
<p><strong>log</strong> - Apache and MySQL log files for the development environment.</p>
</li>
<li>
<p><strong>tmp</strong> - The temp directory for the development environment.</p>
</li>
<li>
<p><strong>www</strong> - This is the actual directory containing our application.  When we deploy to a production, this is the only folder that needs to be copied to the web server.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_application_structure">Application Structure</h4>
<div class="paragraph">
<p>As mentioned above, the "www" directory contains the meat of our application.  Let&#8217;s take a look at its contents now.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-220320-073743.112.png" alt="Image 220320 073743.112">
</div>
<div class="title">Figure 20. The www directory contains the document root of our application.</div>
</div>
<div class="paragraph">
<p>Let&#8217;s take a look at the files that were generated and placed in this directory.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>conf.db.ini.php</strong> - Config file containing <strong>only</strong> the database connection information.</p>
</li>
<li>
<p><strong>conf.ini.php</strong> - Config file containing application-wide configuration.</p>
</li>
<li>
<p><strong>index.php</strong> - The entry point to your application.</p>
</li>
<li>
<p><strong>templates_c</strong> - This directory containes compiled Smarty templates.  This needs to be writable by the web server.</p>
</li>
<li>
<p><strong>Web.config</strong> - A security file for IIS to prevent it from serving ".ini" files.  This is really only necessary when using Xataface on IIS.  The .htaccess file provides the equivalent functionality for Apache.</p>
</li>
<li>
<p><strong>xataface</strong> - The actual xataface library used by the app.  Updating your application to a newer version of Xataface later will be as simple as replacing this directory with the latest version.</p>
</li>
<li>
<p><strong>.htaccess</strong> - This file is omitted by the screenshot, but the app also contains an .htaccess file which prevents Apache from serving ".ini" files.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In this tutorial you&#8217;ll notice that all .ini files have a .php extension.  E.g. we have "conf.ini.php" rather than "conf.ini".  Xataface supports both notations, but you should choose one and stick to it.  The benefit of using the ".php" extension, is that you can block any PHP-enabled web server from serving the file by adding <code>;&lt;?php exit;</code> on the first line of the file.  We also include an .htaccess file and Web.config file for blocking .ini files, but these only apply to IIS and Apache web servers respectively.  If you&#8217;re using a different web server, such as NginX or the PHP development server, then these .htaccess will be ignored and your .ini files may get served to the public - which you don&#8217;t want.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_changing_field_labels">Changing Field Labels</h3>
<div class="paragraph">
<p>Out of the box, Xataface will assign appropriate labels to its form fields based on the underlying columns.  However, you can override these labels very easily.</p>
</div>
<div class="paragraph">
<p>To customize labels for the "notes" table we need to create a file at <code>www/tables/notes/fields.ini.php</code></p>
</div>
<div class="paragraph">
<p>The <code>xataface</code> CLI script will generate this file for us via the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ xataface create-fieldsini notes
Created tables/notes/fields.ini.php</code></pre>
</div>
</div>
<div class="paragraph">
<p>As the output indicates, this created a file at tables/notes/fields.ini.php.  Let&#8217;s open it up to take a look at the contents.</p>
</div>
<div class="listingblock">
<div class="title">The fields.ini file generated for the "notes" table.</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">;&lt;?php exit; <b class="conum">(1)</b>
[note_id]

[title]

[note_content]

[date_posted]

[status]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>First line for security.  It will block any php-enabled web server from serving this file.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>It has generated empty sections for each field in the "notes" table.  All configuration options for a field should go in its section.</p>
</div>
<div class="paragraph">
<p>Now let&#8217;s customize some field labels and descriptions.  We can set a field&#8217;s label using the "widget:label" property, and we can add some "help" text using the "widget:description" property.  Let&#8217;s customize the labels and descriptions for this form by adding these properties.</p>
</div>
<div class="paragraph">
<p>After making a few changes, my fields.ini file now looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">;&lt;?php exit;
[note_id]

[title]
  widget:label=Note title
  widget:description=Enter a descriptive title for this note

[note_content]
  widget:label=Contents
  widget:description=Enter the full content of the note here

[date_posted]

[status]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, open your browser again and try to add a new note.  You&#8217;ll notice that the form has changed:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-220320-075604.685.png" alt="Image 220320 075604.685">
</div>
<div class="title">Figure 21. New record form includes custom labels and descriptions based on the <code>widget:label</code> and <code>widget:description</code> properties I added to the fields.ini file.</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_a_more_complex_example_faculty_of_widgetry_app">A More Complex Example: Faculty of Widgetry App</h2>
<div class="sectionbody">
<div class="paragraph">
<p>sf</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sorting_and_filtering">Sorting and Filtering</h2>
<div class="sectionbody">
<div class="paragraph">
<p>One of the core features of any database application is the ability to sort and filter results.  Xataface applications come with powerful sorting and filtering features out of the box.  All HTTP requests define a result set in your database.  By following some simple <a href="#part_appendix_url_conventions">URL Conventions</a> you can easily craft an HTTP request targetting the exact result set you want.  At a higher level, Xataface also provides a rich user experience for sorting and filtering result sets inside the application.</p>
</div>
<div class="paragraph">
<p>This chapter describes the UI components involved in filtering and sorting, how to use them, and how to configure them to suit your needs.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sorting_results">Sorting Results</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To sort a result set, you can simply click on the "Sort" button in the upper left of the list view as shown below:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-210820-073755.419.png" alt="Image 210820 073755.419">
</div>
<div class="title">Figure 22. List View on desktop.  Click the "Sort" button in the upper left to reveal sorting options.  Note that the list view depicted here is using the "listStyle=mobile" directive so the results are displayed as a list of titles/descriptions rather than a table.</div>
</div>
<div class="paragraph">
<p>This will reveal the sort options.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-210820-073946.197.png" alt="Image 210820 073946.197">
</div>
<div class="title">Figure 23. The sort dialog on desktop allows the user to specify an alternate sort order for the list.</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>Out of the box, Xataface will provide options to sort on every appropriate field in the table.  The table in the above screenshot only includes two sort options:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>"Date posted: Newest first"</p>
</li>
<li>
<p>"Article date: Newest first"</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This is because the application includes the following definitions in its fields.ini file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[date_posted]
    sortable-=1

[article_date]
    sortable-=1</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can "sort" the results by clicking on the appropriate sort option in this dialog.</p>
</div>
<h3 id="_mobile_ui" class="discrete">Mobile UI</h3>
<div class="paragraph">
<p>On desktop, the "sort" dialog slides open from the right of the window.  On mobile, it slides up from the bottom as shown below:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-210820-075054.415.png" alt="Image 210820 075054.415">
</div>
<div class="title">Figure 24. Sort dialog on mobile device.</div>
</div>
<div class="paragraph">
<p>One other nice feature of the mobile UI, is that when you scroll down the page, the "Sort" and "Filter" buttons are changed into floating buttons as shown below:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-210820-075230.037.png" alt="Image 210820 075230.037">
</div>
<div class="title">Figure 25. Sort and Filter become floating buttons when you scroll down the page.</div>
</div>
<h2 id="_sort_option_labels" class="discrete">Sort option Labels</h2>
<div class="paragraph">
<p>The screenshots above demonstrate only sorting on date fields.  The labels "newest first", and "oldest" first are used by default on date and time fields.  Text and numeric fields use different labels by default.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-210820-075531.054.png" alt="Image 210820 075531.054">
</div>
<div class="title">Figure 26. A sort dialog for sorting numeric and text fields.</div>
</div>
<div class="sect2">
<h3 id="_sort_configuration">Sort Configuration</h3>
<div class="paragraph">
<p>Xataface provides sorting out of the box without the need for any configuration, but it is recommended that you configure the sorting behaviour explicitly for each table of your app.  In many cases you may only want to provide sorting on a few key columns.   You can use the "sortable", "sortable-", and "sortable+" fields.ini directives to explicitly mark a field as "sortable".  If no fields in your table are explicitly marked as sortable, then Xataface will make a best guess.  If it finds at least one field that is marked as sortable, then it will simply hand the reigns over to you (i.e. it won&#8217;t make any fields sortable that you haven&#8217;t explicitly marked as sortable, in this case).</p>
</div>
<h4 id="_fields_ini_configuration_options" class="discrete">fields.ini Configuration options</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">sortable</dt>
<dd>
<p>Set this value to "1" to mark this field as sortable in both ascending and descending order.</p>
</dd>
<dt class="hdlist1">sortable-</dt>
<dd>
<p>Set this value to "1" to mark this field as sortable in descending order only.</p>
</dd>
<dt class="hdlist1">sortable+</dt>
<dd>
<p>Set this value to "1" to mark this field as sortable in ascending order only.</p>
</dd>
<dt class="hdlist1">sort.label</dt>
<dd>
<p>Specifies the label that should be used for this field in the sort dialog.  If this is omitted, it will use a sensible label like "Field Name: A-Z".</p>
</dd>
<dt class="hdlist1">sort+.label</dt>
<dd>
<p>Specifies the label that should be used for this field in the sort dialog for sorting in ascending order only.</p>
</dd>
<dt class="hdlist1">sort-.label</dt>
<dd>
<p>Specifies the label that should be used for this field in the sort dialog for sorting in descending order only.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><strong>Example:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[date_posted]
    sortable-=1

[article_date]
    sortable-=1</code></pre>
</div>
</div>
<h4 id="_sort_actions" class="discrete">Sort Actions</h4>
<div class="paragraph">
<p>If sorting on individual fields doesn&#8217;t provide you with enough flexibility, then you can also define actions in your actions.ini file using the "sort_actions" category.</p>
</div>
<div class="paragraph">
<p>TODO: Add documentation on using "sort_actions" category for sorting.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_filtering_results">Filtering Results</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To filter a result set, you can simply click on the "Filter" button in the upper left of the list view as shown below:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-210820-081331.232.png" alt="Image 210820 081331.232">
</div>
</div>
<div class="paragraph">
<p>This will reveal the filtering dialog as shown below:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-210820-081450.121.png" alt="Image 210820 081450.121">
</div>
</div>
<div class="paragraph">
<p>The filter dialog includes a keyword search field, which will perform a search on all eligible columns of the table, followed by options to filter on a selection of fields in the table.  The available fields are determined in a similar fashion to the way that sortable fields are determined.  If you define "filter=1" on <strong>any</strong> field of your application, it will include only those fields that are marked with "filter=1".  If you don&#8217;t mark <strong>any</strong> fields as filterable, then Xataface will make a best guess at which fields should be filterable - defaulting to all fields except certain obvious ones such as password columns which should not be filterable.</p>
</div>
<div class="paragraph">
<p>If we follow the flow of the application depicted above, clickin on the "Author" option reveals filter options for the "Author" field.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-210820-082201.672.png" alt="Image 210820 082201.672">
</div>
</div>
<div class="paragraph">
<p>You can select one or more authors to filter the results on these authors.  The little parenthesized numbers to the right of the options indicates the number of rows in the current result set that match that author.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
The "Show X Results" button at the bottom is automatically updated as you adjust your filter preferences to show you how many results match your filter.  This is helpful when you&#8217;re trying to narrow down the results to a managable size, but also not to zero.
</td>
</tr>
</table>
</div>
<h3 id="_mobile_ui_2" class="discrete">Mobile UI</h3>
<div class="paragraph">
<p>As with the "sort" dialog, the "filter" dialog will slide up from the bottom of the window instead of the side when viewed on a mobile device.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-210820-090239.167.png" alt="Image 210820 090239.167">
</div>
<div class="title">Figure 27. Filter dialog on mobile loads from bottom of the window.</div>
</div>
<div class="sect2">
<h3 id="filter_types">Filter Types</h3>
<div class="paragraph">
<p>Xataface supports a few different filter types.  Use the "filter.type" fields.ini directive to specify the filter type to use for a given field.  If you do not specify this, then Xataface will try to choose the most appropriate filter to use based on the type of field.  The following filter types are supported:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">text</dt>
<dd>
<p>A text field to enter keywords to search for.  This includes options for "exact", "contains", "starts with", and "ends with".  This is the default for VARCHAR, CHAR, and INT columns.</p>
<div class="imageblock">
<div class="content">
<img src="images/Image-210820-085336.821.png" alt="Image 210820 085336.821">
</div>
</div>
</dd>
<dt class="hdlist1">range</dt>
<dd>
<p>Search fields for "min" and "max".  This is the default for FLOAT, DECIMAL, and DATE columns.  Date columns will also provide some options to perform common searches as well.</p>
<div class="imageblock">
<div class="content">
<img src="images/Image-210820-085515.976.png" alt="Image 210820 085515.976">
</div>
<div class="title">Figure 28. Range filter on a varchar field.</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-210820-085758.340.png" alt="Image 210820 085758.340">
</div>
<div class="title">Figure 29. Range filter on a datetime field</div>
</div>
</dd>
<dt class="hdlist1">filter</dt>
<dd>
<p>User can select from current values for the column in the result set, and can see the number of matches per value.</p>
<div class="imageblock">
<div class="content">
<img src="images/Image-210820-090053.430.png" alt="Image 210820 090053.430">
</div>
</div>
</dd>
<dt class="hdlist1">min</dt>
<dd>
<p>Same as the "range" filter type, except it only includes the "Min" field.</p>
</dd>
<dt class="hdlist1">max</dt>
<dd>
<p>Same as the "range" filter type, except it only includes the "Max" field.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_filters_configuration">Filters Configuration</h3>
<div class="paragraph">
<p>The following are some of the configuration options related to filtering that you can define in your fields.ini files.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">filter</dt>
<dd>
<p>A value of "1" indicates that this field is filterable.</p>
</dd>
<dt class="hdlist1">filter.type</dt>
<dd>
<p>The type of filter to use.  Options include "text", "range", "min", "max", and "filter".  See <a href="#filter_types">Filter Types</a>.</p>
</dd>
<dt class="hdlist1">filter.label</dt>
<dd>
<p>The label to use for the filter.  This defaults to the <code>widget:label</code> for the field.</p>
</dd>
<dt class="hdlist1">filter.icon</dt>
<dd>
<p>Icon to use in the text field when using the "text" filter type.  This should be the name of a material icon.  See <a href="#material-icons">Using Material Icons</a> for details about material icons in Xataface.</p>
</dd>
<dt class="hdlist1">filter.min.icon</dt>
<dd>
<p>Optional icon to use inside the "min" field for min and range filters.  The icon should be a valid material icon name.  See <a href="#material-icons">Using Material Icons</a> for details about material icons in Xataface.</p>
<div class="imageblock">
<div class="content">
<img src="images/Image-210820-090958.753.png" alt="Image 210820 090958.753">
</div>
<div class="title">Figure 30. <strong>Example</strong> <code>filter.max.icon=euro_symbol</code></div>
</div>
</dd>
<dt class="hdlist1">filter.max.icon</dt>
<dd>
<p>Same as <code>filter.min.icon</code> except for the "min" field.</p>
</dd>
<dt class="hdlist1">filter.input.type</dt>
<dd>
<p>Specify the <code>type</code> attribute of the <code>&lt;input&gt;</code> tag used in the "text", "range", "min", and "max" filter types.  This will be "text" by default in most fields.  It will be <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/date">date</a> by default for date fields, and <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/datetime-local">datetime-local</a> for datetime fields.</p>
</dd>
<dt class="hdlist1">filter.sort</dt>
<dd>
<p>Used for the "filter" filter type.  This specifies the column to use for sorting the options in the fitler.</p>
</dd>
<dt class="hdlist1">filter.placeholder</dt>
<dd>
<p>Placeholder text used for the "text" filter type.  Placeholder text is only displayed when the field is empty.</p>
</dd>
<dt class="hdlist1">filter.min.placeholder</dt>
<dd>
<p>Placeholder text used the "min" field.  Placeholder text is only displayed when the field is empty.</p>
</dd>
<dt class="hdlist1">filter.max.placeholder</dt>
<dd>
<p>Placeholder text used the "max" field.  Placeholder text is only displayed when the field is empty.</p>
</dd>
<dt class="hdlist1">filter.input.*</dt>
<dd>
<p>Specify HTML attributes on the <code>&lt;input&gt;</code> element used in the "text" filter type.  E.g. <code>filter.input.maxlength=5</code></p>
</dd>
<dt class="hdlist1">filter.min.input.*</dt>
<dd>
<p>Specify HTML attributes on the <code>&lt;input&gt;</code> element used in the "min" field. E.g. <code>filter.min.input.maxlength=5</code></p>
</dd>
<dt class="hdlist1">filter.max.input.*</dt>
<dd>
<p>Specify HTML attributes on the <code>&lt;input&gt;</code> element used in the "max" field. E.g. <code>filter.max.input.maxlength=5</code></p>
</dd>
<dt class="hdlist1">filter.vocabulary</dt>
<dd>
<p>A valuelist that can be used to provide "common" search options.  These are displayed before the text or range fields to allow the user to easily select common searches.</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exporting_data">Exporting Data</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Xataface includes built-in support for exporting data in a variety of formats, including:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>RSS</p>
</li>
<li>
<p>CSV</p>
</li>
<li>
<p>XML</p>
</li>
<li>
<p>JSON</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Additional formats are provided via modules.  The following chapters describe how to integrate these formats into your Xataface applications.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="rss-feeds">RSS Feeds</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A default Xataface application provides RSS feeds to any found set in your application. This article explains a little bit about RSS and how you can configure Xataface to give you the desired results for your RSS feed.</p>
</div>
<h3 id="_what_is_rss" class="discrete">What is RSS?</h3>
<div class="paragraph">
<p>From <a href="http://en.wikipedia.org/wiki/RSS_(file_format)">Wikipedia&#8217;s RSS article</a>:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>"RSS is a family of Web feed formats used to publish frequently updated works such as blog entries, news headlines, audio, and videoin a standardized format.[2] An RSS document (which is called a "feed", "web feed",[3] or "channel") includes full or summarized text, plus metadata such as publishing dates and authorship. Web feeds benefit publishers by letting them syndicate content automatically. They benefit readers who want to subscribe to timely updates from favored websites or to aggregate feeds from many sites into one place. RSS feeds can be read using software called an "RSS reader", "feed reader", or "aggregator", which can be web-based or desktop-based. A standardized XML file format allows the information to be published once and viewed by many different programs. The user subscribes to a feed by entering the feed&#8217;s URI (often referred to informally as a "URL", although technically, those two terms are not exactly synonymous) into the reader or by clicking an RSS icon in a browser that initiates the subscription process. The RSS reader checks the user&#8217;s subscribed feeds regularly for new work, downloads any updates that it finds, and provides a user interface to monitor and read the feeds."</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>In a way, RSS replaces email subscriptions so that you can subscribe to receive updates when content is added or changed on websites that you monitory. This way you can monitory these changes in your RSS reader so that your email box doesn&#8217;t get clogged up.</p>
</div>
<h3 id="_using_rss_in_xataface" class="discrete">Using RSS in Xataface</h3>
<div class="paragraph">
<p>Xataface allows you to subscribe to:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Entire tables</p>
</li>
<li>
<p>Any found set</p>
</li>
<li>
<p>Changes to a particular record</p>
</li>
<li>
<p>Related record lists</p>
</li>
</ol>
</div>
<h4 id="_example_1_subscribing_to_receive_news_updates" class="discrete">Example 1: Subscribing to receive news updates</h4>
<div class="paragraph">
<p>A user wants to be alerted whenever a new item is inserted into the news table, so he navigates to the list tab of the news table, and clicks the RSS Feed icon in the upper right. If he has an RSS reader application set up, this is all he has to do to subscribe to the RSS feed for the news table. When new records are inserted, he&#8217;ll receive alerts in his RSS reader.</p>
</div>
<h4 id="_example_2_subscribing_to_receive_found_set_updates" class="discrete">Example 2: Subscribing to receive found set updates</h4>
<div class="paragraph">
<p>A user wants to be alerted whenever a new item is inserted into the news table that contains the phrase "Buffalo Bills", because he is a Buffalo Bills fan. So he navigates to the news table, and does a search for the phrase "Buffalo Bills". Then he clicks on the "RSS Feed" icon in the upper right of the result set list. If he has an RSS reader application set up, this is all he has to do to subscribe to the RSS feed for news items containing the phrase "Buffalo Bills". Whenever a new item is posted with this phrase, he will be notified via RSS of the new record.</p>
</div>
<h4 id="_example_3_subscribing_to_a_related_list" class="discrete">Example 3: Subscribing to a related list</h4>
<div class="paragraph">
<p>Suppose you want to receive updates whenever a particular author adds a book to his list of published works. Further suppose this is represented by a relationship between the authors table and the books table named publications. You can subscribe to the RSS feed for his publications by navigating to the publications tab for that author, then clicking on the "RSS Feed" icon in the upper right. Now whenever this author adds a new book to his publications list, you&#8217;ll be notified via RSS.</p>
</div>
<h4 id="_example_usage_in_xataface" class="discrete">Example usage in Xataface</h4>
<div class="paragraph">
<p>A user wants to be alerted whenever a new item is inserted into the news table, so he navigates to the list tab of the news table, and clicks the RSS Feed icon in the upper right. If he has an RSS reader application set up, this is all he has to do to subscribe to the RSS feed for the news table. When new records are inserted, he&#8217;ll receive alerts in his RSS reader.</p>
</div>
<div class="paragraph">
<p>A user wants to be alerted whenever a new record about "Wayne Gretzky" is inserted in to the news table. He navigates to the news table, then performs a search for "Wayne Gretzky" using the top right search box. Then, he clicks on the "RSS Feed" icon in the upper right of the result list. Now, whenever a new item is inserted with the phrase "Wayne Gretzky", the user will be notified via RSS.</p>
</div>
<div class="sect2">
<h3 id="_configuring_rss_feeds">Configuring RSS Feeds</h3>
<div class="paragraph">
<p>As with everything else in Xataface, you can configure your RSS feeds to appear just as you want them to. The following delegate class methods are available to be defined in the table delegate class for your feed:</p>
</div>
<div class="paragraph">
<p>See <a href="#appendix-rss-config">RSS Configuration Directives</a> for available configuration directives and delegate class methods related to RSS feeds.</p>
</div>
<h4 id="_example_configuration" class="discrete">Example Configuration</h4>
<div class="paragraph">
<p>There are 2 parts to configuring your RSS feeds:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Configuring the feed as a whole</p>
</li>
<li>
<p>Configuring the feed items (that is each record that will appear in your RSS feed).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Configuring the Feed as a whole</strong></p>
</div>
<div class="paragraph">
<p>For configuring the feed as a whole, we have 2 options. We can specify the title, description, and link for the feed in the <code>[_feed]</code> section of your "conf.ini" file. This is sort of a "one size fits all" approach where all feeds generated from your application will share the same title. E.g.</p>
</div>
<div class="listingblock">
<div class="title">Configuring RSS feed in conf.ini file</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[_feed]
    title="My Site News"
    description="News updates from my site"
    link="http://www.example.com"</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, if we want our feed&#8217;s information to depend on the user&#8217;s query (e.g. what the user was searching for, or which table the feed is generated on, we have more flexibility if we define the <code>getFeed</code> method in either the application delegate class or the table delegate class. E.g.</p>
</div>
<div class="listingblock">
<div class="title">Configuring RSS feed in delegate class</div>
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">function getFeed($query=array()){
    $params = array();
    if ( @$query['-search'] ) $params['title'] = '"'.$query['-search'].'" results';
    else $params['title'] = 'All records from my table';
    return $params;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that I don&#8217;t need to define all possible parameters. Any parameters that I don&#8217;t define will be provided automatically by Xataface, or it will simply use the values specified in your <code>[_feed]</code> section of the "conf.ini" file.</p>
</div>
<div class="paragraph">
<p><strong>Configuring Feed Items</strong></p>
</div>
<div class="paragraph">
<p>Configuring the feed items is quite important for ensuring that subscribers are seeing what you want them to see in the RSS feed. Xataface tries to guess appropriate content for your feed items if you don&#8217;t specify it explicitly, but you&#8217;ll likely want to tweak it a little bit to make the feed look more polished for your purposes.</p>
</div>
<div class="paragraph">
<p>Use the <code>getFeedItem</code> delegate class method to specify how a feed item behaves (e.g. the title, content, date, author, link).  E.g.</p>
</div>
<div class="listingblock">
<div class="title">Configuring a feed item description in the delegate class.</div>
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">function getFeedItem(&amp;$record)){
    return array(
        'description' =&gt; $record-&gt;val('body')
    );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once again, notice that we don&#8217;t need to specify all available options. Only those options that we want to override. In this case we want the description of the feed item to simply display the body of our news item. The description of an RSS feed item is effectively the body text that the user sees why they click on an item in their news reader, so this is quite important.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recipes">Recipes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section of the book includes recipes for common patterns in Xataface applications.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="actions">Actions and Menus</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following sections pertain to actions in Xataface.  An action may either be a menu item, or an HTTP request handler.  Or it can be both.  They are defined in the actions.ini file (or actions.ini.php file) of your application, and their "handlers" are defined inside the "actions" directory of your application.</p>
</div>
<div class="sect2">
<h3 id="material-icons">Using Material Icons</h3>
<h4 id="_problem" class="discrete">Problem</h4>
<div class="paragraph">
<p>You want to use a <a href="https://material.io/resources/icons/?style=baseline">material icon</a> for a menu-item in your application, instead of an image.</p>
</div>
<h4 id="_solution" class="discrete">Solution</h4>
<div class="paragraph">
<p>The default theme of Xataface includes the material icons web font, so you can use any icons in that font on your actions via the <code>materialIcon</code> directive in your action.  For example, suppose we want to add a "Play" button to the rows of our table in list view.  We define our action as follows:</p>
</div>
<div class="listingblock">
<div class="title">A play action for the "songs" table.</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[play]
    condition="$query['-table'] == 'songs'" <b class="conum">(1)</b>
    category=list_row_actions <b class="conum">(2)</b>
    materialIcon=play_circle_outline <b class="conum">(3)</b>
    label="Play" <b class="conum">(4)</b>
    description="Play narration" <b class="conum">(5)</b>
    url="javascript:playSong()"</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The <code>condition</code> directive is used to limit our action so it only displays for the "songs" table.</p>
</li>
<li>
<p>The <code>category</code> directive makes the action appear in the "list_row_actions" menu (which is displayed as icons in each row of the list view.</p>
</li>
<li>
<p>The <code>materialIcon</code> directive specifies that we want to use the <a href="https://material.io/resources/icons/?search=play&amp;icon=play_circle_outline&amp;style=baseline">play_circle_outline</a> material icon.</p>
</li>
<li>
<p>The label, which is hidden for this menu type because the stylesheet is set to show only icons for the "list_row_actions" action.  It is still a good idea to define the label though in case this action is used in other contexts.</p>
</li>
<li>
<p>The description which is shown as tool-tip text if the user mouses over the action.</p>
</li>
</ol>
</div>
<h4 id="_finding_the_right_material_icon" class="discrete">Finding the Right Material Icon</h4>
<div class="paragraph">
<p>You can browse the available material icons <a href="https://material.io/resources/icons/?style=baseline">here</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-130620-080448.218.png" alt="Material Icons site">
</div>
<div class="title">Figure 31. Material Icons website</div>
</div>
<div class="paragraph">
<p>The label below the icon is the name of the icon, that you would use for your <code>materialIcon</code> directive.  If the lable is truncated, you can click the "Selected Icon" button in the lower left to get a more detailed view.</p>
</div>
</div>
<div class="sect2">
<h3 id="javascript-action">Triggering Javascript Function with Action</h3>
<h4 id="_problem_2" class="discrete">Problem</h4>
<div class="paragraph">
<p>You want to trigger a Javascript function when the user clicks on an action.</p>
</div>
<h4 id="_solution_2" class="discrete">Solution</h4>
<div class="paragraph">
<p>Use the <code>onclick</code> directive for the action definition in your actions.ini file.  The javascript you specify here will be executed when the user clicks on the action.  Perhaps the "hardest" part of this recipe is simply knowing where to put the javascript function that you wish to call.  There are many ways to include custom Javascript into your application.  My preferred way is to use the <code>xf_script($scriptpath)</code> inject your Javascript file.</p>
</div>
<div class="paragraph">
<p>I&#8217;ll illustrate this process by way of an example.  I&#8217;m going to create a simple action called "hello_world" that pops up an Alert box that says "Hello World".</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This example is simple enough that it could have been achieved without having to include a separate Javascript file.  E.g. <code>onclick="alert('Hello World!');"</code> would do the trick in the action definition.  But, I&#8217;m going create a separate Javascript file with this functionality for educational purposes.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Step 1: Create a Javascript File</strong></p>
</div>
<div class="paragraph">
<p>If you don&#8217;t have a "js" directory in your application yet, create it now.  This is where you will place all Javascript files in your application.</p>
</div>
<div class="paragraph">
<p>Now create a file inside the "js" directory named "hello.js", with the following contents.</p>
</div>
<div class="listingblock">
<div class="title">hello.js, containing our helloWorld() function that we wish to call.</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">window.helloWorld = function() { <b class="conum">(1)</b>
    alert('Hello World!');
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Step 2: Include the Javascript File</strong></p>
</div>
<div class="paragraph">
<p>You can include this Javascript file into your application by calling:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">xf_script('hello.js');</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Notice that we include 'hello.js', and not 'js/hello.js'.  This is because the Javascript tool always looks in its "include" paths for Javascript files, and it treats all paths as relative to the include path root.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Where</strong> you choose to call this code depends on <strong>when</strong> it will be needed.  If your Javascript file is only needed inside a particular page of your app, then you are probably best to call this inside the action for that page, or inside a block which only appears on that page.</p>
</div>
<div class="paragraph">
<p>If you want it to be included application-wide, then you should call this inside a method that will be called for every request.  I usually place all "global" stuff inside the <code>beforeHandleRequest()</code> method of the Application Delegate class.</p>
</div>
<div class="paragraph">
<p>In this case, I&#8217;m not sure yet, which pages will be displaying the menu item for my "hello" action, so I&#8217;ll include it inside the <code>beforeHandleRequest()</code> method:</p>
</div>
<div class="listingblock">
<div class="title">Application delegate class (<code>conf/ApplicationDelegate.php</code>) with <code>beforeHandleRequest()</code> method defined.</div>
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">&lt;?php
class conf_ApplicationDelegate {
    function beforeHandleRequest() {
        xf_script('hello.js');
    }
}
?&gt;</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>By default, <code>xf_script()</code> uses the JavascriptTool to include the script with the rest of the application&#8217;s scripts, minified.  All of these scripts are included in the HTML page with a single script tag just before the <code>&lt;/body&gt;</code> tag.</p>
</div>
<div class="paragraph">
<p>If you need to include a Javascript file that is included in the <code>&lt;head&gt;</code> of the document for some reason, then you can pass <code>false</code> as the second parameter</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">xf_script('hello.js', false);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The down-side of adding the script to the <code>&lt;head&gt;</code> is that it isn&#8217;t pre-compiled by the Javascript tool, and, thus, cannot use the <code>//require</code> directive to depend on other scripts.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Step 3: Defining the Action</strong></p>
</div>
<div class="paragraph">
<p>Now that we have our script included, we can define our action:</p>
</div>
<div class="listingblock">
<div class="title">Action definition inside the actions.ini (or actions.ini.php) file.</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[hello]
    onclick="window.helloWorld();"
    category=record_actions <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>For demonstration we&#8217;ll add this to the "record_actions" category, which are displayed in a drop-down menu on the record details page.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-140620-084043.111.png" alt="Image 140620 084043.111">
</div>
</div>
<div class="paragraph">
<p>Now, we can click on our "Hello" button to see the pay-off:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-140620-084139.249.png" alt="Image 140620 084139.249">
</div>
</div>
<h4 id="_troubleshooting" class="discrete">Troubleshooting</h4>
<div class="paragraph">
<p>Things never work the first time.  There are a couple of things that can go wrong in setting up this recipe for the first time:</p>
</div>
<div class="paragraph">
<p><strong>My "hello" Action doesn&#8217;t appear in the menu</strong></p>
</div>
<div class="paragraph">
<p>Things to check:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Double check the "category" directive of your action.  It be <code>category=record_actions</code>.  <strong>Case-sensitivty matters!!</strong></p>
</li>
<li>
<p>Ensure that your actions.ini file is getting picked up.  Your actions.ini file should be located in the root directory of your application.  E.g. "/path/to/myapp/actions.ini".  Make sure it is named "actions.ini" and not "Actions.ini".  <strong>Case-sensitivity matters!</strong> (on Linux)</p>
</li>
<li>
<p>Check your PHP error log.  It is possible you have a syntax error in your actions.ini file, and the app isn&#8217;t able to load it.</p>
</li>
<li>
<p>If nothing shows up in your PHP error log, add the "debug=1" directive to the beginning of your <code>conf.ini</code> file, then reload the page.  You&#8217;ll see a whole bunch of warnings now when you look at your PHP error log.  See if there are any fatal errors on your actions.ini file.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Nothing happens when I click on my "hello" Action</strong></p>
</div>
<div class="paragraph">
<p>Things to check:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure you have the "onclick" directive in your action definition.  Check for typos.</p>
</li>
<li>
<p>Look at the Javascript error log in your browser.  E.g. Right click on your page, if using Chrome, and select "Inspect".  Then click on the "Console" tab.  This will show you errors.  If you see an error like "window.helloWorld is not a function", it means that your Javascript file did not get included.  If you see a syntax error listed, probably you have a Javascript error in your hello.js file.</p>
</li>
<li>
<p>Enable Debug mode in the Javascript tool.  This will cause your Javascript files to NOT be minified so it will be easier to debug in the browser.  You can do this by adding the following to your conf.ini file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[Dataface_JavascriptTool]
    debug=1</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="customize-action-label">Customizing Action Labels</h3>
<h4 id="_problem_3" class="discrete">Problem</h4>
<div class="paragraph">
<p>You want to customize the label for an existing action</p>
</div>
<h4 id="_solution_3" class="discrete">Solution</h4>
<div class="paragraph">
<p>If you want to customize the action for all tables, you can simply override the action in your app&#8217;s actions.ini file, and set the <code>label</code> property.</p>
</div>
<div class="listingblock">
<div class="title">Overriding the "new" action in your app&#8217;s actions.ini file</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[new &gt; new]
    label=Insert New Record</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
To override the tooltip text for the action, you could set the <code>description</code> directive.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Alternatively, you can use Xataface&#8217;s internationalization support to override the label.  E.g. in your app&#8217;s "lang/en.ini" file (which contains your English translations), you can define the key "actions.[ACTION_NAME].label".  E.g.</p>
</div>
<div class="listingblock">
<div class="title">Overriding the "new" action&#8217;s label in the lang/en.ini file</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">actions.new.label="Insert New Record"</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
To override the tooltip text for the action, you can set the <code>actions.new.description</code> property.
</td>
</tr>
</table>
</div>
<h5 id="_overriding_label_on_a_particular_table" class="discrete">Overriding Label on a Particular Table</h5>
<div class="paragraph">
<p>The above examples would override the action label in the entire application.  If you want to specify the label in a particular table, you can define the "tables.[TABLENAME].actions.[ACTIONNAME].label" proeprty in your language file (e.g. lang/en.ini).</p>
</div>
<div class="listingblock">
<div class="title">Overriding the label for the "new" action in the "articles" table.</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">tables.articles.actions.new.label="Insert Article"</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
You can also override the the tooltip text using <code>tables.[TABLENAME].actions.[ACTIONNAME].description</code>, and the material icon using <code>tables.[TABLENAME].actions.[ACTIONNAME].materialIcon</code>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="tables-navigation-menu">Customising Navigation Menu</h3>
<h4 id="_problem_4" class="discrete">Problem</h4>
<div class="paragraph">
<p>You want to customize the options in the navigation menu</p>
</div>
<h4 id="_solution_4" class="discrete">Solution</h4>
<div class="paragraph">
<p>Define actions in the <code>_tables</code> category.  These will be used instead of the tables listed in the <code>_tables</code> section of the conf.ini to form the tables navigation menu.</p>
</div>
<h4 id="_discussion" class="discrete">Discussion</h4>
<div class="paragraph">
<p>The top-level navigation menu in Xataface allows you to select which database table you with to work with.  By default, it is generated from the <code>[_tables]</code> section of the conf.ini file.</p>
</div>
<div class="paragraph">
<p>For example, given the following _tables section:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[_tables]
    students=Students
    countries=Countries
    provinces=Provinces</code></pre>
</div>
</div>
<div class="paragraph">
<p>Xataface will generate a menu that looks like:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-150820-073236.636.png" alt="Tables navigation menu in Xataface">
</div>
</div>
<div class="paragraph">
<p>In some cases, you may want to generate your own custom menu.  For example, you may want to group some tables together into a single drop-down menu.  You can do this by defining actions inside your actions.ini file in the <code>_tables</code> category.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="title">Defining actions in the <code>_tables</code> category in your actions.ini file.  These will be used to form the navigation menu instead of your app&#8217;s tables.</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[menu_students]
    label=Students
    category=_tables
    url="?-table=students"
    selected_condition="$table=='students'"

[menu_setup]
    label=Setup
    category=_tables
    subcategory=_tables_setup
    order=10

[menu_countries]
    label="Countries"
    category=_tables_setup
    url="?-table=countries"
    selected_condition="$table=='countries'"

[menu_provinces]
    label="Provinces"
    category=_tables_setup
    url="?-table=provinces"
    selected_condition="$table=='provinces'"</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case we have defined two top-level menus in the <code>_tables</code> category: "menu_students" and "menu_setup".  The "menu_setup" action has uses the "subcategory" property to assert that it is a drop-down menu.  Any actions in the "_tables_setup" category will be included in this drop-down menu.</p>
</div>
<div class="paragraph">
<p>The resulting menu for this setup would be:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-150820-073433.380.png" alt="Custom tables navigation menu">
</div>
</div>
<div class="paragraph">
<p>If you hover over the "Setup" menu, it will expand:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-150820-073452.855.png" alt="Hovering over the Setup drop-down menu">
</div>
</div>
</div>
<div class="sect2">
<h3 id="ajax_actions">Action to Trigger AJAX Request</h3>
<h4 id="_problem_5" class="discrete">Problem</h4>
<div class="paragraph">
<p>You want your action button to trigger an AJAX (background) request rather than linking to another page.  Additionally you would like to provide some UI feedback to inform the user that the action is in progress.  And finally, when the action completes, you would like some UI feedback to the user to indicate the result of the action, and handle errors and failures gracefully.</p>
</div>
<h4 id="_solution_5" class="discrete">Solution</h4>
<div class="paragraph">
<p>There are two parts to this problem:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">The server-side</dt>
<dd>
<p>We need to write a PHP handler that your action should trigger.  Since we are using AJAX, this action will output JSON instead of HTML.</p>
</dd>
<dt class="hdlist1">The client-side</dt>
<dd>
<p>We need to provide a button or menu that the user clicks to trigger the action, as well as the user interface elements to keep the user informed on the progress of the action.</p>
</dd>
</dl>
</div>
<h5 id="_the_server_side" class="discrete">The Server-Side</h5>
<div class="paragraph">
<p>For the Server-side, let&#8217;s create a simple action that outputs JSON.  In your app&#8217;s "actions" directory, create a file named "hello.php" with the following contents:</p>
</div>
<div class="listingblock">
<div class="title">actions/hello.php</div>
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">&lt;?php
class actions_hello {
    function handle($params = []) {
        df_write_json([ <b class="conum">(1)</b>
            'code' =&gt; 200, <b class="conum">(2)</b>
            'message' =&gt; 'Action succeeded' <b class="conum">(3)</b>
        ]);
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>We use the <code>df_write_json()</code> function to encode our output as JSON.</p>
</li>
<li>
<p>The <code>code</code> is a status code that you create.  Generally follow the HTTP convension where codes from 200-299 indicate success.  400-499 indicate some sort of "not allowed" error.  500-599 indicate some sort of server error. Etc..</p>
</li>
<li>
<p>The <code>message</code> Property will contain a human-readable message about the result of the action.</p>
</li>
</ol>
</div>
<h5 id="_the_client_side" class="discrete">The Client-Side</h5>
<div class="paragraph">
<p>I&#8217;ll discuss two different solutions for the client side:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#ajax-action-solution-1">Writing a Custom Javascript Function</a></p>
</li>
<li>
<p><a href="#ajax-action-solution-2">Using the <code>ajax</code> directive of the actions.ini</a> file.</p>
</li>
</ol>
</div>
<h6 id="ajax-action-solution-1" class="discrete">Solution 1: Writing a Custom Javascript Function</h6>
<div class="paragraph">
<p>See <a href="#javascript-action">Triggering Javascript Function with Action</a> for details on triggering a Javascript function using an action.  After setting up your action, you&#8217;ll have a definition in your actions.ini file like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[hello]
    onclick="window.helloWorld();"
    category=record_actions</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you have your action linked up to your Javascript function you can use the <code>jQuery.post()</code> function to trigger your action handler as follows:</p>
</div>
<div class="listingblock">
<div class="title">hello.js, containing our helloWorld() function that we wish to call.</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">window.helloWorld = function() {
    jQuery.post(DATAFACE_SITE_HREF, { <b class="conum">(1)</b>
        '-action' : 'hello' <b class="conum">(2)</b>
    }, function(result) { <b class="conum">(3)</b>
        var message = (res &amp;&amp; res.message) ? res.message : 'Server error';
        if (result &amp;&amp; result.code == 200) {
            alert('Success: ' + message);
            return;
        }

        alert("Failed: " + message);

    });
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The <code>DATAFACE_SITE_HREF</code> constant is always available, and refers to the entry point of your Xataface application.  Uaually <code>index.php</code>.</p>
</li>
<li>
<p>The 2nd parameter of <code>jQuery.post()</code> is a dictionary with the POST request variables.  In our case we want to call our custom handler so we reference it using the <code>-action</code> parameter.</p>
</li>
<li>
<p>The 3rd parameter of <code>jQuery.post()</code> is a callback function that will be run with the action completes.  The JSON result of our action PHP handler is includd in the <code>result</code> argument.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The example above will perform an AJAX request to trigger our PHP action handler.  It will then display the result in an <code>alert()</code> dialog.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-140620-084043.111.png" alt="Image 140620 084043.111">
</div>
<div class="title">Figure 32. The hello action displayed in the record actions menu.</div>
</div>
<div class="paragraph">
<p>This example is overly simplistic.  You can improve it in a number of ways, including:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Adding some sort of progress indicator to provide some feedback to the user while the action is processed.  This is especially important for long-running actions.</p>
</li>
<li>
<p>Add a <code>fail()</code> callback to deal with the case where the HTTP request completely fails for some reason.  The callback in this example will only be called if the handler returns a non-error HTTP status code.</p>
</li>
</ol>
</div>
<h6 id="ajax-action-solution-2" class="discrete">Solution 2: Using <code>ajax=1</code> Directive</h6>
<div class="paragraph">
<p>Xataface provides a simpler alternative to providing your own Javascript function for triggering your action handler.  You can simply specify the <code>ajax=1</code> directive for our action:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[hello]
    category=record_actions
    ajax=1</code></pre>
</div>
</div>
<div class="paragraph">
<p>This directive instructs Xataface to treat this as an AJAX action.  When the user clicks on the action button, it will issue a POST AJAX request, and it will display the result in a status message.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/ajax_action_progress.png" alt="ajax action progress">
</div>
</div>
<div class="paragraph">
<p>When the action completes, it will display the contents of the "message" property of the JSON response in a similar status dialog.  If the action fails, it will display an error message.</p>
</div>
<div class="paragraph">
<p>It expects the following properties in the JSON response:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">code</dt>
<dd>
<p>The Status code.  It will interpret any code between 200 and 299 as a success.</p>
</dd>
<dt class="hdlist1">message</dt>
<dd>
<p>The message to display to the user.</p>
</dd>
<dt class="hdlist1">silent</dt>
<dd>
<p>Optional boolean parameter that will suppress the error or success message so that the action completes silently.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="showing-progress-indicator">Showing a Progress Indicator</h3>
<h4 id="_problem_6" class="discrete">Problem</h4>
<div class="paragraph">
<p>You want to display a progress indicator when the user performs a long-running action so that the user knows that the app is doing something.</p>
</div>
<h4 id="_solution_6" class="discrete">Solution</h4>
<div class="paragraph">
<p>Use the <a href="#showInfiniteProgress">xataface.showInfiniteProgress()</a> Javascript function to show an infinite progress indicator, and <a href="#hideInfiniteProgress">xataface.hideInfiniteProgress()</a> to hide the indicator when you are done.</p>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="listingblock">
<div class="title">Modified real-world example using <code>showInfiniteProgress()</code></div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">$('button.download-btn').click(function(e) {
    // A click handler that initiates a project download
    downloadProject();
    e.preventDefault();
    return false;
});

// Boolean flag to prevent the user from double-clicking the
// download button and initiating two downloads.
var downloadInProgress = false;

// Function to download a project.  This may take a few seconds
function downloadProject() {
    if (downloadInProgress) {
        // download is already in progress
        // do nothing
        return;
    }

    downloadInProgress = true;

    // Display an infinite progress dialog to the user
    // so they know that something is happening.
    xataface.showInfiniteProgress(); <b class="conum">(1)</b>

    if (!validateFormInputs()) {
        // Some validation failed... abort

        // Hide the infinite progress
        xataface.hideInfiniteProgress(); <b class="conum">(2)</b>

        // Release the "in progress" flag so that
        //  the download button will work again.
        downloadInProgress = false;
        alert('Download failed... check form inputs');

        return;
    }




    var formData = new FormData();
    formData.append("-table", "app_templates");
    formData.append('-action', 'download_project');
    formData.append('arg1', 'foo');
    formData.append('arg2', 'bar');

    fetch(DATAFACE_SITE_HREF, {
        method : 'POST',
        body : formData
    }).then(function(response) {
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        return response.blob();
    }).then(function(blob) {
        // The download completed.
        // Now we can hide the infinite progress and
        // re-enable the download button.
        xataface.hideInfiniteProgress(); <b class="conum">(3)</b>
        downloadInProgress = false;
        var link = document.createElement('a');
        link.href = window.URL.createObjectURL(blob);
        link.download = mainName + ".zip";

        document.body.appendChild(link);

        link.click();

        document.body.removeChild(link);
    }).catch(function(error) {
        // The download failed
        // Hide the infinite progress
        xataface.hideInfiniteProgress(); <b class="conum">(4)</b>
        downloadInProgress = false;
        console.log(error);
        alert("Download failed "+error);
    });
    return;

}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>We show the infinite progress before performing the network request</p>
</li>
<li>
<p>We call <code>hideInfiniteProgress()</code> if the network request was canceled.</p>
</li>
<li>
<p>Call <code>hideInfiniteProgress()</code> when the network request completes successfully.</p>
</li>
<li>
<p>Call <code>hideInfiniteProgress()</code> if the network request fails.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The above example shows the use of <code>showInfiniteProgress()</code> to show a progress indicator when the user initiates a network request.  It calls <code>hideInfiniteProgress()</code> when the request completes or fails.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="relationships">Relationships</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="default-related-sort">Setting Default Sort for Related Lists</h3>
<h4 id="_problem_7" class="discrete">Problem</h4>
<div class="paragraph">
<p>You want sort the related record tab on a particular column by default.</p>
</div>
<h4 id="_solution_7" class="discrete">Solution</h4>
<div class="paragraph">
<p>Use the <code>table.default_sort.RELATIONSHIP_NAME</code> fields.ini directive.</p>
</div>
<div class="paragraph">
<p>Suppose we want to sort our "posts" relationship by date posted in descending order (i.e. newest first).  Then we would add the following directive to the beginning of the fields.ini file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">table.default_sort.posts=date_posted desc</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
See <a href="#default-sort">Specifying Default Sorting</a> to learn how to set the default sorting behaviour of the list view (i.e. for sorting NON-related records).
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="security">Security</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following chapters cover all things security-related in Xataface.</p>
</div>
<div class="sect2">
<h3 id="authentication">Authentication</h3>
<div class="paragraph">
<p>Xataface comes with authentication ready to roll out of the box. With a couple of configuration options in the conf.ini file, you can activate the default authentication scheme which uses a table (of your choice) in the database to authenticate against. It supports password encryption, and even includes a registration form if you choose to allow registrations for your application.</p>
</div>
<div class="paragraph">
<p>In addition Xataface&#8217;s authentication is pluggable, meaning you can write your own plug-ins to integrate your application with any authentication scheme you choose. Some authentication modules that already exist include:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="https://github.com/shannah/xataface-module-auth-cas">Yale CAS</a></dt>
<dd>
<p>A module to use <a href="https://developers.yale.edu/cas-central-authentication-service">Yale&#8217;s Central Authentication Service</a> for authentication.</p>
</dd>
<dt class="hdlist1"><a href="https://github.com/shannah/xataface-module-auth-ldap">LDAP</a></dt>
<dd>
<p>A module to use <a href="https://en.wikipedia.org/wiki/Lightweight_Directory_Access_Protocol">LDAP</a> for authentication.  There is also another, more advanced LDAP module developed by Viharm available <a href="https://bitbucket.org/viharm/xatafaceldapauth/">here</a>.</p>
</dd>
<dt class="hdlist1"><a href="https://github.com/shannah/xataface-module-auth-http">HTTP</a></dt>
<dd>
<p>A module to use standard HTTP basic authentication.</p>
</dd>
<dt class="hdlist1"><a href="https://github.com/shannah/xataface-module-oauth">OAuth</a></dt>
<dd>
<p>A module to use an <a href="https://oauth.net/">OAuth</a> service for authentication.  This module provides all of the common infrastructure required to support OAuth.  There are also modules built on this module which provide authentication using a few popular web sites such as <a href="https://github.com/shannah/xataface-module-oauth-facebook">Facebook</a>, <a href="https://github.com/shannah/xataface-module-oauth-twitter">Twitter</a>, <a href="https://github.com/shannah/xataface-module-oauth-linkedin">LinkedIn</a>, and <a href="https://github.com/shannah/xataface-module-oauth-instagram">Instagram</a>.</p>
<div class="paragraph">
<p>See <a href="#oauth">Adding OAuth2 Login Support</a> for more information about setting up OAuth authentication.</p>
</div>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="_setting_up_basic_authentication">Setting up Basic Authentication</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a table (if you haven&#8217;t already) to store your application&#8217;s users. At the bare minimum, this table should have fields to store the username and password (you may call these fields whatever you like). An example table might be:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sql" data-lang="sql">CREATE TABLE `users` (
   `username` VARCHAR(32) NOT NULL,
   `password` VARCHAR(32) NOT NULL,
   PRIMARY KEY (`username`)
)</code></pre>
</div>
</div>
</li>
<li>
<p>Add the following (<code>_auth</code> section) to your <code>conf.ini</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[_auth]
    users_table=users
    username_column=username
    password_column=password</code></pre>
</div>
</div>
<div class="paragraph">
<p>This tells Xataface which table you are storing your user accounts in, and the names of the username and password columns.</p>
</div>
</li>
<li>
<p>Add a sample user record to the <strong>users</strong> table if one does not exist yet.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sql" data-lang="sql">INSERT INTO `users` (`username`,`password`) VALUES ('steve','mypass')</code></pre>
</div>
</div>
</li>
<li>
<p>Load your application in your web browser and you&#8217;ll notice a "login" link in the upper right that allows you to log in.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_using_encryption_for_the_password">Using Encryption for the Password</h4>
<div class="paragraph">
<p>It is good practice to perform some type of encryption on passwords that you store in a database, so that they will be safe, even if your server&#8217;s security is compromised. Some common forms of encryption are SHA1 and MD5. You can apply encryption to your passwords by defining the encryption property to the <code>password</code> field&#8217;s section of the users table <code>fields.ini file</code>. E.g.</p>
</div>
<div class="listingblock">
<div class="title">fields.ini definition on the users table password field to store passwords with md5 encryption</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[password]
    encryption=md5</code></pre>
</div>
</div>
<div class="paragraph">
<p>This tells Xataface to save data to the password field of the users table with MD5 encryption.</p>
</div>
<div class="listingblock">
<div class="title">fields.ini definition on the users table password field to store passwords with <a href="https://en.wikipedia.org/wiki/SHA-1">sha1</a> encryption</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[password]
    encryption=sha1</code></pre>
</div>
</div>
<div class="paragraph">
<p>This tells Xataface to save data to the password field of the users table with <a href="https://en.wikipedia.org/wiki/SHA-1">SHA1</a> encryption.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>In order to switch to MD5 or SHA1 encryption with an existing Xataface installation, all un-encrypted (plain text) passwords must be first converted to MD5. There are several ways to do this. One method is to directly convert the passwords in the database with the MySQL MD5 or SHA1 function. This can be done from the command-line or using a tool such as phpMyAdmin.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you only have a small number of user accounts that require encryption to be updated, it may be easier to just change the passwords manually through Xataface by editing the user records.  They will be automatically encrypted according to the <code>encryption</code> directive in the fields.ini file.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_limiting_access_based_on_user">Limiting Access Based on User</h4>
<div class="paragraph">
<p>Authentication and permissions are distinct issues, but they are related. It is quite common to require a user to log in to access a section of an application. Permissions can be defined in either the Application delegate class or a table&#8217;s delegate class - or both.</p>
</div>
<div class="paragraph">
<p>As an example, if we want to require users to log in to access our application we could define the following <code>getPermissions()</code> method to our application delegate class:</p>
</div>
<div class="listingblock">
<div class="title">Application delegate class with <code>getPermissions()</code> implemented.  This implementation allows ALL access to logged in users, and NO access otherwise.</div>
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">&lt;?php
class conf_ApplicationDelegate {
    function getPermissions(Dataface_Record $record=null){
        // $record is a Dataface_Record object
        $auth = Dataface_AuthenticationTool::getInstance();
        $user = $auth-&gt;getLoggedInUser();
        if ( $user ) return Dataface_PermissionsTool::ALL();
        else return Dataface_PermissionsTool::NO_ACCESS();
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_checking_who_is_logged_in">Checking Who Is Logged In</h4>
<div class="paragraph">
<p>The <code>Dataface_AuthenticationTool</code> class handles all of the dirty work of Xataface&#8217;s authentication. It provides public methods to check who is logged in and perform authentication if necessary. Anywhere inside your Xataface application you can find out who is logged in using one of the following two methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>getLoggedInUser()</code> - Returns a Dataface_Record object representing a record from the users table.</p>
</li>
<li>
<p><code>getLoggedInUsername()</code> - Returns a string.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is quite useful in the <code>getPermissions()</code> method of your delegate classes to find out who is logged in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">function getPermissions(Dataface_Record $record=null){
    $auth = Dataface_AuthenticationTool::getInstance();
    $user = $auth-&gt;getLoggedInUser();
    if ( $user and $user-&gt;val('username') == 'shannah' ){
        // Steve is logged in so we give him special permissions
        return Dataface_PermissionsTool::ALL();
    } else {
        // Steve is not logged in so we give only read only permissions
        return Dataface_PermissionsTool::READ_ONLY();
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_checking_who_is_logged_in_from_a_template">Checking Who is Logged In from a Template</h4>
<div class="paragraph">
<p>All templates in Xataface have access to the <code>$ENV</code> array that contains references to lots of useful information, including the currently logged in user:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>$ENV.user</code></dt>
<dd>
<p>The user object of the currently logged in user (or null if nobody is logged in). This is a Dataface_Record object.</p>
</dd>
<dt class="hdlist1"><code>$ENV.username</code></dt>
<dd>
<p>The name of the currently logged in user. A string.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">&lt;!--
     Print 'Hello Steve' if Steve is logged in,
     'Hello Helen' if Helen is logged in, or just
     'Hello' if nobody is logged in.
--&gt;
Hello {$ENV.username}

&lt;!-- Print some personal user info --&gt;
{if $ENV.user}
    Phone number: {$ENV.user-&gt;val('phone')}&lt;br/&gt;
    Email address: {$ENV.user-&gt;val('email')}&lt;br/&gt;
{/if}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example presumes that the users table has <code>phone</code> and <code>email</code> fields.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="user-registration">Allowing User Registration</h3>
<div class="paragraph">
<p>By default, there is no way for users to create an account themselves.  A user account would need to be set up by the system administrator first.  If you want users to be able to register for accounts themselves, you can add the <code>allow_register=1</code> directive to the <code>_auth</code> section of the conf.ini file.</p>
</div>
<div class="paragraph">
<p>E.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[_auth]
    users_table=users
    username_column=username
    password_column=password
    email_column=email <b class="conum">(1)</b>
    allow_register=1 <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The <code>email_column</code> directive specifies the column that should store the user&#8217;s email address. This is required for user registration since it needs to send an activation email to verify the user&#8217;s email address.</p>
</li>
<li>
<p>The <code>allow_register=1</code> directive turns on user registration.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>With these settings, the login form will now contain a "Register" link as shown below:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-030121-074342.100.png" alt="Image 030121 074342.100">
</div>
</div>
<div class="paragraph">
<p>If the user clicks on this link, they&#8217;ll be taken to a registration form, which is basically a "new record" form on the Users table.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-030121-074655.819.png" alt="Image 030121 074655.819">
</div>
<div class="title">Figure 33. A plain-Jane registration form which contains fields from the users table.</div>
</div>
<div class="paragraph">
<p>The difference between the registration form and the New record form is that the registration form doesn&#8217;t immediately add records into the database.  When the user submits the form, it stores the data in a special registrations table, and sends the user an email with a link to confirm their registration.  If the user clicks on this link, it will then copy the registration information into an actual record of the users table and save it.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><strong>Recommended Users Table Permissions</strong></p>
</div>
<div class="paragraph">
<p>The registration form includes all fields of the users table that grants the "register" permission.  The register permission is the <strong>only</strong> permission that is part of the "NO ACCESS" role, and it is not included in any of the default roles.  Ideally you should be explicit about which fields of the users table you grant the "register" permission on.</p>
</div>
<div class="paragraph">
<p>The following is a snippet from the delegate class for the users table of an application which demonstrates one way to define permissions.</p>
</div>
<div class="listingblock">
<div class="title">Delegate class of users table which provides read-only access to the user record owner, and no access to other users.  It also grants the 'register' permission on the "username", "password", and "email" fields.</div>
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">&lt;?php
class tables_users {

    /**
     * Record/Table-level permissions.
     * Admins = ALL access
     * Owner (i.e. the user whose record this represents) = READ ONLY access
     * Non-logged in user = Only 'register' permission
     * Other users = NO ACCESS
     */
    function getPermissions(Dataface_Record $rec = null) { <b class="conum">(1)</b>
        if (isAdmin()) {
            // Admins get ALL access (this defers to application delegate class
            // which grants all access to admin).
            return null;
        }
        $user = getUser();
        if ($user and $rec and $rec-&gt;val('userid') == $user-&gt;val('userid')) {
            // This record is the user record for the current user.
            // give him read only access.
            return Dataface_PermissionsTool::READ_ONLY();
        }
        $user = getUser();
        if (!$user) {
            // User is not logged in.
            // Grant the 'register' permission to allow the register action
            // to work properly.
            return array('register' =&gt; 1);
        }

        // No access to anyone else.
        // This defers to the application delegate class which grants no
        // access to non-admin users.
        return null;
    }

    /**
     * Default field permissions.
     * Non-Logged-in users = Deny the 'register' permission
     * All other users = Defer to record-level permissions.
     */
    function __field__permissions(Dataface_Record $rec = null) { <b class="conum">(2)</b>
        $user = getUser();
        if (!$user) {
            return array('register' =&gt; 0);
        }
    }

    /**
     * Permissions for username field.
     * Non-logged-in users = Allow the 'register' permission.
     * All other users = Default to default field permissions.
     */
    function username__permissions(Dataface_Record $rec = null) { <b class="conum">(3)</b>
        $user = getUser();
        if (!$user) {
            return array('register' =&gt; 1);
        }
    }

    /**
     * Permissions for password field.
     * Non-logged-in users = Allow the 'register' permission.
     * All other users = Default to default field permissions.
     */
    function password__permissions(Dataface_Record $rec = null) { <b class="conum">(4)</b>
        $user = getUser();
        if (!$user) {
            return array('register' =&gt; 1);
        }
    }

    /**
     * Permissions for the email field.
     * Non-logged-in users = Allow register permission.
     * All other users = Default to default field permissions.
     */
    function email__permissions(Dataface_Record $rec = null) { <b class="conum">(5)</b>
        $user = getUser();
        if (!$user) {
            return array('register' =&gt; 1);
        }
    }

    // ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><code>getPermissions()</code> defines record-level permissions.</p>
</li>
<li>
<p><code><em>field</em>permissions()</code> defines default field-level permission overrides.  In this case we are denying the "register" permission by default so that no fields appear on the registration form by default.</p>
</li>
<li>
<p><code>username__permissions()</code> overrides permissions of the "username" field to grant the "register" permission, so that it will appear on the registration form.</p>
</li>
<li>
<p><code>password__permissions()</code> overrides the permissions of the "password" field to grant the "register" permission, so that it will appear on the registration form.</p>
</li>
<li>
<p><code>email__permissions()</code> overrides permissions of the "email" field.</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
This snippet makes use of the <code>getUser()</code> and <code>isAdmin()</code> functions which are not a part of the Xataface public API.  They are defined separately in this app. You can see sample implementations of these functions <a href="https://github.com/shannah/xataface/blob/master/snippets/functions.inc.php">here</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_disabling_email_validation">Disabling Email Validation</h4>
<div class="paragraph">
<p>By default the registration form doesn&#8217;t create the account directly.  It will first send a validation email to the user.  When the user clicks on the "activation link" in this email, the account is created and the user is automatically logged in.</p>
</div>
<div class="paragraph">
<p>If you with to skip this step, and have the registration form create accounts directly, you can override the "register" action in your actions.ini file and override the "email_validation" directive as follows:</p>
</div>
<div class="listingblock">
<div class="title">actions.ini file overriding "register" action to skip the email validation step.</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[register &gt; register]
  email_validation=0</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="email-login">Enabling Email Login</h3>
<div class="paragraph">
<p>I hate passwords.  I hate having to think of a new password every time I register for a website, as I know I won&#8217;t remember it.  When visiting a website for the first time in a while, I almost always need to use the "Forgot Password" function.  This process is painful as it requires several extra steps, and, at the end of it all, I&#8217;m forced to create yet another password that I won&#8217;t remember.</p>
</div>
<div class="paragraph">
<p>In many cases a better option is for the site to support "Email Login" directly.  The workflow for email login is simple:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The login form has a single field for "Email", and a button "Email Login Link" as shown here:</p>
<div class="imageblock">
<div class="content">
<img src="images/Image-030121-082425.813.png" alt="Image 030121 082425.813">
</div>
</div>
</li>
<li>
<p>The user enters their email address and presses "Email Login Link".</p>
</li>
<li>
<p>An email is sent to the user&#8217;s email with a single-use link to log into the app.  The email looks like the following:</p>
<div class="imageblock">
<div class="content">
<img src="images/Image-030121-071452.674.png" alt="Image 030121 071452.674">
</div>
</div>
</li>
<li>
<p>The user clicks on the link and they are logged in directly without being hassled to enter a password.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To enable Email login, your users table must have an email field.  You may use the "username" field to store the email address if you like, but the <code>_auth</code> section of the conf.ini file needs to declare which field contains the email.</p>
</div>
<div class="listingblock">
<div class="title">conf.ini authentication settings which enables email login.</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[_auth]
    users_table=users
    username_column=username
    password_column=password
    email_column=email <b class="conum">(1)</b>
    allow_email_login=1 <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><code>email_column</code> directive, specifying that the user email address is stored in the "email" column.</p>
</li>
<li>
<p><code>allow_email_login</code> directive enables Email login.</p>
</li>
</ol>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you are allowing users to log in with their email address, you should take some care to prevent duplicate emails.  Xataface puts some automatic safe-guards in place such as login won&#8217;t work if it finds two user accounts with the same email address.  You should additionally add a Unique Key/Index on your email column to further prevent users from having the same email address.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>While you <strong>can</strong> use the same field for the username and email address, but I don&#8217;t recommend this as users sometimes change their email address, and the username should stay unchanged to ensure referential integrity.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With these directives in place, the login form will look something like the following:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-030121-082425.813.png" alt="Image 030121 082425.813">
</div>
</div>
<div class="paragraph">
<p>Notice that there is a link to "log in with password".  Pressing this link will toggle back to the password login form:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-030121-082619.526.png" alt="Image 030121 082619.526">
</div>
</div>
<div class="paragraph">
<p>Also notice that there is still a "Forgot password" option, in case the user would prefer to log in with their password.</p>
</div>
<div class="sect3">
<h4 id="_disabling_password_login">Disabling Password Login</h4>
<div class="paragraph">
<p>If you have email login enabled, you can optionally disable password login entirely.  This may make sense for some services, in the spirit of "less is more" in terms of usability.  You can use the <code>allow_password_login=0</code> directive in the <code>_auth</code> section of the conf.ini file to achieve this:</p>
</div>
<div class="listingblock">
<div class="title">conf.ini file with password login disabled.</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[_auth]
    users_table=users
    username_column=username
    password_column=password
    email_column=email
    allow_email_login=1
    allow_password_login=0 <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The <code>allow_password_login</code> directive disables password login so that email login is the only option.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>With these options, the login form will not include the "or log in with password" link as shown below:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-030121-082708.897.png" alt="Image 030121 082708.897">
</div>
<div class="title">Figure 34. Login form with password login disabled</div>
</div>
<div class="paragraph">
<p>Also notice that the "Forgot Password" option is no longer displayed.  With <code>allow_password_login=0</code> you&#8217;ll also notice that there is no "Change Password" option once logged in.</p>
</div>
</div>
<div class="sect3">
<h4 id="_requesting_short_login_code">Requesting Short Login Code</h4>
<div class="paragraph">
<p>In some cases a login link may not be the ideal format for the second step of email login.  For example, if you are requesting a login link for a mobile app, it may be easier to provide the user with a short login code in their email which they can enter in the app to complete the login.  This is disabled by default because a shorter login code is a little bit less secure than a full login token.</p>
</div>
<div class="paragraph">
<p>Short login codes can be enabled for <a href="#api-authentication">API Authentication</a> only using the following workflow:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add the <code>short_token_length</code> directive to the <code>[_auth]</code> section of the conf.ini file to set the number of characters in the login code. E.g.</p>
<div class="listingblock">
<div class="title">Setting login code length to 6 in conf.ini file.</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[_auth]
    ...
    short_token_length=6</code></pre>
</div>
</div>
</li>
<li>
<p>Send a <em>POST</em> request to the <em>xf_email_login</em> action with the following parameters:</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-action</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">xf_email_login</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">--redirectUrl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any URL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">--email</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The email address of the account</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">--request-login-code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">--remember-me</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0 or 1.  1 indicates that the login should be sticky.</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>This will trigger an email to the user with the login code.  The email will include the code as shown below.</p>
<div class="imageblock">
<div class="content">
<img src="images/request-login-code-email.png" alt="request login code email">
</div>
</div>
<div class="paragraph">
<p>The user would copy this code into your app</p>
</div>
</li>
<li>
<p>Your app would then issue a login request with this code as the <code>--token</code> parameter, using a POST request with the following parameters:</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-action</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">login</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">--token</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The login code that the user entered as received in their email.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">--no-prompt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>The HTTP request should include the header <code>Content-type: application/x-www-form-urlencoded</code></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See <a href="#api-authentication">API Authentication</a> for more details about API authentication.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="email-registration">Email Registration</h4>
<div class="paragraph">
<p>The email login examples shown thus far have not included user registration. (See <a href="#user-registration">Allowing User Registration</a>), but it is fully supported.  If the user clicks on the "Email Login Link", and there is a valid email address in the Email field, it will always at least "pretend" to send a login email.  I.e. it will always display the following dialog:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-030121-083336.042.png" alt="Image 030121 083336.042">
</div>
</div>
<div class="paragraph">
<p>This is for security purposes to prevent malicious actors from testing different email addresses to see if they have an account.</p>
</div>
<div class="paragraph">
<p>However, depending on your authentication configuration, it will do something different.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">If <code>allow_register=0</code> or <code>allow_register</code> is not set</dt>
<dd>
<p>The system won&#8217;t send an email at all, but it will log this to the PHP error log.</p>
</dd>
<dt class="hdlist1">If <code>allow_register=1</code></dt>
<dd>
<p>The system will send an email, but instead of a login link, it will include a link to the registration form.  The email will look something like:</p>
<div class="imageblock">
<div class="content">
<img src="images/Image-030121-083758.534.png" alt="Image 030121 083758.534">
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_enabling_auto_registration">Enabling Auto-Registration</h4>
<div class="paragraph">
<p>Xataface supports an auto-registration feature that helps to minimize the amount of friction involved in creating a user account.  When Auto-registration is enabled, the "Email login link" will work (almost) identically for existing user accounts as they do for non-existent accounts.</p>
</div>
<div class="paragraph">
<p>To enable auto-registration, you can add the <code>auto_register=1</code> directive to the <code>_auth</code> section of your conf.ini file.  E.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[_auth]
    users_table=users
    username_column=username
    password_column=password
    email_column=email
    allow_register=1 <b class="conum">(1)</b>
    allow_email_login=1
    auto_register=1 <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The <code>auto_register=1</code> directive turns on auto-registration.</p>
</li>
<li>
<p>The <code>allow_register=1</code> directive is required for auto-registration to work.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Auto-registration pertains to the scenario when a user presses the "Email Login Link" and they don&#8217;t already have an account on the system.  The "normal" workflow, in this case is to send a registration link (if <code>allow_register=1</code>), which takes the user to the registration form.</p>
</div>
<div class="paragraph">
<p>With <code>auto_register=1</code>, the register link simply creates an account for the user and logs them in directly, without visiting any registration form.</p>
</div>
<div class="paragraph">
<p>This presents the minimum amount of friction possible for creating new accounts.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><strong>The Register Action</strong></p>
</div>
<div class="paragraph">
<p>If you have email authentication enabled (i.e. <code>allow_email_login=1</code>), password authentication disabled (i.e. <code>allow_password_login=0</code>), and auto registration enabled (i.e. <code>auto_register=1</code> and <code>allow_register=1</code>), then the "Register" link will still appear on the login form, <strong>but</strong> it will merly display a prompt advising the user to use the "Email Login Link" button to create an account.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="session-config">Session Configuration</h3>
<div class="paragraph">
<p>By default, Xataface authentication uses <a href="https://www.php.net/manual/en/book.session.php">PHP sessions</a>, which relies on a SESSION ID cookie to link requests to a session file on the server file system.  The logged in username is stored in the <code>$_SESSION['UserName']</code> variable.  If you want to log the user out programmatically, you could simply unset this variable, or destroy the session.  Most of the time, however, it is recommended that you just use the built-in Xataface workflows for login/logout.</p>
</div>
<div class="paragraph">
<p>The three most common aspects of sessions that developers want to configure are:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>The Cookie Timeout</strong> - E.g. When should the cookie expire.  This can be configured using the <code>session_timeout</code> property in the <code>_auth</code> section of the conf.ini file.  The default value is "0", meaning that the cookie will persist in the browser until the browser is closed.</p>
</li>
<li>
<p><strong>The Cookie Path</strong> - E.g. What path in your app&#8217;s domain will have access to the session cookie.  By default the cookie is only availalble to the application root.  E.g. If your application is located at <code><a href="http://example.com/path/to/myapp/index.php" class="bare">http://example.com/path/to/myapp/index.php</a></code>, then the cookie path will be "/path/to/myapp/".  Therefore scripts running under "/path/to/anotherapp/" won&#8217;t be able to access the cookie (and thus won&#8217;t share sessions with this app).  Neither will scripts in a parent directory (e.g. <code><a href="http://example.com/anotherscript.php" class="bare">http://example.com/anotherscript.php</a></code>).  Only scripts under the path <code>/path/to/myapp/&#8230;&#8203;</code> will have access to the session cookie.  This can be configured using the <code>cookie_path</code> property in the <code>_auth</code> secton of the conf.ini file.</p>
</li>
<li>
<p><strong>Garbage Collection Timeout</strong> - E.g. How long after a session is idle, before the server will delete the session files.  By default this is set to 5 minutes longer than the cookie timeout, and thus, can be configured using the same <code>session_timeout</code> property.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Example Settings</strong></p>
</div>
<div class="listingblock">
<div class="title">Example session configuration in conf.ini file</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[_auth]
  session_timeout = 86400   ; 1 day
  cookie_path=/             ; Session cookie available to whole domain
  session_name=my_app_sid   ; Optional custom session name to avoid collisions with other apps</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="auto-login">Auto-Login Support</h3>
<div class="paragraph">
<p>In some cases you may want your sessions to last "forever".  I.e. If the user logs in once, you want them to stay logged in forever- or until they explicitly log out.  Your first instinct might be to use the <code>session_timeout</code> directive to a really big number so that sessions last for 10 years.  This is problematic for two reasons:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Keeping session files lingering for 10 years can fill up your server disk space pretty quickly.  Especially on sites that get a lot of traffic.</p>
</li>
<li>
<p>Some servers may thwart your intentions and delete the session files despite your explicit intention to keep them.  Especially on a shared server, it can be difficult to get full cooperation of the server to <strong>not</strong> delete those session files.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A better alternative is to activate "auto-login" support in your app.  With auto-login support enabled, the login form will include a "Remember me" checkbox as shown below:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-170121-124319.613.png" alt="Image 170121 124319.613">
</div>
</div>
<div class="paragraph">
<p>If the user checks this box, it will save a token on the server (in the <code>dataface__autologins</code> table), add a long-lived cookie.  If the user tries to load a page a few days later, Xataface will first try to load the session.  If none is found, it will look for an "autologin" cookie to and, if found, it will log the user in automatically, starting a new session seamlessly.</p>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="listingblock">
<div class="title">Sample conf.ini file with auto-login support enabled.</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[_auth]
    users_table=users
    username_column=username
    password_column=password
    email_column=email
    allow_register=1
    allow_email_login=1
    allow_password_login=1
    auto_register=1
    autologin=1 <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The <code>autologin</code> directive which enables autologin support.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_auto_login_configuration_directives">Auto-Login Configuration Directives</h4>
<div class="paragraph">
<p>You can customize the behaviour of the auto-login support using the following directives, which all go in the <code>_auth</code> section of the conf.ini file.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>autologin_cookie</code></dt>
<dd>
<p>The name of the cookie to use for storing the autologin token.  Default is "xf_pulse"</p>
</dd>
<dt class="hdlist1"><code>autologin.logout_all_devices</code></dt>
<dd>
<p>Set to "1" to cause the autologin tokens to be invalidated for ALL devices when the user logs out.  By default, when the user logs out, it will invalidate the autologin token in the current device, but if they are logged in on other devices, it will leave those untouched.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="oauth2">OAuth2 Authentication</h3>
<div class="paragraph">
<p>Xataface supports Oauth2 authentication via the <a href="https://github.com/shannah/xataface-module-oauth">oauth module</a>.  This module provides all of core functionality to support OAuth2.
There are also modules built to provide Oauth support for specific services, such as <a href="https://github.com/shannah/xataface-module-oauth-facebook">Facebook</a>, <a href="https://github.com/shannah/xataface-module-oauth-twitter">Twitter</a>, <a href="https://github.com/shannah/xataface-module-oauth-linkedin">LinkedIn</a>, and <a href="https://github.com/shannah/xataface-module-oauth-instagram">Instagram</a>. These "sub" modules all depend on the core <a href="https://github.com/shannah/xataface-module-oauth">oauth module</a>.  They simply provide a few specific configuration settings to support OAuth2 on those services.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>OAuth 2.0 is the industry-standard protocol for authorization. OAuth 2.0 focuses on client developer simplicity while providing specific authorization flows for web applications, desktop applications, mobile phones, and living room devices. This specification and its extensions are being developed within the IETF OAuth Working Group.</p>
</div>
<div class="paragraph">
<p>For more information about the Oauth2 spec, see <a href="https://oauth.net/2/">the official OAuth 2.0 website</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="oauth">Adding OAuth2 Login Support</h4>
<div class="paragraph">
<p>The first step toward adding OAuth2 support in your app, is to download the <a href="https://github.com/shannah/xataface-module-oauth">oauth module</a> into the <code>modules</code> directory of your application. E.g.</p>
</div>
<div class="paragraph">
<p><code>modules/oauth/oauth.php</code></p>
</div>
<div class="paragraph">
<p>And add a a corresponding entry to the <code>[_modules]</code> section of your conf.ini file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[_modules]
  modules_oauth=modules/oauth/oauth.php</code></pre>
</div>
</div>
<div class="paragraph">
<p>You&#8217;ll also need to add the <code>pre_auth_types</code> entry to the <code>[_auth]</code> section oc your conf.ini file:</p>
</div>
<div class="listingblock">
<div class="title">Adding <code>pre_auth_types=oauth_token</code> to the <code>_auth</code> section of your conf.ini file instructs Xataface to attempt authentication using the oauth</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[_auth]
    users_table=users
    username_column=username
    password_column=password
    pre_auth_types=oauth_token</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="api-authentication">API Authentication</h3>
<div class="imageblock">
<div class="content">
<img src="images/Image-140420-113308.724.png" alt="Image 140420 113308.724">
</div>
<div class="title">Figure 35. Login sequence using example curl HTTP request.</div>
</div>
<div class="paragraph">
<p>Xataface provides a REST API for authentication so that you can access your application using a REST client.  When using this API, you&#8217;ll perform a request to the "login" action to obtain an authentication token.  You can then make authenticated requests to your app by adding this token in the Authorization header as a bearer token.</p>
</div>
<h4 id="_login" class="discrete">Login</h4>
<div class="paragraph">
<p>To log in using the API, simply perform a POST request to <code>?-action=login&amp;--no-prompt=1</code></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>UserName</code> - The username to log in with.</p>
</li>
<li>
<p><code>Password</code> - The password to log in with.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If login succeeds, you&#8217;ll receive a JSON response with a token.  E.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "code":200,
  "token":"576646...2dDRuOGUycGI=",
  "message":"Logged in"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>An unsuccessful login will look something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{"code":500,"message":"No UserName provided."}</code></pre>
</div>
</div>
<h4 id="_making_authenticated_requests" class="discrete">Making Authenticated Requests</h4>
<div class="paragraph">
<p>Once you have obtained a token, you should include this token in the <code>Authorization</code> header of HTTP requests.  E.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">curl -H 'Authorization: Bearer {TOKEN}' https://example.com?index.php</code></pre>
</div>
</div>
<div class="paragraph">
<p>But replace <code>{TOKEN}</code> with your token received during login.</p>
</div>
<h4 id="_logging_out" class="discrete">Logging Out</h4>
<div class="paragraph">
<p>To log out, simply perform a POST or GET request to <code>?-action=logout&amp;--no-prompt=1</code></p>
</div>
</div>
<div class="sect2">
<h3 id="relationship-permissions">Relationship Permissions</h3>
<div class="paragraph">
<p>As relationships are a core feature of Xataface, it is helpful to understand how to handle permissions on related records. Even if you apply permissions to every table individually, you need to take into account the relationships that you have defined between tables, because they may open access to actions that you did not intend.</p>
</div>
<div class="paragraph">
<p>For example, suppose we have two tables: <em>people</em> and <em>publications</em>, and we have a relationship from <em>publications</em> table to the people table called publication_authors.</p>
</div>
<div class="paragraph">
<p>Suppose you give a user write access to a record of the <em>publications</em> table, but no access to the <em>people</em> table. If you are allowing the <em>add new related record</em> permission on the <em>publications</em> table record, then the user will still be able to add new people, via the "Add related people record" function of the database. This may or may not be desirable.</p>
</div>
<div class="paragraph">
<p>This section discusses the issues that arise due to relationships and permissions, and how to deal with them.</p>
</div>
<div class="paragraph">
<p>The Xataface <a href="#permissionsini-file">permissions.ini file</a> defines a handful of permissions that are related to the management of related records. These include:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">add new related record</dt>
<dd>
<p>Permission to add a new related record to a relationship.</p>
<div class="paragraph">
<p><strong>Roles:</strong> <code>EDIT</code>, <code>DELETE</code>, <code>OWNER</code>, <code>ADMIN</code>, <code>MANAGER</code></p>
</div>
</dd>
<dt class="hdlist1">add existing related record</dt>
<dd>
<p>Permission to add an existing record to a relationship.</p>
<div class="paragraph">
<p><strong>Roles:</strong> <code>EDIT</code>, <code>DELETE</code>, <code>OWNER</code>, <code>ADMIN</code>, <code>MANAGER</code></p>
</div>
</dd>
<dt class="hdlist1">remove related record</dt>
<dd>
<p>Permission to remove a record from a relationship. (This only allows removing a record from the relationship - not deleting the record from the database, so this is only really relevant in a many-to-many relationship).
<strong>Roles:</strong> <code>EDIT</code>, <code>DELETE</code>, <code>OWNER</code>, <code>ADMIN</code>, <code>MANAGER</code></p>
</dd>
<dt class="hdlist1">delete related record</dt>
<dd>
<p>Permission to delete a related record. This allows both removing the related record from the relationship, and deleting the record from the database. This permission is not included in any default roles. A combination of permission for remove related record? in the source table and delete? in the target table, are equivalent to access to this permission. Use this permission only when you need to override the ability to delete records from the database based on membership in a relationship.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><strong>Roles:</strong> -</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">view related records</dt>
<dd>
<p>Permission to view the records of a relationship.</p>
<div class="paragraph">
<p>Roles: <code>READ ONLY</code>, <code>EDIT</code>, <code>DELETE</code>, <code>OWNER</code>, <code>ADMIN</code>, <code>MANAGER</code></p>
</div>
</dd>
<dt class="hdlist1">related records feed</dt>
<dd>
<p>Permission to access the RSS feed of a relationship.</p>
<div class="paragraph">
<p><strong>Roles:</strong> <code>READ ONLY</code>, <code>EDIT</code>, <code>DELETE</code>, <code>OWNER</code>, <code>ADMIN</code>, <code>MANAGER</code></p>
</div>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="_fine_grained_per_relationship_permissions">Fine-grained, Per-relationship Permissions</h4>
<div class="paragraph">
<p>You may often find that defining a flat set of permissions to all relationships on a record is insufficient for your purposes, because some relationships may demand different access levels than others. You can override the permissions for any particular relationship by implementing the <code>rel_relationshipname__permissions</code> method in the table&#8217;s delegate class, where <em>relationshipname</em> is the name of the relationship.</p>
</div>
<div class="paragraph">
<p>e.g. Consider the relationship manufacturers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">function rel_manufacturers__permissions($record){
    // $record is a Dataface_Record object
    return ['view related records' =&gt; 0];
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will tell xataface that users should not be able to view related records on the <em>manufacturers</em> relationship. This will override any permissions that were defined in the <code>getPermissions</code> method.</p>
</div>
</div>
<div class="sect3">
<h4 id="_more_complete_example">More Complete Example</h4>
<div class="paragraph">
<p>In the following example, we design a products database. We use two relationships on our products table.  One to keep track of the parts that are used in our product. The other to keep track of the users that are allowed to edit our products.</p>
</div>
<div class="paragraph">
<p>We want to make it so that only the product owner can manage the editors for a product, but anyone in the <em>product_editors</em> relationship is allowed to edit the product or add/remove parts from the product.</p>
</div>
<div class="paragraph">
<p>We don&#8217;t want to give any users access directly to the <em>parts</em>, <em>product_parts</em>, or <em>product_editors</em> tables. We want all access to go through the relationships on the products table.</p>
</div>
<div class="sect4">
<h5 id="_databaserelationship_design">Database/Relationship Design</h5>
<div class="paragraph">
<p>Consider a database with five tables:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>products (product_id, product_name, owner_username)</code></p>
</li>
<li>
<p><code>parts (part_id, part_name)</code></p>
</li>
<li>
<p><code>product_parts (part_id, product_id)</code></p>
</li>
<li>
<p><code>product_editors (product_id, editor_username)</code></p>
</li>
<li>
<p><code>users (username, password, role)</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>And we have the following relationships on the <em>products</em> table:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[parts]
parts.part_id=product_parts.part_id
product_parts.product_id="$product_id"

[editors]
product_editors.product_id="$product_id"</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_application_permissions_very_restrictive">Application Permissions : Very Restrictive</h5>
<div class="paragraph">
<p>Like a good boyscout, we define our default permissions in the Application Delegate Class to be very restrictive: Don&#8217;t let anyone do anything.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">class conf_ApplicationDelegate {
    function getPermissions($record){
        return Dataface_PermissionsTool::NO_ACCESS();
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_products_table_permissions_less_restrictive">Products Table Permissions: Less restrictive</h5>
<div class="paragraph">
<p>Now we open it up for our products table in the getPermissions() method of the products delegate class.</p>
</div>
<div class="listingblock">
<div class="title">In tables/products/products.php:</div>
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">class tables_products {
    function getPermissions(Dataface_Record $record = null){
        $user = Dataface_AuthenticationTool::getInstance()
                -&gt;getLoggedInUser();
        if ($user and $record and $record-&gt;val('owner_username') == $user-&gt;val('username')){
            // Give the record owner Edit permissions on the product
            return Dataface_PermissionsTool::getRolePermissions('EDIT');
        }

        // Everybody else gets read only access to the products table.
        return Dataface_PermissionsTool::READ_ONLY();
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_checking_if_the_current_user_is_an_editor">Checking if the current User is an Editor</h5>
<div class="paragraph">
<p>So far we have given the product owner <em>edit</em> permissions and everyone else <em>read only</em> permissions. We still need to allow editors to edit the product. In order to do this we need to be able to <em>efficiently</em> find out if the current user is an editor of a particular product. There are a few different ways to do this, but some are better than others. Some strategies include:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Perform an SQL query inside the <code>getPermissions</code> method to see if the user is an editor for the product</dt>
<dd>
<p><strong>THIS IS VERY BAD!!!</strong> The <code>getPermissions</code> method should not include any IO or database queries because it is called a large number of times per request&#8230;&#8203; making expensive calls in this method will slow down your app dramatically.</p>
</dd>
<dt class="hdlist1">Create a function to load and cache all of the current user&#8217;s products so that this can be easily checked at will.</dt>
<dd>
<p>This is fine if the user is expected be able to edit only a few products. If he could be an editor for thousands of products, this may not be practical as it will cause you to have to load thousands of records into memory on every page request.</p>
</dd>
<dt class="hdlist1">Use the <code>__sql__</code> method of the delegate class to create a grafted field on the products table indicating whether the current user is an editor for the product</dt>
<dd>
<p>This results in a very quick and accessible indicator variable that can be used in the <code>getPermissions</code> method to check to see if the current user is an editor for the current product. E.g. In the <em>tables/products/products.php</em> file (delegate class):</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">function __sql__(){
    return sprintf("select p.*, pe.editor_username from products p
            left join product_editors pe on p.product_id=pe.product_id
            where pe.editor_username='%s'",
            addslashes(Dataface_AuthenticationTool::getInstance()-&gt;getLoggedInUsername())
    );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will result in a situation where product records will have an additional field editor_username which will either be blank if the current user is not an editor for the product; or will contain the current user&#8217;s username if they are an editor for the product.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_table_permissions_for_product_editors">Table Permissions for Product Editors</h5>
<div class="paragraph">
<p>Now that we have a reliable way to tell, for any given product, whether the current user is, in fact, an editor, we can ammend the <code>getPermissions</code> method of the products table to include our editor permissions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">class tables_products {
    function getPermissions($record){
        $user = Dataface_AuthenticationTool::getInstance()-&gt;getLoggedInUser();
        if ( $user and $record and $record-&gt;val('owner_username') == $user-&gt;val('username')){
            // Give the record owner Edit permissions on the product
            return Dataface_PermissionsTool::getRolePermissions('EDIT');
        }

        if ( $user and $record and $record-&gt;val('editor_username') == $user-&gt;val('username') ){
            // If the user is an editor, we give them edit permissions
            // also
            return Dataface_PermissionsTool::getRolePermissions('EDIT');
        }


        if ( $user ){
        // Other logged in users have read only access
            $perms = Dataface_PermissionsTool::READ_ONLY();
            $perms['new'] = 1; // We'll also let them add new products
            return $perms;
        }

        // Regular users just get the default permissions as
        // defined in the Application Delegate class
        return null;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>=====Removing Editor Access to the Editor Relationship</p>
</div>
<div class="paragraph">
<p>You&#8217;ll notice that at this point, the product editor has exactly the same permission as the product owner. They both have permission to add and remove records from all relationships on the product. However, we don&#8217;t want them to be able to access the editors relationship at all. We will use the <code>rel_relationshipname__permissions</code> method to override the permissions for the editors relationship.</p>
</div>
<div class="listingblock">
<div class="title">In the tables/products/products.php delegate class:</div>
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">function rel_editors__permissions($record){
    $user = Dataface_AuthenticationTool::getInstance()-&gt;getLoggedInUser();
    if ($user and $record and $record-&gt;val('owner_username') == $user-&gt;val('username')) {
        // Owners should just get their normal permissions
        return null;
    }

    if ($user and $record and $record-&gt;val('editor_username') == $user-&gt;val('username')) {
        // If the user is an editor, we give them edit permissions
        // also
        return [
            'view related records' =&gt; 0,
            'add new related record' =&gt; 0,
            'add existing related record' =&gt; 0,
            'remove related record' =&gt; 0,
            'delete related record' =&gt; 0
        ];
    }

    // Other users just get their normal permissions
    return null;

}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_assigning_product_owner_by_default">Assigning product owner by default</h5>
<div class="paragraph">
<p>With the current permissions, something funny would happen. Users have permission to add new records, but once the record is added they won&#8217;t be able to edit it because they are neither an editor nor the owner of the product. We&#8217;ll fix this by assigning the current user as the product&#8217;s owner using the beforeSave trigger in the products delegate class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">function beforeSave($record){
    $user = Dataface_AuthenticationTool::getInstance()-&gt;getLoggedInUser();
    if ( $user ){
        $record-&gt;setValue('owner_username', $user-&gt;val('username'));
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_testing_out_our_solution">Testing Out Our Solution</h5>
<div class="paragraph">
<p>In your testing of the solution, you should find the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Trying to access any table other than the products table should result in a permission denied error.</p>
</li>
<li>
<p>If you access the products table, you should be able to see a list of existing products, and the "Add New Record" action.</p>
</li>
<li>
<p>After you add a new product you should see that you are the product owner.</p>
</li>
<li>
<p>As a product owner you should see both the parts and editors tabs in your product record. You should be able to view and add new records to both of these relationships.</p>
</li>
<li>
<p>Add another user as an editor to your product, then log in as that user. You should be able to edit the product, but you shouldn&#8217;t be able to see the editors tab for the product.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="theme_customization">Theme Customization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following sections form a sort of cook book with recipes for customizing themes in Xataface.</p>
</div>
<div class="sect2">
<h3 id="changing-logo">Changing the Site Logo Image</h3>
<h4 id="_problem_8" class="discrete">Problem</h4>
<div class="paragraph">
<p>You want to use a custom logo for your application instead of the default "Xataface" logo.</p>
</div>
<h4 id="_solution_8" class="discrete">Solution</h4>
<div class="paragraph">
<p>Use the <code>site_logo</code> directive in your conf.ini file to point to your custom logo image.</p>
</div>
<div class="paragraph">
<p>E.g.</p>
</div>
<div class="listingblock">
<div class="title">conf.ini file</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">site_logo=images/my-custom-logo.png</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="alternative-logos">Responsive Logo Image</h3>
<h4 id="_problem_9" class="discrete">Problem</h4>
<div class="paragraph">
<p>You want mobile browsers to display a different logo image than desktop browsers.</p>
</div>
<h4 id="_solution_9" class="discrete">Solution</h4>
<div class="paragraph">
<p>Define the <code>[alt_logos]</code> section of your conf.ini file to specify the different images you want to use, along with the rules that define when they are used.  The values in this section are used to construct a <code>&lt;picture&gt;</code> element with corresponding <code>&lt;source&gt;</code> elements for each image.</p>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[alt_logos]
images/mobile-logo.png="media:max-width:768px"
images/desktop-logo.png="media:min-width:768px"</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, the <code>mobile-logo.png</code> will be used on devices with width smaller than 768px, and <code>desktop-logo.png</code> will be used on devices with greater tan 768px.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>[alt_logos]</code> section will be rendered as a <code>&lt;picture&gt;</code> tag by Xataface, and each row will correspond to a <code>&lt;source&gt;</code> element.  The property name (i.e. left side of the equals sign) will be rendered in the <code>srcset</code> property of the <code>&lt;source&gt;</code> tag, and the left side will be parsed as the remaining attributes.  In the above <code>[alt_logos]</code> section example, it would be rendered as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">&lt;picture&gt;
    &lt;source srcset="images/mobile-logo.png" media="max-width:768px"/&gt;
    &lt;source srcset="images/desktop-logo.png" media="min-width:768px"/&gt;
    &lt;img src="..."/&gt;   <b class="conum">(1)</b>
&lt;/picture&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The <code>&lt;img&gt;</code> tag inside the <code>&lt;picture&gt;</code> tag is used as a fallback image for browsers that don&#8217;t support the picture tag.  It will use the image that you specify in the <code>site_logo</code> directive of the conf.ini file.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For more information about the <code>&lt;picture&gt;</code> tag see the <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/picture">MDN documentation for the picture tag</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="webp-logo">Using WebP Images for the Logo</h3>
<h4 id="_problem_10" class="discrete">Problem</h4>
<div class="paragraph">
<p>You want to use a .webp image for the app logo, but some browsers (e.g. Safari) don&#8217;t support the .webp format.</p>
</div>
<div class="sect3">
<h4 id="_problem_11">Problem</h4>
<div class="paragraph">
<p>Use the <code>[alt_logos]</code> solution described in <a href="#alternative-logos">Responsive Logo Image</a>, but use the <code>type</code> attribute on the logos to specify the mimetype, so that browsers that don&#8217;t support .webp will automatically choose the format that they support.</p>
</div>
<div class="paragraph">
<p>E.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[alt_logos]
images/site-logo.webp="type:image/webp"
images/site-logo.png="type:image/png"</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>The .webp image format can result in images that are 10x smaller than the same image in .png format, without sacrificing quality.  The only catch right now is that some browsers (notably Safari) don&#8217;t support .webp.</p>
</div>
<div class="paragraph">
<p>Use the <a href="https://squoosh.app">Squoosh online app</a> to easily experiment with different image formats to find the best solution for your needs.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="adding-a-custom-stylesheet">Adding a Custom Stylesheet</h3>
<h4 id="_problem_12" class="discrete">Problem</h4>
<div class="paragraph">
<p>You want to add a custom stylesheet to your application so that you can override the default styles, and provide styles for your custom elements.</p>
</div>
<h4 id="_solution_10" class="discrete">Solution</h4>
<div class="paragraph">
<p>The <code>xf_stylesheet()</code> function can be used to inject a stylesheet into either the <code>&lt;head&gt;</code> section of the app&#8217;s page, or into the CSS bundle that is compiled by the <code>CSSTool</code>.  Let&#8217;s start with the simplest case, where you want to include the stylesheet in the entire application (i.e. it should be loaded in every page of the app), and the stylesheet is hosted on a CDN (content-delivery network).  In this case, you should place the call to <code>xf_stylesheet()</code> inside the <code>beforeHandleRequest()</code> method of the application delegate class.</p>
</div>
<div class="paragraph">
<p>e.g.</p>
</div>
<div class="listingblock">
<div class="title">The Application delegate class ("conf/ApplicationDelegate.php")</div>
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">&lt;?php
class conf_ApplicationDelegate {
    function beforeHandleRequest() {
        xf_stylesheet('https://example.com/styles.css');
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will append a <code>&lt;link rel="stylesheet"&#8230;&#8203;&gt;</code> tag  in the <code>&lt;head&gt;</code> section of every page.</p>
</div>
<h5 id="_hosting_stylesheet" class="discrete">Hosting Stylesheet</h5>
<div class="paragraph">
<p>If you want to host the stylesheet as part of the app, it is customary to create a <code>css</code> directory in your application&#8217;s main directory where you place your CSS files.  So we can copy our stylesheet into this directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>myapp/
  css/
    mystylesheet.css</pre>
</div>
</div>
<div class="paragraph">
<p>And use embed it just as before in the <code>beforeHandleRequest()</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">&lt;?php
class conf_ApplicationDelegate {
    function beforeHandleRequest() {
        xf_stylesheet('mystylesheet.css');
    }
}</code></pre>
</div>
</div>
<h5 id="_the_css_tool_and_include_paths" class="discrete">The CSS Tool and Include Paths</h5>
<div class="paragraph">
<p><code>xf_stylesheet()</code> takes an optional 2nd parameter which is a flag to indicate whether the stylesheet should be included directly in the <code>&lt;head&gt;</code> section, or bundled by the CSS tool, and injected dynamically on page load.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">xf_stylesheet('mystylesheet.css')</code></pre>
</div>
</div>
<div class="paragraph">
<p>is the same as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">xf_stylesheet('mystylesheet.css', true)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which means that the stylesheet will be bundled by the CSS tool. All stylesheets in a particular request that are included using the CSS tool are bundled together into a single minified file, which is added to the document on load.  The CSS tool has a set of include paths where it looks for CSS files to include, and these paths are treated as "roots" for all CSS files.  The "css" directory is one of these "roots" by default.  This is why we only need to specify "mystylesheet.css" in the path rather than "css/mystylesheet.css" - because all CSS files processed by the CSS tool are searched relative to the include path roots.</p>
</div>
<div class="paragraph">
<p>You can set the 2nd argument to <code>false</code> to simply include the CSS file in the `&lt;head&gt; of the document, and not have the CSS tool process it.  In this case, you would need to include the full relative path to the CSS file.  E.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">xf_stylesheet('css/mystylesheet.css', false);</code></pre>
</div>
</div>
<h5 id="_when_to_use_the_css_tool" class="discrete">When to use the CSS Tool</h5>
<div class="paragraph">
<p>With two different options for including stylesheets, you might be wondering when you should and should not use the CSS tool.  Generally, I&#8217;ll use the CSS tool if I&#8217;m building a module and I want other modules and apps to be able to override the CSS file.  However, if I&#8217;m just including a CSS file that will be used for my application styles, I won&#8217;t use the CSS tool.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you specify the CSS file using a full URL (e.g. "http://&#8230;&#8203;" or "https://&#8230;&#8203;." or "//&#8230;&#8203;"), <code>xf_stylesheet()</code> won&#8217;t use the CSS tool.  If you specify it as a relative path, it <strong>will</strong> use the CSS tool unless you explicitly add <code>false</code> as the 2nd argument.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">xf_stylesheet('mystylesheet.css');        // uses CSS tool
    // Will use ./css/mystylesheet.css
xf_stylesheet('mystylesheet.css', false); // does NOT use CSS tool
    // Will use ./mystylesheet.css
xf_stylesheet('//example.com/mystylesheet.css'); // does NOT use CSS tool
xf_stylesheet('http://example.com/mystylesheet.css'); // does NOT use CSS tool
xf_stylesheet('https://example.com/mystylesheet.css'); // does NOT use CSS tool
xf_stylesheet('https://example.com/mystylesheet.css', true); // Style Doesn't
    // 2nd arg is ignored if URL is absolute</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="changing-color-scheme">Changing the Color Scheme</h3>
<h4 id="_problem_13" class="discrete">Problem</h4>
<div class="paragraph">
<p>You want to override the default color scheme with your own color scheme.</p>
</div>
<h4 id="_solution_11" class="discrete">Solution</h4>
<div class="paragraph">
<p><strong>Add a custom stylesheet that redefines Xataface&#8217;s theme color variables</strong></p>
</div>
<div class="paragraph">
<p>Xataface uses CSS variables to define the colors for its theme.  You can create an entirely new color scheme by simply creating a custom stylesheet (see <a href="#adding-a-custom-stylesheet">Adding a Custom Stylesheet</a>) which redefines these variables.  Here is a bare-bones example of such a "theme" stylesheet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-css" data-lang="css">:root {

    --mainBgColor: white; /* Body background color */
    --mainTextColor: black; /* Default text color */
    --secondaryTextColor: #666666; /* Used for descriptions text*/

    /* Link text colors */
    --linkTextColor: #0366d6;
    --linkTextVisitedColor: Purple;
    --linkTextActiveColor: Red;

    /* Colors used for block borders */
    --highlightColor: rgb(225, 228, 232);
    --highlightColorLight: rgb(236, 239, 241);

    --trimBgColor:#f6f8fa; /* Alt background color used for striping or providing contrast */

    /** Color of text in main buttons and menu items **/
    --buttonColor: rgb(118, 118, 118);
    --buttonBgColor: #28a745;

    /** Color of text in main buttons and menu items when selected */
    --buttonSelectedColor: black;

    /** Navigation tab top border color when tab is selected */
    --tabRidgeSelectedColor: darkorange;
    --menuSelectedColor: black;
    --menuBorderColor: rgb(218, 220, 224);
    --menuBgColor: #fefefe;
    --menuColor: #888888;

    /** Navigation tab top border color when hovering over the tab. */
    --tabRidgeHoverColor: purple;

    /** The navigation tab ridge color when not selected. */
    --tabRidgeColor: #eeeeee;

    /** Bg color of tab when hovering */
    --tabHoverBgColor: rgb(244, 246, 250);

    --inputBgColor: var(--mainBgColor);
    --inputTextColor: var(--mainTextColor);
    --inputBorderColor: #666666;
    --inputFocusedBorderColor: #ffa500;

    /** Login Form-specific Colors */
    --loginFieldBgColor: #f5f5f5;   /* Input fields background */
    --loginFieldUnderlineColor: #666666;  /* Input fields underline */
    --loginFieldUnderlineFocusedColor: #28a745;
    --loginFieldLabelColor: #888888;
    --loginFieldLabelFocusedColor: #28a745;

    /* Submit buttons */
    --submitButtonBgColor: #28a745;
    --submitButtonBgImage: linear-gradient(-180deg,#34d058,#28a745 90%);
    --submitButtonTextColor: #fff;

    /* Alert and error message colors */
    --messageBorderColor: #222;
    --messageBgColor: #eaeaea;
    --messageTextColor: #333;

    /* Mobile theme footer colors.  E.g. for bottom tabs */
    --mobileFooterBgColor: #fefefe;
    --mobileFooterBorderColor: #666666;
    --mobileTabIconColor: #999999;
    --mobileTabLabelColor: #999999;
    --mobileTabIconSelectedColor: rgb(10,132,255);
    --mobileTabLabelSelectedColor: rgb(10,132,255);

    /* Mobile theme status bar/titlebar */
    --mobileStatusBarBgColor: black;
    --mobileStatusBarBorderColor: black;
    --mobileTitleTextColor: white;


    /* Mobile theme sidebar */
    --sidebarMenuTextColor: #fff;
    --sidebarTextColor: rgba(255, 255, 255, 0.50);

}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The list of CSS variables may grow or change over time.  Refer to the plone.css file in the Xataface root directory for a definitive list of styles.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following is an example "dark" theme for Xataface defined wholly overriding CSS color variables:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-css" data-lang="css">:root {
    --mainBgColor: black;
    --trimBgColor:#333333;
    --stripeBgColor: #333;
    --mainTextColor: white;
    --secondaryTextColor: #eaeaea;
    --buttonColor:white;
    --menuColor:#ddd;
    --highlightColor: #333;
    --highlightColorLight: #222;
    --menuBorderColor: #111;
    --menuBgColor:#222;
    --tabHoverBgColor: #444;
    --menuSelectedColor: white;
    --linkTextColor: #eee;
    --linkTextVisitedColor: #ddd;

    --loginFieldBgColor: #333;
    --loginFieldUnderlineColor: #666;
    --loginFieldUnderlineFocusedColor: #999;
    --loginFieldLabelColor: #eee;
    --loginFieldLabelFocusedColor: #fff;
    --submitButtonBgColor: #444;
    --submitButtonBgImage: linear-gradient(-180deg,#555,#333 90%);

    --mobileFooterBgColor: #333;
    --mobileFooterBorderColor: #555;

    --inputBgColor: #333;
    --inputBorderColor: #eee;


}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The result is:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-151020-070807.242.png" alt="Image 151020 070807.242">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-151020-070904.513.png" alt="Image 151020 070904.513">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-151020-070931.742.png" alt="Image 151020 070931.742">
</div>
</div>
</div>
<div class="sect2">
<h3 id="user-specific-stylesheet">Using Preferences to Override Color Scheme</h3>
<h4 id="_problem_14" class="discrete">Problem</h4>
<div class="paragraph">
<p>You want to use a different color scheme depending on which user is logged in, or other run-time environment factors.</p>
</div>
<h4 id="_solution_12" class="discrete">Solution</h4>
<div class="paragraph">
<p><strong>Use the <code>user_stylesheet</code> preference to specify the name of a stylesheet to use.</strong></p>
</div>
<div class="paragraph">
<p>The "user_stylesheet" preference (See <a href="#preference-directives">Preferences Directives</a>) allows you to specify the name of a stylesheet to inject into the current request.  Since preferences can be dynamically defined using the Application delegate&#8217;s <code>getPreferences()</code> method, you can easily use environment information such as the current user or the current URL to define a custom color scheme on a per-user basis.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="title">A <code>getPreferences()</code> method inside the conf/ApplicationDelegate.php file for an application that defines a custom stylesheet for user "fred".</div>
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">&lt;?php
function getPreferences() {
    $prefs = [];
    if (getUserName() == 'fred') {
        // Assuming you've defined your own getUserName() function somewhere
        $prefs['user_stylesheet'] = 'fred.css';

    }
    return $prefs;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now add a CSS file as "css/fred.css" with your custom styles for fred.</p>
</div>
<div class="paragraph">
<p>See <a href="#changing-color-scheme">Changing the Color Scheme</a> for details on changing the color scheme usinc CSS variables.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>Since preferences can also be defined statically in the conf.ini file, you can also provide a custom default stylesheet by specifying the "user_stylesheet" preference there.  E.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[_prefs]
    user_stylesheet=fred.css</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case every user would receive the fred.css file.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="user-selected-color-scheme">Allowing Users to Choose Their Own Color Scheme</h3>
<h4 id="_problem_15" class="discrete">Problem</h4>
<div class="paragraph">
<p>You want users to be able to select their own preferred color scheme.</p>
</div>
<h4 id="_solution_13" class="discrete">Solution</h4>
<div class="paragraph">
<p><strong>Add a field to the "users" table with the <code>prefs.key=user_stylesheet</code> fields.ini property.</strong></p>
</div>
<div class="paragraph">
<p>Xataface allows you to override preferences values using data from the currently logged in user&#8217;s record.  The <code>prefs.key</code> fields.ini directive allows you to specify that the value of the field, in the currently logged in user record, will be used as a value for the specified preference.</p>
</div>
<div class="paragraph">
<p>As an example, let&#8217;s add a <code>VARCHAR(100)</code> column named "stylesheet" to the "users" table.</p>
</div>
<div class="paragraph">
<p>Add the following to the "tables/users/fields.ini" file:</p>
</div>
<div class="listingblock">
<div class="title">fields.ini file definition for "stylesheet" field.</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[stylesheet]
    prefs.key=user_stylesheet
    vocabulary=stylesheets <b class="conum">(1)</b>
    widget:type=select
    widget:label="Theme"
    widget:description="Select your preferred theme"</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
I specify the location as "tables/users/fields.ini", but, of course, your path will depend on the name of your users table.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Notice that we specified a vocabulary for the vield.  We&#8217;ll define that in the valuelists.ini file.</p>
</div>
<div class="paragraph">
<p>E.g.</p>
</div>
<div class="listingblock">
<div class="title">"stylesheets" vocabulary defined in the valuelists.ini file; used as options in the stylesheet select list.</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[stylesheets]
dark.css="Dark Theme"
ocean.css="Ocean Theme"
.. etc..</code></pre>
</div>
</div>
<div class="paragraph">
<p>And, finally, ensure that we have added our stylesheets (dark.css and ocean.css) into the "css" directory of our app.</p>
</div>
<div class="paragraph">
<p>For details on creating custom color schemes using CSS, see <a href="#changing-color-scheme">Changing the Color Scheme</a>.</p>
</div>
<div class="paragraph">
<p>Now the user can change their own color scheme, by simply editing their profile inside the app.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>The user will require edit permissions for the "stylesheet"  field of their own user record in order for this solution to work.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="customize-favicon">Using a Custom favicon</h3>
<h4 id="_problem_16" class="discrete">Problem</h4>
<div class="paragraph">
<p>You want to install a custom favicon for your app.</p>
</div>
<h4 id="_solution_14" class="discrete">Solution</h4>
<div class="paragraph">
<p>Use the <code>favicon</code> block/slot.</p>
</div>
<div class="listingblock">
<div class="title">Implementing the favicon block in your ApplicationDelegate class.</div>
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">function block__favicon($params = []) {
        $icons = [
            '16x16' =&gt; '/images/AppImages/chrome/chrome-favicon-16-16.png',
            '32x32' =&gt; '/images/AppImages/firefox/firefox-generate-32-32.png',
            '96x96' =&gt; '/images/AppImages/android/android-launchericon-96-96.png'
        ];
        foreach ($icons as $sizes =&gt; $url) {
            printf('&lt;link rel="icon" type="image/png" href="%s" sizes="%s" /&gt;', htmlspecialchars($url), htmlspecialchars($sizes));
        }
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="templates">Templates</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following sections form a sort of cook book with recipes for working with Smarty Templates in Xataface</p>
</div>
<div class="sect2">
<h3 id="block-parameters">Passing Parameters to Blocks</h3>
<h4 id="_problem_17" class="discrete">Problem</h4>
<div class="paragraph">
<p>You want to pass a parameter from the template to a block so that the block can output different content depending on the parameters.</p>
</div>
<h4 id="_solution_15" class="discrete">Solution</h4>
<div class="paragraph">
<p>Add parameters as as smarty parameters on the <code>{block}</code> tag.</p>
</div>
<div class="paragraph">
<p>E.g.</p>
</div>
<div class="listingblock">
<div class="title">Smarty template defining a block named "product_description", which passes a product ID from the <code>$productId</code> smarty variable.</div>
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">{block name="product_description" productId=$productId}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The block implementation inside a delegate class may look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">function block__product_description($params = []) {
    if (@$params['productId']) {
        echo "&lt;p&gt;A description for product {$params[productId]}&lt;/p&gt;";
e
    } else {
        echo "&lt;p&gt;A generic description&lt;/p&gt;";
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p><strong>Special Parameter Names</strong></p>
</div>
<div class="paragraph">
<p>A small set of parameter names are treated specially by Xataface, so make sure your custom parameters don&#8217;t collide with these.  These special parameter names are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">name</dt>
<dd>
<p>The name of the block. (<strong>Required</strong>)</p>
</dd>
<dt class="hdlist1">table</dt>
<dd>
<p>The table name.  This dictate&#8217;s which table delegate class&#8217;s implementation for the block will be used.  The default value is the current table.  (i.e. <code>$query['-table]</code>).</p>
</dd>
<dt class="hdlist1">record</dt>
<dd>
<p>A <code>Dataface_Record</code> object referring to the record on which this parameter should operate.  This record&#8217;s table&#8217;s delegate class&#8217;s implementation for the block will be used, unless the <code>table</code> parameter is also explicitly supplied.</p>
</dd>
</dl>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="form_customization">Form Customization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following chapters form a sort of cook book with recipes for customizing forms in Xataface.</p>
</div>
<div class="sect2">
<h3 id="_multiple_tabs_in_forms">Multiple Tabs in Forms</h3>
<h4 id="_problem_18" class="discrete">Problem</h4>
<div class="paragraph">
<p>You want to split your edit/new record forms into multiple tabs</p>
</div>
<h4 id="_solution_16" class="discrete">Solution</h4>
<div class="paragraph">
<p>Use the `tab`directive in each field definition of the fields.ini file to specify the "tab" that each field should be placed in.</p>
</div>
<div class="paragraph">
<p>The tab directive of the fields.ini file specifies which tab of the record edit form a field should be displayed on. Xataface supports multiple tabs on the edit form by way of this tab directive. If no fields contain the tab directive then all fields are displayed in a single tab (named <code><em>main</em></code>).</p>
</div>
<div class="paragraph">
<p><strong>Example 1: Placing address info on separate tab</strong>
Consider the following people table:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sql" data-lang="sql">CREATE TABLE `people` (
    person_id int(11) not null auto_increment primary key,
    first_name varchar(32) not null,
    last_name varchar(32) not null,
    address varchar(100),
    city varchar(100),
    province varchar(100),
    country varchar(100),
    postal_code varchar(20)
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>We want to split the fields into two tabs: "Personal Info" and "Address Info"</p>
</div>
<div class="paragraph">
<p>We&#8217;ll do this in two steps. We use the <code>tab</code> directive to assign all address-related fields to the <code>address_info</code> tab.</p>
</div>
<div class="listingblock">
<div class="title">fields.ini file.  Assigning fields to the "address_info" tab.</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[address]
    tab=address_info

[city]
    tab=address_info

[province]
    tab=address_info

[country]
    tab=address_info

[postal_code]
    tab=address_info</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, when we load the edit form of the people table, we see two tabs: "__main__" and "address_info"</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-090620-092422.464.png" alt="Image 090620 092422.464">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-090620-092436.892.png" alt="Image 090620 092436.892">
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<code>__main__</code> is the name assigned to the default tab (for all fields that don&#8217;t have a tab defined explicitly.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Customizing the tab labels</strong></p>
</div>
<div class="paragraph">
<p>Next we will customize the tab labels by adding the following to the beginning of the fields.ini file:</p>
</div>
<div class="listingblock">
<div class="title">Defining the tabs in the fields.ini file.</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[tab:__main__]
    label="Personal Information"

[tab:address_info]
    label="Address Information"</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-090620-092537.254.png" alt="Image 090620 092537.254">
</div>
</div>
<div class="paragraph">
<p><a href="http://media.weblite.ca/files/photos/Picture%2012.png?max_width=640" class="bare">http://media.weblite.ca/files/photos/Picture%2012.png?max_width=640</a></p>
</div>
<div class="paragraph">
<p><strong>Reordering the tabs</strong></p>
</div>
<div class="paragraph">
<p>If we want to reorder the tabs so that the "address_info" tab comes first, we would just reorder the definitions of the tabs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[tab:address_info]
    label="Address Information"

[tab:__main__]
    label="Personal Information"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_delegating_new_record_form_to_a_different_table">Delegating "New Record Form" to a Different Table</h3>
<div class="paragraph">
<p>Xataface allows you to delegate "new record" input to a different table.  E.g. Given a Table <code>A</code>, you can configure Xataface to use the "new record" form for a different table <code>B</code> for inserting new records.</p>
</div>
<div class="paragraph">
<p><strong>Why might you want to do this?</strong></p>
</div>
<div class="paragraph">
<p>Xataface forms are built around the data model of the underlying table.  It generates input fields for each column of the underlying table.  In some cases, the "new record" form may want to take data in a different form that allows you to generate the underlying data.</p>
</div>
<div class="paragraph">
<p>For example, if you have a "Contacts" table, but you want the user to be able to insert contacts by simply entering their employee ID - and this will be used in the back-end to fetch some initial data about the user from another database.  In this case, your "new record" form should really just include a single field: "Employee ID".</p>
</div>
<div class="sect3">
<h4 id="_instructions_short_version">Instructions: Short Version</h4>
<div class="paragraph">
<p><strong>Definitions</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>SOURCE_TABLE</code> - The source table into which you wish to insert records.</p>
</li>
<li>
<p><code>TARGET_TABLE</code> - The target table whose "New Record" form you wish to use for the UI.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Steps:</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add the <code>new_record_table=TARGET_TABLE</code> directive to the beginning of the fields.ini file of the SOURCE_TABLE.</p>
</li>
<li>
<p>Add a column named <code>xf_inserted_record_id</code> of type <code>TEXT</code> into the TARGET_TABLE.</p>
</li>
<li>
<p>In either the <code>beforeInsert()</code> or <code>afterInsert()</code> hooks of the TARGET_TABLE, process the inputs, and programmatically insert the appropriate record into the SOURCE_TABLE.</p>
</li>
<li>
<p>Also inside the <code>beforeInsert()</code> or <code>afterInsert()</code> hooks of TARGET_TABLE, set the value of the <code>xf_inserted_record_id</code> to the record ID of the SOURCE table that you programmatically inserted in step 3.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_instructions_by_example">Instructions By Example</h4>
<div class="paragraph">
<p>Let&#8217;s take the example I mentioned above.  We have a "contacts" table with lots of details about a contact, including <code>employee_id</code>.  When the user inserts a record, all they need to do is enter the "employee_id" and it will pull the rest of the data in from an external database.  So we will create a second "dummy" table that is only here to facilitate the creation of a new contact.  It includes only a single field "employee_id".</p>
</div>
<div class="paragraph">
<p>Our two tables might have the following definitions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sql" data-lang="sql">CREATE TABLE contacts (
  employee_id VARCHAR(32) PRIMARY KEY,
  first_name VARCHAR(64),
  last_name VARCHAR(64),
  ....
 )

 CREATE TABLE new_contact_form (
   employee_id VARCHAR(32) PRIMARY KEY,
   xf_inserted_record_id TEXT <b class="conum">(1)</b>
 )</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The <code>xf_inserted_record_id</code> field is a special field that will be used to pass the record ID of the corresponding contact record after insertion.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Step 1: Set <code>new_record_table</code></strong></p>
</div>
<div class="paragraph">
<p>At the beginning of the fields.ini file for the "contacts_table", add:</p>
</div>
<div class="listingblock">
<div class="title">tables/contacts/fields.ini file</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">new_record_table=new_contact_form</code></pre>
</div>
</div>
<div class="paragraph">
<p>This tells Xataface that the "new" action for the "contacts" table should redirect to the "new" action of the "new_contact_form" table.</p>
</div>
<div class="paragraph">
<p><strong>Step 2: Implement <code>beforeInsert()</code> Hook</strong></p>
</div>
<div class="paragraph">
<p>If we simply defined the <code>new_record_table</code> directive, it would result in the user being redirected to the <code>new_contact_form</code> table when they want to insert a new record into the <code>contacts</code> table, but it wouldn&#8217;t actually insert anything into the contacts table.  Nor would it return them back to the contacts table when done.  It would just leave the user in the "new_contacts_form" table - and would insert the record there only.</p>
</div>
<div class="paragraph">
<p>If we want to actually insert a record into the "contacts" table, we just do this programmatically.  Preferably inside the <code>beforeInsert()</code> or <code>afterInsert()</code> hooks of the <code>new_contact_form</code> table.</p>
</div>
<div class="paragraph">
<p>In the delegate class for the <code>new_contact_form</code>, we&#8217;ll do:</p>
</div>
<div class="listingblock">
<div class="title">tables/new_contact_form/new_contact_form.php file (Delegate class for the "new_contact_form" table).</div>
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">&lt;?php
class tables_new_contact_form {
    function beforeInsert(Dataface_Record $record) { <b class="conum">(1)</b>
        $employeeData = fetchEmployeeData($record-&gt;val('employee_id');
        // Assume that you've implemented fetchEmployeeData() elsewhere to get
        // the employee info from another database

        if (!$employeeData) {
            XFException::throwValidationFailure("Failed to find employee data for given employee ID.");
        }


        // Create a new contact record
        $contact = new Dataface_Record('contacts', array()); <b class="conum">(2)</b>
        $contact-&gt;setValues(array(
            'employee_id' =&gt; $employeeData['empid'],
            'first_name' =&gt; $employeeData['empFirstName'];
            ...
        ));
        $res = $contact-&gt;save(); <b class="conum">(3)</b>
        if (PEAR::isError($res)) {
            XFException::throwValidationFailure("Failed to insert contact: ".$res-&gt;getMessage());
        }

        // Store the record ID of the new contact record
        $record-&gt;setValue('xf_inserted_record_id', $contact-&gt;getId()); <b class="conum">(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>We implement the <code>beforeInsert()</code> callback, which is executed before the "new_contact_form" record is inserted.</p>
</li>
<li>
<p>We create a new <code>Dataface_Record</code> object for the "contacts" table, and insert data for the contact.</p>
</li>
<li>
<p>We call <code>save()</code> to store the "contacts" record.</p>
</li>
<li>
<p>Get the ID of the newly inserted contact, and add it to the <code>xf_inserted_record_id</code> field of the "new_contact_form" record.  This will be used by Xataface after to redirect back to the original contact table record when it is done.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-140420-010101.342.png" alt="Image 140420 010101.342">
</div>
<div class="title">Figure 36. Sequence diagram for inserting a new record in the Contacts table</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_ownerstamp_to_mark_record_ownership">Using <code>ownerstamp</code> to Mark Record Ownership</h3>
<h4 id="_problem_19" class="discrete">Problem</h4>
<div class="paragraph">
<p>You want to "stamp" a record with the username or user ID of the user who created a record automatically.</p>
</div>
<h4 id="_solution_17" class="discrete">Solution</h4>
<div class="paragraph">
<p>Use the <code>ownerstamp</code> fields.ini directive on the field that you wish to store the userid in.</p>
</div>
<div class="paragraph">
<p>For example, consider a table "posts" that stores posts that users of the system make.  This table has a <code>posted_by</code> field to record the user that posted it.  You want this field to automatically populated with the user ID of the user that is currently logged in, so you can add the <code>ownerstamp</code> directive in the fields.ini file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[posted_by]
  ownerstamp=1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Adding this directive does a number of things simulataneously:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>It will set the user ID of the currently logged in user at the time that the record is inserted.</p>
</li>
<li>
<p>It will prevent the field from being updated later.</p>
</li>
<li>
<p>It will hide the "posted_by" field from all forms.</p>
</li>
</ol>
</div>
<h4 id="_discussion_2" class="discrete">Discussion</h4>
<div class="paragraph">
<p>Before the "ownerstamp" directive existed, you could accomplish the same thing by implementing a <code>beforeSave()</code> trigger and setting the field value to the currently logged in user, changing the field permissions so it can&#8217;t be changed after the fact, and setting the widget type to "hidden".  But since this is such a common requirement, it is much simpler to just set <code>ownerstamp=1</code> and be done with it.</p>
</div>
</div>
<div class="sect2">
<h3 id="_redirecting_user_to_different_page_after_saving_record">Redirecting User to Different Page After Saving Record</h3>
<h4 id="_problem_20" class="discrete">Problem</h4>
<div class="paragraph">
<p>By default, when the user presses "Save" on the "Edit record form", they will be redirected back to the edit record form again after the save is complete.  You want to redirect them to a different page, such as the "View" page.</p>
</div>
<h4 id="_solution_18" class="discrete">Solution</h4>
<div class="paragraph">
<p>Override the "edit" action in your actions.ini file to specify the "after_action" directive.</p>
</div>
<div class="paragraph">
<p>E.g. Add the following to your application&#8217;s actions.ini (or actions.ini.php) file.</p>
</div>
<div class="listingblock">
<div class="title">the actions.ini file. Specifying that user should be directed back to the "view" action after editing the record.</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[edit &gt; edit]
    after_action=view</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you only want to apply this rule to a particular table, you can use the <code>after_action.{TABLENAME}</code> instead.  E.g.</p>
</div>
<div class="listingblock">
<div class="title">Specifying an after_action directive that only applies to editing records of the "users" table.</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[edit &gt; edit]
    after_action.users=view</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>The "new" action also supports the <code>after_action</code> and <code>after_action.tablename</code> directives.  E.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[new &gt; new]
    after_action=view</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="recipe-auto-updating-field">Auto-Updating a Field When Other Fields are Changed</h3>
<h4 id="_problem_21" class="discrete">Problem</h4>
<div class="paragraph">
<p>You want the contents of a field to be automatically updated when the value of another field on the same form is changed.  For example, you have a "Program Title" field that should automatically be populated when the user selects the program ID.</p>
</div>
<h4 id="_solution_19" class="discrete">Solution</h4>
<div class="paragraph">
<p>You can use the <code>ajax_value</code> fields.ini property to make a field dynamically update whenever one or more other fields on the same form is changed.  When a change is detected, the field will load new data from a JSON web service specified by the URL in the property.</p>
</div>
<div class="paragraph">
<p><strong>Syntax:</strong></p>
</div>
<div class="paragraph">
<p><code>ajax_value=&lt;url-template&gt;#&lt;json-path-query&gt;</code></p>
</div>
<div class="paragraph">
<p><code>&lt;url-template&gt;</code> is a string that is used as a template for the URL to the web service from which to load the field&#8217;s content.  The template should contain one or more placeholders of the form <code>{fieldname}</code> which are replaced by the form value of the corresponding field.</p>
</div>
<div class="paragraph">
<p><code>&lt;json-path-query&gt;</code> is a <a href="http://jsonpath.com/">jsonPath</a> query describing which part of the JSON response should be used as the new field value.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
You can omit the json path query (everything from <code>#</code>), if the HTTP request will just return plain text or HTML.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Triggers</strong></p>
</div>
<div class="paragraph">
<p>The field will be updated whenever the URL would be changed.  The URL template may include variables with the syntax <code>{fieldname}</code> that will be replaced by the corresponding field when generating the web service URL.  If the values of any of the fields marked as variables changes, it will trigger an update.</p>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="paragraph">
<p>Consider the following fields.ini file:</p>
</div>
<div class="paragraph">
<p>[source,ini</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[ProgramID]
widget:type=select
vocabulary=programs

[ProgramTitle]
ajax_value="?-action=export_json&amp;-table=Programs&amp;ProgramID={ProgramID}#0.ProgramTitle</pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, whenever the <code>ProgramID</code> field is changed (say to a value of "1"), it will trigger an AJAX request to <code>index.php?-action=export_json&amp;-table=Programs&amp;ProgamID=1</code>.</p>
</div>
<div class="paragraph">
<p>The JSON response will look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">[{"ProgramID":"1", "ProgramTitle":"Some program", ....}]</code></pre>
</div>
</div>
<div class="paragraph">
<p>When it receives the response, it will take the <code>ProgramTitle</code> attribute of the first result in the JSON response, and place it in the ProgramTitle field.  In the above example, it would be "Some program".</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can use the <code>widget:atts:data-xf-update-condition=empty</code> directive to <strong>only</strong> update the field value if it is currently empty.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="display-field-preview-using-ajax">Displaying Field Preview using AJAX</h3>
<h4 id="_problem_22" class="discrete">Problem</h4>
<div class="paragraph">
<p>You want to display some richer feedback to the user based on the value entered into a field.  For example, on a field where the user enters a URL, you may want to display some information about the URL so that the user knows that they have entered the correct URL.</p>
</div>
<h4 id="_solution_20" class="discrete">Solution</h4>
<div class="paragraph">
<p>Use the <code>ajax_preview</code> directive, which works just like the <code>ajax_value</code> directive, except that it displays the result of the AJAX request just below the field as a "preview", rather than in the field itself.</p>
</div>
<div class="paragraph">
<p>Consider the scenario where you have the following table structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sql" data-lang="sql">CREATE TABLE posts (
    post_id INT(11) PRIMARY KEY AUTO_INCREMENT,
    page_url TEXT,
    article_title TEXT,
    article_description
)

CREATE TABLE user_posts (
    user_post_id INT(11) PRIMARY KEY AUTO_INCREMENT,
    post_id INT(11),
    comment TEXT
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The "posts" table is central repository of posts.  The user_posts table is for a user to "post" a comment about a post. The idea is that a particular URL should only be imported into the "posts" table once, but many users can post comments around a "post" in the "users_posts" table.  We will only give the user direct access to the "user_posts" table, where they will provide the URL they want to post along with a comment about the post.</p>
</div>
<div class="paragraph">
<p>The challenge here is that the user_posts table doesn&#8217;t have a "page_url" field - just a post_id field.  We could use the depselect widget here, but this adds a step.  It would be better to hide the post_id field, and just provide a page_url field, which will automatically populate the "post_id" field with the correct post ID from the posts table.</p>
</div>
<div class="paragraph">
<p>So for our first step, we&#8217;ll hide the "post_id" field and add a page_url transient field:</p>
</div>
<div class="listingblock">
<div class="title">Adding a transient field for the post_url in the users_posts fields.ini file</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[post_id]
    widget:type=hidden

[post_url]
    transient=1
    order=-1
    widget:description="Please enter the URL to the article you wish to post"</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the user enters a URL into the post_url field we want to trigger an AJAX request to a custom action that will:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>See if a post has already been added at that URL, and return the ID of the post if found.</p>
</li>
<li>
<p>If the post hasn&#8217;t been added yet, we add it, and return the ID.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In either case the AJAX request should obtain a post ID which can be inserted into the post_id field.</p>
</div>
<div class="paragraph">
<p>Such a custom action might look like the following:</p>
</div>
<div class="listingblock">
<div class="title">Sample Action (defined in actions/get_post_id.php) to get a Post ID for a given page url.</div>
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">&lt;?php
class actions_get_post_id {
    function handle($params) {
        header('Content-Type:text/plain');
        if (!@$_GET['page_url']) {
            return;
        }
        //echo $_GET['page_url'];exit;
        $user = getUser();
        $post = df_get_record('posts', array('page_url' =&gt; '='.$_GET['page_url']));

        if (!$post) {
            $post = new Dataface_Record('posts', array());
            $post-&gt;setValues(array(
                'posted_by' =&gt; $user-&gt;val('user_id'),
                'page_url' =&gt; $_GET['page_url']
            ));
            $res = $post-&gt;save();
        }
        echo $post-&gt;val('post_id');
    }
}
?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>We will use the <code>ajax_value</code> directive on the <code>post_id</code> field to automatically populate it from that AJAX action when the value of <code>page_url</code> changes.</p>
</div>
<div class="listingblock">
<div class="title">Add the ajax_value directive to populate the post_id field when post_url is updated.</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[post_id]
    widget:type=hidden
    ajax_value="?-action=get_post_id&amp;page_url={post_url}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Lastly, we want to display a preview of the page content below the page_url field.  We will use the <code>ajax_preview</code> directive for this.  First we&#8217;ll create an AJAX action to display this preview, given the post ID.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">&lt;?php
class actions_ajax_post_preview {

    function handle($params) {
        if (!@$_GET['post_id']) {
            return;
        }
        $post = df_get_record('posts', array('post_id' =&gt; '='.$_GET['post_id']));
        if ($post) {
            df_display(array('post' =&gt; $post), 'ajax_post_preview.html'); <b class="conum">(1)</b>
        }
    }
}
?&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>"ajax_post_preview.html" template should be in the application&#8217;s templates directory.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Now we can use this from our `ajax_preview directive:</p>
</div>
<div class="listingblock">
<div class="title">Adding the ajax_preview directive to update the preview automatically with post_id is changed.</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[post_url]
    transient=1
    order=-1
    widget:description="Please enter the URL to the article you wish to post"
    ajax_preview="?-action=ajax_post_preview&amp;post_id={post_id}"</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-070620-011602.097.png" alt="Image 070620 011602.097">
</div>
<div class="title">Figure 37. Ajax preview displayed below the post_url field.</div>
</div>
<div class="paragraph">
<p><strong>Bonus Points</strong></p>
</div>
<div class="paragraph">
<p>We&#8217;re not quite done.  Our current setup works great for the new record form, because the user will be adding the URL.  But if they&#8217;re editing an existing record, the post_id value will already by set, but the user hasn&#8217;t entered anything the post_url field (because it is transient).  We need to add an <code>ajax_value</code> directive to the post_url field so that it auto-populates based on the value of the post_id field.</p>
</div>
<div class="paragraph">
<p>We&#8217;ll use the export_json action as our AJAX action so we don&#8217;t need to create a custom action.</p>
</div>
<div class="listingblock">
<div class="title">Adding the ajax_value directive to the post_url field so that it auto-populates on the edit form.</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[post_url]
    transient=1
    order=-1
    widget:description="Please enter the URL to the article you wish to post"
    ajax_preview="?-action=ajax_post_preview&amp;post_id={post_id}"
    ajax_value="?-table=posts&amp;-action=export_json&amp;post_id=={post_id}&amp;-mode=browse&amp;-limit=1&amp;--fields=page_url#0.page_url"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_disabling_client_side_validation">Disabling Client-side Validation</h3>
<h4 id="_problem_23" class="discrete">Problem</h4>
<div class="paragraph">
<p>You want to disable client-side validation for a particular field, but keep the server-side validaton.</p>
</div>
<h4 id="_solution_21" class="discrete">Solution</h4>
<div class="paragraph">
<p>Use the <code>widget:validation=server</code> fields.ini directive.</p>
</div>
<div class="paragraph">
<p>E.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">[myfield]
  widget:validation=server</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_setting_fixed_number_of_rows_in_the_grid_widget">Setting Fixed Number of Rows in the Grid Widget</h3>
<h4 id="_problem_24" class="discrete">Problem</h4>
<div class="paragraph">
<p>You have a grid widget for editing related records on a form.  Rather than have it start with only a single row, and have additional rows appear only as the user enters data into the last row, you want it to display a fixed number of rows and have some of the data pre-populated.</p>
</div>
<h4 id="_solution_22" class="discrete">Solution</h4>
<div class="paragraph">
<p>Use the <code>widget:fixedrows</code> directive to a specific number of rows, and you can implement the <code>fieldname__prepareGridData($record, $cols, $data)</code> delegate method to return the data to prepopulate the grid with.</p>
</div>
<div class="listingblock">
<div class="title">fields.ini file</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[exam_results]
  relationship=exam_results
  widget:type=grid
  widget:fixedrows=3
  widget:cols="exam_name,exam_grade"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Delegate class</div>
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">class tables_students {
    function exam_results__prepareGridData($record, $cols, &amp;$data) {
        if (count($data) == 0) {
            $data[] = array('exam_name' =&gt; 'Midterm 1', 'exam_grade' =&gt; '');
            $data[] = array('exam_name' =&gt; 'Midterm 2', 'exam_grade' =&gt; '');
            $data[] = array('exam_name' =&gt; 'Final', 'exam_grade' =&gt; '');
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="field-actions">Adding Actions to Fields</h3>
<h4 id="_problem_25" class="discrete">Problem</h4>
<div class="paragraph">
<p>You want to add an an action button next to a field in your form.  For example, suppose you have a text field that stores the URL to a logo for the record, and you want to provide a link for the user to be able to upload an image, and then copy its URL into the field.  Ideally the field would have an "upload" button next to it.</p>
</div>
<h4 id="_solution_23" class="discrete">Solution</h4>
<div class="paragraph">
<p>Use the <code>actions</code> directive of the fields.ini file to specify an action category on the field, and then define an "upload" action with that category.</p>
</div>
<div class="paragraph">
<p>E.g.</p>
</div>
<div class="listingblock">
<div class="title">The fields.ini definition for our field.  Notice the <code>actions</code> directive.</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[feed_cover_art_url]
    logo=1
	group=details
	order=-10
	widget:type=text
	display=inline
    actions=feed_cover_art_url_actions</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">The upload_feed_cover_art action definition in the actions.ini file.  Notice that it is added to the "feed_cover_art_url_actions" category.</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[upload_feed_cover_art]
    category=feed_cover_art_url_actions
    label="Upload"
    description="Upload cover art for this feed"
    url="javascript:void(0)"
    onclick="uploadCoverArt(this)"</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the result:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-281220-071824.428.png" alt="Image 281220 071824.428">
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>This example uses the <code>onclick</code> directive of the action to bind it to a Javascript function.  See <a href="#javascript-action">Triggering Javascript Function with Action</a> for details on triggering javascript functions with actions.  In this case, since the script is only needed on the edit form for this table, I would place <code>xf_script()</code> call inside the "before_feed_cover_art_url_widget" block:</p>
</div>
<div class="listingblock">
<div class="title">Defining the before_feed_cover_art_url_widget block inside the table delegate class.</div>
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">function block__before_feed_cover_art_url_widget() {
    xf_script('uploadCoverArt.func.js');
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, I would create my Javascript file inside at "js/uploadCoverArt.func.js":</p>
</div>
<div class="listingblock">
<div class="title">Implementing the uploadCoverArt function in js/uploadCoverArt.func.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">window.uploadCoverArt = function(source) {
     // Do the upload cover art stuff here.
};</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
See <a href="#recordbrowser-example">the RecordBrowser usage example</a> for an example implementation of the <code>uploadCoverArt()</code> function that allows the user to actually select records from a table, and upload images.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="list_customization">List Customization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following sections form a sort of cook book with recipes for customizing result lists in Xataface.</p>
</div>
<div class="sect2">
<h3 id="_adding_option_to_filter_result_list">Adding Option to Filter Result LIst</h3>
<h4 id="_problem_26" class="discrete">Problem</h4>
<div class="paragraph">
<p>You want to add a drop-down list for the user to select filters for the result set.</p>
</div>
<h4 id="_solution_24" class="discrete">Solution</h4>
<div class="paragraph">
<p>Use the <code>filter</code> directive in the fields.ini file on any field that you want the filter to be added for.</p>
</div>
<div class="listingblock">
<div class="title">Field definition in fields.ini file using the filter directive.</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[test_field]
  filter=1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, if you navigate to this table&#8217;s list view, you&#8217;ll see a drop-down list at the top of the results where you can select all of the distinct values in the <code>test_field</code> column.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-150520-070017.404.png" alt="Image 150520 070017.404">
</div>
<div class="title">Figure 38. List View when a filter field defined.</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-150520-070032.226.png" alt="Image 150520 070032.226">
</div>
<div class="title">Figure 39. Expanding the filter list, you can see all of the distinct values for the test_field column.</div>
</div>
<div class="paragraph">
<p>If you select one of the options, it will filter the results to only show those results that match the filter.</p>
</div>
</div>
<div class="sect2">
<h3 id="_hiding_filter_counts">Hiding Filter Counts</h3>
<h4 id="_problem_27" class="discrete">Problem</h4>
<div class="paragraph">
<p>You want to hide the counts for each entry in the "filters" drop-down list on the list view.  By default when you add a filter list via the <code>filter</code> directive, each row has the "count" displayed beside it:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-150520-065039.669.png" alt="Image 150520 065039.669">
</div>
<div class="title">Figure 40. A result filter list.  Notice each row has a (1) beside it indicating that there is 1 row matching that filter.</div>
</div>
<div class="paragraph">
<p>We want to hide this.</p>
</div>
<h4 id="_solution_25" class="discrete">Solution</h4>
<div class="paragraph">
<p>Use the <code>show_filter_counts</code> preferences directive to hide these counts as follows.  In the <code>_prefs</code> section of the <code>conf.ini</code> file, add:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">show_filter_counts=0</code></pre>
</div>
</div>
<div class="paragraph">
<p>After this change, the filter lists will look like:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-150520-065357.583.png" alt="Image 150520 065357.583">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sorting_filter_results">Sorting Filter Results</h3>
<h4 id="_problem_28" class="discrete">Problem</h4>
<div class="paragraph">
<p>Filter lists are sorted by the "filtered" field in alphabetical order.  You want to sort the filter lists on some other column.</p>
</div>
<h4 id="_solution_26" class="discrete">Solution</h4>
<div class="paragraph">
<p>Use the <code>filter.sort.</code> fields.ini directive to specify the field that the filter should sort on.</p>
</div>
<div class="paragraph">
<p>E.g.</p>
</div>
<div class="listingblock">
<div class="title">Sort the "city" filter in descending order</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[city]
  filter=1
  filter.sort="city desc"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="row-css-classes">Adding CSS Classes to Rows</h3>
<h4 id="_problem_29" class="discrete">Problem</h4>
<div class="paragraph">
<p>You want to add custom CSS classes to the rows of the table in list view.</p>
</div>
<h4 id="_solution_27" class="discrete">Solution</h4>
<div class="paragraph">
<p>Implement the <code>css__tableRowClass()</code> method in the table delegate class.  Have it return a string with the CSS classes you wish to add.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">&lt;?php
class tables_MyTable {
    ...

    function css_tableRowClass(Dataface_Record $rec) {
        if ($record-&gt;val('status') == 'approved') {
            return 'status-approved another-css-class';
        } else {
            return 'another-css-class status-pending';
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, on rows where the 'status' field is a approved you&#8217;ll see something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">&lt;tr class="status-approved another-css-class"&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>and in other rows you&#8217;ll see</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">&lt;tr class="another-css-class status-pending"&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_adding_row_actions">Adding Row Actions</h3>
<h4 id="_problem_30" class="discrete">Problem</h4>
<div class="paragraph">
<p>You want to add a button to each row of the list view to perform some action on that row.</p>
</div>
<h4 id="_solution_28" class="discrete">Solution</h4>
<div class="paragraph">
<p>Define an action with <code>category=list_row_actions</code> and <code>condition="$query['-table'] == 'tablename'</code>.</p>
</div>
<div class="paragraph">
<p>E.g.</p>
</div>
<div class="listingblock">
<div class="title">Defining an action named "play_post" that is displayed in each row of the list view for the <code>_tmp_newsfeed</code> table.</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[play_post]
    condition="$query['-table'] == '_tmp_newsfeed'" <b class="conum">(1)</b>
    category=list_row_actions
    materialIcon=play_circle_outline <b class="conum">(2)</b>
    label="Play"
    description="Play narration"
    url="{$record-&gt;getURL('-action=play_post')}" <b class="conum">(3)</b>
    url_condition="$record" <b class="conum">(4)</b>
    order=1</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Only display this action in the <code>_tmp_newsfeed</code> table.</p>
</li>
<li>
<p>Uses a material icon for the action.</p>
</li>
<li>
<p>The <code>url</code> directive specifies the URL where the action should go when the user clicks on it.  THe <code>$record</code> variable is a <code>Dataface_Record</code> object that encapsulates the current row.  We call the <code>getURL()</code> method to get the URL for that record with the <code>play_post</code> action.</p>
</li>
<li>
<p>The <code>url_condition</code> directive is necessary to stop Xataface from trying to parse the <code>url</code> directive if <code>$record</code> is <code>null</code>.  It is interpretted as a boolean expression. When it evaluates to a falsey value, it will skip parsing the <code>url</code> directive.</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
When the user clicks on this action, they will be directed to the URL <code>index.php?-table=_tmp_newsfeed&amp;-action=play_post&amp;&#8230;&#8203;.</code>.   You need to make sure to implement this action handler in <code>actions/play_post.php</code>.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-140620-091333.203.png" alt="Image 140620 091333.203">
</div>
<div class="title">Figure 41. The "play_post" action appears in the left-most column of the list view</div>
</div>
</div>
<div class="sect2">
<h3 id="custom-row-action-styles">Customizing Row Action Styles</h3>
<h4 id="_problem_31" class="discrete">Problem</h4>
<div class="paragraph">
<p>You want to customize the style on a particular action</p>
</div>
<h4 id="_solution_29" class="discrete">Solution</h4>
<div class="paragraph">
<p>Use the <code>class</code> directive on the action to specify a custom CSS class on the <code>&lt;a&gt;</code> tag of the action.  Then use this CSS class to target that button specifically from your stylesheet.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[play_post]
    condition="$query['-table'] == '_tmp_newsfeed'"
    category=list_row_actions
    materialIcon=play_circle_outline
    label="Play"
    description="Play narration"
    order=1
    class=large-button</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then in your CSS file you can target this action directly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-css" data-lang="css">.large-button {
    font-size: 150%;
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_adding_javascript_row_actions">Adding Javascript Row Actions</h3>
<h4 id="_problem_32" class="discrete">Problem</h4>
<div class="paragraph">
<p>You want to trigger a Javascript function when the user clicks on a row action instead of just directing the user to a URL.</p>
</div>
<h4 id="_solution_30" class="discrete">Solution</h4>
<div class="paragraph">
<p>Use the <code>onclick</code> directive instead of the <code>url</code> directive.</p>
</div>
<div class="paragraph">
<p>See <a href="#javascript-action">Triggering Javascript Function with Action</a> for an introduction to Javascript actions with a detailed example using the <code>onclick</code> handler.  The only thing we need to add to make our Javascript action useful, is the ability to retrieve the record ID of the current row.  There are two ways to do this:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use the <code>$record</code> variable inside the <code>onclick</code> directive to obtain details about the record, and add them as parameters to your Javascript function.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[myaction]
    category=list_row_actions
    onclick="window.playPost('{$record-&gt;val('post_id')}');"</code></pre>
</div>
</div>
<div class="paragraph">
<p>An alternative way is to make user of the <code>xf-record-id</code> attribute that can be found on the <code>&lt;tr&gt;</code> tag of the row in list view.  If you look at the resulting HTML source of the list view, and drill down to the individual rows of the table, you&#8217;ll see something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">&lt;tr class="listing odd " xf-record-id="_tmp_newsfeed?post_id=73"&gt;
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can use this inside our Javascript function, as follows.  First we pass <code>this</code> as an argument to our function. <code>this</code> will refer to the <code>&lt;a&gt;</code> tag that was clicked.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[myaction]
    category=list_row_actions
    onclick="window.playPost(this);"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Javascript file definine the function that we want to call from our <code>playPost</code> function</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">(function(){
    var $ = jQuery;
    window.playPost = playPost;

    function playPost(el) {
        if (!$(el).attr('xf-record-id')) {  <b class="conum">(1)</b>
            var trTag = $(el).parents('[xf-record-id]').first();
            if (trTag.length == 0) {
                return new Promise(function(resolve, reject){ <b class="conum">(2)</b>
                    reject('Not found');
                });
            } else {
                el = trTag; <b class="conum">(3)</b>
            }
        }
        return new Promise(function(resolve, reject) { <b class="conum">(4)</b>
            // Do the actual playing here, and either call resolve() or reject()
            // when done.
        });

    }
})();</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Check to see if the HTML element that element contains the <code>xf-record-id</code> attribute.  If it doesn&#8217;t we need to walk up the DOM until with find an element that does.</p>
</li>
<li>
<p>If we didn&#8217;t find <strong>any</strong> elements with the xf-record-id attribute, we&#8217;ll just return a promise that rejects.</p>
</li>
<li>
<p>If we found an element with <code>xf-record-id</code> we will just use this element instead of the one that was passed into the method.  Since our action is called with <code>window.playPost(this)</code>, it will always be passing the <code>&lt;a&gt;</code> tag to the <code>playPost()</code> method, and the <code>a</code> tag doesn&#8217;t have the attribute.  The parent <code>&lt;tr&gt;</code> tag has the attribute, so this is where we crawl up to.</p>
</li>
<li>
<p>We perform our action on the provided element.  In this case, I&#8217;m returning a Promise to get us prepared for performing asynchronous actions cleanly.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="toggle-row-actions">Making Row Actions Toggleable</h3>
<h4 id="_problem_33" class="discrete">Problem</h4>
<div class="paragraph">
<p>You want to add an action to each row of the list view that can be toggled between two different states.  For example, we have functionality to add and remove rows from a playlist.  If the record is currently "on" the playlist, we want the action to display "Remove from playlist".  If the record is not on the playlist, we want the action to display "Add to playlist".</p>
</div>
<h4 id="_solution_31" class="discrete">Solution</h4>
<div class="paragraph">
<p>Use two different actions: "add_to_playlist" and "remove_from_playlist" and conditionally show either action depending on whether the record is currently "on" the playlist.</p>
</div>
<div class="paragraph">
<p>I&#8217;ll include two different recipes here to achieve this:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A fully server-side solution using the <code>condition</code> directive.</p>
</li>
<li>
<p>A server <strong>and</strong> client-side solution using Javascript, CSS, and AJAX to add and remove rows from the playlist.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The 2nd option is more complex but yields a better user experience.</p>
</div>
<h5 id="_solution_1_using_condition_directive" class="discrete">Solution 1: Using <code>condition</code> directive</h5>
<div class="paragraph">
<p>We can define our actions as follows: (And assume that our table has an "on_playlist" field that indicates whether or not a record is on the playlist currently.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[add_to_playlist]
    condition="$query['-table'] == '_tmp_newsfeed' and $record and !$record-&gt;val('on_playlist')"
    category=list_row_actions
    label="Add to Playlist"
    materialIcon="playlist_add"
    order=2
    onclick="window.addToPlaylist(this)"


[remove_from_playlist]
    condition="$query['-table'] == '_tmp_newsfeed' and $record and $record-&gt;val('on_playlist')"
    category=list_row_actions
    materialIcon="remove_from_queue"
    order=3
    onclick="window.removeFromPlaylist(this)"
    label="Remove from Playlist"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The key here is in the <code>condition</code> directives of these actions.  The <code>add_to_playlist</code> is set to appear only when we are on the <code>_tmp_newsfeed</code> table <strong>AND</strong> the record is not on the playlist.  The <code>remove_from_playlist</code> action is set to appear only when the record is on the playlist.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>In both actions we need to ensure that <code>$record</code> exists before calling <code>$record&#8594;val('on_playlist')</code> otherwise the application will crash in cases where there is NO record in the current context.  I.e. We need to have</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">$record and $record-&gt;val('on_playlist')</code></pre>
</div>
</div>
<div class="paragraph">
<p>and not just</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">$record-&gt;val('on_playlist')</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There is a lot hidden in this solution inside the <code>addToPlaylist()</code> and <code>removeFromPlaylist()</code> Javascript functions.  These are responsible for actually adding and removing records from the playlist. See <a href="#ajax-list-row-actions">Using AJAX To Modify Row Records</a> for an example using AJAX to do this.</p>
</div>
<h5 id="_solution_2_using_css_to_showhide_actions" class="discrete">Solution 2: Using CSS to Show/Hide Actions</h5>
<div class="paragraph">
<p>The first solution relies on the <code>condition</code> directive to show or hide our actions.  However, this directive is processed on the server-side, so we would need to reload the whole page if we wanted to update state.  We can offer a better user experience by using CSS to show/hide the actions.</p>
</div>
<div class="paragraph">
<p>The gist of this solution is to:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add a CSS class, <code>on-playlist</code>, to the  <code>&lt;tr&gt;</code> tag (i.e. each record row) to indicate whether that record is currently on the playlist.</p>
</li>
<li>
<p>Add CSS classes to the two actions, so that we can easily target them from a stylesheet.</p>
</li>
<li>
<p>Add custom CSS to show/hide actions depending on whether the <code>&lt;tr&gt;</code> tag includes the <code>on-playlist</code> CSS class.</p>
</li>
<li>
<p>The <code>addToPlaylist()</code> function removes the <code>on-playlist</code> CSS class from the <code>&lt;tr&gt;</code> tag, and the <code>removeFromPlaylist()</code> adds it.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Adding the CSS class to the <code>&lt;tr&gt;</code> tag:</strong></p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
See <a href="#row-css-classes">Adding CSS Classes to Rows</a> for more details on adding CSS classes to rows.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Method from the table delegate class that causes the <code>&lt;tr&gt;</code> tag to have the <code>on-playlist</code> CSS class if the record is on the playlist.</div>
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">function css__tableRowClass(Dataface_Record $rec = null) {
    if ($rec-&gt;val('on_playlist')) {
        return 'on-playlist';
    }
    return '';
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Adding CSS classes to the two actions:</strong></p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
See <a href="#custom-row-actions-styles">[custom-row-actions-styles]</a> for more details on using the <code>class</code> directive to customize action styles.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">add_to_playlist]
    condition="$query['-table'] == '_tmp_newsfeed'"
    category=list_row_actions
    label="Add to Playlist"
    materialIcon="playlist_add"
    order=2
    onclick="window.addToPlaylist(this)"
    class="add-to-playlist" <b class="conum">(1)</b>

[remove_from_playlist]
    condition="$query['-table'] == '_tmp_newsfeed'"
    category=list_row_actions
    materialIcon="remove_from_queue"
    order=3
    onclick="window.removeFromPlaylist(this)"
    label="Remove from Playlist"
    class="remove-from-playlist" <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>We add the <code>add-to-playlist</code> CSS class to the <code>&lt;a&gt;</code> tag for the "add" action.</p>
</li>
<li>
<p>We add the <code>remove-from-playlist</code> CSS class to the <code>&lt;a&gt;</code> tag for the "remove" action.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Defining Styles to Show/Hide Actions</strong></p>
</div>
<div class="paragraph">
<p>Now that we have our CSS actions defined, we&#8217;ll be dealing with HTML like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">&lt;tr class="on-playlist"&gt;
  ....
  &lt;a class="remove-from-playlist" ...&gt; ... &lt;/a&gt;

  &lt;a class="add-to-playlist"...&gt; ...&lt;/a&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can target our <code>&lt;a&gt;</code> tags with the following CSS directives in our stylesheet.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-css" data-lang="css">/* Hide add-add-to-playlist when tr has on-playlist class */
tr.on-playlist .add-to-playlist {
    display:none;
}

/* Hide remove-from-playlist by default */
span.row-actions .remove-from-playlist {
    display:none;
}

/* Show remove-from-playlist when tr has on-playlist class */
tr.on-playlist .remove-from-playlist {
    display:block;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Adding/Removing CSS classes using Javascript</strong></p>
</div>
<div class="paragraph">
<p>As we&#8217;ve seen above, our actions will trigger the <code>addToPlaylist()</code> and <code>removeFromPlaylist()</code> functions respectively.  We just need add/remove the CSS class as appropriate here.</p>
</div>
<div class="paragraph">
<p>e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">function addtoPlaylist(el) {
    if (!$(el).attr('xf-record-id')) {
        var trTag = $(el).parents('[xf-record-id]').first();
        if (trTag.length == 0) {
            return new Promise(function(resolve, reject){
                reject('Not found');
            });
        } else {
            el = trTag;
        }
    }
    $(el).addClass('on-playlist'); <b class="conum">(1)</b>
    return new Promise(function(resolve, reject) {
        // Do the actual playing here, and either call resolve() or reject()
        // when done.

        addToPlaylistImpl(el.attr('xf-record-id')).then(function(data) {
            // success
            resolve(data);
        }).catch (function(data) {
            // Failed
            $(el).removeClass('on-playlist'); <b class="conum">(2)</b>
            reject(data);
        });;
    });
}

function removeFromPlaylist(el) {
    if (!$(el).attr('xf-record-id')) {
        var trTag = $(el).parents('[xf-record-id]').first();
        if (trTag.length == 0) {
            return new Promise(function(resolve, reject){
                reject('Not found');
            });
        } else {
            el = trTag;
        }
    }
    $(el).removeClass('on-playlist');<b class="conum">(3)</b>
    return new Promise(function(resolve, reject) {
        // Do the actual playing here, and either call resolve() or reject()
        // when done.

        removeFromPlaylistImpl(el.attr('xf-record-id')).then(function(data) {
            // success
            resolve(data);
        }).catch (function(data) {
            // Failed
            $(el).addClass('on-playlist'); <b class="conum">(4)</b>
            reject(data);
        });;
    });
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Optimistically add the 'on-playlist' CSS class when user clicks the "add" button.  This will toggle the actions immediately.</p>
</li>
<li>
<p>If the action failed, we revert the CSS class back, by removing the "on-playlist" CSS class.</p>
</li>
<li>
<p>Optimistally remove the 'on-playlist' CSS class when user clicks the "remove" button.  This will toggle the actions immediately.</p>
</li>
<li>
<p>If the action failed, we revert the CSS class back, by re-adding the "on-playlist" CSS class.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="ajax-list-row-actions">Using AJAX To Modify Row Records</h3>
<h4 id="_problem_34" class="discrete">Problem</h4>
<div class="paragraph">
<p>You need to perform a server-side action when the user clicks on a row action.  E.g. From <a href="#toggle-row-actions">Making Row Actions Toggleable</a>, we needed to add and remove the row record from the playlist.</p>
</div>
<h4 id="_solution_32" class="discrete">Solution</h4>
<div class="paragraph">
<p>Create a custom action handler that performs the the function, and returns JSON, and write a Javascript function that calls this AJAX action.</p>
</div>
<div class="paragraph">
<p>TODO: Need to write this solution</p>
</div>
</div>
<div class="sect2">
<h3 id="default-sort">Specifying Default Sorting</h3>
<h4 id="_problem_35" class="discrete">Problem</h4>
<div class="paragraph">
<p>You want the records in a particular table to be sorted on a particular column by default.</p>
</div>
<div class="sect3">
<h4 id="_solution_33">Solution</h4>
<div class="paragraph">
<p>Use the <code>table.default_sort</code> property of the fields.ini file.</p>
</div>
<div class="listingblock">
<div class="title">Using the <code>table.default_sort</code> property in the fields.ini file to sort records in descending order on the date_posted field.</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">table.default_sort=date_posted desc</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
See <a href="#default-related-sort">Setting Default Sort for Related Lists</a> to learn how to set the default sort order on a related tab.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="grid-view">Rendering List View as a Grid</h3>
<h4 id="_problem_36" class="discrete">Problem</h4>
<div class="paragraph">
<p>You want to display the "list" view as a grid for one or more tables in your app.</p>
</div>
<h4 id="_solution_34" class="discrete">Solution</h4>
<div class="paragraph">
<p>Add <code>list_template=@grid</code> to the beginning of your table&#8217;s <code>fields.ini</code> file.</p>
</div>
<div class="paragraph">
<p>This will cause the list to use the <code>actions/list/grid.html</code> template for rendering the list view.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/grid-list-view.png" alt="grid list view">
</div>
<div class="title">Figure 42. Example rendering list as a grid.</div>
</div>
<div class="paragraph">
<p>Note: For the "grid" layout to make sense, you should have at least one image column column in the table.  You can specify a column as an "image" column by adding the <code>image=1</code> fields.ini directive.</p>
</div>
</div>
<div class="sect2">
<h3 id="list-style-mobile">Using Mobile List Template on Desktop</h3>
<h4 id="_problem_37" class="discrete">Problem</h4>
<div class="paragraph">
<p>The Xataface list view is responsive, and renders lists differently on mobile devices than on desktop.  In some cases you may prefer to use the mobile list style on desktop also to achieve a unified look.</p>
</div>
<h4 id="_solution_35" class="discrete">Solution</h4>
<div class="paragraph">
<p>Set the <code>table.listStyle=mobile</code> directive in the table&#8217;s fields.ini file.  This is a table-level directive, so it should be at the top of your fields.ini file, before any of the field definitions.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s look at a quick example.  Here is a list using the mobile theme.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/related-list-mobile.png" alt="related list mobile">
</div>
</div>
<div class="paragraph">
<p>Here is the same list when viewed on a desktop:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/related-list-desktop.png" alt="related list desktop">
</div>
</div>
<div class="paragraph">
<p>Now, I&#8217;ll add the <code>table.listStyle=mobile</code> directive to the beginning of the table&#8217;s fields.ini file.</p>
</div>
<div class="paragraph">
<p>The result is:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/related-list-desktop-list-style-mobile.png" alt="related list desktop list style mobile">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This directive will also affect how related lists <strong>to</strong> this table are rendered, but only in one-to-many relationships to this table (i.e. where the rows are essentially records of this table).
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="row-style-external-link">Rendering Row as Link to External URL</h3>
<h4 id="_problem_38" class="discrete">Problem</h4>
<div class="paragraph">
<p>You want to render the rows of your table such that they summarize some external web page, and provide a link to it, similar to the way that Twitter renders tweets that contains a link to a webpage.</p>
</div>
<h4 id="_solution_36" class="discrete">Solution</h4>
<div class="paragraph">
<p>Use the <code>table.listStyle=mobile</code> fields.ini directive in conjunction with the <code>table.row_style=external-link</code> directive, and implement a calculated field on the table named <code>external_link</code> as I will describe below.  The result will be something that looks like:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/table-row-style-external-link.png" alt="table row style external link">
</div>
</div>
<h5 id="_steps" class="discrete">Steps</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add the following to the beginning of your fields.ini file (before any field definitions):</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">table.listStyle=mobile <b class="conum">(1)</b>
table.row_style=external-link <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The <code>table.listStyle</code> directive will make sure that the desktop version uses the mobile list theme, since the <code>external-link</code> style is only rendered in the mobile theme.</p>
</li>
<li>
<p>The <code>table.row_style</code> directive tells the list view and related list views to render rows in the external-link theme.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Define a method named <code>field__external_link()</code> in your table delegate class as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">function field__external_link(Dataface_Record $rec) {
    // return an array with url, title, and cover_image keys
    return [
        'url' =&gt; $rec-&gt;display('page_url'), <b class="conum">(1)</b>
        'title' =&gt; $rec-&gt;display('article_title'), <b class="conum">(2)</b>
        'cover_image' =&gt; $rec-&gt;display('article_image') <b class="conum">(3)</b>
    ];
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The <code>url</code> key should refer to the URL for the given record.  In this example we assume that the table has a column named <code>page_url</code> containing the URL to the link.</p>
</li>
<li>
<p>The <code>title</code> key should refer to an article title to display.  In this example we assume that the table has a column named <code>article_title</code>.</p>
</li>
<li>
<p>The <code>cover_image</code> key should refer to the URL for an image for the article. In this example, we assume that the table includes a field called <code>article_image</code> containing a URL - though this could also be a container or blob field in this example, as the <code>display()</code> method would get the URL to the container&#8217;s image.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="view_tab_customization"><em>View</em> Tab Customization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following sections form a sort of cook book with recipes for customizing the <em>view</em> tab, also known as the <em>Details</em> tab.  This is the tab in the UI that shows the details of a single record.</p>
</div>
<div class="sect2">
<h3 id="_displaying_syntheticcalculated_field">Displaying Synthetic/Calculated Field</h3>
<h4 id="_problem_39" class="discrete">Problem</h4>
<div class="paragraph">
<p>You want to create a <em>synthetic</em> field, and display it in the <em>view</em> tab just as you would with all of the regular fields.</p>
</div>
<h4 id="_solution_37" class="discrete">Solution</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Define your synthetic field in your table&#8217;s delegate class using the <code>field__</code> prefix.  E.g.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">function field__mycustomfield(Dataface_Record $record) {
    return "My custom field value";
}</code></pre>
</div>
</div>
</li>
<li>
<p>Add an entry to the <em>fields.ini</em> file for this field, and set <code>visibility:browse=visible</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[mycustomfield]
    visibility:browse=visible</code></pre>
</div>
</div>
</li>
</ol>
</div>
<h4 id="_example" class="discrete">Example</h4>
<div class="paragraph">
<p><a href="https://www.tuxpin.com">Tuxpin</a> includes a <em>podcasts</em> table that allows users to create their own podcast.  Each podcast has a unique ID, which is stored in the <em>podcast_uuid</em> column.  It also provides a website for the podcast, which is located at a URL of the form:</p>
</div>
<div class="paragraph">
<p><em><a href="https://podcasts.tuxpin.com/{podcast_uuid}" class="bare">https://podcasts.tuxpin.com/{podcast_uuid}</a></em></p>
</div>
<div class="paragraph">
<p>Beause the website URL can be derived from the <em>podcast_uuid</em>, we don&#8217;t need to actually store it in the database.  However, we would like to display this URL in the View tab.</p>
</div>
<div class="paragraph">
<p>To achieve this, we first define the <em>website_url</em> field in the delegate class as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">function field__website_url(Dataface_Record $record) {
    return 'https://podcasts.tuxpin.com/' . $record-&gt;val('podcast_uuid').'/';
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default synthetic (or calculated) fields are not displayed in the view tab (or anywhere in the UI, for that matter).  You need to set the <code>visibility:browse</code> property of the field to <code>visible</code>, in order to have it appear in the view tab.</p>
</div>
<div class="paragraph">
<p>So, in the table&#8217;s <em>fields.ini</em> file we add:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[website_url]
    visibility:browse=visible
    group=website    ; Tell it to display this field in the website fieldgroup</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the result:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/calculated-field-view-tab.png" alt="calculated field view tab">
</div>
</div>
<div class="paragraph">
<p>We can now treat this field like any other field in our view tab.  We can further customize using configuration options and delegate class methods, just as we would with a <em>real</em> field.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="searching">Searching</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following section include tips on configuring search support in Xataface application.</p>
</div>
<div class="sect2">
<h3 id="_case_sensitive_searches">Case-Sensitive Searches</h3>
<h4 id="_problem_40" class="discrete">Problem</h4>
<div class="paragraph">
<p>You searches on a particular column to be case-sensitive.  (E.g. If the user searches for "Bob", it should match "Bob" but not "bob").</p>
</div>
<h4 id="_solution_38" class="discrete">Solution</h4>
<div class="paragraph">
<p>Use the <code>collate</code> fields.ini directive to "utf8_general_cs" (or any other supported collation that is case-sensitive.</p>
</div>
<div class="paragraph">
<p>E.g.</p>
</div>
<div class="paragraph">
<div class="title">fields.ini file, specifying that searches of the "name" field should be case sensitive.</div>
<p>[source,ini</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[name]
   collate=utf8_general_cs</pre>
</div>
</div>
<h4 id="_discussion_3" class="discrete">Discussion</h4>
<div class="paragraph">
<p>By default, the case-sensitivity of searches depends on the collation of the underlying table and column in MySQL.  If the column was defined with a case-sensitive collation (e.g. <code>utf8_general_cs</code>), then all searches on this column will be case-sensitive.  If, however, it was defined with a case-insensitive collaction (e.g. <code>utf8_general_ci</code>), all searches will be case-insensitive.  If you want to change the behaviour of the app, you could simply change the underlying collation.  But in some cases you may not want to modify the table structure (or you won&#8217;t have access to the table structure).  In such cases, the "collate" directive is helpful.</p>
</div>
</div>
<div class="sect2">
<h3 id="_explicitly_specifying_case_sensitivity_of_a_search">Explicitly Specifying Case-sensitivity of a Search</h3>
<h4 id="_problem_41" class="discrete">Problem</h4>
<div class="paragraph">
<p>You want to perform a case-sensitive search on a field that has a case-insensitive collation.</p>
</div>
<h4 id="_solution_39" class="discrete">Solution</h4>
<div class="paragraph">
<p>Wrap the query value in a command wrapper, and use the "cs" command to specify "case-sensitive" (or "ci" to specify case-insensitive").</p>
</div>
<div class="paragraph">
<p>E.g.</p>
</div>
<div class="paragraph">
<p>If you want to search for "Bob" in the name field, enter the following in the search field for "Bob".</p>
</div>
<div class="listingblock">
<div class="content">
<pre>#Bob#cs</pre>
</div>
</div>
<div class="paragraph">
<p>If you, instead wanted to explicitly perform a case-insensitive search you would enter</p>
</div>
<div class="listingblock">
<div class="content">
<pre>#Bob#ci</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_making_columns_not_searchable">Making Columns Not-Searchable</h3>
<h4 id="_problem_42" class="discrete">Problem</h4>
<div class="paragraph">
<p>The main search box at the top of the application searches for matches in all of the char, varchar, and text fields by default.  What if you want to only match against specific fields?</p>
</div>
<div class="sect3">
<h4 id="_solution_40">Solution</h4>
<div class="paragraph">
<p>Use the <code>not_searchable</code> fields.ini directive on any field cause searches <strong>not</strong> to match using that column.</p>
</div>
<div class="paragraph">
<p>E.g. If I don&#8217;t want the search field to match on a the "private_info" column, I could do the following:</p>
</div>
<div class="listingblock">
<div class="title">fields.ini directives, disabling search matching on the private_info field</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[private_info]
    not_searchable=1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, if the user enters a search in the top search box, it won&#8217;t match against the "private_info" column.</p>
</div>
<div class="paragraph">
<p>You can "inverse" this behaviour, and make all of the columns not searchable by default, using the <code>__global__</code> section.</p>
</div>
<div class="paragraph">
<p>E.g.</p>
</div>
<div class="listingblock">
<div class="title">Making all fields unsearchable except for the <code>myfield</code> column.</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[__global__]
    not_searchable=1

[myfield]
    not_searchable=0</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p><code>not_searchable</code> only affects the top search box (i.e. the <code>-search</code> query parameter).  Users can still peform "finds" on a field with <code>not_searchable=1`by directly performing a find on that column using either the "advanced find" form, column search, filters, or via URL conventions (e.g. `myfield=someval</code>).</p>
</div>
<div class="paragraph">
<p>If you want to make a field completely "un-findable", you should use the <code>not_findable</code> directive.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="file_uploads">File Uploads</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following sections pertain to management of file uploads.</p>
</div>
<div class="sect2">
<h3 id="_specifying_content_disposition_of_file_download">Specifying Content Disposition of File Download</h3>
<h4 id="_problem_43" class="discrete">Problem</h4>
<div class="paragraph">
<p>By default the contents of <code>blob</code> fields and container fields are downloaded as a file download in the browser.  You want the browser to navigate to the file instead of downloading it.</p>
</div>
<h4 id="_solution_41" class="discrete">Solution</h4>
<div class="paragraph">
<p>Use the <code>contentDisposition=inline</code> fields.ini directive.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[myfield]
    contentDisposition=inline</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, when users click on the link for this field, the browser will navigate to the field content.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
The <code>contentDisposition</code> directive will be used to set the <code>Content-Disposition</code> HTTP header.  Learn more about this header <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Disposition">here</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="generating-thumbnails">Generating Thumbnails</h3>
<h4 id="_problem_44" class="discrete">Problem</h4>
<div class="paragraph">
<p>I want to automatically resize uploaded images to specific dimensions.</p>
</div>
<h4 id="_solution_42" class="discrete">Solution</h4>
<div class="paragraph">
<p>Use the <code>transform</code> property on the Container field in the fields.ini file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[file]
    Type=container
    widget:description="Select image to upload"
    transform="itunes300 fill:300x300; itunes1400 fill:1400x1400"</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above snippet, I&#8217;ve defined two thumbnail sizes for uploaded images:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>itunes300</strong>, which resizes images to 300 pixels wide and 300 pixels high, and crops the image so that it fills the entire image (so it may cut off some of the image on top/bottom or left/right.</p>
</li>
<li>
<p><strong>itunes1400</strong>, which resizes images to be 1400 pixels high and wide.  It also fills the entire image, so may cut off some of hte image on top/bottom or left/right.</p>
</li>
</ol>
</div>
<h4 id="_the_right_thumbnail_for_the_right_occasion" class="discrete">The Right Thumbnail for the Right Occasion</h4>
<div class="paragraph">
<p>The <strong>transform</strong> directive will cause images to be automatically resized at the time that the images are uploaded, but it doesn&#8217;t specify how and when the thumbnails are used.  You might want a small (100px) thumbnail used when displaying the record in list view, and a slightly larger image (640x480) used in the view tab.  In the above example we&#8217;ve defined two thumbnail sizes "itunes300" and "itunes1400".</p>
</div>
<div class="paragraph">
<p>The default behaviour is to display the <strong>first</strong> thumbnail type defined in all situations.  If you want a particular action to use a different thumbnail by default, then you can use the <code>thumbnail.ACTIONNAME</code> fields.ini directive to specify this.</p>
</div>
<div class="paragraph">
<p>For example, if you want the "view" action to use the "itunes1400" thumbnail, you would add the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">thumbnail.view=itunes1400</code></pre>
</div>
</div>
<div class="paragraph">
<p>So the full snippet becomes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[file]
    Type=container
    widget:description="Select image to upload"
    transform="itunes300 fill:300x300; itunes1400 fill:1400x1400"
    thumbnail.list = itunes1400</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_storing_files_on_amazon_s3">Storing Files on Amazon S3</h3>
<h4 id="_problem_45" class="discrete">Problem</h4>
<div class="paragraph">
<p>Rather than storing uploaded files directly on the server file system, you want to store them on Amazon S3 for scalability purposes.</p>
</div>
<h4 id="_solution_43" class="discrete">Solution</h4>
<div class="paragraph">
<p>Use the <a href="https://github.com/shannah/xataface-module-s3">s3 module</a>.</p>
</div>
<div class="paragraph">
<p><strong>Installation Instructions</strong></p>
</div>
<div class="paragraph">
<p>You can find installation instructions for the s3 module in the <a href="https://github.com/shannah/xataface-module-s3">README</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The S3 module requires the <a href="https://aws.amazon.com/sdk-for-php/">Amazon AWS SDK for PHP</a> which you can install in your project using <a href="https://getcomposer.org">Composer</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Configuration</strong></p>
</div>
<div class="paragraph">
<p>Once the module is installed, you need to add some configuration to your app&#8217;s conf.ini file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[modules_s3]
  key=YOUR_AWS_API_KEY      ; Change to your AWS key
  secret=YOUR_SECRET_KEY    ; Change to your AWS secret key
  region="us-east-1"        ; Change to the region of your S3 buckets</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>fields.ini Configuration</strong></p>
</div>
<div class="paragraph">
<p>In addition to the conf.ini configuration, you need to add the <code>s3.bucket</code> directive to any Container fields that you wish to store on S3, to specify the name of the bucket where it should store the files.</p>
</div>
<div class="listingblock">
<div class="title">Example fields.ini configuration</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[file]
	Type=container
    s3.bucket=YOUR_BUCKET
    s3.key.prefix=FILE_PREFIX/
	widget:description="Select image or video to upload"
	transform="itunes300 fill:300x300; itunes1400 fill:1400x1400"
	thumbnail.view=itunes1400</code></pre>
</div>
</div>
<div class="paragraph">
<p>The key properties in the above example are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">s3.bucket</dt>
<dd>
<p>The name of the bucket where your files should be stored.</p>
</dd>
<dt class="hdlist1">s3.key.prefix</dt>
<dd>
<p>A prefix for the file names that is prepended to the autogenerated file names in S3.</p>
</dd>
</dl>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
The S3 module fully supports Xataface&#8217;s <a href="#generating-thumbnails">thumbnail</a> feature, as demonstrated in the example above with the "transform" and "thumbnail.view" directives.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="http_request_handling">HTTP Request Handling</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following sections include tips for configuring how Xataface applications respond to HTTP requests.  This includes topics such as event routing, response types, etc&#8230;&#8203;</p>
</div>
<div class="sect2">
<h3 id="_specifying_a_default_action">Specifying a Default Action</h3>
<h4 id="_problem_46" class="discrete">Problem</h4>
<div class="paragraph">
<p>You want your application to use a default action other than the Xataface default, if the user doesn&#8217;t explicitly provide an "-action" parameter.</p>
</div>
<h4 id="_solution_44" class="discrete">Solution</h4>
<div class="paragraph">
<p>Use the <code>default_action</code> conf.ini directive.</p>
</div>
<div class="paragraph">
<p>E.g.:</p>
</div>
<div class="listingblock">
<div class="title">Setting a default action at the beginning of your conf.ini file.</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">default_action=find</code></pre>
</div>
</div>
<div class="paragraph">
<p>This would result in the user being directed to the "find" action by default.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If "default_action" is not specified, then Xataface will use the "list" action as the default.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_using_different_default_action_depending_on_table">Using Different Default Action Depending on Table</h3>
<h4 id="_problem_47" class="discrete">Problem</h4>
<div class="paragraph">
<p>You want to specify a default action only for one table in your application.  The "default_action" conf.ini directive sets the default action application-wide.</p>
</div>
<h4 id="_solution_45" class="discrete">Solution</h4>
<div class="paragraph">
<p>Use the <code>default_action.tablename</code> directive in your conf.ini file.  (<code>tablename</code> should be replaced with your desired table name.  For example, suppose I want to make the "view" action the default action for the "posts" table, then I would define the following at the beginning of the conf.ini file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">default_action.posts=view</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_specifying_default_query_parameters_for_default_actions">Specifying Default Query Parameters for Default Actions</h3>
<h4 id="_problem_48" class="discrete">Problem</h4>
<div class="paragraph">
<p>You want to supply additional query parameters for your default actions.  These parameters should only be applied when the default action is used.</p>
</div>
<h4 id="_solution_46" class="discrete">Solution</h4>
<div class="paragraph">
<p>Use the <code>default_params.tablename</code> directive.  E.g.</p>
</div>
<div class="listingblock">
<div class="title">Setting some default query parameters for when the default action is used on the posts table.</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">default_action.posts=view
default_params.posts="post_id=2&amp;foo=bar"</code></pre>
</div>
</div>
<div class="paragraph">
<p>These default parameters will be used if the user requests a URL like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>index.php?-table=posts</pre>
</div>
</div>
<div class="paragraph">
<p>The above would effectively be the same as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>index.php?-table=posts&amp;-action=view&amp;post_id&amp;foo=bar</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>default_params.tablename</code> directive only applies when the default action is being used.  E.g. In the above example, if the user requests:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>index.php?-table=posts&amp;-action=view</pre>
</div>
</div>
<div class="paragraph">
<p>The default params would not be applied because the "-action" has been specified explicitly by the user.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The above example shows the <code>default_params.posts</code> directive specified as a URL-encoded string.  However, you can also define the parameters as a section.</p>
</div>
<div class="paragraph">
<p>E.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[default_params.posts]
  post_id=2
  foo=bar</code></pre>
</div>
</div>
<div class="paragraph">
<p>This would be equivalent to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">default_params.posts="post_id=2&amp;foo=bar"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_showing_the_edit_tab_by_default_for_record_details">Showing the "Edit" Tab By Default for Record Details</h3>
<h4 id="_problem_49" class="discrete">Problem</h4>
<div class="paragraph">
<p>By default, when the user clicks on a record to see its details, they will be shown the "View" tab.  You want to show them the "Edit" tab instead.</p>
</div>
<h4 id="_solution_47" class="discrete">Solution</h4>
<div class="paragraph">
<p>Use the <code>default_browse_action</code> directive of the conf.ini file. This directive is analagous to the <code>default_action</code> directive, except it is only applied when the user requests the "browse" action, which is the default action used for displaying record details.</p>
</div>
<div class="paragraph">
<p>The direct solution to our problem would be the following at the beginning of the conf.ini file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">default_browse_action=edit</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>Just like the <code>default_action</code> directive, you can specify a different default browse action for different tables using the <code>default_browse_action.tablename</code> directive.  E.g.</p>
</div>
<div class="listingblock">
<div class="title">Only setting the default browse action to edit on the "posts" table.</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">default_browse_action.posts=edit</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_setting_default_query_parameters_for_the_browse_action">Setting Default Query Parameters for the <code>browse</code> Action</h3>
<h4 id="_problem_50" class="discrete">Problem</h4>
<div class="paragraph">
<p>You have specified a custom action that you are using as the default "browse" action for your table via the <code>default_browse_action.mytable=myaction</code> directive.  However your action requires some additional query parameters to work correctly.  You need to add these default parameters somehow.</p>
</div>
<h4 id="_solution_48" class="discrete">Solution</h4>
<div class="paragraph">
<p>Use the <code>default_browse_params.tablename</code> directive to add parameters to the <code>browse</code> action. This directive works similarly to the <code>default_params.tablename</code> directive.  E.g. Let&#8217;s add a "foo" query parameter by default when the user accesses the "browse" action on the "posts" table.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">default_browse_action.posts=myaction
default_browse_params.posts="foo=bar"</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>The above example shows the <code>default_browse_params.posts</code> directive specified as a URL-encoded string.  However, you can also define the parameters as a section.</p>
</div>
<div class="paragraph">
<p>E.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[default_browse_params.posts]
  foo=bar
  fuzz=bazz</code></pre>
</div>
</div>
<div class="paragraph">
<p>This would be equivalent to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">default_browse_params.posts="foo=bar&amp;fuzz=bazz"</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_setting_a_related_records_tab_as_the_default_browse_action">Setting a Related Records Tab as the Default Browse Action</h3>
<h4 id="_problem_51" class="discrete">Problem</h4>
<div class="paragraph">
<p>When the user clicks on a record in the "list" view, you want them to see a related record tab instead of the "View" tab by default.</p>
</div>
<h4 id="_solution_49" class="discrete">Solution</h4>
<div class="paragraph">
<p>We can achieve this by way of the <code>default_browse_params.tablename</code> conf.ini directives.  For example, suppose we wanted to show the "authors" relationship of the "posts" table by default when a post&#8217;s details are shown:</p>
</div>
<div class="listingblock">
<div class="title">Specifying that the "authors" relationship should be shown by default when viewing a record in the posts table.</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">default_browse_params.posts="-relationship=authors"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice here, that we didn&#8217;t actually need to use the <code>default_browse_action</code> parameter to specify that it should use the <code>related_records_list</code> action (which is the action used to display a related list).  Xataface infers this by the presence of the "-relationship" directive.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tables_views_queries">Tables, Views, and Queries</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following chapters pertain tables, views, and queries.  It includes tips on how to set up your tables, views, and queries for optimal performance and flexibility.</p>
</div>
<div class="sect2">
<h3 id="_accessing_an_sql_query_like_a_table">Accessing an SQL query like a Table</h3>
<h4 id="_problem_52" class="discrete">Problem</h4>
<div class="paragraph">
<p>You want to create a user-specific SQL query and navigate its results as if it were a proper table.  You want the results of this table to be different for different users.</p>
</div>
<h4 id="_solution_50" class="discrete">Solution</h4>
<div class="paragraph">
<p>There are a few strategies that you could use for this.  You could simply use a MySQL view, and set up a security filter on the table.  In some cases, this may not be flexible enough, though.  In such cases you can use a dynamic query.</p>
</div>
<div class="paragraph">
<p>You can create a dynamic query as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add a directory to your application&#8217;s "tables" directory named <code>_tmp_{NAME}</code> where <code>{NAME}</code> is the name of your query.</p>
</li>
<li>
<p>Create a <code>fields.ini.php</code> (or fields.ini) file inside this directory with at least a <code>__sql__</code> directive.  This <code>__sql__</code> directive is were you specify the SQL query that should be used for the contents of the table.</p>
</li>
<li>
<p>Specify the primary key for the table by adding a <code>Key=PRI</code> directive to one of the fields in the fields.ini file.  You can inject the user id of the currently logged in user with the <code>{{USER_ID}}</code> string.  This will be replaced by the user ID.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For example, let&#8217;s add a dynamic query called "my_posts", which is basically just a list of posts that the current user has posted.  This provides an easy way for the user to generate a feed of his own posts.</p>
</div>
<div class="paragraph">
<p>First we&#8217;ll create the <code>_tmp_my_posts</code> directory, inside the "tables" directory.  Then we&#8217;ll add our <code>fileds.ini.php</code> file:</p>
</div>
<div class="listingblock">
<div class="title">fields.ini.php file</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">;&lt;?php exit; // To prevent this file from being served
__sql__ = "select * from posts where posted_by='{{USER_ID}}'"

[post_id]
   Key=PRI</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can alternatively create a delegate class for your table by creating a delegate class (<code><em>tmp_my_posts.php</code>) and define an <code>__sql_</em>()</code> method.</p>
</div>
<div class="paragraph">
<p>E.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">&lt;?php
class tables__tmp_my_posts {
    function __sql__() {
        return "select * from posts where posted_by='{{USER_ID}}'";
    }
}</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can access this "table" just as you would, a normal table.  Just remember that the full table name is "_tmp_my_posts".  E.g. If you go to "index.php?-table=_tmp_my_posts", it will show you these results.</p>
</div>
<h4 id="_how_dynamic_queries_work" class="discrete">How Dynamic Queries Work</h4>
<div class="paragraph">
<p>When xataface receives a request for a table whose name starts with "<em>tmp</em>" it begins by performing the <code>__sql__</code> and loading the results into a temporary table.  This operation is very fast because temporary tables are typically stored in RAM, and they are only usable in the current session (i.e. other users cannot see this table).</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Dynamic query tables are ephemeral, so any changes you make to is will disappear at the end of the request.  This means that you cannot insert or update records into these tables.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="deployment-and-administration">Deployment and Administration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following section includes recipes for administration and deployment of your Xataface applications.  This includes things like managing development, staging, and production servers, and dealing with versions and upgrades.</p>
</div>
<div class="sect2">
<h3 id="whereis-phpini">Where is my php.ini file?</h3>
<h3 id="_problem_53" class="discrete">Problem</h3>
<div class="paragraph">
<p>You need to change a setting in your php.ini file but you don&#8217;t know where it is, or your server has multiple php.ini files and you don&#8217;t know which one is the correct one.</p>
</div>
<h3 id="_solution_51" class="discrete">Solution</h3>
<div class="paragraph">
<p>Create a file inside your application directory named "phpinfo.php" with the following contents:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">&lt;?php
phpinfo();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Load this page in your web browser and search for "php.ini".</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/phpinfo-phpini-location.png" alt="phpinfo phpini location">
</div>
</div>
<div class="paragraph">
<p>Now open that file and make your changes.</p>
</div>
</div>
<div class="sect2">
<h3 id="_using_different_config_files_on_different_servers">Using Different Config Files on Different Servers</h3>
<h4 id="_problem_54" class="discrete">Problem</h4>
<div class="paragraph">
<p>You want your production server to use different configuration options than your development server.  For example, perhaps you want to enable the output cache on the production server, but not on the development server.</p>
</div>
<div class="sect3">
<h4 id="_solution_52">Solution</h4>
<div class="paragraph">
<p>Use the <a href="#confini-include-directive"><code>__include__</code></a> directive in your conf.ini file to load your server-specific configuration options from a different config file.  Use the <code>{host}</code> placeholder to specify a different config file depending on the host name of the current request.</p>
</div>
<div class="paragraph">
<p>E.g.</p>
</div>
<div class="listingblock">
<div class="title">conf.ini.php file</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">;&lt;?php exit;
__include__=hosts/{host}/{host}.conf.ini.php

[_tables]
  table1=My First Table
  table2=My Second Table</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><code>hosts/localhost/localhost.conf.ini.php</code> Config file when application is accessed via localhost.</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">;&lt;?php exit;
;; Development Server Config
[_database]
    host=localhost
    name=mydb
    user=root
    password=mypass

[_output_cache]
    enabled=0 ;; Disable output cache on development server</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><code>hosts/example.com/example.com.conf.ini.php</code> Config file when application is accessed via localhost.</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">;&lt;?php exit;
;; Production Server Config
[_database]
    host=localhost
    name=mydb
    user=mydbuser
    password=mydbuserpass

[_output_cache]
    enabled=1 ;; Enable output cache on production server</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_application_versioning_and_synchronization">Application Versioning and Synchronization</h3>
<h4 id="_problem_55" class="discrete">Problem</h4>
<div class="paragraph">
<p>You want to deploy the changes in the development version of your app to the production server, including database changes.</p>
</div>
<h4 id="_solution_53" class="discrete">Solution</h4>
<div class="paragraph">
<p>Increment the build number in your app&#8217;s version.txt file, and implement corresponding <code>update_xxx()</code> methods in your <code>conf/Installer.php</code> file.</p>
</div>
<h4 id="_discussion_4" class="discrete">Discussion</h4>
<div class="paragraph">
<p>One of the more annoying challenges involved with managing production web applications is keeping the development and production versions in sync. Git makes this task trivial for source code and file system changes, but changes to the database schema between versions still need to be handled with care, as these changes fall outside the watch of any version control system.</p>
</div>
<div class="paragraph">
<p>For example, suppose I am running an application that stores user profile information, and I want to add a column to the users table to store the users postal code. I add the column to my development database but I dont want to add it to the production database until I am finished with the rest of my changes.</p>
</div>
<div class="paragraph">
<p><strong>The old way: Copy &amp; Paste  text files</strong></p>
</div>
<div class="paragraph">
<p>The old way managing these changes was to make the change in the development database, then copy and paste the SQL query that I used to perform the update into a text file. I would repeat this process for each change that I made. When it came time to move the changes to the production application, I would just execute these statements manually one by one on the production server.</p>
</div>
<div class="paragraph">
<p>The down-side of this approach is that it didnt scale very well. It works OK if I only have one production installation and one development server. But what if I have dozens of production servers all running the same application, and perhaps running different versions. It would become cumbersome if not impossible to keep track of all of these changes and manually apply them across all installations.</p>
</div>
<div class="paragraph">
<p><strong>The new way: Xataface Application Versioning</strong></p>
</div>
<div class="paragraph">
<p>Xataface allows you to track the version of your application with a text file named version.txt stored in your applications directory. This file should contain one line like with two numbers separated by a space:</p>
</div>
<div class="paragraph">
<p><code>1.0b1 345</code></p>
</div>
<div class="paragraph">
<p>This example means that the application version is <code>1.0b1</code>, and that the build version is <code>345</code>. The build version must be an integer that is incremented every time there is a change to the source code. It is used by Xataface to figure out whether the file system version matches the database version.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The build version number is independent of the application version, and should only ever go "up" in value with new releases.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>On every page request, Xataface checks the version.txt file to see what version of application is currently in the file system. It compares this with the version of the database. If the database version is lower, it will execute the necessary queries to update the database to the current version.</p>
</div>
<h5 id="_the_confinstaller_php_file" class="discrete">The conf/Installer.php file</h5>
<div class="paragraph">
<p>Xataface looks for a class named <code>conf_Installer</code> located in your applications "conf/Installer.php" file to find out what it needs to do to update between versions. You can define methods in this class of the form:</p>
</div>
<div class="paragraph">
<p><code>function update_##(){}</code></p>
</div>
<div class="paragraph">
<p>Where <code>##</code> is the build number of the update.</p>
</div>
<div class="paragraph">
<p>Xataface will execute all functions <code>update_XX()</code> to <code>update_YY()</code> in your <code>conf_Installer</code> class automatically if it finds that the database version is <code>XX</code> and the filesystem version is <code>YY</code>. This is where you can place your database updates that need to be performed between versions.</p>
</div>
<div class="paragraph">
<p>For example, suppose the production server is running build version <code>345</code>. That means that the version.txt file in your production server might look something like:</p>
</div>
<div class="paragraph">
<p><code>0.5.1 345</code></p>
</div>
<div class="paragraph">
<p>Now you want to add a <code>postal_code</code> column to the users table in the development version, so youll increment the version number on the development server:</p>
</div>
<div class="paragraph">
<p><code>0.5.2 346</code></p>
</div>
<div class="paragraph">
<p>And add a method to your <code>conf/Installer.php</code> file to perform the database change:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">&lt;?php
class conf_Installer {
    function update_346(){
        $sql[] = 'ALTER TABLE `users` ADD `postal_code` VARCHAR(32) AFTER `phone_number`';
        df_q($sql);
       }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can just update the source files to the production server using subversion. The first time you run the production app after updating the source files youll get a message saying that the application has been updated to version <code>346</code>.</p>
</div>
<div class="paragraph">
<p>Thats all it takes. You just keep on adding these methods for each update. Then even if you have an instance that is a couple of versions behind, all you need to do is update to the latest source revisions, and it will automatically update the database to the correct version.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_user_interface_and_themes">User Interface and Themes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following sections cover user interface considerations such as themes, UI configuration, and customization.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="responsive-ui">Responsive UI</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Starting in Xataface 3.0, the entire the user interface has been revamped to provide a good mobile experience out of the box.  Every aspect of the UI has been reviewed and improved to fit user expectations of a mobile application.  Elements that don&#8217;t make sense in a mobile interface have been "hidden" and replaced with other more suitable elements.</p>
</div>
<div class="paragraph">
<p>Here are a few snapshots of the new look:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-060820-013308.455.png" alt="Image 060820 013308.455">
</div>
<div class="title">Figure 43. List view</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-060820-013349.259.png" alt="Image 060820 013349.259">
</div>
<div class="title">Figure 44. Details view</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-060820-013500.872.png" alt="Image 060820 013500.872">
</div>
<div class="title">Figure 45. New Record Form</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-060820-013559.078.png" alt="Image 060820 013559.078">
</div>
<div class="title">Figure 46. Hamburger Menu</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-060820-013629.481.png" alt="Image 060820 013629.481">
</div>
<div class="title">Figure 47. Login form</div>
</div>
<div class="paragraph">
<p>You&#8217;ll notice quite a few differences from the desktop theme:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Instead of a table with columns, the "list" view renders similar to the view you would expect in a mobile news, mail, or social media app.  Each row includes a title, description, icon, and set of actions that can be performed.</p>
</li>
<li>
<p>The familiar "Details", "List", and "Find" tabs are still there, but have been moved to the bottom of the screen and have been restyled to look more like the tabs in native mobile apps.</p>
</li>
<li>
<p>The navigation menu (to select the <strong>table</strong>), and personal tools menu ("logout", "profile", etc..) are now contained in hamburger slide-out menu; a common pattern in mobile apps.</p>
</li>
<li>
<p>Table actions (e.g. "New Record", "Delete", etc..) have been moved into a FAB (floating action button) in the lower right that hovers over the screen.  This is also a common element in mobile apps.</p>
</li>
<li>
<p>Forms are laid out in a single column, and the "Save" button has been moved to a fixed position at the bottom of the screen to streamline usability.</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="_switching_between_mobile_and_desktop_theme">Switching Between Mobile And Desktop Theme</h3>
<div class="paragraph">
<p>The theme is fully responsive, meaning that it will automatically render the appropriate UI based on the size of the window.  Currently the threshold occurs as a window width of 768 pixels.  If the window is wider than that, it will render the desktop UI.  Narrower, and it will render the mobile theme.</p>
</div>
<div class="paragraph">
<p>When in "mobile" mode, the <code>body</code> tag will include the "small" CSS class.  When in "desktop" mode, it will include the "large" CSS class.  This will allow you to define CSS styles that target mobile or desktop separately.  E.g.</p>
</div>
<div class="listingblock">
<div class="title">Using CSS to target styles to mobile or desktop.  The following would render <code>&lt;h1 class="mystyle"&gt;My heading&lt;/h1&gt;</code> as blue on mobile and green on desktop.</div>
<div class="content">
<pre class="highlight"><code class="language-css" data-lang="css">/**
 * red style for h1 tags.  Not used at all because it is overridden
 * by following two rules on mobile and desktop.
 */
h1.mystyle {
    color:red;
}

/**
 * Blue style applied on mobile only.
 */
body.small h1.mystyle {
    color:blue;
}

/**
 * Green style applied on desktop only.
 */
body.large h1.mystyle {
    color:green;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A Javascript event is fired both when entering and exiting mobile mode.  You can use these events in your Javascript code to be notified when transitioning between modes.  E.g.</p>
</div>
<div class="listingblock">
<div class="title">The <code>xf-mobileenter</code> and <code>xf-mobileexit</code> events are fired when entering and leaving mobile mode respectively.</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// Event that is fired when the window enters "mobile" mode
window.addEventListener('xf-mobileenter', function() {
    // Do stuff required to adjust to the change to mobile mode
});

// Event that is fired when the window exits "mobile" mode
window.addEventListener('xf-mobileexit', function() {
    // // Do stuff required to adjust to the change to desktop mode
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information about these events, see <a href="#javascript-events">Javascript Events</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_mobile_header_and_footer">Mobile Header and Footer</h3>
<div class="paragraph">
<p>The header and footer components of the mobile theme have "fixed" positions.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-060820-022427.761.png" alt="Image 060820 022427.761">
</div>
<div class="title">Figure 48. The mobile header</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-060820-022505.157.png" alt="Image 060820 022505.157">
</div>
<div class="title">Figure 49. The mobile footer</div>
</div>
<div class="paragraph">
<p>The size of these components may change as it is possible to add and remove contents from these components.  It is also possible to hide them in some contexts.</p>
</div>
<div class="paragraph">
<p>Xataface automatically configures the body padding so that these do not obscure other content on the page.  If you are using fixed or absolute positioning, you should be aware of these components.  You can use the <code>xf-viewport-changed</code> Javascript event be be notified when the size of the header or footer is changed.  For example, the FAB component is designed to hover in the lower right corner of the page, but it shouldn&#8217;t overlap the bottom tabs, so it needs to be positioned relative to the "mobile-footer" component. It uses the following code to accomplish this:</p>
</div>
<div class="listingblock">
<div class="title">The FAB component makes use of the <code>xf-viewport-changed</code> event to reposition itself when the mobile footer or header is changed.</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">function updatePosition() {
    var zoom = document.querySelector('.zoom');

    if (zoom) {
        var footer = document.querySelector('.mobile-footer');
        if (footer) {
            zoom.style.bottom = (footer.offsetHeight + 10) + "px";
        }
    }
}
window.addEventListener('xf-viewport-changed', updatePosition);</code></pre>
</div>
</div>
<h4 id="_hiding_the_header_and_footer" class="discrete">Hiding the Header and Footer</h4>
<div class="paragraph">
<p>You can hide the mobile-header and/or mobile-footer components by adding "no-mobile-header" and "no-mobile-footer" CSS classes to the <code>body</code> tag respectively.</p>
</div>
<div class="listingblock">
<div class="title">Hiding the Header from Javascript</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">document.body.classList.add('no-mobile-header');</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Hiding the footer from Javscript</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">document.body.classList.add('no-mobile-footer');</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can use the <code>addBodyCSSClass()</code> method of the <code>Dataface_Application</code> class to add CSS classes to the <code>body</code> tag from PHP.  E.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">$app = Dataface_Application::getInstance();
$app-&gt;addBodyCSSClass('-no-mobile-header');</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Certain Xataface actions hide the header, footer, and FAB by default.  Some examples include the login, edit, and new record forms.
</td>
</tr>
</table>
</div>
<h4 id="_adding_content_to_the_footer" class="discrete">Adding Content to the Footer</h4>
<div class="paragraph">
<p>The mobile footer is a handy place to add content that you want to display in a fixed position at the bottom of the screen.  The following snippet shows how to add a component to the top/beginning of the mobile footer.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">var mobileFooter = document.querySelector('.mobile-footer');
jQuery(mobileFooter).prepend(myElement);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_table_tabs">Table Tabs</h3>
<div class="imageblock">
<div class="content">
<img src="images/Image-060820-025517.027.png" alt="Image 060820 025517.027">
</div>
<div class="title">Figure 50. The mobile table tabs.</div>
</div>
<div class="paragraph">
<p>The table tabs (i.e. "Details", "List", and "Find") are rendered in the mobile footer by default. These are taken from the same actions as the table tabs in the desktop UI.  You can add/remove options to this menu by adding actions to the "table_tabs" category.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
For best results, make sure that the action includes a <code>materialIcon</code>.  See <a href="#material-icons">Using Material Icons</a> for more details on material icons.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Like the header and footer, you can hide the table tabs in mobile using the "no-table-tabs" CSS class on the "body" tag.</p>
</div>
<div class="paragraph">
<p>For example, the "edit" action includes the following snippet to remove the header, fab, and table tabs.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">$app-&gt;addBodyCSSClass('no-table-tabs');
$app-&gt;addBodyCSSClass('no-mobile-header');
$app-&gt;addBodyCSSClass('no-fab');</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_fab_floating_action_button">FAB (Floating Action Button)</h3>
<div class="imageblock">
<div class="content">
<img src="images/Image-060820-025738.446.png" alt="Image 060820 025738.446">
</div>
<div class="title">Figure 51. FAB with one action</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-060820-025922.987.png" alt="Image 060820 025922.987">
</div>
<div class="title">Figure 52. FAB with more than one action is rendered with a menu icon.  Clicking on it expands it to show the individual actions.</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-060820-030005.881.png" alt="Image 060820 030005.881">
</div>
<div class="title">Figure 53. FAB expanded to show actions.</div>
</div>
<div class="paragraph">
<p>The <strong>table actions menu</strong> is rendered using a floating action button.  You can hide this by adding the "no-fab" CSS class to the <code>body</code> tag.</p>
</div>
<div class="paragraph">
<p>To add options to the FAB, simply add actions to the <code>table_actions_menu</code> category, and make sure they have a <code>materialIcon</code> directive.  See <a href="#material-icons">Using Material Icons</a> for more about material icons.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>Actions in the <code>table_actions_menu</code> category are shared between the desktop and mobile themes.  You can make the action desktop-only by adding "#large#" to the <code>tags</code> property of the action. E.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">;An action that only shows up on desktop
[myaction]
    category=table_actions_menu
    label="My Action"
    tags="#large#"</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_customizing_the_list_view">Customizing the List View</h3>
<div class="paragraph">
<p>The rows of the list view use different mark-up in mobile than in desktop.  Both versions are rendered in HTML, but only one of them is visible at any given time.</p>
</div>
<div class="paragraph">
<p>There are 4 core content elements of a row in the mobile theme:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-060820-031126.567.png" alt="Image 060820 031126.567">
</div>
<div class="title">Figure 54. A row in the mobile theme.</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Logo</dt>
<dd>
<p><span class="image"><img src="images/Image-060820-031809.806.png" alt="Image 060820 031809.806"></span>
A logo or icon that is rendered on the left side.  You can customize this image by setting a field of your data base as the "logo".  The logo field should contain the URL to an image.  You can use a container field for this, a regular field, or a calculated field. E.g.</p>
<div class="listingblock">
<div class="title">Logo field defined in fields.ini file.</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[mylogofield]
    logo=1</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">Title</dt>
<dd>
<p><span class="image"><img src="images/Image-060820-031911.676.png" alt="Image 060820 031911.676"></span></p>
<div class="paragraph">
<p>The title field. There are many ways to define the title field.  Xataface uses some heuristics to guess the field, but you can configure this explicitly using the <code>getTitle()</code> delegate method or the <code>title</code> fields.ini property.</p>
</div>
</dd>
<dt class="hdlist1">Description</dt>
<dd>
<p><span class="image"><img src="images/Image-060820-031941.796.png" alt="Image 060820 031941.796"></span></p>
<div class="paragraph">
<p>The description field.  There are many ways to define the description field.  As with "title", Xataface uses some heuristics to guess the most appropriate field, but you can configure this explicitly using the <code>getDescription()</code> delegate method or the <code>description</code> fields.ini property.</p>
</div>
</dd>
<dt class="hdlist1">Record Actions</dt>
<dd>
<p><span class="image"><img src="images/Image-060820-031958.143.png" alt="Image 060820 031958.143"></span></p>
<div class="paragraph">
<p>Actions from the "list_row_actions" category are rendered in the south of the row.  For best results, the action should include the "materialIcon" directive.  See <a href="#material-icons">Using Material Icons</a> for more details about material icons.</p>
</div>
</dd>
</dl>
</div>
<h4 id="_useful_css_classes_in_mobile_list_view" class="discrete">Useful CSS Classes In Mobile List View</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">mobile-listing-row</dt>
<dd>
<p>The <code>&lt;div&gt;</code> tag wrapping the row.  This tag will also include the <code>xf-record-id</code> attribute whose value is the record ID of the record.  This element is the analog of the <code>&lt;tr&gt;</code> tag of the desktop interface.</p>
</dd>
<dt class="hdlist1">mobile-row-content</dt>
<dd>
<p>Inner <code>&lt;div&gt;</code> tag containing the row content.</p>
</dd>
<dt class="hdlist1">mobile-logo</dt>
<dd>
<p><code>&lt;div&gt;</code> tag wrapping the logo.</p>
</dd>
<dt class="hdlist1">mobile-title</dt>
<dd>
<p><code>&lt;div&gt;</code> tag wrapping the record title.</p>
</dd>
<dt class="hdlist1">mobile-description</dt>
<dd>
<p><code>&lt;div&gt;</code> tag wrapping the record description.</p>
</dd>
</dl>
</div>
<h4 id="_infinite_scroll" class="discrete">Infinite Scroll</h4>
<div class="paragraph">
<p>You&#8217;ll notice that the mobile list view doesn&#8217;t include any paging buttons (e.g. "Previous" or "Next").  This is because it uses infinite scrolling.  When the user scrolls to the bottom of the list, it will automatically load the next 30 records and append them to the end of the list seamlessly.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_appendix_1_configuration_directives">Appendix 1: Configuration Directives</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following chapters serve as reference to show all of the various configuration directives available in Xataface apps.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="confini-directives">Conf.ini Directives</h2>
<div class="sectionbody">
<h3 id="_overview" class="discrete">Overview</h3>
<div class="paragraph">
<p>The conf.ini file is where most of the application-level configuration information is stored for a Xataface application. It contains information such as:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>database connection information</p>
</li>
<li>
<p>which tables should appear in the tables menu.</p>
</li>
<li>
<p>preference settings</p>
</li>
<li>
<p>authentication settings</p>
</li>
<li>
<p>which add-on modules are to be used</p>
</li>
<li>
<p>output caching settings</p>
</li>
<li>
<p>history/undo settings</p>
</li>
<li>
<p>other misc settings.</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
This section documents some of the built-in configuration directives that Xataface supports, however, this file is extensible so you can add your own configuration directives as well (which you access in your PHP and Action definitions).
</td>
</tr>
</table>
</div>
<h3 id="_sections" class="discrete">Sections</h3>
<div class="paragraph">
<p>Every conf.ini file must contain at least the following sections:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">_database</dt>
<dd>
<p>Contains database connection info.</p>
<div class="listingblock">
<div class="title">Example <code>_database</code> section</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[_database]
  name=spokenpage
  user=root
  password=password
  host=localhost
  driver=mysqli</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
It is recommended to place the <code>[<em>database]</code> section in a separate file named <code>conf.db.ini.php</code> and include it in the <code>__includes__</em></code> directive to make your app more portable.
</td>
</tr>
</table>
</div>
</dd>
<dt class="hdlist1">_tables</dt>
<dd>
<p>Contains a list of tables that are to be included in the navigation menu of the application.</p>
<div class="listingblock">
<div class="title">Example <code>_tables</code> section</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[_tables]
    people=People
    publications=Publications</code></pre>
</div>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The following optional sections may also be included:</p>
</div>
<div id="conf-ini-alt_logos" class="dlist">
<dl>
<dt class="hdlist1">alt_logos</dt>
<dd>
<p>Specifies alternative images that can be used for the site logo depending on media queries (i.e. to show different images for different devices) and browser support (e.g. to provide fall-back images for browsers that don&#8217;t support an image format).  See <a href="#alternative-logos">Responsive Logo Image</a></p>
<div class="paragraph">
<p>Used in conjuction with <a href="#confini-site_logo">[confini-site_logo]</a></p>
</div>
<div class="paragraph">
<p>Since 3.0</p>
</div>
</dd>
<dt class="hdlist1">_allowed_tables</dt>
<dd>
<p>Specifies tables that should be explicitly allowed to override disallowed tables listed or matched in the _disallowed_tables section.	Since 0.7</p>
</dd>
<dt class="hdlist1">_auth</dt>
<dd>
<p>Contains information about authentication.	Since 0.6</p>
</dd>
<dt class="hdlist1">_disallowed_tables</dt>
<dd>
<p>A list of tables or patterns that match tables that should be blocked from being accessed directly through the application. By default any table beginning with an underscore, 'dataface_', or ending in '__history' are blocked. This prevents unintended access to some of the automatically created tables in Xataface.	Since 0.7</p>
</dd>
<dt class="hdlist1">_feed</dt>
<dd>
<p>Configuration options for RSS feeds that are generated by the application.	Since 1.0</p>
</dd>
<dt class="hdlist1">_history</dt>
<dd>
<p>Settings pertaining to the history feature (e.g. whether it has been enabled).	Since 0.7</p>
</dd>
<dt class="hdlist1">_index</dt>
<dd>
<p>Settings for the full site search indexing.	Since 1.0</p>
</dd>
<dt class="hdlist1">_modules</dt>
<dd>
<p>A list of modules that are enabled for this application.	Since 1.0</p>
</dd>
<dt class="hdlist1">_output_cache</dt>
<dd>
<p>Output cache settings. Using output caching can dramatically improve performance for busier sites.	Since 0.8</p>
</dd>
<dt class="hdlist1">_themes</dt>
<dd>
<p>A list of the themes that are to be applied to the application. Since 0.8</p>
</dd>
<dt class="hdlist1">default_tables</dt>
<dd>
<p>Allows you to set a default table on a per-action basis.  Keys are action names, values are table names.  E.g. If you wanted the <code>my_profile</code> action to use the <em>users</em> table by default, then you would have:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[default_tables]
  my_profile=users</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Since 3.0</strong></p>
</div>
</dd>
<dt class="hdlist1">table_labels</dt>
<dd>
<p>A list that defines friendly labels for displaying table names. Similar to the <code>[_tables]</code> section, but these tables do not appear in the application&#8217;s navigation menu by default. This is also the only method to display friendly table names in the search index results as of Xataface 2.1 or prior. (See Editing Search Results &gt;&gt; How Do I change table names). Also see the <a href="#fieldsini-table-label">label global directive in the fields.ini_file</a>.	Since always.</p>
</dd>
</dl>
</div>
<div class="sect2">
<h3 id="_stand_alone_attributes">Stand-alone Attributes</h3>
<div class="paragraph">
<p>Stand-alone attributes for an INI file must appear at the beginning of the INI file (before any of the sections). The conf.ini may contain the following stand-alone attributes.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">cache_queries</dt>
<dd>
<p>Enables query caching. Enabling this feature can yield drastic performance improvements especially on busy sites with large databases.</p>
<div class="paragraph">
<p><strong>Accepted Values</strong>: boolean (0 or 1)</p>
</div>
<div class="paragraph">
<p><strong>Since</strong> 1.2</p>
</div>
</dd>
<dt class="hdlist1">cache_queries_log</dt>
<dd>
<p>Enables logging of query caching to the file /tmp/querylog.log so that you can tell whether your queries are being cached, and which ones are being cached.</p>
<div class="paragraph">
<p><strong>Accepted Values</strong> boolean (0 or 1)</p>
</div>
<div class="paragraph">
<p><strong>Since </strong> 1.2</p>
</div>
</dd>
<dt class="hdlist1">default_action</dt>
<dd>
<p>The default action to be performed if it is not explicitly specified in the query (e.g. 'list', 'find', 'edit').</p>
<div class="paragraph">
<p><strong>Accepted Values</strong> string.  Name of action.</p>
</div>
<div class="paragraph">
<p><strong>Default Value</strong> 'list'.</p>
</div>
<div class="paragraph">
<p><strong>Since</strong> 0.6</p>
</div>
</dd>
<dt class="hdlist1">debug</dt>
<dd>
<p>If this is set to 1, then the application will run in debug mode which displays the available slots and blocks on the screen, along with some other debug information.</p>
<div class="paragraph">
<p><strong>Accepted Values</strong> 0 or 1</p>
</div>
<div class="paragraph">
<p><strong>Default Value</strong> 0</p>
</div>
<div class="paragraph">
<p><strong>Since</strong> 0.6</p>
</div>
</dd>
<dt class="hdlist1">default_browse_action</dt>
<dd>
<p>The default action to perform in the details tab. E.g. When you click on the "details" tab there are a number of sub-tabs including 'view', 'edit', etc&#8230;&#8203; . The default value for this directive is 'view'. If you want to go directly to the edit form when clicking on a record in list view, you would set default_browse_action to 'edit'.	string</p>
<div class="paragraph">
<p><strong>Since</strong> 0.6</p>
</div>
</dd>
<dt class="hdlist1">default_language</dt>
<dd>
<p>The default language to use. This is the 2-digit ISO language code. If this value is not specified it defaults to the first language listed in the [languages] section.	string (2-digit ISO language code)</p>
<div class="paragraph">
<p><strong>Since</strong> 0.6</p>
</div>
</dd>
<dt class="hdlist1">default_limit</dt>
<dd>
<p>The default limit (i.e. the number of records to show per page) if none is explicitly specified in the query.</p>
<div class="paragraph">
<p><strong>Accepted Values</strong> positive integer.  E.g. 100</p>
</div>
<div class="paragraph">
<p><strong>Default Value</strong> 30</p>
</div>
<div class="paragraph">
<p><strong>Since</strong> 0.6</p>
</div>
</dd>
<dt class="hdlist1">default_table</dt>
<dd>
<p>The default table to show if none is specified by the query.</p>
<div class="paragraph">
<p><strong>Default Value:</strong> The first table listed in the <code>[_tables]</code> section.</p>
</div>
<div class="paragraph">
<p><strong>Since</strong>	0.6</p>
</div>
</dd>
<dt class="hdlist1">disable_session_ip_check</dt>
<dd>
<p>Default behaviour automatically tracks the IP address of the user when they log in. If a request is made for a session from a different IP then the session is automatically destroyed and the user is logged out.</p>
<div class="paragraph">
<p><strong>Accepted Values</strong> boolean	(0 or 1)</p>
</div>
<div class="paragraph">
<p><strong>Since</strong> 1.3rc4</p>
</div>
</dd>
</dl>
</div>
<div id="confini-site_logo" class="dlist">
<dl>
<dt class="hdlist1">site_logo</dt>
<dd>
<p>Overrides the image file that is used for the site logo. See <a href="#changing-logo">Changing the Site Logo Image</a>.</p>
<div class="paragraph">
<p>See also <a href="#conf-ini-alt_logos">[conf-ini-alt_logos]</a></p>
</div>
<div class="paragraph">
<p>Since 3.0</p>
</div>
</dd>
<dt class="hdlist1">title</dt>
<dd>
<p>A title for the application (appears in the browser title bar).</p>
<div class="paragraph">
<p><strong>Since</strong> 0.6</p>
</div>
</dd>
</dl>
</div>
<div id="confini-include-directive" class="dlist">
<dl>
<dt class="hdlist1">__include__</dt>
<dd>
<p>A comma-delimited list of configuration files that you wish to include.</p>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>This list can be used to separate your configuration into multiple files, or to provide different configurations for different host environments.  It is common, for example, to factor your database connection information into a separate file named "conf.db.ini.php" which is not kept in version control to make the application more portable.</p>
</div>
<div class="paragraph">
<p><strong>Example:</strong> Placing database configuration in separate file</p>
</div>
<div class="listingblock">
<div class="title">conf.ini.php file</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">;&lt;?php exit;

__include__=conf.db.ini.php

[_tables]
   table1=My First Table
   table2=My Second Table</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">conf.db.ini.php file</div>
<div class="content">
<pre>;&lt;?php exit;

[_database]
   host=localhost
   name=mydb
   user=mydbuser
   password=dbpass</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
For security it is recommended to add the ".php" extension to all of your INI files to prevent the web server from publishing them.  The first line, then is always <code>;&lt;?php exit;</code> as this will be ignored when parsing the file as an INI file, and it will cause execution to exit when parsing as a PHP file.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Placeholder Variables</strong></p>
</div>
<div class="paragraph">
<p>Since version 3.0, you can use placeholder variables in your __include__ directive which allow you to specify a different path based on the environment.  The following placeholders are supported:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>{host}</code></dt>
<dd>
<p>Will be replaced by the HTTP host name of the request.  E.g. if the app is being accessed at <code><a href="http://example.com" class="bare">http://example.com</a></code>, then <code>{host}</code> placeholders will be replaced with "example.com".</p>
</dd>
<dt class="hdlist1"><code>{port}</code></dt>
<dd>
<p>Will be replaced by the HTTP port for the request.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="title">Example conf.ini.php using placeholders</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">;&lt;?php exit;

__include__=conf.db.ini.php, hosts/{host}/{host}.conf.ini.php</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, if the app is accessed at example.com, then it would include the conf file located at <code>hosts/example.com/example.com.conf.ini.php</code>, but if it is accessed at <code>localhost</code>, then it would load the config file at <code>hosts/localhost/localhost.conf.ini.php</code>.</p>
</div>
<div class="paragraph">
<p><strong>Optional Includes</strong></p>
</div>
<div class="paragraph">
<p><strong>TLDR:</strong>  Add <code>?</code> to the end of a file path to make it an optional include. E.g. <code>__include__=hosts/{host}/{host}.conf.ini.php?</code></p>
</div>
<div class="paragraph">
<p>By default, if an include fails (because the included file doesn&#8217;t exist), then an exception will be thrown when the app is loaded.  In some cases you may want the include to be "optional" so that it just fails to load silently if the file can&#8217;t be found.  You can add <code>?</code> to the end of a file path to make it optional.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">use_manifest</dt>
<dd>
<p>Boolean value (0 or 1) indicating whether the app should use a manifest to keep track of all of its files.  This may improve performance in some cases as it may prevent file system calls to check if a file exists.   When using this option, if you add or remove any files from the app, you&#8217;ll need to increment the application version in the version.txt file to force the app to regenerate the manifest.</p>
<div class="paragraph">
<p><strong>Since 3.0</strong></p>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="fieldsini-directives">Fields.ini Directives</h2>
<div class="sectionbody">
<h3 id="_overview_2" class="discrete">Overview</h3>
<div class="paragraph">
<p>The fields.ini file is a configuration file which is associated with a single table of a database application. It provides metadata about the table&#8217;s fields to help Xataface dictate how they should be included in the application. This includes metadata such as</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Widget type</strong> - To specify the type of widget that should be used to edit content in the field (e.g. text, select, checkbox).</p>
</li>
<li>
<p><strong>Label</strong> - The labels that can be used in column headers and on forms.</p>
</li>
<li>
<p><strong>Help text</strong> - for forms to inform the user how data should be entered.</p>
</li>
<li>
<p><strong>Field Groupings</strong></p>
</li>
<li>
<p><strong>widget:atts</strong> - To use javascripts in event handlers</p>
</li>
<li>
<p>and more</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Although a table doesn&#8217;t need to have an associated fields.ini file in order for the application to work, each table can have one; and it is always located in the "tables" directory. For example, the fields.ini file for the "people" table would be located at <code>tables/people/fields.ini</code> file.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>All ini files can also contain the ".php" file extension.  E.g. "fields.ini.php".  Using a .php extension can be helpful for security as it allows you to easily prevent the contents of the INI file from being served by the web server by adding the following to the first line of the file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">;&lt;?php exit;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you do not use the ".php" extension, ensure that your .htaccess file blocks access to .ini files.  A sample .htaccess file is bundled with Xataface <a href="https://github.com/shannah/xataface/blob/master/site_skeleton/.htaccess">here</a>.  The contents are:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">&lt;FilesMatch "\.ini$"&gt;
    # Apache 2.2
    &lt;IfModule !mod_authz_core.c&gt;
        Deny from all
    &lt;/IfModule&gt;

    # Apache 2.4
    &lt;IfModule mod_authz_core.c&gt;
        Require all denied
    &lt;/IfModule&gt;
&lt;/FilesMatch&gt;</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<h3 id="_syntax" class="discrete">Syntax</h3>
<div class="paragraph">
<p>The fields.ini file uses standard INI syntax (just like the php.ini file), where each section corresponds to a column in the table.</p>
</div>
<div class="paragraph">
<p>For example, consider a table "people" with columns "first_name", "last_name", and "age". The fields.ini file for the people table could then contain sections for each of its columns as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[first_name]

[last_name]

[age]</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example the sections are empty (i.e. they have no directives, but we could easily add some directives:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[first_name]
    widget:description="Please enter your first name"
    widget:label="Given Name"

...etc...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we have told Xataface that the first name field should include some help text (using the <code>widget:description</code> directive) on its edit form.</p>
</div>
<h3 id="_example_fields_ini_file" class="discrete">Example fields.ini file</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">;; Global directives applied to every field
[__global__]
    visibility:list=hidden

[isbn]
widget:label = ISBN
visibility:list=visible

[copyright_year]
widget:label = "Year"
widget:atts:size=4
visibility:list=visible

[categories]
widget:type=checkbox
vocabulary = book_categories

[media]
widget:type=checkbox
vocabulary = book_media

[borrower_id]
widget:type=select
vocabulary=users

[due_date]
widget:description = "The date that the book is due to be returned to the library"
visibility:list=visible

[cover_art_url_small]
visibility:browse=hidden

[cover_art_url_medium]
;visibility:browse=hidden

[cover_art_url_large]
visibility:browse=hidden
visibility:find=hidden

[amazon_description]
widget:label = Description

[amazon_reviews]

[amazon_url]

[amazon_refresh_timestamp]
widget:type=static

[date_created]
timestamp=insert
widget:type = static

[date_modified]
timestamp=update
widget:type=static

[created_by]
widget:type=static

[modified_by]
widget:type=static

[notes]</code></pre>
</div>
</div>
<h3 id="_field_directives" class="discrete">Field Directives</h3>
<div class="paragraph">
<p>The following directives may be added to a field&#8217;s section of the fields.ini file to customize the field&#8217;s behavior. Some directives are not applicable to all fields.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">actions</dt>
<dd>
<p>Optional actions category for actions which should be rendered next to the field on the edit form.  See <a href="#field-actions">Adding Actions to Fields</a> for a usage example.</p>
<div class="paragraph">
<p><strong>Since 2.0</strong></p>
</div>
</dd>
<dt class="hdlist1">ajax_value</dt>
<dd>
<p>Make the field dynamically update whenever one or more other fields on the same form is changed. When a change is detected, the field will load new data from a JSON web service specified by the URL in the property.  See <a href="#recipe-auto-updating-field">Auto-Updating a Field When Other Fields are Changed</a> for a usage example.</p>
<div class="paragraph">
<p><strong>Since 3.0</strong></p>
</div>
</dd>
<dt class="hdlist1">ajax_preview</dt>
<dd>
<p>A URL to content that should be displayed just below the field.  By default the content is updated whenever the field content is changed, but the <code>ajax_preview_event</code> directive can be used to specify a different event.  See <a href="#display-field-preview-using-ajax">Displaying Field Preview using AJAX</a> for example usage.</p>
<div class="paragraph">
<p><strong>Since 3.0</strong></p>
</div>
</dd>
<dt class="hdlist1">ajax_preview_event</dt>
<dd>
<p>The event that triggers the <code>ajax_preview</code> content to be updated.  Default is "change", but any valid Javascript event name may be used.  The event is triggered by the field itself.  E.g. set this to "input" to update the content as the user types into the field.</p>
<div class="paragraph">
<p><strong>Since 3.0</strong></p>
</div>
</dd>
<dt class="hdlist1">column:label</dt>
<dd>
<p>Specifies a custom label to use in list view for the column. If this is not specified, then the value of <code>widget:label</code> will be used.</p>
<div class="paragraph">
<p><strong>Since 1.3</strong></p>
</div>
</dd>
<dt class="hdlist1">column:legend</dt>
<dd>
<p>Adds a small amount of help text to the column header for this field in list view. Default is blank. E.g.</p>
<div class="imageblock">
<div class="content">
<img src="images/Image-080820-063616.423.png" alt="Image 080820 063616.423">
</div>
</div>
<div class="paragraph">
<p>In this photo it shows the text "*Paper Uploaded" set as the <code>column:legend</code> for "field 1".</p>
</div>
<div class="paragraph">
<p><strong>Since 1.3</strong></p>
</div>
</dd>
<dt class="hdlist1">date_format</dt>
<dd>
<p>Specifies how the field should be formatted when displayed. Takes same parameters as PHP strftime function.</p>
<div class="paragraph">
<p><strong>Since 2.0</strong></p>
</div>
</dd>
<dt class="hdlist1">display</dt>
<dd>
<p>Specifies the layout of the field on the edit form. Most fields have an implicit value of "inline" meaning the widget and its label appear on the same line. Textareas and htmlareas have an implicit value of "block" meaning that the label and widget appear in separate rows (label above the widget). You can set this value explicitly also to override the layout of a field.</p>
<div class="paragraph">
<p><strong>Since 0.8</strong></p>
</div>
</dd>
<dt class="hdlist1">display_format</dt>
<dd>
<p>A pattern that can be used to define the display format of the field. This takes the same parameters as the PHP sprintf function.</p>
<div class="paragraph">
<p><strong>Since 2.0</strong></p>
</div>
</dd>
<dt class="hdlist1">encryption</dt>
<dd>
<p>Primarily used with password fields, indicates the type of encryption that should be used to save the field. Supports "md5", "sha1", "encrypt", and "password".
<strong>Since 0.6</strong></p>
</dd>
<dt class="hdlist1">event.date</dt>
<dd>
<p>For use by the Calendar Action. Indicates that the field stores the date of the record when interpreted as an event. Possible values "0" or "1".</p>
<div class="paragraph">
<p><strong>Since 1.0</strong></p>
</div>
</dd>
<dt class="hdlist1">event.start</dt>
<dd>
<p>For use by the Calendar Action. Indicates that the field stores the start time of the record when interpreted as an event. Possible values "0" or "1".</p>
<div class="paragraph">
<p><strong>Since 1.0</strong></p>
</div>
</dd>
<dt class="hdlist1">event.end</dt>
<dd>
<p>For use by the Calendar Action. Indicates that the field stores the end time of the record when interpreted as an event. Possible values "0" or "1".</p>
<div class="paragraph">
<p><strong>Since 1.0</strong></p>
</div>
</dd>
<dt class="hdlist1">event.location</dt>
<dd>
<p>For use by the Calendar Action. Indicates that the field stores the location of a record when interpreted as an event. Possible values "0" or "1".</p>
<div class="paragraph">
<p><strong>Since 1.0</strong></p>
</div>
</dd>
<dt class="hdlist1">filter</dt>
<dd>
<p>Boolean value (0 or 1) indicating whether this field should be filterable? in list view?.</p>
<div class="paragraph">
<p><strong>Since 0.8</strong></p>
</div>
</dd>
<dt class="hdlist1">filter.multiple</dt>
<dd>
<p>Boolean value (0 or 1) that sets a filter select list to allow multiple options to be selected.  Currently this only works with the older Xataface 2-style filters (i.e. when the <code>use_xataface2_result_filters</code> preference is active).</p>
<div class="paragraph">
<p>Since 3.1</p>
</div>
</dd>
<dt class="hdlist1">filter.type</dt>
<dd>
<p>The type of filter to use.  Options include "text", "range", "min", "max", and "filter".  See <a href="#filter_types">Filter Types</a>.</p>
<div class="paragraph">
<p><strong>Since 3.0</strong></p>
</div>
</dd>
<dt class="hdlist1">filter.label</dt>
<dd>
<p>The label to use for the filter.  This defaults to the <code>widget:label</code> for the field.</p>
<div class="paragraph">
<p><strong>Since 3.0</strong></p>
</div>
</dd>
<dt class="hdlist1">filter.icon</dt>
<dd>
<p>Icon to use in the text field when using the "text" filter type.  This should be the name of a material icon.  See <a href="#material-icons">Using Material Icons</a> for details about material icons in Xataface.</p>
<div class="paragraph">
<p><strong>Since 3.0</strong></p>
</div>
</dd>
<dt class="hdlist1">filter.min.icon</dt>
<dd>
<p>Optional icon to use inside the "min" field for min and range filters.  The icon should be a valid material icon name.  See <a href="#material-icons">Using Material Icons</a> for details about material icons in Xataface.</p>
<div class="imageblock">
<div class="content">
<img src="images/Image-210820-090958.753.png" alt="Image 210820 090958.753">
</div>
<div class="title">Figure 55. <strong>Example</strong> <code>filter.max.icon=euro_symbol</code></div>
</div>
<div class="paragraph">
<p><strong>Since 3.0</strong></p>
</div>
</dd>
<dt class="hdlist1">filter.max.icon</dt>
<dd>
<p>Same as <code>filter.min.icon</code> except for the "min" field.</p>
<div class="paragraph">
<p><strong>Since 3.0</strong></p>
</div>
</dd>
<dt class="hdlist1">filter.input.type</dt>
<dd>
<p>Specify the <code>type</code> attribute of the <code>&lt;input&gt;</code> tag used in the "text", "range", "min", and "max" filter types.  This will be "text" by default in most fields.  It will be <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/date">date</a> by default for date fields, and <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/datetime-local">datetime-local</a> for datetime fields.</p>
<div class="paragraph">
<p><strong>Since 3.0</strong></p>
</div>
</dd>
<dt class="hdlist1">filter.sort</dt>
<dd>
<p>Used for the "filter" filter type.  This specifies the column to use for sorting the options in the fitler.</p>
<div class="paragraph">
<p><strong>Since 3.0</strong></p>
</div>
</dd>
<dt class="hdlist1">filter.placeholder</dt>
<dd>
<p>Placeholder text used for the "text" filter type.  Placeholder text is only displayed when the field is empty.</p>
<div class="paragraph">
<p><strong>Since 3.0</strong></p>
</div>
</dd>
<dt class="hdlist1">filter.min.placeholder</dt>
<dd>
<p>Placeholder text used the "min" field.  Placeholder text is only displayed when the field is empty.</p>
<div class="paragraph">
<p><strong>Since 3.0</strong></p>
</div>
</dd>
<dt class="hdlist1">filter.max.placeholder</dt>
<dd>
<p>Placeholder text used the "max" field.  Placeholder text is only displayed when the field is empty.</p>
<div class="paragraph">
<p><strong>Since 3.0</strong></p>
</div>
</dd>
<dt class="hdlist1">filter.input.*</dt>
<dd>
<p>Specify HTML attributes on the <code>&lt;input&gt;</code> element used in the "text" filter type.  E.g.<code>filter.input.maxlength=5</code></p>
<div class="paragraph">
<p><strong>Since 3.0</strong></p>
</div>
</dd>
<dt class="hdlist1">filter.min.input.*</dt>
<dd>
<p>Specify HTML attributes on the <code>&lt;input&gt;</code> element used in the "min" field. E.g. <code>filter.min.input.maxlength=5</code></p>
<div class="paragraph">
<p><strong>Since 3.0</strong></p>
</div>
</dd>
<dt class="hdlist1">filter.max.input.*</dt>
<dd>
<p>Specify HTML attributes on the <code>&lt;input&gt;</code> element used in the "max" field. E.g. <code>filter.max.input.maxlength=5</code></p>
<div class="paragraph">
<p><strong>Since 3.0</strong></p>
</div>
</dd>
<dt class="hdlist1">filter.vocabulary</dt>
<dd>
<p>A valuelist that can be used to provide "common" search options.  These are displayed before the text or range fields to allow the user to easily select common searches.</p>
<div class="paragraph">
<p><strong>Since 3.0</strong></p>
</div>
</dd>
<dt class="hdlist1">frozen_description</dt>
<dd>
<p>The field description shown when the widget is frozen (i.e. uneditable). If this is not specified, no field description is shown in this case.</p>
<div class="paragraph">
<p><strong>Since 1.2</strong></p>
</div>
</dd>
<dt class="hdlist1">group</dt>
<dd>
<p>The name of the field group that this field belongs to. Fields with the same "group" value will be rendered in the same field group on the form.</p>
<div class="paragraph">
<p><strong>Since 0.5</strong></p>
</div>
</dd>
<dt class="hdlist1">Key</dt>
<dd>
<p>If you are using a View for the table you need to explicitly mark the fields that comprise the primary key. E.g. Key=PRI</p>
<div class="paragraph">
<p><strong>Since 0.6</strong></p>
</div>
</dd>
<dt class="hdlist1">label_link</dt>
<dd>
<p>An optional URL for the field label to link to. This would usually be some "help" page that explains what the field is for. The link will be a link in both the view and edit tabs.</p>
<div class="paragraph">
<p><strong>Since 1.1.3</strong></p>
</div>
</dd>
<dt class="hdlist1">ignore</dt>
<dd>
<p>Boolean value (0 or 1) indicating whether this field should be ignored on the edit form. This is handy if the field is going to be constantly updated in the background (via a cron job perhaps) and you don&#8217;t want the edit form to interfere.</p>
<div class="paragraph">
<p><strong>Since 1.0</strong></p>
</div>
</dd>
<dt class="hdlist1">logo</dt>
<dd>
<p>Boolean value (0 or 1) to indicate if this field should be treated as a logo field. Logo fields are displayed in the upper left of the view tab for a record, and are assumed to contain an image. If no logo field is explicitly specified, Xataface will make a best guess as to which field should be used.</p>
<div class="paragraph">
<p><strong>Since 0.7</strong></p>
</div>
</dd>
<dt class="hdlist1">money_format</dt>
<dd>
<p>For fields containing monetary amounts, this specifies the format. Takes same parameters as PHP money_format function.</p>
<div class="paragraph">
<p><strong>Since 2.0</strong></p>
</div>
</dd>
<dt class="hdlist1">noLinkFromListView</dt>
<dd>
<p>Boolean value (0 or 1) to indicate if this field should be linked when in list view (or in a related list). Default value is 0 to indicate that the field IS linked. It is common to use this directive when using a custom xxx__renderCell() method that contains its own links.</p>
<div class="paragraph">
<p><strong>Since 1.1</strong></p>
</div>
</dd>
<dt class="hdlist1">not_findable</dt>
<dd>
<p>A flag to indicate that this field can not be used as part of a query. This is helpful if you want a field to remain completely confidential to prevent people from finding records based on the value of this field. This flag is even necessary if the permissions for the field don&#8217;t permit viewing the value of the field.</p>
<div class="paragraph">
<p><strong>Since 1.1</strong></p>
</div>
</dd>
<dt class="hdlist1">number_format</dt>
<dd>
<p>For numeric fields, this indicates the number of decimal places to display when displaying this field. E.g. 2</p>
<div class="paragraph">
<p><strong>Since 2.0</strong></p>
</div>
</dd>
<dt class="hdlist1">order</dt>
<dd>
<p>The order of the field when laid out on forms and lists. Can contain any floating point number or integer (e.g. 0, 10, -10, 235.4)</p>
<div class="paragraph">
<p><strong>Since 0.6</strong></p>
</div>
</dd>
<dt class="hdlist1">prefs.key</dt>
<dd>
<p>The name of a preference to set with the value of this field in the currently logged-in user record.  See <a href="#preferences-directives">[preferences-directives]</a> for more information about preferences.  See <a href="#user-selected-color-scheme">Allowing Users to Choose Their Own Color Scheme</a> for an example using <code>prefs.key=user_stylesheet</code>.</p>
<div class="paragraph">
<p><strong>Since 3.0</strong></p>
</div>
</dd>
<dt class="hdlist1">relationship</dt>
<dd>
<p>Used only with complex fields that involve editing related records (e.g. grid). This is the name of the relationship that the field should be edited.</p>
<div class="paragraph">
<p><strong>Since 0.8</strong></p>
</div>
</dd>
<dt class="hdlist1">repeat</dt>
<dd>
<p>Boolean value (0 or 1) used in conjunction with a select widget to indicate whether to enable a multi-select.</p>
</dd>
<dt class="hdlist1">section</dt>
<dd>
<p>The name of the section that this field should belong to in the view tab.</p>
<div class="paragraph">
<p><strong>Since 0.7</strong></p>
</div>
</dd>
<dt class="hdlist1">secure</dt>
<dd>
<p>A boolean flag for use with container fields? to indicate that it should use secure URLs for the file downloads (i.e. it will obey the application permissions). Without this directives, uploaded files are served directly by apache and don&#8217;t obey the Xataface permissions defined per record.</p>
<div class="paragraph">
<p><strong>Since 1.3</strong></p>
</div>
</dd>
<dt class="hdlist1">sortable</dt>
<dd>
<p>A boolean flag that indicates whether a column is sortable.  This does not affect permissions (i.e. the user can still sort on the column by including it in the <code>-sort</code> request parameter.   This only affects whether the column is sortable in the UI.  Currently this is only used for the mobile UI.  On the desktop UI, all columns visible in list view are sortable.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If no columns in the table define the <code>sortable</code> property, then all columns are treated as <code>sortable=1</code>.  If at least one column in the table has <code>sortable</code> defined, then the remaining columns are assumed to be <code>sortable=0</code>.  One way of thinking about this that you need to opt in to this behaviour to use it.  Otherwise Xataface will just guess at which columns the usezr should be able to sort on.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Since 3.0</strong></p>
</div>
</dd>
<dt class="hdlist1">sortable+</dt>
<dd>
<p>A boolean flag that enables or disables sorting on this column in ascending order.</p>
<div class="paragraph">
<p><strong>Since 3.0</strong></p>
</div>
</dd>
<dt class="hdlist1">sortable-</dt>
<dd>
<p>A boolean flag that enables or disables sorting on this column in descending order.</p>
</dd>
<dt class="hdlist1">sort.label</dt>
<dd>
<p>The label that should be used for sorting on this field.</p>
<div class="paragraph">
<p><strong>Since 3.0</strong></p>
</div>
</dd>
<dt class="hdlist1">sort+.label</dt>
<dd>
<p>The label that should be used for sorting on this field in ascending order.</p>
<div class="paragraph">
<p><strong>Since 3.0</strong></p>
</div>
</dd>
<dt class="hdlist1">sort-.label</dt>
<dd>
<p>The label that should be used for sorting on this field in descending order.</p>
<div class="paragraph">
<p><strong>Since 3.0</strong></p>
</div>
</dd>
<dt class="hdlist1">struct</dt>
<dd>
<p>A boolean (0 or 1) value indicating whether this field is considered a structure. A value of 1 indicates that this field is a structure and should not be truncated under any circumstances. Normally fields are truncated at 255 chars in list view. This is useful if the field contains XML or other structured data so that attempts to truncate it would destroy integrity.</p>
<div class="paragraph">
<p><strong>Since 1.1.2</strong></p>
</div>
</dd>
<dt class="hdlist1">tab</dt>
<dd>
<p>If tabbed forms are enabled, then this specifies the name of the tab that this field belongs to on the edit form.</p>
<div class="paragraph">
<p><strong>Since 0.8</strong></p>
</div>
</dd>
<dt class="hdlist1">timestamp</dt>
<dd>
<p>Indicates when a timestamp should be set in the field (only applicable for date and time fields). Possible values are "insert" and "update"</p>
<div class="paragraph">
<p><strong>Since 0.7</strong></p>
</div>
</dd>
<dt class="hdlist1">title</dt>
<dd>
<p>Boolean value (0 or 1) indicating whether this field should be treated as a title field.</p>
<div class="paragraph">
<p><strong>Since 0.7</strong></p>
</div>
</dd>
<dt class="hdlist1">transform</dt>
<dd>
<p>String defining rules for generating thumbnails for uploaded images.  This directive is only used with Container fields.</p>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><strong>Syntax</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>transform=name1 [op1:]w1xh1; ...;nameN [opN:]wNxhN</pre>
</div>
</div>
<div class="paragraph">
<p>Where:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>name1</code> &#8230;&#8203; <code>nameN</code> are names of the thumbnail sizes you wish to resize images to.</p>
</li>
<li>
<p><code>w1</code> &#8230;&#8203; <code>wN</code> are corresponding widths in pixels,</p>
</li>
<li>
<p><code>h1</code> &#8230;&#8203; <code>hN</code> are corresponding heights in pixels, and</p>
</li>
<li>
<p><code>op1</code> &#8230;&#8203; <code>opN</code> are the corresponding operations to perform for resizing.  Currently the only operations supported are "fit" and "fill".  "fit" will cause the image to be resized to "fit" completely inside the dimensions of the thumbnail size, and "fill" will cause the image to fill the thumbnail space completely, possibly cropping some off edges to make it fit.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="paragraph">
<p><code>transform="itunes300 fill:300x300; itunes1400 fill:1400x1400"</code></p>
</div>
<div class="paragraph">
<p>Defines two thumbnail types "itunes300" and "itunes1400" with sizes 300x300 pixels and 1400x1400 pixels respectively. This means that images uploaded to this container field will automatically have thumbnails generated in those two sizes.  Both of these thumbnail types use the "fill" operation so images will be resized to fill the space, and may have some cropped off the edges.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>This directive is commonly used with <code>thumbnail.ACTIONNAME</code> directives which specify which thumbnail should be used in which action.</p>
</div>
<div class="paragraph">
<p>See <a href="#generating-thumbnails">Generating Thumbnails</a> for a recipe on how to use this directive.</p>
</div>
<div class="paragraph">
<p><strong>Since 3.0</strong></p>
</div>
</dd>
<dt class="hdlist1">transient</dt>
<dd>
<p>Boolean value (0 or 1) indicating whether this field is a transient field or not. A transient field is a field that is defined in the fields.ini file but not in the database. Hence the values that are input into this field on the edit form are not saved to the database.</p>
<div class="paragraph">
<p><strong>Since 0.8</strong></p>
</div>
</dd>
<dt class="hdlist1">Type</dt>
<dd>
<p>The data type of the field (note the capital "T" as Xataface is case sensitive). This value is only overridden for container? fields, however its value can be accessed programmatically for any field.</p>
<div class="paragraph">
<p><strong>Since 0.5</strong></p>
</div>
</dd>
<dt class="hdlist1">userid</dt>
<dd>
<p>Marks the field as containing a User ID, which corresponds to the userId of the users table. This is used by caching solutions, such as <a href="#scaler">Scaler Module</a>, to be able to invalidate the cache if only a particular user&#8217;s records are modified in a table.  See <a href="https://github.com/shannah/xataface-module-scaler/blob/master/README.adoc#table-subset-dependencies">Table Subset Dependencies</a> in the Scaler module readme file for more information.</p>
<div class="paragraph">
<p><strong>Since 3.0</strong></p>
</div>
</dd>
<dt class="hdlist1">username</dt>
<dd>
<p>Marks the field as containing a username, which corresponds to the username of the users table. This is used by caching solutions, such as <a href="#scaler">Scaler Module</a>, to be able to invalidate the cache if only a particular user&#8217;s records are modified in a table.  See <a href="https://github.com/shannah/xataface-module-scaler/blob/master/README.adoc#table-subset-dependencies">Table Subset Dependencies</a> in the Scaler module readme file for more information.</p>
<div class="paragraph">
<p><strong>Since 3.0</strong></p>
</div>
</dd>
<dt class="hdlist1">uuid</dt>
<dd>
<p>Marks a field as storing a UUID (universal unique identifier).  This works similar to the <code>timestamp</code> and <code>ownerstamp</code> directives, in that it will automatically generate a UUID at the time the record is inserted if one is not supplied.  It will also apply appropriate defaults to hide this field on the edit form.</p>
<div class="paragraph">
<p><strong>Since 3.0.1</strong></p>
</div>
</dd>
<dt class="hdlist1">validators:VALIDATOR_NAME</dt>
<dd>
<p>A prefix for a validation type on the current field. (Replace "VALIDATOR_NAME" with the name of the validator to be used. e.g. required). There are many validators available to be used.</p>
<div class="paragraph">
<p><strong>Since 0.5</strong></p>
</div>
</dd>
<dt class="hdlist1">validators:VALIDATOR_NAME:message</dt>
<dd>
<p>The message the should be displayed if the form fails to validator due to the "VALIDATION_NAME" validation rule.</p>
<div class="paragraph">
<p><strong>Since 0.5</strong></p>
</div>
</dd>
<dt class="hdlist1">viewgroup</dt>
<dd>
<p>The name of the field grouping that this field will belong to in the view tab. If this is not present, then it will be grouped according to the group directive.</p>
<div class="paragraph">
<p><strong>Since 1.0</strong></p>
</div>
</dd>
<dt class="hdlist1">visibility:browse</dt>
<dd>
<p>Indicates whether the field should be visible in browse mode (i.e. in the "view" tab). Possible values are "visible" and "hidden".</p>
<div class="paragraph">
<p><strong>Since 0.6</strong></p>
</div>
</dd>
<dt class="hdlist1">visibility:csv</dt>
<dd>
<p>Indicates whether the field should be included in CSV exports. Possible values are "visible" and "hidden".</p>
<div class="paragraph">
<p><strong>Since (1.0 beta 4)	1.0b4</strong></p>
</div>
</dd>
<dt class="hdlist1">visibility:find</dt>
<dd>
<p>Indicates whether the field should be visible in find mode. Possible values are "visible" and "hidden"	+
<strong>Since 1.0</strong></p>
</dd>
<dt class="hdlist1">visibility:list</dt>
<dd>
<p>Indicates whether the field should be visible in list view. Possible values are "visible" and "hidden".	+
<strong>Since 0.6</strong></p>
</dd>
<dt class="hdlist1">visibility:update</dt>
<dd>
<p>Indicates whether the field should be included in update and copy/replace forms. Possible values are "visible" and "hidden".</p>
<div class="paragraph">
<p><strong>Since 1.3</strong></p>
</div>
</dd>
<dt class="hdlist1">vocabulary</dt>
<dd>
<p>The valuelist that should be used as the options to select. This is only applicable for fields that have options to select like a select list or a checkbox group.</p>
<div class="paragraph">
<p><strong>Since 0.5</strong></p>
</div>
</dd>
<dt class="hdlist1">widget:atts</dt>
<dd>
<p>A namespace for attributes that should be added to the HTML widget. This allows you to specify things like javascript events, styles, widget size, etc..</p>
<div class="paragraph">
<p><strong>Since 0.5</strong></p>
</div>
</dd>
<dt class="hdlist1">widget:columns</dt>
<dd>
<p>For checkbox groups, this specifies the number of columns to use for laying out the checkboxes.</p>
<div class="paragraph">
<p><strong>Since 1.0</strong></p>
</div>
</dd>
<dt class="hdlist1">widget:description</dt>
<dd>
<p>Help text to give the user a hint about how to edit the field&#8217;s content.</p>
<div class="paragraph">
<p><strong>Since 0.1</strong></p>
</div>
</dd>
<dt class="hdlist1">widget:editor</dt>
<dd>
<p>The type of HTML editor that should be used. This is used only when widget:type is set to htmlarea</p>
<div class="paragraph">
<p>Acceptable values include:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>fckeditor (default)</p>
</li>
<li>
<p>tinymce (version 0.6 or higher)</p>
</li>
<li>
<p>nicedit (version 1.0 or higher)</p>
</li>
<li>
<p>all</p>
</li>
</ol>
</div>
</dd>
<dt class="hdlist1">widget:editvalues</dt>
<dd>
<p>Used with select lists to allow users to add values to the select list. E.g. widget:editvalues=1</p>
<div class="paragraph">
<p><strong>Since 0.8</strong></p>
</div>
</dd>
<dt class="hdlist1">widget:focus</dt>
<dd>
<p>Sets default focus. 0 or 1. (Javascript focus in a form)</p>
<div class="paragraph">
<p><strong>Since 0.6</strong></p>
</div>
</dd>
<dt class="hdlist1">widget:label</dt>
<dd>
<p>The label that should be used for the current field on edit forms, column headings, and other relevant locations.</p>
<div class="paragraph">
<p><strong>Since 0.1</strong></p>
</div>
</dd>
<dt class="hdlist1">widget:question</dt>
<dd>
<p>Text displayed just before the widget. This is almost the same as widget:description except that this text is guaranteed to be displayed before the widget, whereas widget:description may be displayed below or beside the widget.</p>
<div class="paragraph">
<p><strong>Since 0.1</strong></p>
</div>
</dd>
<dt class="hdlist1">widget:type</dt>
<dd>
<p>The type of widget that should be used (e.g. checkbox, select, text, etc..)</p>
<div class="paragraph">
<p><strong>Since 0.1</strong></p>
</div>
</dd>
<dt class="hdlist1">xml</dt>
<dd>
<p>A flag for use with calculated fields (i.e. fields defined in the delegate class via the field__fieldname method) that will include the field in XML output produced by the export xml action. Default is 0, but setting this value to 1 wil cause the field to be included.</p>
<div class="paragraph">
<p><strong>Since 1.2.7</strong></p>
</div>
</dd>
</dl>
</div>
<h3 id="_applying_directives_to_all_fields_global" class="discrete">Applying Directives to All fields (<code>__global__</code>)</h3>
<div class="paragraph">
<p>Xataface 1.2.6 includes support for a <code>__global__</code> section that allows you to specify directives that should be applied to all fields. These directives can be overridden on a field by field basis. The <code>__global__</code> section can take all the same directives that a normal field section takes.</p>
</div>
<h3 id="_widgetattsclass_values" class="discrete"><code>widget:atts:class</code> Values</h3>
<div class="paragraph">
<p>The <code>widget:atts:class</code> directive allows you to assign a CSS class to a field&#8217;s widget. There are certain CSS classes that have meaning to Xataface and will cause additional functionality to automatically be added to the field. These built-in classes are listed below:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">passwordTwice</dt>
<dd>
<p>Applicable only to password fields. If you set <code>widget:atts:class=passwordTwice</code>, then this will convert the password field into two fields whereby both fields need to match in order for submission to continue on the edit form. This operates as a password verification field.</p>
<div class="paragraph">
<p><strong>Since 1.3rc2</strong></p>
</div>
</dd>
</dl>
</div>
<h3 id="_global_directives" class="discrete">Global Directives</h3>
<div class="paragraph">
<p>The following directives can be added to the beginning of the fields.ini file (before any field sections) to customize field groups and the table as a whole.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">__dependencies__</dt>
<dd>
<p>A comma-delimited list of tables that this table is dependent upon for caching purposes. E.g. if any table in this list is modified, then the query cache is cleared for queries on this table. See this blog article for more information about query caching.</p>
<div class="paragraph">
<p><strong>Since 1.2</strong></p>
</div>
</dd>
<dt class="hdlist1">__isa__</dt>
<dd>
<p>The name of the parent table of the current table. This directive allows you to have a heirarchical structure amongst the tables in your application.</p>
<div class="paragraph">
<p><strong>Since 0.8</strong></p>
</div>
</dd>
<dt class="hdlist1">__source_tables__</dt>
<dd>
<p>A comma-delimited list of tables that this table/view is derived from. This is used with the query caching feature and is necessary to use this directive if the table is actually a view. If this directive is not set, then any queries involving this view will not use the query cache because Xataface would have no way to discern the update time of the view. See this blog article for more information about query caching.</p>
<div class="paragraph">
<p><strong>Since 1.2</strong></p>
</div>
</dd>
<dt class="hdlist1">__sql__</dt>
<dd>
<p>Defines a custom select query to override the default select query for the current table. (The default select query is generally "select * from tablename").</p>
<div class="paragraph">
<p><strong>Since 0.7</strong></p>
</div>
</dd>
<dt class="hdlist1">__prefs__</dt>
<dd>
<p>Sets preferences for this table and its records. This directive is an array, so it must be enclosed in square brackets, i.e. <code>[__prefs__]</code>, unlike the other global directives listed above.</p>
<div class="paragraph">
<p><strong>Since 1.0b4</strong></p>
</div>
</dd>
<dt class="hdlist1">scaler.trackUsedTables</dt>
<dd>
<p>Boolean (0 or 1) indicating whether requests on this table should track the tables used in the request.  Used with <a href="#scaler">Scaler Module</a>.  See <a href="https://github.com/shannah/xataface-module-scaler/blob/master/README.adoc#tracking-used-tables">Tracking Used Tables</a> in the Scaler module readme.</p>
<div class="paragraph">
<p><strong>Since 3.0</strong></p>
</div>
</dd>
<dt class="hdlist1">table.default_sort</dt>
<dd>
<p>Sets the default sort column for the table.  See <a href="#default-sort">Specifying Default Sorting</a>.</p>
<div class="paragraph">
<p><strong>Since 3.0</strong></p>
</div>
</dd>
<dt class="hdlist1">table.default_sort.RELATIONSHIPNAME</dt>
<dd>
<p>Sets the default sort column for the given relationship.  E.g. <code>table.default_sort.posts=date posted desc</code>.  See <a href="#default-related-sort">Setting Default Sort for Related Lists</a>.</p>
<div class="paragraph">
<p><strong>Since 3.0</strong></p>
</div>
</dd>
<dt class="hdlist1">table.label</dt>
<dd>
<p>Sets the friendly name for this table. This is the equivalent of using the [_tables] section in the conf.ini file, except without imposing the requirement that these tables appear in the application&#8217;s primary navigation menu. E.g. label = "Table Name"</p>
</dd>
<dt class="hdlist1">table.title</dt>
<dd>
<p>A string SQL select expression that is used to describe the title of records. This is the equivalent of the <code>titleColumn()</code> function used in Delegate_class_methods.</p>
</dd>
<dt class="hdlist1">table.list_template</dt>
<dd>
<p>An alternative template to use for rendering the list view of this table. This can either be the path to a template (relative to the template path roots), or some special values including <code>@grid</code>, which will be expanded to <code>xataface/actions/list/grid.html</code>  See <a href="#grid-view">Rendering List View as a Grid</a>.</p>
</dd>
<dt class="hdlist1">table.listStyle</dt>
<dd>
<p>Setting this to "mobile" will cause the list view to use the "mobile" list style in desktop mode also.  This will also affect one-to-many relationships to this table - i.e. related lists where this table is the domain table will be rendered with the mobile style, if this is set to "mobile". See <a href="#list-style-mobile">Using Mobile List Template on Desktop</a></p>
</dd>
<dt class="hdlist1">table.row_style</dt>
<dd>
<p>Setting this to "external-link" will cause the mobile list view (and related list view) to render rows as links to an external link, similar to how Twitter renders tweets that contains links.  See <a href="#row-style-external-link">Rendering Row as Link to External URL</a></p>
</dd>
<dt class="hdlist1">table.depends</dt>
<dd>
<p>A comma-delimited list of tables on which this table depends.  When using <a href="#scaler">Scaler Module</a>, this helps Xataface determine which tables were used in generating a response for a request, and thereby know when the cache for that page should be invalidated.  This directive is usually used for MySQL views or temporary tables Xataface won&#8217;t automatically increment their version numbers when their underlying tables are modified.</p>
<div class="paragraph">
<p>Since 3.0</p>
</div>
</dd>
</dl>
</div>
<h3 id="_field_groups" class="discrete">Field Groups</h3>
<div class="paragraph">
<p>The "group" directive allows you to group multiple fields together so that they will be rendered in the same field group on forms. You can also configure these groups as a whole by defining a section named "[fieldgroup:GROUPNAME]" (where GROUPNAME is the name of the field group, corresponding to the group directive values for the fields) in the fields.ini file. This section provides a few basic directives to customize some aspects of the field group:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>label</p>
</li>
<li>
<p>order</p>
</li>
<li>
<p>description</p>
</li>
<li>
<p>template</p>
</li>
<li>
<p>more&#8230;&#8203;</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The most common use of these sections is to customize the label or order of groups, especially when there are multiple field groups in the table. For example, suppose we have a table "people" with fields "first_name", "last_name", "phone", "fax", "email", "address", "city", and "country". Suppose these fields are grouped as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>"first_name" and "last_name"</p>
</li>
<li>
<p>"phone", "fax", and "email"</p>
</li>
<li>
<p>"address", "city", and "country"</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>so that the fields.ini file looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[first_name]
    group=name

[last_name]
    group=name

[phone]
    group=contact

[fax]
    group=contact
[email]
    group=contact

[address]
    group=address

[city]
    group=address

[country]
    group=address</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, the "name" group will appear first in the form, followed by "contact" and "address". If we want to place "address" first we could add the following section to our fields.ini file:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">order</dt>
<dd>
<p>Specifies the order of the group with respect to other groups on the form. Accepts any numerical value (e.g. 0, 1, -1, 25.43), with lower values appearing first. Default value is 0.</p>
<div class="paragraph">
<p><strong>Since 0.6</strong></p>
</div>
</dd>
<dt class="hdlist1">hidden</dt>
<dd>
<p>A value of "1" causes the field group to be hidden by default.  Hidden groups will have a button placed along the bottom of the form which can be used to reveal the field group.  If this directive is used, the <code>materialIcon</code> directive must also be used to provide the icon that is used in this button.</p>
<div class="imageblock">
<div class="content">
<img src="images/Image-080820-070623.789.png" alt="Image 080820 070623.789">
</div>
<div class="title">Figure 56. Form with 3 hidden field groups.  Users can click on the corresponding buttons at the bottom of the form to reveal a field group.</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-080820-070748.070.png" alt="Image 080820 070748.070">
</div>
<div class="title">Figure 57. After user clicks on a field group&#8217;s button, it will be shown on the form, and the button will become grayed out.</div>
</div>
<div class="paragraph">
<p><strong>Since 3.0</strong></p>
</div>
</dd>
</dl>
</div>
<div id="fieldsini-table-label" class="dlist">
<dl>
<dt class="hdlist1">label</dt>
<dd>
<p>Specifies the label that should be used for the field group.</p>
<div class="paragraph">
<p><strong>Since 0.6</strong></p>
</div>
</dd>
<dt class="hdlist1">label_link</dt>
<dd>
<p>Specifies a URL that the field group label should link to.</p>
<div class="paragraph">
<p><strong>Since 1.1.3</strong></p>
</div>
</dd>
<dt class="hdlist1">label_prefix</dt>
<dd>
<p>Specifies a prefix for the label.  This can be useful if the label of the action has been localized using the language files, but you want a prefix (which may include a PHP expression).</p>
<div class="paragraph">
<p><strong>Since 3.0</strong></p>
</div>
</dd>
<dt class="hdlist1">label_suffix</dt>
<dd>
<p>Specifies a suffix for the label.  This can be useful if the label of the action has been localized using the language files, but you want a suffix (which may include a PHP expression).</p>
<div class="paragraph">
<p><strong>Since 3.0</strong></p>
</div>
</dd>
<dt class="hdlist1">materialIcon</dt>
<dd>
<p>A material icon to use for the field group&#8217;s button when the group is hidden via the <code>hidden</code> directive.  See <a href="#material-icons">Using Material Icons</a> for more information about material icons.  See <code>hidden</code> directive docs for information about the hidden directive.</p>
<div class="paragraph">
<p><strong>Since 3.0</strong></p>
</div>
</dd>
<dt class="hdlist1">noheader</dt>
<dd>
<p>A value of "1" hides the usual collapsible header for the field group so that the fields are just rendered directly on the form.</p>
<div class="paragraph">
<p><strong>Since 3.0</strong></p>
</div>
</dd>
<dt class="hdlist1">template</dt>
<dd>
<p>The path to a custom template that should be used to render the fields of the field group.</p>
<div class="paragraph">
<p><strong>Since 1.0</strong></p>
</div>
</dd>
<dt class="hdlist1">collapsed</dt>
<dd>
<p>Boolean value (0 or 1) indicating whether the field group should be collapsed by default (user can expand it).</p>
<div class="paragraph">
<p><strong>Since 1.0</strong></p>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="relationshipsini-directives">Relationships.ini Directives</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_overview_3">Overview</h3>
<div class="paragraph">
<p>The <em>relationship.ini</em> file is a configuration file which is associated with a single table of a database application. It provides metadata about the table&#8217;s relationships to other tables to help Xataface dictate how they should be included in the application.</p>
</div>
</div>
<div class="sect2">
<h3 id="_field_directives_2">Field Directives</h3>
<div class="paragraph">
<p>The following directives may be added to a field&#8217;s section of the relationship.ini file to customize the field&#8217;s behavior. Some directives are not applicable to all fields.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>sql</em></dt>
<dd>
<p>The SQL query that defines this relationship.</p>
<div class="paragraph">
<p><em>Since: 0.1</em></p>
</div>
</dd>
<dt class="hdlist1">action:visible</dt>
<dd>
<p>A boolean value (0 or 1) that indicates whether this relationship should be visible in the record tabs.</p>
<div class="paragraph">
<p><em>Since 0.1</em></p>
</div>
</dd>
<dt class="hdlist1">action:condition</dt>
<dd>
<p>An expression that evaluates to a boolean that determines at runtime whether the relationship&#8217;s tab should appear in the record tabs.</p>
<div class="paragraph">
<p><em>Since 0.1</em></p>
</div>
</dd>
<dt class="hdlist1">action:permission</dt>
<dd>
<p>An array that determines at runtime whether the relationship&#8217;s tab should appear in the record tabs for the logged in user.</p>
<div class="paragraph">
<p>Also see: <a href="#relationship-permissions">Relationship Permissions</a></p>
</div>
<div class="paragraph">
<p><em>Since 0.1</em></p>
</div>
</dd>
<dt class="hdlist1">action:label</dt>
<dd>
<p>The label that appears in the relationship tab for this relationship. Default is to use the relationship name.</p>
<div class="paragraph">
<p><em>Since: 0.1</em></p>
</div>
</dd>
<dt class="hdlist1">action:order</dt>
<dd>
<p>An integer value that specifies the order of this relationship tab in relation to the other tabs.</p>
<div class="paragraph">
<p><em>Since: 0.1</em></p>
</div>
</dd>
<dt class="hdlist1">action:delegate</dt>
<dd>
<p>The name of an alternative action that can be used instead of the standard related records list. One possible value for this would be "related_records_checkboxes" which would provide the user with a checkbox group to select the records that should be part of the relationship rather than the usual related record list.</p>
<div class="paragraph">
<p><em>Since: 1.0</em></p>
</div>
</dd>
<dt class="hdlist1">actions:addexisting</dt>
<dd>
<p>Boolean value (0 or 1) indicating whether the action to add existing records should exist in this relationship.</p>
<div class="paragraph">
<p><em>Since: 0.1</em></p>
</div>
</dd>
<dt class="hdlist1">actions:addnew</dt>
<dd>
<p>Boolean value (0 or 1) indicating whether the action to add new records should exist in this relationship.</p>
<div class="paragraph">
<p><em>Since: 0.1</em></p>
</div>
</dd>
<dt class="hdlist1">actions:remove</dt>
<dd>
<p>Boolean value (0 or 1) indicating whether the action to remove existing records should exist in this relationship.</p>
<div class="paragraph">
<p><em>Since: 0.1</em></p>
</div>
</dd>
<dt class="hdlist1">list:link_to_domain_record</dt>
<dd>
<p>Specify that rows in the related list view should like directly to the domain record, rather than the intermediate <code>view_related_record</code> action.</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="listingblock">
<div class="title">tables/publisher/relationships.ini file</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[podcasts]
    publisher_podcasts.publisher_id=$publisher_id
    list:link_to_domain_record=1</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, each row of the <em>podcasts</em> relationship will link directly ot the corresponding record of the <em>publisher_podcasts</em> table.  If we did not add this, then clicking on a row would link to the <code>view_related_record</code> action for the related record, which will display the details of the related record, and will have a link to go to the domain record of the <em>publisher_podcasts</em> table.</p>
</div>
</div>
</div>
<div class="paragraph">
<p><em>Since 3.0</em></p>
</div>
</dd>
<dt class="hdlist1">list:type</dt>
<dd>
<p>Optional type of list to use for the related record list. Possible value: "treetable"</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>Example: Setting <code>list:type=treetable</code></strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/treetable.png" alt="treetable">
</div>
</div>
<div class="paragraph">
<p><strong>Prerequisites</strong></p>
</div>
<div class="paragraph">
<p>The TreeTable component needs to be able to figure out the logical children of each record in order to know what to show when a row is expanded. You can use either the <code>meta:class</code> directive of the <em>relationships.ini</em> file to specify a relationship as a "children" relationship, or you can implement the <a href="#delegate-getChildren">getChildren method</a> of the table delegate class to manually define a record&#8217;s child elements.</p>
</div>
</div>
</div>
<div class="paragraph">
<p><em>Since:  0.8</em></p>
</div>
</dd>
<dt class="hdlist1">meta:class</dt>
<dd>
<p>An optional special class to assign to the relationship, e.g. "parent" or "children".</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>The meta:class directive allows you to ascribe special meaning to a relationship which Xataface can use in various parts of your application to provide enhanced capabilities.</p>
</div>
<div class="paragraph">
<p>For example you can specify a relationship as a "parent" relationship, thereby using the relationship to obtain the "parent" of records of this table. This can be used to help build breadcrumbs.</p>
</div>
<div class="paragraph">
<p>You can also specify a relationship as a "children" relationship which would treat records in the relationship as children of the current record. This can be used in conjunction with the <code>list:type=treetable</code> directive of the <em>relationships.ini</em> file to build a tree table that navigates all child records and subtrees.</p>
</div>
<div class="paragraph">
<p>The <code>Dataface_Record</code> class contains some methods for retrieving the parent and children of records and these methods will take into account any settings you make here.</p>
</div>
<div class="paragraph">
<p><strong>Allowed Values:</strong></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">parent</dt>
<dd>
<p>Designates the relationship as a 'parent' relationship, meaning that the first record in this relationship will be treated as the parent of the current record. This setting can be overridden by the getParent? method of the table delegate class if implemented.</p>
<div class="paragraph">
<p><em>Since 0.8</em></p>
</div>
</dd>
<dt class="hdlist1">children</dt>
<dd>
<p>Designates the relationship as a 'children' relationship meaning that records of the the relationship will be treated as a children. This setting can be overridden by the getChildren method of the table delegate class if implemented.</p>
<div class="paragraph">
<p><em>Since 0.8</em></p>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p><strong>See Also</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#delegate-getChildren">getChildren()</a> delegate class method.</p>
</li>
<li>
<p><a href="#delegate-getParent">getParent()</a> delegate class method.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="paragraph">
<p><em>Since 0.8</em></p>
</div>
</dd>
<dt class="hdlist1">metafields:order</dt>
<dd>
<p>If the relationship should have a default order this specifies the field that should be used for this sort.</p>
<div class="paragraph">
<p><em>Since: 0.1</em></p>
</div>
</dd>
<dt class="hdlist1">visibility:fieldName</dt>
<dd>
<p>If given the value hidden will make that particular fieldName disappear in the relationship. This will only be applied for that particular relationship.</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>Example: Hiding a Field</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[myrelationship]
  conferences.ConferenceID = "$ConferenceID"
  visibility:ConferenceID = hidden</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will make the <em>ConferenceID</em>  field in the relationship list view disappear.</p>
</div>
<div class="paragraph">
<p><strong>Example: Showing a Field</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>[myrelationship]
  conferences.ConferenceID = "$ConferenceID"
  visibility:ConferenceID = visible</pre>
</div>
</div>
<div class="paragraph">
<p>This will make the <em>ConferenceID</em> field in the relationship list view appear.</p>
</div>
</div>
</div>
<div class="paragraph">
<p><em>Since: 0.1</em></p>
</div>
</dd>
<dt class="hdlist1">visibility:find</dt>
<dd>
<p>If given the value hidden this will cause the related fields to not appear on the find form. Normally each relationship is provided a section of the find form to enable users to find records that contain at least one match in the related records.</p>
<div class="paragraph">
<p><em>Since 1.3rc4</em></p>
</div>
</dd>
<dt class="hdlist1">vocabulary:existing</dt>
<dd>
<p>Specifies a valuelist that can be used to provide the set of records that can be added to this relationship. If target table has a single column primary key then the valuelist should use the primary key for the value. If it has a multi-column primary key, then the value should be in the form <code>key1=value1&amp;key2=value2</code> etc&#8230;&#8203;</p>
<div class="paragraph">
<p><strong>See also</strong> <a href="#delegate-relationshipname<em>getAddableValues">relationshipname</em>getAddableValues delegate class method</a> for a programatic solution.</p>
</div>
<div class="paragraph">
<p><em>Since: 1.0</em></p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_glance_lists">Glance Lists</h3>
<div class="paragraph">
<p>In the <em>view</em> tab, related records are shown by default in the left column. These sections are called glance lists. The field directives below customize how the glance lists are displayed.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">section:visible</dt>
<dd>
<p>Boolean value (0 or 1) indicating whether the relationship information should appear as a section.</p>
<div class="paragraph">
<p><em>Since 0.7</em></p>
</div>
</dd>
<dt class="hdlist1">section:condition</dt>
<dd>
<p>An expression that evaluates to a boolean that determines at runtime whether the relationship information should appear as a section.</p>
<div class="paragraph">
<p><em>Since 0.7</em></p>
</div>
</dd>
<dt class="hdlist1">section:permission</dt>
<dd>
<p>An array that determines at runtime whether the relationship information should appear as a section for the logged in user.</p>
<div class="paragraph">
<p><strong>Also see</strong>: <a href="#relationship-permissions">Relationship Permissions</a></p>
</div>
<div class="paragraph">
<p><em>Since 0.7</em></p>
</div>
</dd>
<dt class="hdlist1">section:class</dt>
<dd>
<p>An optional value (main) to specify that this section should be in the main column instead of the left sidebar. Default is <code>left</code>.</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>Example 1: A "Hello World" Section</strong></p>
</div>
<div class="paragraph">
<p>We&#8217;ll start by adding a simple section that simply displays "Hello World" to the user. In the delegate class for your table, add the following method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">function section__hello(&amp;$record){
    return [
        'content' =&gt; 'Hello World!!!',
        'class' =&gt; 'main'
    ];
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now if you reload our application and click on the "View" tab for any of the records in the database, you&#8217;ll notice a section labelled hello with the text <em>Hello World!!!</em> in it.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s dissect the above code so that we can better understand what is going on here.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The <code>function section<em>hello()</code> defines a section named hello. If you wanted to define a section named <code>foo</code> you would call the function <code>section</em>foo()</code></p>
</li>
<li>
<p>This function returns an array with the keys <em>content</em>, and <em>class</em>.</p>
</li>
<li>
<p>The content key points to the actual HTML content of the section. In this case it is simply the text <em>Hello World!!!</em>.</p>
</li>
<li>
<p>The <em>class</em> key defines where the section should be displayed. It accepts values of "left" and "main" only. If it is set to "left", then the section will be displayed in the <em>left</em> column. A value of "main" indicates that it should be displayed in the <em>main</em> column.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Customizing the Section Label</strong></p>
</div>
<div class="paragraph">
<p><em>hello</em> is a boring label, so let&#8217;s add our own custom label by adding the label key to the array returned by our method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">function section__hello(&amp;$record){
    return [
        'content' =&gt; 'Hello World!!!',
        'class' =&gt; 'main',
        'label' =&gt; 'Message of the Day'
    ];
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now if you load the view tab of your application, you&#8217;ll notice that the section has a heading "Message of the Day".</p>
</div>
<div class="paragraph">
<p><strong>Customizing the Section Order</strong></p>
</div>
<div class="paragraph">
<p>A section can also specify an order attribute to define the order in which this section should appear. It defaults to 0 which may cause the section to appear at the top of the view tab. You can push it to the bottom of the view tab by assiging a higher number to the order attribute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">function section__hello(Dataface_Record $record = null){
    return [
        'content' =&gt; 'Hello World!!!',
        'class' =&gt; 'main',
        'label' =&gt; 'Message of the Day',
        'order' =&gt; 10
    ];
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now if you reload the <em>view</em> tab you&#8217;ll notice that the section has moved to the bottom of the page.</p>
</div>
</div>
</div>
<div class="paragraph">
<p><em>Section 0.7</em></p>
</div>
</dd>
<dt class="hdlist1">section:label</dt>
<dd>
<p>The label that appears in the header of this related record section. Default is to use the relationship name or action:label if defined as documented above.</p>
<div class="paragraph">
<p><em>Since 0.7</em></p>
</div>
</dd>
<dt class="hdlist1">section:order</dt>
<dd>
<p>Integer. The order of this related record section in relation to the other sections. Default is <code>0</code>.</p>
<div class="paragraph">
<p><em>Since 0.7</em></p>
</div>
</dd>
<dt class="hdlist1">section:limit</dt>
<dd>
<p>Integer. The number of records to show in this related record section. Default is <code>5</code>.
<em>Since 0.7</em></p>
</dd>
<dt class="hdlist1">section:sort</dt>
<dd>
<p>A comma-delimited list of columns and optionally direction to use in sorting this related record section, similar to an ORDER BY clause in SQL. E.g.</p>
<div class="listingblock">
<div class="content">
<pre>section:sort="some_column asc"</pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre>section:sort="col1 asc,col2 desc,etc..."</pre>
</div>
</div>
<div class="paragraph">
<p><em>Since 0.7</em></p>
</div>
</dd>
<dt class="hdlist1">section:filter</dt>
<dd>
<p>A string SQL clause to be used to filter the results.</p>
<div class="paragraph">
<p><em>Since 0.7</em></p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_relationship_permissions">Relationship Permissions</h3>
<div class="paragraph">
<p>See <a href="#relationship-permissions">Relationship Permissions</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="actionsini-directives">Actions.ini Directives</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The actions.ini file stores information about the various action?s that can be performed by your application. An action may be manifested in two ways:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>As a web page</p>
</li>
<li>
<p>As a menu item</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>And there is no reason why an action cannot serve in both capacities simultaneously. All menu items and functions that Xataface performs are defined in the Xataface actions.ini file (in the root of the Xataface installation dirctory). You can also create an actions.ini file in your application&#8217;s root directory to override existing Xataface actions, or to create your own.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>This section refers to "actions.ini" file, Xataface supports adding a .php extension to all .ini files to increase security.  I.e. Instead of actions.ini, you can name your file actions.ini.php.  The benefit of the .php extension is that you can have a line at the beginning of the file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">;&lt;?php exit;</code></pre>
</div>
</div>
<div class="paragraph">
<p>which will be ignored by Xataface&#8217;s INI file parser, but will result in the web server not serving the file - so the malicious snoopers can&#8217;t access the file directly.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you want to modify an existing action instead of overriding it, you can use this syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[browse &gt; browse]
label = Browse</code></pre>
</div>
</div>
<div class="paragraph">
<p>The &gt; symbol simply means to inherit from the existing browse action. All the attributes are the same, and we just override the label to Browse (originally was Details)</p>
</div>
<div class="sect2">
<h3 id="_syntax_2">Syntax</h3>
<div class="paragraph">
<p>As with the <a href="#fieldsini-directives">fields.ini file</a> and the valuelists.ini file, the actions.ini file uses the simple INI file syntax to define its actions. Each action is defined in its own section, and can have a number of directives to specify the action&#8217;s behavior.</p>
</div>
<div class="paragraph">
<p>Here is a snippet from the Xataface actions.ini file to give you an idea:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">;; Show the details of the current record
[browse]
label = Details
category = table_tabs
url = "{$this-&gt;url('-action=view')}"
accessKey = "b"
mode = browse
permission = view
order=0

;; Show a list of the records in the current found set
[list]
label = List
category = table_tabs
url = "{$this-&gt;url('-action=list')}"
accessKey = "l"
mode = list
template = Dataface_List_View.html
permission = list
order=0.5

;; Show a "Find Record Form"
[find]
label = Find
category = table_tabs
url = "{$this-&gt;url('-action=find')}"
accessKey = "f"
mode = find
permission = find
template = Dataface_Find_View.html
order=0.75</code></pre>
</div>
</div>
<div class="paragraph">
<p>This snippet shows the definition of the browse, list, and find actions - three of the most central actions in a Xataface application. Notice how each action has its own section (according to INI file syntax?) with a number of directives which specify how the action behaves. For instance, each action has a "category" value of "table_tabs", which tells Xataface to display the actions as part of the table tabs in the user interface.</p>
</div>
</div>
<div class="sect2">
<h3 id="_directives">Directives</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">ajax</dt>
<dd>
<p>Indicates this this is an ajax action.  See <a href="#ajax_actions">Action to Trigger AJAX Request</a>.</p>
</dd>
<dt class="hdlist1">allow_override</dt>
<dd>
<p>An optional directive to indicate that this action can be overridden by more specific directives in another ini file. Currently there is only support for a value of "relationships.ini" indicating that the settings can be overridden in the relationships.ini file. In order for this to work, related=1 must also be set.</p>
<div class="paragraph">
<p>Since 1.3rc4</p>
</div>
</dd>
<dt class="hdlist1">label</dt>
<dd>
<p>The label to display if the action is used as a menu item.</p>
</dd>
<dt class="hdlist1">category</dt>
<dd>
<p>The name of the action&#8217;s category which can be used to group this action together with other similar actions to be used in a menu in the user interface.</p>
<div class="paragraph">
<p><strong>See</strong> <a href="#action-categories">Action Categories</a></p>
</div>
</dd>
<dt class="hdlist1">url</dt>
<dd>
<p>If the action appears as a menu item, this is the URL that the menu item points to. This may contain PHP expressions inside curly braces.</p>
</dd>
<dt class="hdlist1">onclick</dt>
<dd>
<p>A javascript snippet to call when the user clicks on the action.  This can be used as an alternative to the <code>url</code> directive.  See <a href="#javascript-action">Triggering Javascript Function with Action</a>.</p>
<div class="paragraph">
<p>Since 2.0</p>
</div>
</dd>
<dt class="hdlist1">accessKey</dt>
<dd>
<p>The key code to automatically select this action if it is included as a menu item. I.e. ALT+accessKey calls the action.</p>
</dd>
<dt class="hdlist1">materialIcon</dt>
<dd>
<p>The name of a material Icon to use for the action menu item.  See <a href="#material-icons">Using Material Icons</a></p>
<div class="paragraph">
<p>Since 3.0</p>
</div>
</dd>
<dt class="hdlist1">mode</dt>
<dd>
<p>This indicates which tab of the table tabs (find, details, list, etc&#8230;&#8203;) that this action should appear to be part of when the action is viewed as a web page. If this is left undefined, or it does not match any existing visible action in the table tabs, then no tab will appear to be selected.</p>
</dd>
<dt class="hdlist1">permission</dt>
<dd>
<p>The name of a permission required to both see the action as part of a menu and to access the action as a web page.</p>
</dd>
<dt class="hdlist1">visible</dt>
<dd>
<p>A boolean value indicating whether the action should be visible as a menu item.</p>
</dd>
<dt class="hdlist1">condition</dt>
<dd>
<p>A boolean value or a PHP expression evaluating to a boolean value to indicate whether the action should be visible as a menu item.</p>
</dd>
<dt class="hdlist1">url_condition</dt>
<dd>
<p>A PHP expression evaluating to a boolean value to indicate whether the URL directive should be evaluated. This basically checks to make sure that its OK to evaluate the "url" expression, just in case the current state of affairs would cause it to throw a fatal error.</p>
</dd>
<dt class="hdlist1">order</dt>
<dd>
<p>A numeric value indicating the order in which the action should be displayed as part of a menu. Low numbers result in higher placement in the menu.</p>
</dd>
<dt class="hdlist1">icon</dt>
<dd>
<p>The path to an icon that should be used when the action appears as a menu item.  If possible, prefer the <code>materialIcon</code> directive to this one as they are far mor flexible with respect to styling.</p>
</dd>
<dt class="hdlist1">scaler.depends</dt>
<dd>
<p>Used by <a href="#scaler">Scaler Module</a>, this is a comma-separate list of table names that are used by the action.  This will override the <code>-table</code> GET parameter in so far as it is used to invalidate the cache for the request.  This is often used in conjunction with the <em>scaler.trackUsedTables</em> directive.</p>
</dd>
<dt class="hdlist1">scaler.trackUsedTables</dt>
<dd>
<p>Overrides the <em>trackUsedTables</em> setting of the <a href="#scaler">Scaler Module</a> for this action.</p>
</dd>
<dt class="hdlist1">template</dt>
<dd>
<p>The path to the template that should be used when the action is displayed as a web page.</p>
</dd>
<dt class="hdlist1">description</dt>
<dd>
<p>Mouseover text for the action (when displayed as a menu item).</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_php_expression_context">PHP Expression Context</h3>
<div class="paragraph">
<p>Notice that the <code>url</code>, <code>condition</code>, and <code>url_condition</code> directives allow you to use a PHP expression for their values. In order for this to be helpful, you should know a little bit about the context and environment in which these expressions will be executed. All expressions are evaluated immediately prior to being rendered, so the same action can be displayed multiple times in the same page, but have very different resulting values for their urls and conditions.</p>
</div>
<div class="paragraph">
<p>These expressions are all executed within the context of the <code>Dataface_Application::parseString()</code> method, with the following variables loaded in the local symbol table (i.e. you can use the following variables in your expressions).</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">$site_url</dt>
<dd>
<p>The URL to the current application&#8217;s directory (not including "index.php")</p>
</dd>
<dt class="hdlist1">$site_href</dt>
<dd>
<p>The URL to the current application including "index.php"</p>
</dd>
<dt class="hdlist1">$dataface_url</dt>
<dd>
<p>The URL to the xataface installation directory.</p>
</dd>
<dt class="hdlist1">$table</dt>
<dd>
<p>The name of the current table (i.e. the value of the "-table" request parameter"</p>
</dd>
<dt class="hdlist1">$tableObj</dt>
<dd>
<p>The <code>Dataface_Table</code> object for the current table.</p>
</dd>
<dt class="hdlist1">$query</dt>
<dd>
<p>An associative array of the current query variables.</p>
</dd>
<dt class="hdlist1">$app</dt>
<dd>
<p>A reference to the current <code>Dataface_Application</code> object. Alias of <code>$this</code></p>
</dd>
<dt class="hdlist1">$authTool</dt>
<dd>
<p>A reference to the <code>Dataface_AuthenticationTool</code> instance.</p>
</dd>
<dt class="hdlist1">$relationship</dt>
<dd>
<p>If the action is being rendered in the context of a related record or a relationship request, this will be the corresponding <code>Dataface_Relationship</code> object.</p>
</dd>
<dt class="hdlist1">$resultSet</dt>
<dd>
<p>A reference to the <code>Dataface_QueryTool</code> object for the current query.</p>
</dd>
<dt class="hdlist1">$record</dt>
<dd>
<p>A reference to the current <code>Dataface_Record</code> object.</p>
</dd>
<dt class="hdlist1">$context</dt>
<dd>
<p>An associative array of context variables that are passed to the action from the context in which the action is called.</p>
</dd>
</dl>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>If your action expression contains any fatal errors, you may find yourself in a position where your app won&#8217;t load at all (e.g. the white screen of death).  The error log may provide no clues because Xataface suppresses warnings and errors when evaluating the PHP expressions.</p>
</div>
<div class="paragraph">
<p>You can debug these issues by adding the <code>debug=1</code> directive to the beginning of your conf.ini file.  That will cause the action expressions to be evaluated "noisily", and you should see the the error either in your PHP error log or in the browser window when you reload the app.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="action-categories">Action Categories</h3>
<div class="paragraph">
<p>The <code>category</code> directive of the <em>actions.ini</em> file is used to specify <em>where</em> an action should be displayed in the UI.  Xataface includes a number of built-in categories that you can leverage to inject menu items and buttons into various parts of the UI.  Some of these are:</p>
</div>
<div class="sect3">
<h4 id="_global_menus">Global Menus</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">find_actions</dt>
<dd>
<p>Actions that are rendered as a drop-down selector in the search field, and allow you to create custom "find" actions.</p>
</dd>
<dt class="hdlist1">personal_tools</dt>
<dd>
<p>Actions that are rendered in the personal tools menu.  E.g. Login, Logout, Change Password, etc&#8230;&#8203;</p>
</dd>
<dt class="hdlist1">status_bar_right</dt>
<dd>
<p>Actions rendered on the right side of the top status bar.  Currently this includes only the "Login" action and the "Personal Tools" menu, which loads items from the <code>personal_tools</code> category.</p>
</dd>
<dt class="hdlist1">table_tabs</dt>
<dd>
<p>Actions added as the root level tabs within a table.  E.g. <code>list</code>, <code>view</code>, <code>find</code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_record_details_view_menus">Record Details View Menus</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">record_actions</dt>
<dd>
<p>Actions that can be performed on the current record.  This category is used for the overflow menu of the <code>record_actions_menu</code> category, which is the <a href="#page-actions-category">Page actions category</a> for the <code>view</code> action, so it is rendered as an overflow menu in the upper right in the desktop theme, and in the FAB (floating action button menu) on mobile in the <em>record`details</em> views.</p>
<div class="imageblock">
<div class="content">
<img src="images/record_actions-screenshot.png" alt="record actions screenshot">
</div>
<div class="title">Figure 58. Items in the overflow menu come from <code>record_actions</code> category.</div>
</div>
</dd>
<dt class="hdlist1">record_actions_menu</dt>
<dd>
<p>Actions that can be performed on the current record.  This category is the  <a href="#page-actions-category">Page actions category</a> for the <code>view</code> action, so it is rendered as an overflow menu in the upper right in the desktop theme, and in the FAB (floating action button menu) on mobile in the <code>details</code> view.</p>
<div class="paragraph">
<p><strong>See also</strong> The <code>record_actions</code> category, which is used for the menu items of the overflow menu.</p>
</div>
</dd>
<dt class="hdlist1">record_nav_actions</dt>
<dd>
<p>Menu in the record view that is displayed just below the record title and description.  Useful for providing quick navigation links to related records.</p>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>Example: Adding link to parent record</strong></p>
</div>
<div class="listingblock">
<div class="title">actions.ini file</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[up_to_podcast]
    ;Link to the parent "Podcast" record from a podcast episode
    category=record_nav_actions
    condition="$record and $record-&gt;_table-&gt;tablename == 'publisher_podcast_episodes'"
    url="?-table=publisher_podcasts&amp;publisher_podcast_id={$record-&gt;val('publisher_podcast_id')}&amp;-action=view"
    url_condition="$record and $record-&gt;_table-&gt;tablename == 'publisher_podcast_episodes'"
    label="{$record-&gt;val('podcast_title')}"
    label_condition="$record and $record-&gt;_table-&gt;tablename == 'publisher_podcast_episodes'"
    materialIcon=arrow_upward

[up_to_podcast_episodes]
    category=record_nav_actions
    condition="$record and $record-&gt;_table-&gt;tablename == 'publisher_podcast_episodes'"
    url="?-table=publisher_podcasts&amp;publisher_podcast_id={$record-&gt;val('publisher_podcast_id')}&amp;-action=related_records_list&amp;-relationship=episodes"
    url_condition="$record and $record-&gt;_table-&gt;tablename == 'publisher_podcast_episodes'"
    label="Other Episodes"
    label_condition="$record and $record-&gt;_table-&gt;tablename == 'publisher_podcast_episodes'"
    materialIcon=list
    order=2</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Result:</strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/record_nav_menu-links.png" alt="record nav menu links">
</div>
<div class="title">Figure 59. "Steve Hannah&#8217;s Blog" and "Other Episodes" links inserted into the record header using the <code>record_nav_actions</code> category.</div>
</div>
</div>
</div>
<div class="paragraph">
<p><em>Since 3.0</em></p>
</div>
</dd>
<dt class="hdlist1">record_tabs</dt>
<dd>
<p>Tabs in the detail record view.  This is where the <em>view</em> tab is rendered, as well as related lists.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_list_view_menus">List View Menus</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">list_settings</dt>
<dd>
<p>Actions for managing list settings.  E.g. "Sort" and "Filter" options.</p>
</dd>
<dt class="hdlist1">result_list_actions</dt>
<dd>
<p>The actions related to a result list.</p>
</dd>
<dt class="hdlist1">selected_result_actions</dt>
<dd>
<p>Actions that operate on the currently selected rows in list view.</p>
</dd>
<dt class="hdlist1">summary_actions</dt>
<dd>
<p>Actions that operate on a row in the summary list view.</p>
</dd>
<dt class="hdlist1">table_actions</dt>
<dd>
<p>Actions that can be performed on the current table.  This category is used for the overflow menu of the <code>table_actions_menu</code> category, which is the default <a href="#page-actions-category">Page actions category</a>, so it is rendered as an overflow menu in the upper right in the desktop theme, and in the FAB (floating action button menu) on mobile, throughout most of the app - specifically in the <code>list</code> view.</p>
<div class="paragraph">
<p>Actions in this category include <code>rss</code>, <code>export_xml</code>, <code>export_csv</code>, <code>delete_set</code>, <code>copy_set</code>, and <code>update_set</code>.  These actions are displayed only when in list view.  The <code>record_actions</code>, <code>edit_record_actions</code>, <code>new_record_actions</code>, and <code>new_related_record_actions</code> categories</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Actions in this category may use the <code>class=featured-action</code> to take on a "Featured" look.   In the default theme featured actions are rendered green with an inner shadow, in contrast to regular action buttons that are rendered white with a gray border.
</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><strong>Example: Default Actions in table_actions category</strong></p>
</div>
<div class="paragraph">
<p>The core Xataface actions.ini file defines several actions in the <code>table_actions</code> category.  These actions are shown in the screenshot below:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/table_actions.png" alt="table actions">
</div>
<div class="title">Figure 60. table_actions overflow menu on desktop.  Note that the "New Record" button uses the <code>table_actions_menu</code> category.  The menu items in the overflow menu use the <code>table_actions</code> category.</div>
</div>
<div class="paragraph">
<p>The above screenshot is from a stock install.  Notice that the <em>New Record</em> button makes use of the <code>class=featured-action</code> directive to appear as a featured button.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/table_actions_mobile.png" alt="table actions mobile">
</div>
<div class="title">Figure 61. On Mobile, the table actions are included in the FAB (floating action button) in the lower right.</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/table_actions_fab_expanded.png" alt="table actions fab expanded">
</div>
<div class="title">Figure 62. Expanding the FAB reveals the actions in the table_actions category.</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">table_actions_menu</dt>
<dd>
<p>Used for the default <a href="#page-actions-category">page actions category</a>.  Used in most actions, notably "list".  Includes an overflow menu whose menu items come from the <code>table_actions</code> category.  Rendered in top right on desktop, and in the FAB (floating action button) on  mobile.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_related_list_menus">Related List Menus</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">related_export_actions</dt>
<dd>
<p>Actions available on the export related records form.</p>
</dd>
<dt class="hdlist1">related_list_actions</dt>
<dd>
<p>Actions that operate on a related list.</p>
</dd>
<dt class="hdlist1">related_list_settings</dt>
<dd>
<p>Actions for managing related list settings.  E.g. "Sort" and "Filter" options.</p>
</dd>
<dt class="hdlist1">relationship_actions</dt>
<dd>
<p>Actions which operate on a particular related list.  E.g. <code>new_related_record</code>.</p>
</dd>
<dt class="hdlist1">selected_related_result_actions</dt>
<dd>
<p>Actions that operate on the currently selected rows in a related list.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_edit_form_menus">Edit Form Menus</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">edit_record_actions_menu</dt>
<dd>
<p>The default <a href="#page-actions-category">Page Actions Category</a> for the <code>edit</code> action.</p>
</dd>
<dt class="hdlist1">new_related_record_actions_menu</dt>
<dd>
<p>The default <a href="#page-actions-category">Page Actions Category</a> for the <code>new_related_record</code> action.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_new_form_menus">New Form Menus</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">new_record_actions_menu</dt>
<dd>
<p>The default <a href="#page-actions-category">Page Actions Category</a> for the <code>new</code> action.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_view_related_record_menus">View Related record Menus</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">view_related_record_actions</dt>
<dd>
<p>Default <a href="#page-actions-category">Page Actions Category</a> for the view_related_record action.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_edit_related_record_menus">Edit Related Record Menus</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">existing_related_record_actions_menu</dt>
<dd>
<p>The default <a href="#page-actions-category">Page Actions Category</a> for the <code>add_existing_related_record</code> action.  Overflow menu items from the <code>edit_related_record_actions</code> category.</p>
</dd>
<dt class="hdlist1">edit_related_record_actions</dt>
<dd>
<p>Actions appearing in the <code>edit_related_record</code> action.  By default there is only a "Cancel" action.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_login_menus">Login Menus</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">login_actions</dt>
<dd>
<p>Actions rendered on the login page.  E.g. <code>forgot_password</code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_management_menus">Management Menus</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">management_actions</dt>
<dd>
<p>Actions that are available in the "Manage" section.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_other_menus">Other Menus</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">ajax_actions</dt>
<dd>
<p>Actions for saving and loading records over AJAX. These don&#8217;t appear in any menu.</p>
</dd>
<dt class="hdlist1">event_actions</dt>
<dd>
<p>Actions that operate on an event.  These are used in the calendar view.</p>
</dd>
<dt class="hdlist1">history_record_actions</dt>
<dd>
<p>Actions related to a history record.</p>
</dd>
<dt class="hdlist1">password_changed_actions</dt>
<dd>
<p>Actions that appear after the user has changed their password.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="page-actions-category">Page Actions Category</h4>
<div class="paragraph">
<p>Xataface 3.0&#8217;s default theme has attempted to consolidate actions into fewer menus that are shown contextually.  Typically on any given "page", there are a set of actions that the user can perform on the subject of that page.  On desktop these actions are rendered in the upper right in a "more" menu, and on mobile, they are rendered in a FAB menu (floating action button menu).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/table_actions.png" alt="table actions">
</div>
<div class="title">Figure 63. Page actions on desktop displayed in upper right.</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/table_actions_mobile.png" alt="table actions mobile">
</div>
<div class="title">Figure 64. On Mobile, the table actions are included in the FAB (floating action button) in the lower right.</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/table_actions_fab_expanded.png" alt="table actions fab expanded">
</div>
<div class="title">Figure 65. Expanding the FAB reveals the actions in the table_actions category.</div>
</div>
<div class="paragraph">
<p>When in list view, these "page actions" come from the <code>table_actions</code> category.  When in the <em>details</em> view for a record, they come from the <code>record_actions</code> category.  Some special actions, such as <code>edit</code> and <code>new</code> define their own categories for the actions that should be displayed in this spot: <code>edit_record_actions</code> and <code>new_record_actions</code> respectively.</p>
</div>
<div class="paragraph">
<p>If you create a custom action, you can specify the category that should be used for the "page menu" via the <code>page_menu_category</code> directive of the actions.ini file.</p>
</div>
<div class="sect4">
<h5 id="_example_view_action">Example: View Action</h5>
<div class="paragraph">
<p>The <code>view</code> action uses the <code>record_actions</code> category for its page actions.  Its action definition is as follows:</p>
</div>
<div class="listingblock">
<div class="title">The <code>view</code> action definition from the xataface actions.ini file.  It uses the <code>page_menu_category</code> directive to specify that the "page actions" should be populated from actions in the <code>record_actions_menu</code> category.</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[view]
    label = View
    url = "{$this-&gt;url('-action=view&amp;-relationship=')}"
    template = Dataface_View_Record.html
    permission = view
    mode = browse
    category = record_tabs
    selected_condition = "$query['-action'] == 'view'"
    order=-2
    page_menu_category=record_actions_menu
    rel=sibling</code></pre>
</div>
</div>
<div class="paragraph">
<p>Above is the full action definition, but our interest in this example is the <code>page_menu_category</code> directive, which says that the "page menu" should be populated using actions in the <code>record_actions_menu</code> category.</p>
</div>
</div>
<div class="sect4">
<h5 id="_creating_an_overflow_menu">Creating an Overflow Menu</h5>
<div class="paragraph">
<p>Generally the "page actions" will display one or two buttons directly, and additional actions will be placed in an overflow menu.  If you are creating your own "page actions category", and you want to achieve this kind of grouping, you can achieve it by creating two categories:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A category for the top-level items.</p>
</li>
<li>
<p>A category for the overflow menu.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Then create an action in the top level category with <code>subcategory</code> set to the category of the overflow menu.</p>
</div>
<div class="paragraph">
<p><strong>Example: The View Action</strong></p>
</div>
<div class="paragraph">
<p>The <code>view</code> action uses the <code>record_actions_menu</code> category for its page actions, and the <code>record_actions</code> category for its overflow menu.</p>
</div>
<div class="paragraph">
<p>So the <code>view</code> action is defined as follows:</p>
</div>
<div class="listingblock">
<div class="title">The view action (some directives omitted for clarity)</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[view]
  page_menu_category=record_actions_menu</code></pre>
</div>
</div>
<div class="paragraph">
<p>It then defines the <code>record_actions</code> action in the <code>record_actions_menu</code> category, which will be manifested as the overflow menu button.  Defined as follows:</p>
</div>
<div class="listingblock">
<div class="title">The <code>record_actions</code> action creates an overflow button.</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[record_actions]
	label=""
	materialIcon="more_vert"
	subcategory=record_actions
	category="record_actions_menu"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The secret sauce of this action is the <code>category</code> directive, which adds this action to the <code>record_actions_menu</code> category, combined with the <code>subcategory</code> directive, which specifies the category that is used for its menu items.  It is the <code>subcategory</code> directive that turns this button into a menu.</p>
</div>
<div class="paragraph">
<p>Finally, there are a few actions that are registered to the overflow menu, by assigning them to the <code>record_actions</code> category.  E.g.</p>
</div>
<div class="paragraph">
<p>E.g. The <code>view_xml</code> action.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[view_xml]
	label = Export XML
	description = "Export an XML representation of this record"
	url = "{$record-&gt;getURL('-action=export_xml')}&amp;--single-record-only=1"
	url_condition="$record"
	permission=view xml
	mode=browse
	category=record_actions
	materialIcon=code
	condition="$record"</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/record_actions_menu.png" alt="record actions menu">
</div>
<div class="title">Figure 66. The  <code>record_actions_menu</code> menu.</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/record_actions_menu_overflow.png" alt="record actions menu overflow">
</div>
<div class="title">Figure 67. The <code>record_actions_menu</code> menu with the overflow menu showing.  The actions in the overflow menu come from the <code>record_actions</code> category.</div>
</div>
<div class="paragraph">
<p>On mobile the page actions are shown in the FAB (floating action button) in the lower right.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/record_actions_menu_fab.png" alt="record actions menu fab">
</div>
<div class="title">Figure 68. The <code>record_actions_menu</code> FAB in the mobile theme.</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/record_actions_menu-fab-expanded.png" alt="record actions menu fab expanded">
</div>
<div class="title">Figure 69. The <code>record_actions_menu</code> FAB expanded.  The "More&#8230;&#8203;" menu item is where the overflow menu items from the <code>record_actions</code> category are located.</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/record_actions_menu-fab-overflow.png" alt="record actions menu fab overflow">
</div>
<div class="title">Figure 70. The <code>record_actions</code> category (the overflow menu).</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="preference-directives">Preferences Directives</h2>
<div class="sectionbody">
<h3 id="_how_to_set_preferences" class="discrete">How to Set Preferences</h3>
<div class="paragraph">
<p>Xataface preferences can be defined in 4 ways:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the <code>[_prefs]</code> section of the conf.ini file for global static preferences.</p>
</li>
<li>
<p>Implementing the <code>getPreferences()</code> method in the Application Delegate Class</p>
</li>
<li>
<p>In the <code><em>prefs</em></code> section of the fields.ini file for a table for static preferences on that table. (Limited to only certain preferences).</p>
</li>
<li>
<p>Using the <code>prefs.key</code> fields.ini directive on fields of the users table to specify that the value of that field should be used as a preference for the currently logged in user.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">Example [_prefs] section in the conf.ini</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[_prefs]
    hide_updated=1
    hide_posted_by=1</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example getPreferences? method in the Application Delegate Class:</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">function getPreferences(){
    return array('hide_update'=&gt;1, 'hide_posted_by'=&gt;1);

}</code></pre>
</div>
</div>
<h3 id="_available_preferences" class="discrete">Available Preferences</h3>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Available Preferences</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Preference</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">show_result_stats</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show the result statistics (e.g. found x of y records in table z)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">show_jump_menu</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show he drop-down menu that allows you to "jump" to any record in the found set.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">show_result_controller</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show Next, previous, page number .. links&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">show_table_tabs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show Details, List, Find, etc&#8230;&#8203; tabs.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">show_actions_menu</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show New record, Show all, delete, etc..</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">show_logo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show logo at top of app</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">show_tables_menu</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show the tabs to select a table.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">show_search</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show search field in upper right.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">show_record_actions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show actions related to particular record</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">show_bread_crumbs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show bread crumbs at top of page to show where you are.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">show_record_tabs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">View, Edit, Translate, History, etc&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">show_record_tree</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show tree to navigate the relationships of this record.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">list_view_scroll_horizontal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to scroll list horizontal if it exceeds page width</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">list_view_scroll_vertical</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to scroll list vertical if it exceeds page height.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hide_posted_by</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to hide the posted by text in glance lists (e.g. in the view tab, the related records are shown in the left column. This hides the posted by text next to each related record.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.0b4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hide_updated</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to hide the updated text in the glance lists (e.g. in the view tab, the related records are shown in the left column. This hides the updated text next to each related record.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.0b4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SummaryList_logo_width</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The width of the logo to be used as the preview image in summary lists.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SummaryList_hideSort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hides the sort control for a summary list (the box that allows users to sort by column).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hide_user_status</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hides the user&#8217;s status (e.g. "You are logged in as &#8230;&#8203;"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hide_personal_tools</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hides the personal tool links in upper right. This includes likes such as "Control Panel" and "My Profile"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hide_resultlist_controller</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hides the controller for a result list (E.g. next/back/results per page etc&#8230;&#8203;).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hide_related_sections</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hides the sections of the view tab that show the related records. These are the sortable section boxes. Not the related tabs.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hide_record_search</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hides the record search form that appears in the view tab. Not to be confused with the find tab.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">show_resultlist_controller_only_when_needed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the resultlist controller (e.g. back/next/results per page/etc&#8230;&#8203;) to only show up if paging is required (i.e. if there are more records than can be shown on one page (according to the '-limit' parameter).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hide_record_view_logo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hides the logo for a record that appears in the upper left of the view tab for each record.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">horizontal_tables_menu</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to force the tables menu to appear as tabs along the top of the page (alternative is as a menu on the left). If there are 10 or fewer allowed tables, then the default is 1, otherwise the default is set to 0.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hide_result_filters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">In list view, setting this value to 1 will cause the column filters to be hidden (the select lists to filter the results).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">show_filter_counts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A value of 0 will hide the result filter counts.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">disable_select_rows</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A value of 1 causes the checkboxes in each row of the list view to be hidden.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">result_list_use_geturl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use the getURL() method to link to records in the list view rather than the default (which uses the -cursor parameter).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">disable_ajax_record_details</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to disable the ajax record details (the '+' sign beside each record in list view that expands to show the record details.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">use_old_resultlist_controller</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">As of Xataface 1.1, a new style result list controller is used that resembles facebook. It is more slimmed down and is easier to manage. If you prefer the old controller, set this preference to 1.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">user_stylesheet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of a CSS file that should be used to define custom styles for the current user request.  Xataface will look for a stylesheet by this name inside the app&#8217;s <code>css</code> directory, or the <code>xataface/css</code> directory. See <a href="#user-specific-stylesheet">Using Preferences to Override Color Scheme</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mobile_app_menu_position</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the position of the "app menu" in the mobile theme.  Supported values are "ne" (for northeast) and "se" for south east.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"ne"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mobile_app_menu_sheet_position</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For the mobile theme, this specifies the value that is supplied to the "sheet" in which the app menu opens.  If the "mobile_app_menu_position" is "ne", then this will default to "right".  Otherwise it defaults to "fill"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depends</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.0</p></td>
</tr>
</tbody>
</table>
<h3 id="_inverse_preferences" class="discrete">Inverse Preferences</h3>
<div class="paragraph">
<p>The following preferences perform the inverse of some of the options above. When these options are set to 1, their respective option is set to 0.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Inverse Preferences</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Inverse</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hide_nav_menu</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">show_tables_menu</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hide_view_tabs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">show_table_tabs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hide_result_controller</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">show_result_controller</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hide_table_result_stats</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">show_result_stats</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hide_search</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">show_search</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="permissionsini-directives">Permissions.ini Directives</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <em>permissions.ini</em> file stores custom permissions and roles that can be used by an application. It is an optional file that should be placed in the application root directory (i.e. the same directory where your conf.ini, and index.php files are located).</p>
</div>
<div class="paragraph">
<p>The <em>permissions.ini</em> file allows you to define two things:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Permissions</p>
</li>
<li>
<p>Roles (i.e. sets of permissions).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Permissions and roles are used throughout Xataface to limit access to actions, records, fields, and relationships. For example, each action in your application can specify a permission that is necessary to perform the action. Your delegate classes may include <code>getPermissions()</code> methods to define what permissions a user gets when interacting with different records. This file (<em>permissions.ini</em>) simply defines the permissions that can be used by your application. It doesn&#8217;t actually assign those permissions. Assigning permissions is the job of the <code>getPermissions()</code> (or <code>getRoles()</code>) method.</p>
</div>
<div class="sect2">
<h3 id="_defining_permissions">Defining Permissions</h3>
<div class="paragraph">
<p>Permissions are defined by standalone properties in the beginning of the permissions.ini file. For example, if you were desiging a proof-reading application, you might need permissions for "submit_for_proof", or "approve_text" to correspond with the submitting a document to be proof-read, and approving a document&#8217;s proof. In this case we would have the following at the beginning of our permissions.ini file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>submit_for_proof = Submit a document to be proofread
approve_text = "Approve this document's proof"</pre>
</div>
</div>
<div class="paragraph">
<p>The left side of the equals sign is the name of the permission. The right side contains a human readable description of the permission and what it is for.</p>
</div>
</div>
<div class="sect2">
<h3 id="_limiting_access_to_actions_based_on_permissions">Limiting Access to Actions based on Permissions</h3>
<div class="paragraph">
<p>At this point these permissions don&#8217;t do anything. In order to be useful we need reference these permissions from an action or a section. For example, let&#8217;s create an action called "submit_for_proof" which displays a form for a user to submit a document record to be proofread.</p>
</div>
<div class="paragraph">
<p>Our actions.ini file entry might look something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[submit_for_proof]
url="{$this-&gt;url('-action=submit_for_proof')}"
label="Submit document for proof"
category=record_actions
permission=submit_for_proof
template=submit_for_proof.html</pre>
</div>
</div>
<div class="paragraph">
<p>And for completeness, since this make-believe action specifies th "submit_for_proof.html" template, we&#8217;ll create the "submit_for_proof.html" template in the templates directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">&lt;html&gt;&lt;body&gt;You have permission to perform this action.&lt;/body&gt;&lt;/html&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_defining_who_gets_which_permissions">Defining Who Get&#8217;s Which Permissions</h3>
<div class="paragraph">
<p>Finally, in order to benefit from permissions, your application has to decide that it is going to use permissions (unless you define a <code>getPermissions()</code> method, users are granted ALL permissions by default. Hence if you try to access our submit_for_proof action, we&#8217;ll see it without any problem. Regardless of who we are. So let&#8217;s create a simple, but restrictive <code>getPermissions()</code> method in our application delegate class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">&lt;?php
class conf_ApplicationDelegate {
    function getPermissions(&amp;$record){
        return Dataface_PermissionsTool::READ_ONLY();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now if we try to access our <em>submit_for_proof</em> action it will give us a "Permission Denied" message, because we are only granted <code>READ ONLY</code> permissions (which is a role that includes the view permission and some others - but not our custom "submit_for_proof" permission.</p>
</div>
<div class="paragraph">
<p>Now we&#8217;ll make a small modification to our <code>getPermissions()</code> method to provide us with our <em>submit_for_proof</em> permission:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">&lt;?php
class conf_ApplicationDelegate {
    function getPermissions(&amp;$record){
        $perms =  Dataface_PermissionsTool::READ_ONLY();
        $perms['submit_for_proof'] = 1;
        return $perms;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now if we try to access our submit_for_proof action, it will show us our template with no error messages (hopefully).</p>
</div>
</div>
<div class="sect2">
<h3 id="_roles">Roles</h3>
<div class="paragraph">
<p>Roles are sets of permissions. They are defined in the permissions.ini file as sections with lists of included permissions. It might be handy to create roles such as <code>EDITOR</code> or <code>MANAGER</code> which contain sets of permissions that are meant to be assigned to users of those types. For example an <code>EDITOR</code> may have the view and edit permissions, but not the delete permission. A <code>MANAGER</code> might have the <code>view</code>, <code>edit</code>, and <code>delete</code> permissions. You can define these two roles in the <em>permissions.ini</em> file as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[EDITOR]
view=1
edit=1

[MANAGER]
view=1
edit=1
delete=1</pre>
</div>
</div>
<div class="paragraph">
<p>Then we could assign these roles to users using the <code>Dataface_PermissionsTool::getRolePermissions()</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">function getPermissions(&amp;$record){
    $user =&amp; Dataface_AuthenticationTool::getInstance()-&gt;getLoggedInUser();
    if ( $user and $user-&gt;val('role') == 'EDITOR' ){
        return Dataface_PermissionsTool::getRolePermissions('EDITOR');
    } else if ( $user and $user-&gt;val('role') == 'MANAGER' ){
        return Dataface_PermissionsTool::getRolePermissions('MANAGER');
    }
    return Dataface_PermissionsTool::READ_ONLY();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or equivalently we could use the <code>getRoles()</code> method of our delegate class instead of <code>getPermissions()</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">function getRoles(&amp;$record){
    $user =&amp; Dataface_AuthenticationTool::getInstance()-&gt;getLoggedInUser();
    if ( $user and $user-&gt;val('role') == 'EDITOR' ){
        return 'EDITOR';
    } else if ( $user and $user-&gt;val('role') == 'MANAGER' ){
        return 'MANAGER'
    }
    return 'READ ONLY';
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_xataface_core_permissions_roles">Xataface Core Permissions &amp; Roles</h3>
<div class="paragraph">
<p>Xataface is distributed with its own <em>permissions.ini</em> file that defines some core permissions and roles. You can look at this <em>permissions.ini</em> file (located in the <em>xataface</em> directory) to see what the format should look like. Any settings you place in your application&#8217;s <em>permissions.ini</em> file will augment or override settings in Xataface&#8217;s file.</p>
</div>
<div class="sect3">
<h4 id="_core_permissions">Core Permissions</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">view</dt>
<dd>
<p>Permission to view a record or field. This permission is required to access the view tab, and several other details tabs.</p>
<div class="paragraph">
<p><em>Since 0.6</em></p>
</div>
</dd>
<dt class="hdlist1">list</dt>
<dd>
<p>Permission to access the list tab.</p>
<div class="paragraph">
<p><em>Since 0.6</em></p>
</div>
</dd>
<dt class="hdlist1">calendar</dt>
<dd>
<p>Permission to access the calendar tab.</p>
<div class="paragraph">
<p><em>Since 0.6</em></p>
</div>
</dd>
<dt class="hdlist1">edit</dt>
<dd>
<p>Permission to edit a record or field. This also gives access to the edit tab.</p>
<div class="paragraph">
<p><em>Since 0.6</em></p>
</div>
</dd>
<dt class="hdlist1">new</dt>
<dd>
<p>Permission to edit a record or field for the purpose of creating a new record. This permission is required to access the new record form.</p>
<div class="paragraph">
<p><em>Since 0.6</em></p>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p><em>select_rows</em>	Permission to select rows in list view to perform actions on them.</p>
</div>
<div class="paragraph">
<p>+
<em>Since 0.6</em></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">post</dt>
<dd>
<p>Permission to post a record using HTTP POST</p>
<div class="paragraph">
<p><em>Since 0.6</em></p>
</div>
</dd>
<dt class="hdlist1">copy</dt>
<dd>
<p>Permission to copy a record.</p>
<div class="paragraph">
<p><em>Since 0.6</em></p>
</div>
</dd>
<dt class="hdlist1">update_set</dt>
<dd>
<p>Permission to perform an update on a result set (i.e. access the update set action).</p>
<div class="paragraph">
<p><em>Since 0.8</em></p>
</div>
</dd>
<dt class="hdlist1">add new related record</dt>
<dd>
<p>Permission to add a new record to a relationship. See Relationship Permissions</p>
<div class="paragraph">
<p><em>Since 0.6</em></p>
</div>
</dd>
<dt class="hdlist1">add existing related record</dt>
<dd>
<p>Permission to add an existing record to a relationship. See Relationship Permissions</p>
<div class="paragraph">
<p><em>Since 0.6</em></p>
</div>
</dd>
<dt class="hdlist1">view related records</dt>
<dd>
<p>Permission to view the records in a relationship. See Relationship Permissions</p>
<div class="paragraph">
<p><em>Since 1.0</em></p>
</div>
</dd>
<dt class="hdlist1">delete</dt>
<dd>
<p>Permission to delete a record.</p>
<div class="paragraph">
<p><em>Since 0.6</em></p>
</div>
</dd>
<dt class="hdlist1">delete found</dt>
<dd>
<p>Permission to access the delete found set action (to delete multiple records at a time).
<em>Since 0.6</em></p>
</dd>
<dt class="hdlist1">show all</dt>
<dd>
<p>Permission to access show all records action.</p>
<div class="paragraph">
<p><em>Since 0.6</em></p>
</div>
</dd>
<dt class="hdlist1">remove related record</dt>
<dd>
<p>Permission to remove a record from a relationship. See Relationship Permissions</p>
<div class="paragraph">
<p><em>Since 0.6</em></p>
</div>
</dd>
<dt class="hdlist1">delete related record</dt>
<dd>
<p>Permission to delete a record in a relationship. This is stronger than the remove related record permission in that it allows the user to delete the record from the database.</p>
<div class="paragraph">
<p><strong>See Also</strong> <a href="#relationship-permissions">Relationship permissions</a></p>
</div>
<div class="paragraph">
<p><em>Since 0.6</em></p>
</div>
</dd>
<dt class="hdlist1">find</dt>
<dd>
<p>Permission to perform the find action.</p>
<div class="paragraph">
<p><em>Since 0.6</em></p>
</div>
</dd>
<dt class="hdlist1">import</dt>
<dd>
<p>Permission to perform the import action (to import records into the database).</p>
<div class="paragraph">
<p><em>Since 0.6</em></p>
</div>
</dd>
<dt class="hdlist1">export_csv</dt>
<dd>
<p>Permission to perform the Export CSV action (to export the result set in comma-separated-value format).</p>
<div class="paragraph">
<p><em>Since 0.6</em></p>
</div>
</dd>
<dt class="hdlist1">export_xml</dt>
<dd>
<p>Permission to perform the Export XML action (to export the result set as XML).</p>
<div class="paragraph">
<p><em>Since 0.8</em></p>
</div>
</dd>
<dt class="hdlist1">translate</dt>
<dd>
<p>Permission to translate a record into another language. This permission provides access to the "translate" tab.</p>
<div class="paragraph">
<p><em>Since 0.8</em></p>
</div>
</dd>
<dt class="hdlist1">history</dt>
<dd>
<p>Permission to view history information for a record (e.g. the history tab). This requires that history be enabled.</p>
<div class="paragraph">
<p><em>Since 0.8</em></p>
</div>
</dd>
<dt class="hdlist1">edit_history</dt>
<dd>
<p>Permission to edit history information such as undo/redo support for a record.</p>
<div class="paragraph">
<p><em>Since 0.8</em></p>
</div>
</dd>
<dt class="hdlist1">navigate</dt>
<dd>
<p>Permission to navigate through records of a table.</p>
<div class="paragraph">
<p><em>Since 0.6</em></p>
</div>
</dd>
<dt class="hdlist1">reorder_related_records</dt>
<dd>
<p>Permission to reorder the records of a relationship (this is different than just sorting). It sets a default order for the records. Requires the metafields:order directive to be set for the relationship.</p>
<div class="paragraph">
<p><em>Since 0.6</em></p>
</div>
</dd>
<dt class="hdlist1">ajax_save</dt>
<dd>
<p>Permission to save a record through AJAX.</p>
<div class="paragraph">
<p><em>Since 0.8</em></p>
</div>
</dd>
<dt class="hdlist1">ajax_load</dt>
<dd>
<p>Permission to load a record through AJAX.</p>
<div class="paragraph">
<p><em>Since 0.8</em></p>
</div>
</dd>
<dt class="hdlist1">ajax_form</dt>
<dd>
<p>Permission to access the inline editing ajax form for a record.</p>
<div class="paragraph">
<p><em>Since 0.8</em></p>
</div>
</dd>
<dt class="hdlist1">find_list</dt>
<dd>
<p>Permission to search current table.</p>
<div class="paragraph">
<p><em>Since 0.6</em></p>
</div>
</dd>
<dt class="hdlist1">find_multi_table</dt>
<dd>
<p>Permission to perform a site-wide search.</p>
<div class="paragraph">
<p><em>Since 0.8</em></p>
</div>
</dd>
<dt class="hdlist1">register</dt>
<dd>
<p>Permission to register for an account.</p>
<div class="paragraph">
<p><em>Since 0.8</em></p>
</div>
</dd>
<dt class="hdlist1">xml_view</dt>
<dd>
<p>Permission to view a result set as xml.</p>
<div class="paragraph">
<p><em>Since 0.8</em></p>
</div>
</dd>
<dt class="hdlist1">view_xml</dt>
<dd>
<p>View the XML for an individual record.</p>
<div class="paragraph">
<p><em>Since 0.8</em></p>
</div>
</dd>
<dt class="hdlist1">manage_output_cache</dt>
<dd>
<p>Management permission to clear the output cache.</p>
<div class="paragraph">
<p><em>Since 0.8</em></p>
</div>
</dd>
<dt class="hdlist1">manage_migrate</dt>
<dd>
<p>Permission to access the migration tool to migrate between versions.</p>
<div class="paragraph">
<p><em>Since 0.8</em></p>
</div>
</dd>
<dt class="hdlist1">manage</dt>
<dd>
<p>Permission to access the management control panel.</p>
<div class="paragraph">
<p><em>Since 0.8</em></p>
</div>
</dd>
<dt class="hdlist1">manage_build_index</dt>
<dd>
<p>Permission to rebuild the search index.</p>
<div class="paragraph">
<p><em>Since 0.8</em></p>
</div>
</dd>
<dt class="hdlist1">expandable</dt>
<dd>
<p>Whether the record can be expanded in the left nav menu	N/A</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_core_roles">Core Roles</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">READ ONLY</dt>
<dd>
<p><strong>Permissions:</strong> <code>view</code>, <code>list</code>, <code>calendar</code>, <code>view xml</code>, <code>show all</code>, <code>find</code>, <code>navigate</code>, <code>ajax_load</code>, <code>find_list</code>, <code>find_multi_table</code>, <code>rss</code>, <code>export_csv</code>, <code>export_xml</code>, and <code>export_json</code></p>
<div class="paragraph">
<p><em>Since 0.6</em></p>
</div>
</dd>
<dt class="hdlist1">EDIT</dt>
<dd>
<p><strong>Permissions:</strong> All permissions in <code>READ ONLY</code>, and <code>edit</code>, <code>add new related record</code>, <code>add existing related record</code>, <code>add new record</code>, <code>remove related record</code>, <code>reorder_related_records</code>, <code>import</code>, <code>translate</code>, <code>new</code>, <code>ajax_save</code>, <code>ajax_form</code>, <code>history</code>, <code>edit_history</code>, <code>copy</code>, <code>update_set</code>, and <code>select_rows</code></p>
<div class="paragraph">
<p><em>Since 0.6</em></p>
</div>
</dd>
<dt class="hdlist1">DELETE</dt>
<dd>
<p><strong>Permissions:</strong> All permissions in <code>EDIT</code>, and <code>delete</code> and <code>delete found</code>.</p>
<div class="paragraph">
<p><em>Since 0.6</em></p>
</div>
</dd>
<dt class="hdlist1">OWNER</dt>
<dd>
<p><strong>Permissions:</strong> All permissions in <code>DELETE</code> except <code>navigate</code>, <code>new</code>, and <code>delete found</code>.</p>
<div class="paragraph">
<p><em>Since 0.6</em></p>
</div>
</dd>
<dt class="hdlist1">REVIEWER</dt>
<dd>
<p><strong>Permissions:</strong> All permissions in <code>READ ONLY</code>, and <code>edit</code> and <code>translate</code>.</p>
<div class="paragraph">
<p><em>Since 0.6</em></p>
</div>
</dd>
<dt class="hdlist1">USER</dt>
<dd>
<p><strong>Permissions:</strong> All permissions in <code>READ ONLY</code>, and <code>add new related record</code>.</p>
<div class="paragraph">
<p><em>Since 0.6</em></p>
</div>
</dd>
<dt class="hdlist1">ADMIN</dt>
<dd>
<p><strong>Permissions:</strong> All permissions in <code>DELETE</code> and <code>xml_view</code></p>
<div class="paragraph">
<p><em>Since 0.6</em></p>
</div>
</dd>
<dt class="hdlist1">MANAGER</dt>
<dd>
<p><strong>Permissions:</strong> All permissions in <code>ADMIN</code> and <code>manage</code>, <code>manage_output_cache</code>, <code>manage_migrate</code>, <code>manage_build_index</code>, and <code>install</code>.</p>
<div class="paragraph">
<p><em>Since 0.6</em></p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_extending_and_overriding_roles">Extending and Overriding Roles</h4>
<div class="paragraph">
<p>The cleanest and easiest way to define a new role is to extend an existing role. Xataface allows you to extend roles via the <code>extends</code> keyword. For example, if you wanted to create a role <code>TEST ROLE</code> that contained all of the same permissions as the <code>READ ONLY</code> role, you could define it as follows in your application&#8217;s <em>permissions.ini</em> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[TEST ROLE extends READ ONLY]</pre>
</div>
</div>
<div class="paragraph">
<p>If we wanted it to contain the same permissions as <code>READ ONLY</code> but to also allow the edit permission we would define it as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[TEST ROLE extends READ ONLY]
edit=1</pre>
</div>
</div>
<div class="paragraph">
<p>If we wanted to disallow the <code>list</code> permission, we would do something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[TEST ROLE extends READ ONLY]
edit=1
list=0</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_overriding_existing_roles">Overriding Existing Roles</h4>
<div class="paragraph">
<p>You can also redefine existing roles:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[READ ONLY extends READ ONLY]
my_permission=1</pre>
</div>
</div>
<div class="paragraph">
<p>This is handy if you have added your own custom permissions that you feel should be included in a core role.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="appendix-rss-config">RSS Configuration Directives</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section describes the configuration directives and delegate methods that can be used to configure RSS feeds.  See <a href="#rss-feeds">RSS Feeds</a> for an introduction to Xataface&#8217;s RSS feed support.</p>
</div>
<table id="rss-delegate-class-methods" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. RSS Delegate Class Methods</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#rss-getfeeditem"><code>getFeedItem</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For RSS Feeds, overrides the defaults and returns an associative array with feed elements for a particular record</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#rss-getfeed"><code>getFeed</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For RSS feeds, overrides the default feed for a query, returning an array of feed items.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getFeedSource</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Overrides the default feed source parameter for an RSS feed.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getRSSDescription</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Overrides the default generated RSS description for a record.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getSingleRecordSearchFeed</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Overrides the default feed for a subsearch within a record. This works identically to the getFeed method except that it takes 2 parameters: one for the current record, and a second parameter for the query.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.2.3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getEnclosureField</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the name of the field that contains an "enclosure" which can be used for podcasting.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.0</p></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="rss-getfeed"><code>getFeed()</code> Delegate Method</h3>
<h4 id="_synopsis" class="discrete">Synopsis</h4>
<div class="paragraph">
<p>The <code>getFeed()</code> method of a table delegate class or application delegate class returns an associative array of parameters to configure the RSS feed for a particular table . An RSS feed consists of the following components:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>title</code> - The title of the RSS feed as it should appear in the subscribers' feed list.</p>
</li>
<li>
<p><code>description</code> - Describes the RSS feed.</p>
</li>
<li>
<p><code>link</code> - A link to the RSS feed</p>
</li>
<li>
<p><code>syndicationURL</code> - The URL to this RSS feed&#8217;s site.</p>
</li>
</ol>
</div>
<h4 id="_parameters" class="discrete">Parameters</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>array</code> <code>$query</code> - The HTTP query. Contains information like the current table, current action, and search parameters. This allows you to customize your RSS feed depending on the user&#8217;s query parameters.</p>
</li>
<li>
<p>Return Value</p>
<div class="paragraph">
<p>The <code>getFeed()</code> method returns an associative array with the components of the RSS feed. This array does not need to contain all possible keys, or even any keys. Any keys that are omitted will simply use default values in the RSS feed. The array may contain the following keys:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>title</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The title for the RSS feed. If this omitted, it will try to use the title directive of the <code>[_feed]</code> section of the conf.ini file. Failing that, it will try to generate an appropriate title for the feed depending on the current query.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>description</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Description for this RSS feed. If this is omitted, it will try to use the description directive of the [_feed] section of the conf.ini file.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>link</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A link to the source page of the RSS feed. If this is omitted, it will try to use the link directive of the [_feed] section of the conf.ini file.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>syndicationURL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A link to the source page of the RSS feed. If this is omitted, it will try to use the syndicationURL directive of the [_feed] section of the conf.ini file.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.0</p></td>
</tr>
</tbody>
</table>
</li>
</ol>
</div>
<h4 id="_example_2" class="discrete">Example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">function getFeed(&amp;$query){
    return array(
        'title' =&gt; "RSS feed for the ".$query['-table']." table.",
        'description' =&gt; "News and updates for automobiles",
        'link' =&gt; df_absolute_url(DATAFACE_SITE_HREF),
        'syndicationURL' =&gt; df_absolute_url(DATAFACE_SITE_HREF)
    );
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
RSS feeds will work perfectly well without defining this method. This just allows you to customize one or more parameters of the RSS feed.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="rss-getfeeditem"><code>getFeedItem()</code> Delegate Method</h3>
<h4 id="_synopsis_2" class="discrete">Synopsis</h4>
<div class="paragraph">
<p>The <code>getFeedItem()</code> method of a table delegate class returns an associative array of parameters for a record as it should appear as part of an RSS feed. An RSS feed item consists of the following components:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>title</code> - The title of the record as it appears in the RSS feed.</p>
</li>
<li>
<p><code>description</code> - The description of the record for the RSS feed. This is really the body of the RSS feed item.</p>
</li>
<li>
<p><code>link</code> - The linkback URL if users want to know more about the record.</p>
</li>
<li>
<p><code>date</code> - The date that the record was posted/modified.</p>
</li>
<li>
<p><code>author</code> - The name of the person who posted this record.</p>
</li>
<li>
<p><code>source</code> - URL to the site where record originated from.</p>
</li>
</ol>
</div>
<h4 id="_parameters_2" class="discrete">Parameters</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>Dataface_Record</code> <code>&amp;$record</code> - The record that is being represented in an RSS feed.</p>
</li>
</ol>
</div>
<h4 id="_return_value" class="discrete">Return Value</h4>
<div class="paragraph">
<p>The <code>getFeedItem()</code> method returns an associative array with the components of the RSS feed. This array does not need to contain all possible keys, or even any keys. Any keys that are omitted will simply use default values in the RSS feed. The array may contain the following keys:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>title</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The record title as it appears in RSS feeds. If this is omitted, the RSS feed will simply use the output of Dataface_Record&#8217;s getTitle() method.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>description</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The record description. This is used in the main body of the RSS feed. If this is omitted, the RSS feed will use an HTML table that shows all of the field data in the record. This value can also be overridden using the getRSSDescription? method of the delegate class.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>link</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The URL to this record. If this is omitted it just points to the view tab for this record. However you can direct it anywhere you like. When the user clicks on the "More Info" link in his RSS reader it will direct him to this link.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>date</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The date that this record was posted or last modified. This is the date that an RSS reader will use to decide if it has already loaded the record yet. If this is omitted it will try the Dataface_Record&#8217;s getLastModified() method to obtain the last modified date of the record. Failing that, it will use Dataface_Record&#8217;s getCreated() method to try to obtain the creation date of the record. This date should be a unix timestamp.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>author</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the user who posted this record. If this is omitted, then it will try to use <code>Dataface_Record&#8217;s `getCreator()</code> method. Failing that, it will use the value of the default_author parameter in the [_feed] section of the conf.ini file. If that is not defined, then it simply uses the string "Site Administrator".</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>source</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The source URL where the feed is to have originated. If none is specified, then it will use the value of the source parameter in the [_feed] section of the conf.ini file. Failing that, it will simply use the URL to the application.</p>
<p class="tableblock"><strong>Note that you can alternatively define this value using the <code>getFeedSource</code> method.</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>enclosure</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An associative array with keys <code>url</code>, <code>type</code>, and <code>length</code> describing audio or video content that will be used by podcasting apps.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.0</p></td>
</tr>
</tbody>
</table>
<h4 id="_example_3" class="discrete">Example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">function getFeedItem(&amp;$record){
    return array(
        'title' =&gt; "News Item: ".$record-&gt;getTitle(),
        'description' =&gt; $record-&gt;display('News Body'),
        'link' =&gt; $record-&gt;getPublicLink(),
        'date' =&gt; strtotime($record-&gt;val('last_modified')),
        'author' =&gt; $record-&gt;val('posted_by'),
        'source' =&gt; 'http://www.example.com',
        'enclosure' =&gt; array(
            'url' =&gt; 'http://www.example.com/path/to/mypodcast.mp3',
            'length' =&gt; 123456, // in bytes
            'type' =&gt; 'audio/mp3'
        )
    );
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
RSS feeds will work perfectly well without defining this method. This just allows you to customize one or more parameters of the RSS feed.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_thumbnail_handling">Thumbnail Handling</h2>
<div class="sectionbody">
<h3 id="_overview_4" class="discrete">Overview</h3>
<div class="paragraph">
<p>Xataface 3.0 includes automatic thumbnail generation for Container fields.  See the <a href="#generating-thumbnails">Generating Thumbnails</a> recipe for an example of how to use this feature.  You can also refer to the <a href="#fieldsini-directives">Fields.ini Directives</a> section to see the syntax of the  <code>transform</code> and <code>thumbnail.ACTIONAME</code> directives.</p>
</div>
<div class="paragraph">
<p>This section describes the PHP and HTTP APIs for Xataface&#8217;s thumbnail feature.</p>
</div>
<div class="sect2">
<h3 id="_how_it_works">How it works</h3>
<div class="paragraph">
<p>If you add the <code>transform</code> directive to your container field, Xataface will automatically generate thumbnails for images that are uploaded to that field, at the time that they are uploaded.</p>
</div>
<div class="paragraph">
<p>e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">transform="itunes300 fill:300x300; itunes1400 fill:1400x1400"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first thumbnail (in this case itunes300) will be displayed by default whenever displaying this field&#8217;s image.  You can configure a specific thumbnail to be used for a given action using the <code>thumbnail.ACTIONNAME</code> directive.  E.g. If you wanted to use the "itunes1400" thumbnail for the "list" action you would add:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">thumbnail.list=itunes1400</code></pre>
</div>
</div>
<div class="paragraph">
<p>When using <code>Dataface_Record::display($fieldname)</code> and <code>Dataface_Record::htmlValue($fieldname)</code> it will respect these directives.  E.g. If you call <code>$record&#8594;display('myimage')</code> it will return the URL for the "itunes300" thumbnail when called inside a request for most actions, but it will return the URL for the "itunes1400" thumbnail when called inside a request for the "list" action.</p>
</div>
<div class="paragraph">
<p>If you look at the resulting URL generated by the <code>display()</code> method, you&#8217;ll see something like:</p>
</div>
<div class="paragraph">
<p><code>index.php?-action=getBlob&amp;&#8230;&#8203;&amp;-thumb=itunes300</code></p>
</div>
<div class="paragraph">
<p>It is the "-thumb" query parameter at the end that specifies the thumbnail.  If you remove that parameter, it will just return the full-sized image.</p>
</div>
</div>
<div class="sect2">
<h3 id="_php_api">PHP API</h3>
<div class="paragraph">
<p>The <code>Dataface_Record</code> and <code>Datafae_Table</code> classes include a few methods for dealing with thumbnails.  Some of these methods include:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">`Dataface_Record::thumbnail($fieldname, $thumbnailType) : String `</dt>
<dd>
<p>Returns the URL for a thumbnail of the given type of thumbnail.</p>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="title">Getting thumbnail of type itunes1400 for the "logo" field in the record.</div>
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">$imageUrl = $record-&gt;thumbnail('logo', 'itunes1400');
echo $imageUrl;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Output:</p>
</div>
<div class="listingblock">
<div class="title">Output shows that the "-thumb" GET parameter is set to "itunes1400", which is caused by the 2nd parameter of the above <code>thumbnail()</code> call.</div>
<div class="content">
<pre class="highlight"><code class="language-listing" data-lang="listing">http://example.com/index.php?-action=getBlob&amp;...&amp;-thumb=itunes1400</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>Dataface_Record::getThumbnailForAction($fieldname, $actionName) : String</code></dt>
<dd>
<p>Returns the URL for the thumbnail that should be used for the specified action name.  This is configured via the <code>thumbnail.$actionName</code> directive in the fields.ini file.</p>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><strong>Example:</strong></p>
</div>
<div class="listingblock">
<div class="title">fields.ini file definition for the logo field.</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[logo]
Type=container
transform="itunes300 fill:300x300; itunes1400 fill:1400x1400"
thumbnail.list=itunes1400</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">PHP code getting URL for the "logo" field in three different ways.</div>
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">echo $record-&gt;display('logo') ."\n";
echo $record-&gt;getThumbnailForAction('logo', 'list')."\n";
echo $record-&gt;getThumbnailForAction('logo', 'view');</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Output when request was for the "list" action.</div>
<div class="content">
<pre class="highlight"><code class="language-listing" data-lang="listing">http://example.com/index.php?-action=getBlob&amp;...&amp;-thumb=itunes1400 <b class="conum">(1)</b>
http://example.com/index.php?-action=getBlob&amp;...&amp;-thumb=itunes1400 <b class="conum">(2)</b>
http://example.com/index.php?-action=getBlob&amp;...&amp;-thumb=itunes300 <b class="conum">(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><code>display()</code> returns URL with <code>-thumb=itunes1400</code> because of the "thumbnail.list=itunes1400" in the fields.ini file, and because the current request is for the "list" action.</p>
</li>
<li>
<p><code>getThumbnailForAction('logo', 'list')</code> returns "itunes1400" because of the "thumbnail.list" directive in the fields.ini file.</p>
</li>
<li>
<p><code>getThumbnailForAction('logo', 'view')</code> returns "itunes300" because there is no explicit "thumbnail.view" directive in the fields.ini file so it defaults to the first thumbnail type defined in the "transform" directive.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">Output when request is for the "view" action.</div>
<div class="content">
<pre class="highlight"><code class="language-listing" data-lang="listing">http://example.com/index.php?-action=getBlob&amp;...&amp;-thumb=itunes300 <b class="conum">(1)</b>
http://example.com/index.php?-action=getBlob&amp;...&amp;-thumb=itunes1400
http://example.com/index.php?-action=getBlob&amp;...&amp;-thumb=itunes300</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Notice that the output of <code>display()</code> is different when it is executed as part of the "view" action.  In this case it adds the "-thumb=300" GET parameter because that is the effective thumbnail type for this action - no <code>thumbnail.view</code> directive is defined, so it falls back to the first thumbnail type defined in the <code>transform</code> directive.</p>
</li>
</ol>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>Dataface_Record::getThumbnailTypeForAction($fieldname, $actionName) : String</code></dt>
<dd>
<p>Returns the thumbnail type for the given action.  If there is an explicit directive for <code>thumbnail.$actionName</code> in the fields.ini file, then its value will be used.  Otherwise it will return the first thumbnail type defined in the <code>transform</code> directive.</p>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><strong>Example:</strong></p>
</div>
<div class="listingblock">
<div class="title">fields.ini file definition for the logo field.</div>
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[logo]
Type=container
transform="itunes300 fill:300x300; itunes1400 fill:1400x1400"
thumbnail.list=itunes1400</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample PHP code</div>
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">echo $record-&gt;getThumbnailTypeForAction('logo', 'list')."\n";
echo $record-&gt;getThumbnailForTypeAction('logo', 'view');</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample Output</div>
<div class="content">
<pre class="highlight"><code class="language-listing" data-lang="listing">itunes1400 <b class="conum">(1)</b>
itunes300 <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>When <code>$actionName</code> is 'list' it outputs "itunes1400" because of the <code>thumbnail.list=itunes1400</code> directive in the fields.ini file.</p>
</li>
<li>
<p>When <code>$actionName</code> is 'view' it outputs "itunes300" because there is no <code>thumbnail.view</code> directive defined in the fields.ini file so it falls back to the first thumbnail type defined in the <code>transform</code> directive.</p>
</li>
</ol>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>Dataface_Record::hasThumbnail($fieldname, $thumbName) : boolean</code></dt>
<dd>
<p>Checks if a record has a thumbnail of the given type for the specified field.  If the <code>transform</code> directive defines a thumbnail of the given <code>$thumbName</code> but the current record doesn&#8217;t actually have a thumbnail stored of that type, then this will return <code>false</code>.  It only returns true if the record actually has a thumbnail of this type that can be displayed.  E.g. if the field is empty (has no image), then this also returns <code>false</code>.</p>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><strong>Example:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">if ($record-&gt;hasThumbnail('logo', 'itunes1400')) {
    // The record has a thumbnail of itunes1400 type.
    $thumbUrl = $record-&gt;thumbnail('logo', 'itunes1400');
    // ..
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>Dataface_Record::getThumbnailTypes($fieldname) : string[]</code> </dt>
<dd>
<p>Returns a list of the thumbnails that are currently available for this record.  This only includes thumbnail types that actually exist.  It isn&#8217;t sufficient for them to be listed in the <code>transform</code> directive.</p>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><strong>Example:</strong></p>
</div>
<div class="listingblock">
<div class="title">PHP Source</div>
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">$types = $record-&gt;getThumbnailTypes('logo');
print_r($types);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Output</div>
<div class="content">
<pre class="highlight"><code class="language-listing" data-lang="listing">array(
    0 =&gt; itunes300,
    1 =&gt; itunes1400
)</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_appendix_2_delegate_class_methods">Appendix 2: Delegate Class Methods</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_table_delegate_class">Table Delegate Class</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_relationships_methods">Relationships Methods</h3>
<div class="sect3">
<h4 id="delegate-getChildren"><code>getChildren()</code></h4>
<div class="paragraph">
<p>The <code>getChildren()</code> method can be implemented in a table&#8217;s delegate class to specify the logical "child" records of a given record which can be used when creating hierarchical applications. This method will effectively override the output of the <code>Dataface_Record::getChildren()</code> method for records of this table.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Signature</dt>
<dd>
<p><code>function getChildren( Dataface_Record $record) : Dataface_Record[]</code></p>
</dd>
<dt class="hdlist1">Parameters</dt>
<dd>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>$record</code> - The <code>Dataface_Record</code> that is the subject of the query</p>
</li>
</ol>
</div>
</dd>
<dt class="hdlist1">Returns</dt>
<dd>
<p>This method should return an array of <code>Dataface_Record</code> objects that are considered to be children of the subject record.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><strong>Examples</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">function getChildren($record){
    return df_get_records('webpages', [
        'parent_id'=&gt;'='.$record-&gt;val('webpage_id')
    ]);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>See Also</strong> <a href="#delegate-getParent"><code>getParent()</code></a></p>
</div>
</div>
<div class="sect3">
<h4 id="delegate-getParent"><code>getParent()</code></h4>
<div class="paragraph">
<p>A Delegate class method to return the logical parent of a given record.</p>
</div>
</div>
<div class="sect3">
<h4 id="delegate-relationshipname__getAddableValues"><code>relationshipname__getAddableValues()</code></h4>
<div class="paragraph">
<p>Returns array of addable values when adding existing records to relationships.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_appendix_3_javascript_environment">Appendix 3: Javascript Environment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Xataface defines a small set of Javascript events to notify subscribers of lifecycle events.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_javascript_components">Javascript Components</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Xataface includes a set of Javascript components that can be reused in many different contexts.  This section lists some of theme.</p>
</div>
<div class="paragraph">
<p>TODO: Add documentation on javascript components</p>
</div>
<div class="sect2">
<h3 id="_window_xataface">window.xataface</h3>
<div class="paragraph">
<p>The <code>window.xataface</code> object includes a number of utility classes and functions.  Some functions are always available.  Others require you to explicitly to load a script in order for them to be available.</p>
</div>
<h4 id="_properties" class="discrete">Properties</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">viewport</dt>
<dd>
<p>The current display viewport dimensions.  If the mobile footer and header are visible, then this viewport will be the bounds not covered by the header or footer.  Properties include <code>top</code>, <code>left</code>, <code>right</code>, <code>bottom</code>, <code>width</code>, and <code>height</code>.</p>
<div class="listingblock">
<div class="title">Example Using viewport to position an element</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">var viewport = xataface.viewport;
if (viewport) {
    // Position the settings wrapper 10 pixels above the footer
    settingsWrapper.style.bottom = (viewport.bottom + 10) + 'px';
}</code></pre>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="action-sheet">xataface.ActionSheet</h3>
<div class="imageblock">
<div class="content">
<img src="images/ActionSheet.png" alt="ActionSheet">
</div>
</div>
<div class="paragraph">
<p>A component for displaying menu in a Sheet.  ActionSheets can be displayed from the bottom, left, top, or right positions, and they transition in over top of the existing page content.</p>
</div>
<div class="paragraph">
<p><strong>Since 3.0</strong></p>
</div>
<h4 id="_bootstrapping" class="discrete">Bootstrapping</h4>
<div class="listingblock">
<div class="title">Loading Script in PHP</div>
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">xf_script('xataface/components/ActionSheet.js');</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Loading Script in Javascript using <code>require</code></div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">//require &lt;xataface/components/ActionSheet.js&gt;</code></pre>
</div>
</div>
<h4 id="_initialization_options" class="discrete">Initialization Options</h4>
<div class="paragraph">
<p>Use <code>new ActionSheet(options)</code> to create a new sheet.  The following options are allowed:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">modelEl</dt>
<dd>
<p><code>HTMLElement</code> of a <code>&lt;ul&gt;</code> tag that defines the menu options to appear in this sheet.  See <a href="#modelEl-structure">Structure of the <code>modelEl</code> <code>&lt;ul&gt;</code> tag.</a>.</p>
</dd>
<dt class="hdlist1">position</dt>
<dd>
<p>The position where the sheet should be displayed. <code>top</code>, <code>left</code>, <code>right</code>, <code>bottom</code>.</p>
</dd>
<dt class="hdlist1">parent</dt>
<dd>
<p>Optional <code>ActionSheet</code> that is the parent of this <code>ActionSheet</code>.  If this property is provided then the sheet will have a "back" button to navigate back to the parent instead of a "close" button.</p>
</dd>
</dl>
</div>
<h5 id="_alternative_intialization_options" class="discrete">Alternative Intialization Options</h5>
<div class="paragraph">
<p>The <code>ActionSheet</code> constructor can also be called simply with single <code>String</code> or <code>HTMLElement</code> argument.  In the <code>String</code> case, the string will be interpreted as the query selector to the <code>&lt;ul&gt;</code> tag to use for the <code>modelEl</code> property.  In the <code>HTMLElement</code> case, it will be used as the <code>modelEl</code> property itself.</p>
</div>
<div id="modelEl-structure" class="sidebarblock">
<div class="content">
<div class="title">Structure of the <code>modelEl</code> <code>&lt;ul&gt;</code> tag.</div>
<div class="paragraph">
<p>The <code>modelEl</code> property should be an <code>HTMLElement</code> <code>&lt;ul&gt;</code> tag.  The menu options are constructed based on the <code>&lt;li&gt;</code> items inside the <code>&lt;ul&gt;</code> tag.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Each <code>&lt;li&gt;</code> tag may include an <code>&lt;a&gt;</code> tag, which defines where the menu links to.</p>
</li>
<li>
<p>The nested <code>&lt;a&gt;</code> tag may contain a <code>&lt;span&gt;</code> tag which will be used as the menu item label.</p>
</li>
<li>
<p>The nested <code>&lt;a&gt;</code> tag may also include an <code>&lt;i&gt;</code> with class "material-icons" which specifies a material icon to use in the menu item.</p>
</li>
<li>
<p>The <code>&lt;li&gt;</code> tag may also include a <code>&lt;ul&gt;</code> tag which will be treated as a sub-menu.  This <code>&lt;ul&gt;</code> tag should not be nested inside the <code>&lt;a&gt;</code> tag.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">&lt;ul&gt;
    &lt;li&gt;
        &lt;a href="index.html"&gt;
            &lt;i class="material-icons"&gt;home&lt;/i&gt;
            &lt;span&gt;Home&lt;/span&gt;
        &lt;/a&gt;
    &lt;/li&gt;
    &lt;li&gt;
        &lt;a href="about.html"&gt;
            &lt;i class="material-icons"&gt;info&lt;/i&gt;
            &lt;span&gt;About&lt;/span&gt;
        &lt;/a&gt;
    &lt;/li&gt;
    &lt;li&gt;
        &lt;a href="javascript:void(0)" onclick="sayHello()"&gt;
            &lt;i class="material-icons"&gt;help&lt;/i&gt;
            &lt;span&gt;Say Hello&lt;/span&gt;
        &lt;/a&gt;
    &lt;/li&gt;
    &lt;li&gt;
        &lt;span&gt;More Options&lt;/span&gt;
        &lt;ul&gt;
            &lt;li&gt;
                &lt;a href="subpage1.html"&gt;Subpage 1&lt;/a&gt;
            &lt;/li&gt;
            &lt;li&gt;
                &lt;a href="subpage2.html"&gt;Subpage 2&lt;/a&gt;
            &lt;/li&gt;
        &lt;/ul&gt;
&lt;/ul&gt;
    &lt;/li&gt;
&lt;/ul&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example demonstrates a fairly simple menu that includes one sub-menu.  Notice that the "sayHello" option uses an <code>onclick</code> handler instead of an "href" attribute.  This is fine.  When the <code>ActionSheet</code> constructs its menu based on this model, it will call <code>click()</code> on the actual modelEl&#8217;s <code>&lt;a&gt;</code> tag, so that clicking on the option in the <code>ActionSheet</code> is pretty much the same as having clicked on the <code>modelEl</code> element link itself.</p>
</div>
</div>
</div>
<h4 id="_properties_2" class="discrete">Properties</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">parent</dt>
<dd>
<p>Reference to the parent <code>ActionSheet</code> instance, if one was provided in the constructor.</p>
</dd>
</dl>
</div>
<h4 id="_methods" class="discrete">Methods</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">show(initialHeight)</dt>
<dd>
<p>Show the sheet.  Takes optional <code>int</code> parameter <strong>initialHeight</strong> specifying the starting height of the ActionSheet.  This is used internally when showing a submenu so that the transition to and from the child menu is smooth.</p>
</dd>
<dt class="hdlist1">close(all)</dt>
<dd>
<p>Close the sheeet.  Takes optional <code>boolean</code> argument <strong>all</strong> which, if true, will close all parent sheets as well.  Default behaviour is to navigate back to the parent if the sheet has a parent.</p>
</dd>
</dl>
</div>
<h4 id="_usage_example" class="discrete">Usage Example</h4>
<div class="listingblock">
<div class="title">Example implementation for the FAB button which opens the page actions menu.</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">//require &lt;xataface/components/ActionSheet.js&gt;
(function() {
    var ActionSheet = window.xataface.ActionSheet;

    /**
     * Function to install the FAB button.
     * This will be called after the page is finished loading.
     * See DOMContentLoaded event listener registration below.
     */
    function installFab() {
        // Convenience reference to jQuery
        var $ = jQuery;

        // Add a click handler to the zoom button.
        $('#zoomBtn').click(function() {

            // Get the page actions &lt;ul&gt; tag that
            // was rendered elsewhere on the page.  This is a standard
            // menu that is used in the Desktop theme that includes
            // all of the actions that are relevant to the current page.
            // The menu is hidden in the mobile theme, but we'll use
            // it as the model for the FAB button here so that its
            // actions can still be used in mobile.
            var pageActionsUl = $('div.page-actions &gt; nav &gt; ul').first();
            if (pageActionsUl.length &gt; 0) {
                var menu = new ActionSheet(pageActionsUl.get(0));
                menu.show();
            }

        });

        // The "zoom" section has a `display:none` style directive
        // in the HTML template so that it isn't displayed before
        // we've had a chance to set it up.
        // Remove that style directive now that it should be all set up.
        $('.zoom').css('display', '');
    }

    // Some code omitted here for clarity

    window.addEventListener('DOMContentLoaded', installFab);
})();</code></pre>
</div>
</div>
<div class="paragraph">
<p>That example references some HTML tags that are defined in the <code>Dataface_Main_Template.html</code> template.  Let&#8217;s look at those here.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>div.page-actions &gt; nav &gt; ul</code></dt>
<dd>
<p>This is a reference to the page actions.  They are rendered in the HTML template as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">&lt;div class='page-actions'&gt;
    {block name="before_menus"}
    {define_slot name="menus"}
        {include file="Dataface_TableView_menus.html"}
    {/define_slot}
    {block name="after_menus"}
&lt;/div&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the <code>Dataface_TableView_menus.html</code> renders a <code>&lt;ul&gt;</code> tag with the menus.</p>
</div>
</dd>
<dt class="hdlist1"><code>#zoomBtn</code> and <code>.zoom</code></dt>
<dd>
<p>These are references to the zoom section and button defined in the template as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">{define_slot name="fab"}
    {*
        The FAB (floating action button), which uses the table_actions_menu
        category.

        Exclude actions from the FAB using the #large# tag in the action.
        Include actions in the FAB by adding materialIcon. If action doesn't
        have materialIcon, it won't be included in the FAB.

    *}

     {script src="xataface/fab.js"}
     &lt;div class="zoom mobile" style="display:none"&gt;
         &lt;a class="zoom-fab zoom-btn-large" id="zoomBtn"&gt;
            &lt;i class="material-icons"&gt;menu&lt;/i&gt;
         &lt;/a&gt;

     &lt;/div&gt;

{/define_slot}</code></pre>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="showInfiniteProgress">xataface.showInfiniteProgress()</h3>
<div class="paragraph">
<p>Shows an infinite progress indicator.  This is helpful if you are performing an action that takes a few seconds and you want to convey to the user that the app is doing something.</p>
</div>
<div class="paragraph">
<p>Use <a href="#hideInfiniteProgress">xataface.hideInfiniteProgress()</a> to hide the progress indicator when you are done with it.</p>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">xataface.showInfiniteProgress();
var onTaskComplete = function() {
    xataface.hideInfiniteProgress();
}
// Call a long-running task which takes a callback function which
// will be called when it completes
doSomeLongRunningTask(onComplete);</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Parameters</strong></p>
</div>
<div class="paragraph">
<p>Both <code>showInfiniteProgress</code> and <a href="#hideInfiniteProgress">xataface.hideInfiniteProgress()</a> take an optional argument that is a DOM element inside which the progress indicator should be placed.  If this is omitted, the progress indicator is added to the document body and is displayed in the center of the screen.</p>
</div>
<div class="paragraph">
<p><strong>Returns</strong></p>
</div>
<div class="paragraph">
<p>The progress indicator&#8217;s DOM element.</p>
</div>
<div class="paragraph">
<p><strong>Since 3.0</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="hideInfiniteProgress">xataface.hideInfiniteProgress()</h3>
<div class="paragraph">
<p>Hides an infinite progress indicator that has been previously shown using <a href="#showInfiniteProgress">xataface.showInfiniteProgress()</a>.</p>
</div>
<div class="paragraph">
<p><strong>Since 3.0</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="_xataface_infinitescroll">xataface.InfiniteScroll</h3>
<div class="paragraph">
<p>A component that supports infinite scrolling.  This is used by default in the mobile theme&#8217;s list view.</p>
</div>
<div class="paragraph">
<p><strong>Since 3.0</strong></p>
</div>
<h4 id="_bootstrapping_2" class="discrete">Bootstrapping</h4>
<div class="listingblock">
<div class="title">Loading Script in PHP</div>
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">xf_script('xataface/components/InfiniteScroll.js');</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Loading Script in Javascript using <code>require</code></div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">//require &lt;xataface/components/InfiniteScroll.js&gt;</code></pre>
</div>
</div>
<h4 id="_properties_3" class="discrete">Properties</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">scrollEl</dt>
<dd>
<p>HTMLElement to which the scroll listener should be added.  Defaults to <code>&lt;body&gt;</code></p>
</dd>
<dt class="hdlist1">parentEl</dt>
<dd>
<p>HTMLElement that should have elements added to it.  Defaults to the <code>.mobile-listing</code> div, which is the result list in mobile view.</p>
</dd>
<dt class="hdlist1">action</dt>
<dd>
<p>The Xataface action to use for fetching new rows.</p>
</dd>
<dt class="hdlist1">pageSize</dt>
<dd>
<p>The number of records to load each time.  Default is 30.</p>
</dd>
</dl>
</div>
<h4 id="_methods_2" class="discrete">Methods</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">loadMore()</dt>
<dd>
<p>Loads the next page of results.  If either no rows are loaded, or there is a problem loading rows (due to a network error), the InfiniteScroll&#8217;s <code>reachedEnd</code> flag is set, which will prevent it from attempting to load any more records.</p>
</dd>
</dl>
</div>
<h4 id="_usage_example_2" class="discrete">Usage Example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">new xataface.InfiniteScroll({
   scrollEl : $('body').get(0),
   parentEl : $('.mobile-listing').get(0)
});</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="recordbrowser">xataface.RecordBrowser</h3>
<div class="imageblock">
<div class="content">
<img src="images/Image-291220-115848.591.png" alt="Image 291220 115848.591">
</div>
</div>
<div class="paragraph">
<p>A component for selecting a record from the database.  This is used by the lookup widget for selecting records, but can be used directly via its Javascript API.</p>
</div>
<div class="paragraph">
<p><strong>Since 1.0</strong></p>
</div>
<h4 id="_bootstrapping_3" class="discrete">Bootstrapping</h4>
<div class="listingblock">
<div class="title">Loading Script in PHP</div>
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">xf_script('RecordBrowser/RecordBrowser.js)');</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Loading Script in Javascript using <code>require</code></div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">//require &lt;RecordBrowser/RecordBrowser.js&gt;</code></pre>
</div>
</div>
<h4 id="_initialization_options_2" class="discrete">Initialization Options</h4>
<div class="paragraph">
<p>Use <code>new RecordBrowser(options)</code> to create a new dialog, and display it with the <code>display()</code> method.  The options are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">table</dt>
<dd>
<p>The name of the table from which to select records.</p>
</dd>
<dt class="hdlist1">value</dt>
<dd>
<p>The name of the column to use for the value in the select list.  Set this value to <code>__id__</code> to use the record ID.  Default, if left blank:  If primary key of table is a single column then it will use the primary key column. If the table has a compound primary key, then it uses <code>__id__</code> as the default.</p>
<div class="paragraph">
<p>You can use the optional <code>display:</code> prefix for the value to use the result of <code>Dataface_Record::display()</code> for the field rather than simply <code>Dataface_Record::val()</code>.  E.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">new xataface.RecordBrowser({
    value : 'display:file'
    //...
});</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">text</dt>
<dd>
<p>The name of the column to use for the text/label in the select list.  Set this value to <code>__title__</code> to use the record title.  This is the default, if left blank.</p>
</dd>
<dt class="hdlist1">image</dt>
<dd>
<p>Optional column containing an image.  If you set this value, then each row in the select list will also display an image.</p>
</dd>
<dt class="hdlist1">imageWidth</dt>
<dd>
<p>Optional image width in pixels.</p>
</dd>
<dt class="hdlist1">imageHeight</dt>
<dd>
<p>Optional image height in pixels.</p>
</dd>
<dt class="hdlist1">filters</dt>
<dd>
<p>Dictionary if filters to add to the AJAX requests.  You can use Xataface&#8217;s URL conventions here.</p>
</dd>
<dt class="hdlist1">callback</dt>
<dd>
<p>Callback function that is called when the user selects a record from the record browser. It will receive an Object with key/value pairs of the selected records, where the "keys" are the values and the values are the text.</p>
</dd>
<dt class="hdlist1">editParams</dt>
<dd>
<p>Dictionary of GET parameters to pass to the edit form for editing records in the record browser.</p>
</dd>
<dt class="hdlist1">newParams</dt>
<dd>
<p>Dictionary of GET parameters to pass to the new record form for adding new records.</p>
</dd>
<dt class="hdlist1">allowAddNew</dt>
<dd>
<p>boolean value indicating whether the record browser supports adding new records.  Default is <code>true</code>.  If true, then an "Add New" button is included in the dialog.  When the user clicks on it, it will open a New Record Form inside a <code>RecordDialog</code> component.</p>
</dd>
</dl>
</div>
<h4 id="_methods_3" class="discrete">Methods</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">display()</dt>
<dd>
<p>Displays the dialog.</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="recordbrowser-example">Usage Example</h4>
<div class="listingblock">
<div class="title">A simple example implementing  function, <code>uploadCoverArt()</code> which can be triggered to allow the user to select records from the <code>nn_media</code> table.</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">//require &lt;jquery.packed.js&gt;
//require &lt;RecordBrowser/RecordBrowser.js&gt;
(function() {
    var $ = jQuery;
    window.uploadCoverArt = function(button) {

        // Callback function that will be called with the user
        // selects a record.
        function callback(data) {
            // the data will contain something like:
            // {'admin.php?-action=getBlob&amp;...&amp;-thumb=itunes300' : 'doc-martin.jpeg'}

            // Find the parent div with the "field" class.
            var fieldDiv = $(button).parents('.field');

            // Find the text input in this field.
            var textInput = fieldDiv.find('input[type=text]');

            for (var url in data) {
                // We put this in a for loop, but really
                // data should only contain one value.
                textInput.val(url);
            }
        }

        // Create a new record browser.
        new xataface.RecordBrowser({
            // Browse only records in the nn_media table
            table : 'nn_media',

            // The "file" column contains an image for the record.
            // use that in the browser.
            image : 'file',

            // The value column (which we are interested in) is the
            // file column.  We use the `display` operation to get the result of
            // $record-&gt;display('file') instead of just $record-&gt;val('file')
            value : 'display:file',

            // The callback to call when the user selects a record.
            callback : callback

        }).display();

    }
})();</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In the above example, we called this <code>uploadCoverArt()</code> by adding <code>onclick=window.uploadCoverArt(this)</code> to an action.  See <a href="#field-actions">Adding Actions to Fields</a> for more details on this specific example.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sheet">xataface.Sheet</h3>
<div class="imageblock">
<div class="content">
<img src="images/Image-160820-125111.003.png" alt="Image 160820 125111.003">
</div>
</div>
<div class="paragraph">
<p>A component for displaying content in a Sheet.  Sheets can be displayed from the bottom, left, top, or right positions, and they transition in over top of the existing page content.</p>
</div>
<div class="paragraph">
<p><strong>Since 3.0</strong></p>
</div>
<h4 id="_bootstrapping_4" class="discrete">Bootstrapping</h4>
<div class="listingblock">
<div class="title">Loading Script in PHP</div>
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">xf_script('xataface/components/Sheet.js');</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Loading Script in Javascript using <code>require</code></div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">//require &lt;xataface/components/Sheet.js&gt;</code></pre>
</div>
</div>
<h4 id="_initialization_options_3" class="discrete">Initialization Options</h4>
<div class="paragraph">
<p>Use <code>new Sheet(options)</code> to create a new sheet.  The following options are allowed:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">position</dt>
<dd>
<p>The position where the sheet should be displayed. <code>top</code>, <code>left</code>, <code>right</code>, <code>bottom</code>.</p>
</dd>
<dt class="hdlist1">url</dt>
<dd>
<p>The URL to load in the sheet.  <strong>String</strong></p>
</dd>
</dl>
</div>
<h4 id="_properties_4" class="discrete">Properties</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">installed</dt>
<dd>
<p>A read-only property indicating whether the sheet is currently installed in the document.</p>
</dd>
<dt class="hdlist1">position</dt>
<dd>
<p>The position where the sheet should be displayed in the window. One of 'top', 'bottom', 'left', 'right', or 'fill'.</p>
</dd>
</dl>
</div>
<h4 id="_methods_4" class="discrete">Methods</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">load(url:string)</dt>
<dd>
<p>Load the given URL inside the Sheet.  This will be loaded inside an iframe.</p>
</dd>
<dt class="hdlist1">show()</dt>
<dd>
<p>Show the sheet.</p>
</dd>
<dt class="hdlist1">close()</dt>
<dd>
<p>Close the sheeet</p>
</dd>
</dl>
</div>
<h4 id="_usage_example_3" class="discrete">Usage Example</h4>
<div class="listingblock">
<div class="title">Function that opens the sort options dialog inside a sheet.</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">//require &lt;xataface/actions/Sheet.js&gt;

// ...

function openSortDialog() {
    var qStr = window.location.search;
    if (qStr.indexOf('-action=') !== -1) {
        qStr = qStr.replace(/-action=[^&amp;]*/, '-action=mobile_sort_dialog');
    } else {
        qStr += '&amp;-action=mobile_sort_dialog';
    }
    var sheet = new xataface.Sheet({
        url : qStr
    });
    sheet.show();
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>A simple way to open a link inside a sheet is to add the <code>data-xf-sheet-position</code> attribute to an <code>&lt;a&gt;</code> tag in your HTML.  E.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">&lt;a href="https://xataface.com" data-xf-sheet-position="fill"&gt;Open Xataface Site in Sheet&lt;/a&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>All positions supported by the <code>Sheet.position</code> property are supported by the <code>data-xf-sheet-position</code> attribute.</p>
</div>
</td>
</tr>
</table>
</div>
<h2 id="javascript-events" class="discrete">Javascript Events</h2>
<div class="dlist">
<dl>
<dt class="hdlist1">xf-mobileenter</dt>
<dd>
<p>Triggered on the <code>window</code> object when transitioning from "desktop" mode to "mobile" mode.  See <a href="#responsive-ui">Responsive UI</a> for more information about mobile mode.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">window.addEventListener('xf-mobileenter', function() {
    // Entering mobile mode
});</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">xf-mobileexit</dt>
<dd>
<p>Triggered on the <code>window</code> object when transitioning from "mobile" mode to "desktop" mode. See <a href="#responsive-ui">Responsive UI</a> for more information about mobile mode.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">window.addEventListener('xf-mobileexit', function() {
    // Exiting mobile mode
});</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">xf-viewport-changed</dt>
<dd>
<p>Triggered in mobile mode when the viewport area is changed.  The viewport is considered the area below the <strong>mobile-header</strong> and <strong>mobile-footer</strong> blocks, which are positioned "fixed" at the top and bottom of the screen respectively.  This event will allow you to reposition components whose position should depend on the size of the view port.</p>
<div class="paragraph">
<p>One example use of this event is the FAB button that needs to be positioned in the bottom-right corner of the viewport.  The following Javascript code will reposition the FAB whenever the viewport size is changed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">function updatePosition() {
    var zoom = document.querySelector('.zoom');

    if (zoom) {
        var footer = document.querySelector('.mobile-footer');
        if (footer) {
            zoom.style.bottom = (footer.offsetHeight + 10) + "px";
        }
    }
}
window.addEventListener('xf-viewport-changed', updatePosition);</code></pre>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_appendix_4_url_conventions">Appendix 4: URL Conventions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Xataface adheres to a few simple URL conventions for all of its actions. When you understand how Xataface URLs work you begin to get far more out of your applications. By specifying the appropriate query parameters to can jump directly to any point in your application, or produce a specific result set.</p>
</div>
<div class="paragraph">
<p>For example, the URL <code>index.php?-table=people</code> will take you to the people table (and since the default action for a Xataface application is list, it will take you to the list view.</p>
</div>
<div class="paragraph">
<p>You could be more explicit by specifying the action in the URL directly:</p>
</div>
<div class="paragraph">
<p><code>index.php?-table=people&amp;-action=list</code></p>
</div>
<div class="paragraph">
<p>This would take you to the same screen. From this example, you see that you can specify such things as the table and action via GET parameters. Xataface accepts many more GET parameters also, as you&#8217;ll see in the next section.</p>
</div>
<h2 id="_available_get_parameters" class="discrete">Available GET Parameters</h2>
<div class="dlist">
<dl>
<dt class="hdlist1">-action</dt>
<dd>
<p>Specifies the action to perform. E.g. browse, list, find, edit, new, &#8230;&#8203; etc..	Default value is "list".</p>
<div class="paragraph">
<p><strong>Since 0.1</strong></p>
</div>
</dd>
<dt class="hdlist1">-table</dt>
<dd>
<p>The name of the table to use as the context table.	Defaults to the first table in the <code>[_tables]</code> section of your conf.ini file.</p>
<div class="paragraph">
<p><strong>Since 0.1</strong></p>
</div>
</dd>
<dt class="hdlist1">-skip</dt>
<dd>
<p>Skip a certain number of results in the current found set to display. E.g. If there are 100 records in the table and you want to start browsing from the 30th record, you would set <code>-skip=29</code>.</p>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Not to be confused with the <code>-cursor</code> parameter which is used to specify which record to view in the "details" tab.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Default value: 0</p>
</div>
<div class="paragraph">
<p><strong>Since 0.1</strong></p>
</div>
</dd>
<dt class="hdlist1">-limit</dt>
<dd>
<p>The maximum number of records in the found set to display.	Default value: 30</p>
<div class="paragraph">
<p><strong>Since 0.1</strong></p>
</div>
</dd>
<dt class="hdlist1">-cursor</dt>
<dd>
<p>The index of the record in the current found set that is treated as the "current" record. This is used in the details tab to identify which record to act on. E.g. which record to view or edit.	Default value is 0</p>
<div class="paragraph">
<p><strong>Since 0.1</strong></p>
</div>
</dd>
<dt class="hdlist1">-sort</dt>
<dd>
<p>A comma-delimited list of columns to sort the result set on. Optionally specify descending or descending by adding " asc" or " desc" to the column.  E.g. <code>-sort=first_name+asc,height+desc</code>.  If no sort is specified, it will not sort the results.</p>
<div class="paragraph">
<p><strong>Since 0.1</strong></p>
</div>
</dd>
<dt class="hdlist1">-relationship</dt>
<dd>
<p>If we are browsing related records, this specifies the name of the relationship.</p>
<div class="paragraph">
<p><strong>Since 0.1</strong></p>
</div>
</dd>
<dt class="hdlist1">-related:start</dt>
<dd>
<p>If we are browsing related records, this is the first record in the relationship to show.	Defaults value: 0</p>
<div class="paragraph">
<p><strong>Since 0.1</strong></p>
</div>
</dd>
<dt class="hdlist1">-related:limit</dt>
<dd>
<p>If we are browsing related records, this is the number of records to show per page.	Default value:30</p>
<div class="paragraph">
<p><strong>Since 0.1</strong></p>
</div>
</dd>
<dt class="hdlist1">-search</dt>
<dd>
<p>A keyword search term to filter the found set on. Any row containing any field that matches the query will be returned.</p>
<div class="paragraph">
<p><strong>Since 0.1</strong></p>
</div>
</dd>
<dt class="hdlist1">--no-query=1</dt>
<dd>
<p>A flag to indicate that xataface should not query the database by default. This flag is used in the new record form to prevent the form parameters from being interpreted as query parameters to search in the database. If you set this flag, it likely result in a message saying "No records found". Generally you would only use this in a custom action where you are not relying on Xataface&#8217;s default found set.</p>
<div class="paragraph">
<p><strong>Since 1.3</strong></p>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>There are many other GET parameters that are used in various contexts but the above parameters are available throughout the entire application.</p>
</div>
<h2 id="_finding_records_using_the_url" class="discrete">Finding Records using the URL</h2>
<div class="paragraph">
<p>Notice that all of the GET parameters mentioned in the previous section begin with a hyphen (i.e. '-'). This is a convention Xataface uses to distinguish directives from search queries. All parameters that do not begin with '-' are treated as a query to filter the found set.</p>
</div>
<div class="paragraph">
<p>For example, <code>first_name=bob</code> used as a GET parameter would cause the found set to be filtered so that only records where the first_name column contains the phrase "bob" are returned. Putting this all together, suppose we wanted to show the list tab for the people table, but only wanted to show the people with first names containing "bob":</p>
</div>
<div class="paragraph">
<p><code>index.php?-action=list&amp;-table=people&amp;first_name=bob</code></p>
</div>
<h3 id="_exact_range_and_pattern_matching" class="discrete">Exact, Range, and Pattern Matching</h3>
<div class="paragraph">
<p>By default, queries on text columns look for partial matches. I.e. if you search for "bob" it will match "bob", "bobby", "rubob", and any other text that contains "bob". If you are only interested in finding records that match exactly "bob", then you can prepend an "=" to the query. E.g. first_name==bob, or the full URL:</p>
</div>
<div class="paragraph">
<p><code>index.php?-action=list&amp;-table=people&amp;first_name==bob</code></p>
</div>
<div class="paragraph">
<p>This should show the list tab for the people table with only records with first name exactly "bob".</p>
</div>
<div class="paragraph">
<p>There are a number of modifiers that you can prepend to your query to modify how it is executed. They are as follows:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Search operators</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Prefix</th>
<th class="tableblock halign-left valign-top">Usage Example</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">age=&gt;10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Match records greater than search parameter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">age=&lt;10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Match records less than search parameter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">age=&gt;=10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Match records greater than or equal to the search parameter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">age=&lt;=10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Match records less than or equal to the search parameter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">..</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">age=10..20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Match records in a given range.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">first_name==bob</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Match records that exactly match the search parameter (if there is no prefix then it will search for partial matches on text/varchar/char fields.).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">~</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">first_name=~a%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exact match, but you can include wildcards such as '%' and '?' in your search.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">!=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">first_name=!=bob</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Match records that do NOT match the search parameter. (Same as &lt;&gt;)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">first_name=&lt;&gt;bob</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Match records that do NOT match the search parameter. (Same as !=)</p></td>
</tr>
</tbody>
</table>
<h3 id="_search_examples" class="discrete">Search Examples</h3>
<div class="paragraph">
<p>Given the following data set:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">first_name</th>
<th class="tableblock halign-left valign-top">age</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bob</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cindy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Julie</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jake</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kabob</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Here are some example queries on this data set and their results:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Query</th>
<th class="tableblock halign-left valign-top">Matches</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">age=&gt;10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">match records where age is greater than 10. This includes Cindy and Kabob.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">age=&lt;10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">match records where age is less than 10. This includes Julie and Jake</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">age=&gt;=10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">match records where age is greater or equal to 10. This includes Bob, Cindy, and Kabob.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">age=&lt;=10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">match records where age is less than or equal to 10. This includes Bob, Julie, and Jake.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">age=8..10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">match records where age is between 8 and 10. This includes Bob and Jake.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">first_name=bob</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Matches records where first_name contains "bob". This includes Bob and Kabob.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">first_name==bob</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Matches records where first_name is exactly "bob". This includes Bob only.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">first_name=~J%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Matches records that begin with "J". This includes Jake and Julie</p></td>
</tr>
</tbody>
</table>
<h3 id="_matching_on_related_records" class="discrete">Matching on Related Records</h3>
<div class="paragraph">
<p>It is also possible to match records based on their related data (i.e. data that is not physically stored in the record itself, but in related records via a relationship). For example if we want to find authors who have written about a particular topic, we would normally have to first find all of the articles that contain a topic, and then cross-reference that result against the authors table. With Xataface we can perform this query directly from the authors table using something like the following query:</p>
</div>
<div class="paragraph">
<p><code>index.php?-table=authors&amp;articles/title=sports</code></p>
</div>
<div class="paragraph">
<p>This assumes that the authors table has a relationship named articles that contains all of the articles that an author has written. So the above query returns precisely those authors who have written at least one article whose title field contains the phrase "sports".</p>
</div>
<h4 id="_anatomy_of_a_related_query" class="discrete">Anatomy of a Related Query</h4>
<div class="paragraph">
<p><code>%relationship%/%field%=%query%</code></p>
</div>
<div class="paragraph">
<p>This matches all records in the current table such that at least one record in its <code>&lt;relationship&gt;</code> relationship matches the query: <code>%field%=%query%</code>.</p>
</div>
<h3 id="_using_the_or_operator" class="discrete">Using the "OR" Operator</h3>
<div class="paragraph">
<p>Xataface allows you to search for more than one value at a time using the OR operator. E.g.</p>
</div>
<div class="paragraph">
<p><code>first_name=bob+OR+steve</code></p>
</div>
<div class="paragraph">
<p>Would match all records with first_name containing "bob" or "steve".</p>
</div>
<div class="paragraph">
<p><code>first_name=bob+OR+=steve</code></p>
</div>
<div class="paragraph">
<p>Would match all records with first_name containing "bob" or exactly matching "steve"</p>
</div>
<div class="paragraph">
<p><code>age=&lt;10+OR+&gt;20</code></p>
</div>
<div class="paragraph">
<p>Would match all records with age less than 10 or greater than 20.</p>
</div>
<h3 id="_combining_multiple_queries_in_one_request" class="discrete">Combining Multiple Queries in One Request</h3>
<div class="paragraph">
<p>Xataface allows you to filter on more than one field at a time. If you combine multiple queries in the same request it has the effect of strengthening the filter, matching only those rows that match both queries. E.g.</p>
</div>
<div class="paragraph">
<p><code>age=&gt;10&amp;first_name=bob</code></p>
</div>
<div class="paragraph">
<p>would match all records where age is greater than 10 AND that have first_name containing "bob".</p>
</div>
<h4 id="_examples_of_combined_queries" class="discrete">Examples of Combined Queries</h4>
<div class="paragraph">
<p>Given the same data set as the previous set of examples:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">first_name</th>
<th class="tableblock halign-left valign-top">age</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bob</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cindy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Julie</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jake</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kabob</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><code>first_name=bob&amp;age=11</code></p>
</div>
<div class="paragraph">
<p>would return no matches because there are no records that contain both first_name "bob" and age 11.</p>
</div>
<div class="paragraph">
<p>However</p>
</div>
<div class="paragraph">
<p><code>first_name=bob&amp;age=10</code></p>
</div>
<div class="paragraph">
<p>would return only "Bob" and</p>
</div>
<div class="paragraph">
<p><code>first_name=bob&amp;age=16</code></p>
</div>
<div class="paragraph">
<p>would return only "Kabob".</p>
</div>
<h3 id="_special_common_queries" class="discrete">Special Common Queries</h3>
<h4 id="_search_for_null_or_blank_value" class="discrete">Search For Null or Blank Value</h4>
<div class="paragraph">
<p>Searching for a null value or a blank value is an exact match for "". Therefore you can simply search for "=". E.g. To find records with a null or blank first_name you would use the query first_name==. Or the full query:</p>
</div>
<div class="paragraph">
<p><code>index.php?-table=people&amp;first_name==</code></p>
</div>
<h4 id="_search_for_non_blank_value" class="discrete">Search for Non-blank Value</h4>
<div class="paragraph">
<p>Searching for a non-blank value is the same as searching for a value greater than "". Therefore you can simply search for "&gt;". E.g. if you wanted to find records with a first_name, you would use the query "first_name=&gt;". Or the full query:</p>
</div>
<div class="paragraph">
<p><code>index.php?-table=people&amp;first_name=&gt;</code></p>
</div>
<h3 id="_preserved_vs_non_preserved_parameters" class="discrete">Preserved vs Non-preserved Parameters</h3>
<div class="paragraph">
<p>As mentioned above any parameters that are prefixed by a hyphen (i.e. "=") are treated as directives rather than search filters. Hence if you want to use your own GET parameters you should always prefix them with a "-" to ensure that Xataface does not attempt to apply it as a search filter. In order to keep a consistent context for users, all browsing within the same table preserves both search queries and directives. Hence if you go to the URL:</p>
</div>
<div class="paragraph">
<p><code>index.php?-table=people&amp;-action=list&amp;first_name=bob</code></p>
</div>
<div class="paragraph">
<p>It will show you the list tab of the people table with only those records with first_name "bob". Now if you click on the details tab it will preserve your query "first_name". The query will become something like:</p>
</div>
<div class="paragraph">
<p><code>index.php?-table=people&amp;-action=details&amp;first_name=bob&amp;&#8230;&#8203;etc&#8230;&#8203; more parameters</code></p>
</div>
<div class="paragraph">
<p>(Although the parameters may appear in a different order). This allows you to navigate forward and back to previous and next records and stay within the same found set. It also ensures that if you click on the list tab to return to the list view, it will retain your place in the list.</p>
</div>
<div class="paragraph">
<p>Note that navigating within the same table it will also preserve your directives. E.g. If you specify the "-limit" directive to show 100 records per page:</p>
</div>
<div class="paragraph">
<p><code>index.php?-table=people&amp;-action=list&amp;-limit=100</code></p>
</div>
<div class="paragraph">
<p>And then you click on the details tab, it will retain your "-limit" parameter. Of course the "-limit" parameter is not actually used by the details action because it works on only one record at a time (it uses the "-cursor" parameter instead), when you click back on the list tab it will still show you 100 records per page.</p>
</div>
<div class="paragraph">
<p>Because of this, we call the "-limit" parameter a preserved parameter. It is retained when navigating within the same table. Note: parameters are retained in the HTTP Query string, not in sessions or cookies. This ensures that there are no surprises when you enter a URL to your Xataface application.</p>
</div>
<h4 id="_unpreserved_parameters" class="discrete">Unpreserved Parameters</h4>
<div class="paragraph">
<p>If you don&#8217;t want Xataface to preserve one of your parameters, you should prefix two hyphens to the parameter name. I.e. "--". One example of an unpreserved parameters throughout Xataface applications is the --msg parameter. The value of this parameter will be displayed on the page as an info message to the user. Clearly you don&#8217;t want this parameter preserved across requests, as you only want the user to see a message once. E.g.</p>
</div>
<div class="paragraph">
<p><code>index.php?--msg=Record+Successfully+saved</code></p>
</div>
<div class="paragraph">
<p>Would display the mesage "Record Successfully Saved" at the top of the page. If you click on any link in the application, it will not retain the --msg parameter so you will not see the message on subsequent requests.</p>
</div>
<div class="paragraph">
<p>This parameter is useful if you want to give feedback to the user about an action that has been carried out.</p>
</div>
<h4 id="_summary" class="discrete">Summary</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter Type</th>
<th class="tableblock halign-left valign-top">Prefix</th>
<th class="tableblock halign-left valign-top">Examples</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Preserved</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-limit</code>, <code>-skip</code>, <code>-cursor</code>, <code>-action</code>, <code>-table</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parameter value is preserved when user navigates away from the page (within the same table).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unpreserved Parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--msg</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parameter is NOT retrained with the user navigates away from the page.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_appendix_performance">Appendix: Performance</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section includes documentation for Xataface features related to performance tuning.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="scaler">Scaler Module</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="https://github.com/shannah/xataface-module-scaler">Scaler Module</a> provides a flexible and robust caching solution that will allow your application to handle much heavier loads than usual.  It uses the <a href="https://www.php.net/manual/en/book.memcache.php">PHP Memcache</a> extension to cache output in memory.</p>
</div>
<div class="paragraph">
<p>If you expect your application to receive heavy loads, then you should seriously consider using this module to help the application scale.</p>
</div>
<div class="paragraph">
<p>See the see the <a href="https://github.com/shannah/xataface-module-scaler/blob/master/README.adoc">Scaler module README file</a> for more information.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="output-cache">Output Cache</h2>
<div class="sectionbody">
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The <a href="https://github.com/shannah/xataface-module-scaler">Scaler Module</a> provides a superior caching solution to this output cache. See <a href="#scaler">Scaler Module</a> for more information.
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><strong>TLDR:</strong> Enable the output cache by adding the following to your conf.ini.php file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[_output_cache]
   enabled=1</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Xataface does quite a bit of heavy lifting on each page request. If your application is getting a lot of traffic that is slowing your server down, you may want to look at enabling the Xataface output cache.</p>
</div>
<div class="sect2">
<h3 id="_features">Features</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Improve speed of application dramatically - especially for seldom updated sites.</p>
</li>
<li>
<p>Supports multiple languages.</p>
</li>
<li>
<p>Supports multiple users (each user has own cache).</p>
</li>
<li>
<p>Provides GZIP compression for improved performance.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_how_it_works_2">How it works?</h3>
<div class="paragraph">
<p>When you receive a request, Xataface will return a cached version of the page if the page has been accessed before. If the page doesn&#8217;t yet exist in the cache it generates the page, saves it to the cache and outputs it to the user transparently. The cache is completely transparent to your users.</p>
</div>
</div>
<div class="sect2">
<h3 id="_faq">FAQ</h3>
<h4 id="_where_is_the_cache_stored" class="discrete">Where is the cache stored?</h4>
<div class="paragraph">
<p>Xataface creates a table called <code>__output_cache</code> that stores all of the cached content for your application. This table stores both a GZIPed and regular version of each page. If the user&#8217;s browser supports GZIP compression, Xataface will automatically return the GZIP version. This results in further performance improvements.</p>
</div>
<h4 id="_what_if_i_make_changes_to_the_database" class="discrete">What if I make changes to the database?</h4>
<div class="paragraph">
<p>Xataface records which tables were in use when a page is cached. If any of those tables are modified after the page is cached, Xataface will mark that cached page as out of date and regenerate it the next time that it is requested.</p>
</div>
<h4 id="_what_if_i_make_changes_to_my_configuration_files_and_templates" class="discrete">What if I make changes to my configuration files and templates?</h4>
<div class="paragraph">
<p>The output cache will have to be manually cleared if you make any changes to your source files (e.g. PHP, templates, and INI files). Clearing the cache is as easy as deleting or emptying the <code>__output_cache</code> table.</p>
</div>
<h4 id="_how_do_i_enable_the_cache" class="discrete">How do I enable the Cache?</h4>
<div class="paragraph">
<p>Add the following to your conf.ini file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">[_output_cache]
  enabled=1</code></pre>
</div>
</div>
<h4 id="_how_do_i_disable_the_cache" class="discrete">How do I disable the Cache?</h4>
<div class="paragraph">
<p>Simply comment out or remove the [_output_cache] section of your conf.ini file. E.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">;[_output_cache]
;   enabled=1</code></pre>
</div>
</div>
<h4 id="_configuration_options" class="discrete">Configuration Options</h4>
<div class="paragraph">
<p>The following directives can be added to the <code>[_output_cache]</code> section of your conf.ini file to customize how your output cache works.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">lifeTime</dt>
<dd>
<p>Number of seconds before cached page is considered out of date.</p>
<div class="paragraph">
<p><strong>Since</strong> 0.7</p>
</div>
</dd>
<dt class="hdlist1">tableName</dt>
<dd>
<p>The name of the table to store the cached pages. Default '__output_cache'.</p>
<div class="paragraph">
<p><strong>Since</strong> 0.7</p>
</div>
</dd>
<dt class="hdlist1">ignoredTables</dt>
<dd>
<p>A comma-delimited list of tables that don&#8217;t affect the output cache (i.e. these tables can be changed without causing the output cache to be refreshed.</p>
<div class="paragraph">
<p><strong>Since</strong> 0.7</p>
</div>
</dd>
<dt class="hdlist1">observedTables</dt>
<dd>
<p>A comma-delimited list of tables that should affect the status of the output cache for every page (whether the table is explicitly used by the page or not). This is a useful way to tell Xataface to refresh your cache.</p>
<div class="paragraph">
<p><strong>Since</strong> 0.7</p>
</div>
</dd>
<dt class="hdlist1">exemptActions</dt>
<dd>
<p>A comma-delimited list of actions that are exempt from the output cache (and thus should not be cached).</p>
<div class="paragraph">
<p><strong>Since</strong> 0.7</p>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="opcache">PHP Opcache</h2>
<div class="sectionbody">
<div class="paragraph">
<p>PHP 7 comes with shiny, new, built-in <a href="https://www.php.net/manual/en/book.opcache.php">opcache</a> that can drastically improve your performance.  All you need to do is enable it in your php.ini file.</p>
</div>
<div class="paragraph">
<p>Simply activating the opcache on your server should reduce application latency noticeably.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can enable your opcache by opening your php.ini file, and look for the following line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>;zend_extension=opcache.so</pre>
</div>
</div>
<div class="paragraph">
<p>Uncomment this line and restart your web server.</p>
</div>
<div class="paragraph">
<p>See <a href="#whereis-phpini">Where is my php.ini located?</a> if you don&#8217;t know where your php.ini file is located.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_getting_more_out_of_opcache">Getting More Out of Opcache</h3>
<div class="paragraph">
<p>When you enable the opcache you will get a performance boost due to PHP being able to cache compiled versions your app&#8217;s PHP files in RAM.  However, you can crank even more performance out of opcache by instructing Xataface to cache its configuration information in the opcache as well.</p>
</div>
<div class="paragraph">
<p>Add the following to the beginning of your app&#8217;s index.php file in order to enable the opcache for caching Xataface configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php">define('XF_USE_OPCACHE', function_exists('opcache_reset'));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Xataface will look for this <code>XF_USE_OPCACHE</code> constant and, if defined, and <code>true</code>, it will use the opcache to cache its configuration data.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
If <code>XF_USE_OPCACHE</code> is defined and <code>true</code>, changes that you make to your PHP files, database structure, and configuration files may not be reflected until you clear your cache, or increment your application version in <code>version.txt</code>.  **This includes disabling the <code>XF_USE_OPCACHE</code> directive because the PHP file may be cached in the opcache.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_refreshing_the_opcache">Refreshing the Opcache</h3>
<div class="paragraph">
<p>If you make changes to your app&#8217;s PHP or INI files, or make changes to the database structure (e.g. adding or removing columns), then you will need to refresh the opcache for the changes to be picked up.</p>
</div>
<div class="paragraph">
<p>There are two ways to refresh the opcache:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use the <code>clear_cache</code> action.  E.g. <code>index.php?-action=clear_cache</code>, when logged in as someone with the "manage" permission.  You can also access this action in the "Control Panel".</p>
</li>
<li>
<p>Increment the version number in your version.txt file.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-02-06 06:58:10 -0800
</div>
</div>
</body>
</html>