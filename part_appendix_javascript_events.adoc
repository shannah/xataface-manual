[part_appendix_javascript_environment]
= Appendix 3: Javascript Environment

Xataface defines a small set of Javascript events to notify subscribers of lifecycle events.


== Javascript Components

Xataface includes a set of Javascript components that can be reused in many different contexts.  This section lists some of theme.  

TODO: Add documentation on javascript components

=== window.xataface

The `window.xataface` object includes a number of utility classes and functions.  Some functions are always available.  Others require you to explicitly to load a script in order for them to be available.

[discrete]
==== Properties

viewport::
The current display viewport dimensions.  If the mobile footer and header are visible, then this viewport will be the bounds not covered by the header or footer.  Properties include `top`, `left`, `right`, `bottom`, `width`, and `height`.
+

.Example Using viewport to position an element
[source,javascript]
----
var viewport = xataface.viewport;
if (viewport) {
    // Position the settings wrapper 10 pixels above the footer
    settingsWrapper.style.bottom = (viewport.bottom + 10) + 'px';
}
----

=== xataface.InfiniteScroll

A component that supports infinite scrolling.  This is used by default in the mobile theme's list view.

**Since 3.0**

[discrete]
==== Bootstrapping

.Loading Script in PHP
[source,php]
----
xf_script('xataface/components/InfiniteScroll.js');
----

.Loading Script in Javascript using `require`
[source,javascript]
----
//require <xataface/components/InfiniteScroll.js>
----


[discrete]
==== Properties

scrollEl::
HTMLElement to which the scroll listener should be added.  Defaults to `<body>`

parentEl::
HTMLElement that should have elements added to it.  Defaults to the `.mobile-listing` div, which is the result list in mobile view.

action::
The Xataface action to use for fetching new rows.

pageSize::
The number of records to load each time.  Default is 30.

[discrete]
==== Methods

loadMore()::
Loads the next page of results.  If either no rows are loaded, or there is a problem loading rows (due to a network error), the InfiniteScroll's `reachedEnd` flag is set, which will prevent it from attempting to load any more records.

[discrete]
==== Usage Example

[source,javascript]
----
new xataface.InfiniteScroll({
   scrollEl : $('body').get(0),
   parentEl : $('.mobile-listing').get(0) 
});
----
        

=== xataface.Sheet

image::images/Image-160820-125111.003.png[]

A component for displaying content in a Sheet.  Sheets can be displayed from the bottom, left, top, or right positions, and they transition in over top of the existing page content.

**Since 3.0**

[discrete]
==== Bootstrapping

.Loading Script in PHP
[source,php]
----
xf_script('xataface/components/Sheet.js');
----

.Loading Script in Javascript using `require`
[source,javascript]
----
//require <xataface/components/Sheet.js>
----

[discrete]
==== Initialization Options

Use `new Sheet(options)` to create a new sheet.  The following options are allowed:

position:: The position where the sheet should be displayed. `top`, `left`, `right`, `bottom`.

url:: The URL to load in the sheet.  *String*



[discrete]
==== Properties

installed::
A read-only property indicating whether the sheet is currently installed in the document.

position::
The position where the sheet should be displayed in the window. One of 'top', 'bottom', 'left', or 'right'.

[discrete]
==== Methods

load(url:string)::
Load the given URL inside the Sheet.  This will be loaded inside an iframe.

show()::
Show the sheet.

close()::
Close the sheeet

[discrete]
==== Usage Example

.Function that opens the sort options dialog inside a sheet.
[source,javascript]
----
//require <xataface/actions/Sheet.js>

// ...

function openSortDialog() {
    var qStr = window.location.search;
    if (qStr.indexOf('-action=') !== -1) {
        qStr = qStr.replace(/-action=[^&]*/, '-action=mobile_sort_dialog');
    } else {
        qStr += '&-action=mobile_sort_dialog';
    }
    var sheet = new xataface.Sheet({
        url : qStr
    });
    sheet.show();
}
----
    

[#javascript-events]
[discrete]
== Javascript Events

xf-mobileenter::
Triggered on the `window` object when transitioning from "desktop" mode to "mobile" mode.  See <<responsive-ui>> for more information about mobile mode.
+
[source,javascript]
----
window.addEventListener('xf-mobileenter', function() {
    // Entering mobile mode
});
----

xf-mobileexit::
Triggered on the `window` object when transitioning from "mobile" mode to "desktop" mode. See <<responsive-ui>> for more information about mobile mode.
+
[source,javascript]
----
window.addEventListener('xf-mobileexit', function() {
    // Exiting mobile mode
});
----

xf-viewport-changed::
Triggered in mobile mode when the viewport area is changed.  The viewport is considered the area below the *mobile-header* and *mobile-footer* blocks, which are positioned "fixed" at the top and bottom of the screen respectively.  This event will allow you to reposition components whose position should depend on the size of the view port.
+
One example use of this event is the FAB button that needs to be positioned in the bottom-right corner of the viewport.  The following Javascript code will reposition the FAB whenever the viewport size is changed.
+
[source,javascript]
----
function updatePosition() {
    var zoom = document.querySelector('.zoom');
    
    if (zoom) {
        var footer = document.querySelector('.mobile-footer');
        if (footer) {
            zoom.style.bottom = (footer.offsetHeight + 10) + "px";
        }    
    }
}
window.addEventListener('xf-viewport-changed', updatePosition);
----




