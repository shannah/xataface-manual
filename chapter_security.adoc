[#security]
== Security

The following chapters cover all things security-related in Xataface.

[#oauth2]
=== OAuth2 Authentication

Xataface supports Oauth2 authentication via the https://github.com/shannah/xataface-module-oauth[oauth module].  This module provides all of core functionality to support OAuth2.  
There are also modules built to provide Oauth support for specific services, such as https://github.com/shannah/xataface-module-oauth-facebook[Facebook], https://github.com/shannah/xataface-module-oauth-twitter[Twitter], https://github.com/shannah/xataface-module-oauth-linkedin[LinkedIn], and https://github.com/shannah/xataface-module-oauth-instagram[Instagram]. These "sub" modules all depend on the core https://github.com/shannah/xataface-module-oauth[oauth module].  They simply provide a few specific configuration settings to support OAuth2 on those services.

[TIP]
====
OAuth 2.0 is the industry-standard protocol for authorization. OAuth 2.0 focuses on client developer simplicity while providing specific authorization flows for web applications, desktop applications, mobile phones, and living room devices. This specification and its extensions are being developed within the IETF OAuth Working Group.

For more information about the Oauth2 spec, see https://oauth.net/2/[the official OAuth 2.0 website].
====

==== Adding OAuth2 Login Support

The first step toward adding OAuth2 support in your app, is to download the https://github.com/shannah/xataface-module-oauth[oauth module] into the `modules` directory of your application. E.g.

`modules/oauth/oauth.php`

And add a a corresponding entry to the `[_modules]` section of your conf.ini file:

[source,ini]
----
[_modules]
  modules_oauth=modules/oauth/oauth.php
----

You'll also need to add the `pre_auth_types` entry to the `[_auth]` section oc your conf.ini file:

.Adding `pre_auth_types=oauth_token` to the `_auth` section of your conf.ini file instructs Xataface to attempt authentication using the oauth
[source,ini]
----
[_auth]
    users_table=users
    username_column=username
    password_column=password
    pre_auth_types=oauth_token
----

=== API Authentication

.Login sequence using example curl HTTP request.
image::images/Image-140420-113308.724.png[]

Xataface provides a REST API for authentication so that you can access your application using a REST client.  When using this API, you'll perform a request to the "login" action to obtain an authentication token.  You can then make authenticated requests to your app by adding this token in the Authorization header as a bearer token.

[discrete]
==== Login

To log in using the API, simply perform a POST request to `?-action=login&--no-prompt=1`

1. `UserName` - The username to log in with.
2. `Password` - The password to log in with.

If login succeeds, you'll receive a JSON response with a token.  E.g.

[source,json]
----
{
  "code":200,
  "token":"576646...2dDRuOGUycGI=",
  "message":"Logged in"
}
----

An unsuccessful login will look something like:

[source,json]
----
{"code":500,"message":"No UserName provided."}
----

[discrete]
==== Making Authenticated Requests

Once you have obtained a token, you should include this token in the `Authorization` header of HTTP requests.  E.g.

[source,bash]
----
curl -H 'Authorization: Bearer {TOKEN}' https://example.com?index.php
----

But replace `{TOKEN}` with your token received during login.

[discrete]
==== Logging Out

To log out, simply perform a POST or GET request to `?-action=logout&--no-prompt=1`



